<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DUTCHMAXXING — Een Literair Avontuur</title>
<meta name="description" content="Een interactief Nederlands leeravontuur — oefen werkwoorden, lees het nieuws, en maxx je Dutch skills van A2 tot C1.">
<meta property="og:type" content="website">
<meta property="og:title" content="DUTCHMAXXING — Een Literair Avontuur">
<meta property="og:description" content="Een interactief Nederlands leeravontuur — oefen werkwoorden, lees het nieuws, en maxx je Dutch skills van A2 tot C1.">
<meta property="og:image" content="https://artificialnouveau.github.io/dutchmaxxing/og-image.png">
<meta property="og:url" content="https://artificialnouveau.github.io/dutchmaxxing/">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="DUTCHMAXXING — Een Literair Avontuur">
<meta name="twitter:description" content="Een interactief Nederlands leeravontuur — oefen werkwoorden, lees het nieuws, en maxx je Dutch skills van A2 tot C1.">
<meta name="twitter:image" content="https://artificialnouveau.github.io/dutchmaxxing/og-image.png">
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Syne:wght@400;500;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #FAFAFA;
  --parchment: #222;
  --amber: #D40920;
  --teal: #1356A2;
  --wine: #D40920;
  --gold: #F7D842;
  --charcoal: #FAFAFA;
  --cream: #333;
  --ink: #111;
  --muted: #666;
  --green: #2d8a56;
  --red: #D40920;
  --blue: #1356A2;
  --purple: #1356A2;
  --card-bg: #fff;
  --card-shadow: none;
  --text-shadow: none;
  --glass: #fff;
  --glass-border: #000;
  --coral: #D40920;
  --pink: #D40920;
  --lavender: #1356A2;
  --mondrian-red: #D40920;
  --mondrian-blue: #1356A2;
  --mondrian-yellow: #F7D842;
  --mondrian-black: #000;
  --mondrian-white: #fff;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Space Grotesk', 'Inter', -apple-system, sans-serif;
  background: var(--bg);
  color: var(--ink);
  min-height: 100vh;
  overflow-x: hidden;
  font-size: 14px;
  line-height: 1.6;
}

body::before, body::after { display: none; }

/* Header */
.game-header {
  display: grid;
  grid-template-columns: 12px 1fr 12px;
  grid-template-rows: 12px auto 12px;
  background: var(--mondrian-black);
  gap: 3px;
  position: relative;
  z-index: 1;
}

.game-header::before { display: none; }

.header-corner-tl { background: var(--mondrian-red); grid-area: 1/1; }
.header-corner-tr { background: var(--mondrian-yellow); grid-area: 1/3; }
.header-corner-bl { background: var(--mondrian-blue); grid-area: 3/1; }
.header-corner-br { background: var(--mondrian-yellow); grid-area: 3/3; }
.header-bar-top { background: var(--mondrian-red); grid-area: 1/2; }
.header-bar-bottom { background: var(--mondrian-blue); grid-area: 3/2; }
.header-side-l { background: var(--mondrian-white); grid-area: 2/1; }
.header-side-r { background: var(--mondrian-white); grid-area: 2/3; }

.header-center {
  grid-area: 2/2;
  background: var(--mondrian-white);
  text-align: center;
  padding: 22px 20px 16px;
}

.game-title {
  font-family: 'Syne', sans-serif;
  font-size: clamp(24px, 5vw, 44px);
  font-weight: 800;
  color: var(--mondrian-black);
  margin-bottom: 6px;
  letter-spacing: 8px;
  text-transform: uppercase;
}

.game-subtitle {
  font-family: 'Space Grotesk', sans-serif;
  font-size: clamp(11px, 2vw, 14px);
  color: #666;
  font-weight: 400;
  letter-spacing: 2px;
}
.game-subtitle span { color: var(--mondrian-red); font-weight: 600; }

.stats-bar {
  display: flex;
  justify-content: center;
  gap: 20px;
  padding: 10px;
  flex-wrap: wrap;
  margin-top: 8px;
}

.stat {
  font-size: 12px;
  display: flex;
  align-items: center;
  gap: 6px;
  color: #555;
  font-weight: 400;
}

.stat-icon { font-size: 14px; }
.stat-value { color: var(--mondrian-red); font-weight: 600; }

/* Tabs */
.tab-bar {
  display: flex;
  justify-content: center;
  gap: 0;
  padding: 0;
  overflow-x: auto;
  background: var(--mondrian-white);
  border-bottom: 4px solid var(--mondrian-black);
  position: relative;
  z-index: 1;
}

.tab-btn {
  font-family: 'Space Grotesk', sans-serif;
  font-size: clamp(10px, 1.4vw, 13px);
  font-weight: 600;
  padding: 12px 18px;
  background: transparent;
  color: #666;
  border: none;
  border-right: 2px solid var(--mondrian-black);
  border-bottom: 4px solid transparent;
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.2s ease;
  letter-spacing: 0.5px;
  text-transform: uppercase;
}

.tab-btn:hover { color: #000; background: var(--mondrian-yellow); }

.tab-btn.active {
  color: #fff;
  background: var(--mondrian-red);
  border-bottom-color: transparent;
}

.tab-content {
  display: none;
  padding: 28px 20px;
  min-height: 70vh;
  background: var(--bg);
  animation: fadeIn 0.4s ease;
  position: relative;
  z-index: 1;
}
.tab-content.active { display: block; }

@keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: none; } }

/* ===== CARD SYSTEM ===== */
.card {
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
  padding: 24px;
  position: relative;
  transition: transform 0.2s ease;
}

.card:hover {
  transform: translateY(-2px);
}

.card-header {
  font-family: 'Syne', sans-serif;
  font-size: 20px;
  font-weight: 700;
  color: var(--mondrian-black);
  margin-bottom: 12px;
  border-bottom: 3px solid var(--mondrian-black);
  padding-bottom: 8px;
}

.card-body {
  font-size: 14px;
  line-height: 1.7;
  color: #333;
}

/* ===== TAB 1: THOUGHT CABINET ===== */
.cabinet-container { max-width: 900px; margin: 0 auto; }

.thought-card-area {
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
  padding: 20px;
  margin-bottom: 12px;
  position: relative;
  overflow: hidden;
}

.thought-card-area::before { display: none; }

.thought-card {
  background: var(--mondrian-yellow);
  border: 3px solid var(--mondrian-black);
  padding: 16px 24px;
  max-width: 500px;
  margin: 0 auto;
  text-align: center;
  position: relative;
}

.thought-card .verb-emoji {
  font-size: 32px;
  margin-bottom: 4px;
}

.thought-card .verb-name {
  font-family: 'Syne', sans-serif;
  font-size: 26px;
  font-weight: 800;
  color: var(--mondrian-black);
  margin-bottom: 2px;
  letter-spacing: 1px;
}

.thought-card .verb-meaning {
  color: #555;
  font-size: 13px;
  margin-bottom: 8px;
  font-weight: 400;
}

.thought-card .verb-flavor {
  font-style: italic;
  color: var(--mondrian-red);
  font-size: 12px;
  margin-bottom: 10px;
  padding: 6px 12px;
  background: rgba(212,9,32,0.08);
  border-left: 4px solid var(--mondrian-red);
}

.thought-card .challenge-text {
  font-family: 'Syne', sans-serif;
  font-size: 15px;
  color: var(--mondrian-black);
  margin-bottom: 6px;
  font-weight: 600;
}

.pattern-badge {
  display: inline-block;
  font-size: 11px;
  padding: 4px 14px;
  border: 2px solid;
  font-weight: 600;
  margin-top: 8px;
  letter-spacing: 0.5px;
}

.thought-card .hint-btn {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 12px;
  padding: 6px 16px;
  background: transparent;
  color: var(--mondrian-blue);
  border: 2px solid var(--mondrian-blue);
  cursor: pointer;
  margin-top: 8px;
  transition: all 0.2s;
  font-weight: 600;
}
.thought-card .hint-btn:hover { background: var(--mondrian-blue); color: #fff; }

.hint-bubble {
  display: none;
  background: var(--mondrian-white);
  border: 2px solid var(--mondrian-black);
  padding: 16px 18px;
  font-size: 13px;
  line-height: 1.8;
  margin-top: 14px;
  text-align: left;
  color: #333;
}
.hint-bubble.show { display: block; }
.hint-bubble .hl { color: var(--mondrian-red); font-weight: 600; }

/* Answer input area */
.answer-grid {
  max-width: 500px;
  margin: 12px auto 0;
}

.answer-input-wrap {
  display: flex;
  gap: 10px;
  align-items: center;
}

.answer-input {
  flex: 1;
  font-family: 'Space Grotesk', sans-serif;
  font-size: 18px;
  padding: 14px 20px;
  background: var(--mondrian-white);
  color: var(--mondrian-black);
  border: 3px solid var(--mondrian-black);
  outline: none;
  transition: all 0.2s;
  text-align: center;
  letter-spacing: 1px;
  font-weight: 500;
}
.answer-input:focus { border-color: var(--mondrian-blue); }
.answer-input::placeholder { color: #aaa; font-weight: 300; }
.answer-input.correct { border-color: var(--green); background: #eaffea; animation: correctGlow 0.5s; }
.answer-input.wrong { border-color: var(--mondrian-red); background: #fff0f0; animation: shake 0.4s; }

.answer-submit-btn {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 14px;
  font-weight: 600;
  padding: 14px 24px;
  background: var(--mondrian-blue);
  color: #fff;
  border: 3px solid var(--mondrian-black);
  cursor: pointer;
  transition: all 0.2s;
  letter-spacing: 1px;
}
.answer-submit-btn:hover { background: var(--mondrian-red); }
.answer-submit-btn:disabled { opacity: 0.4; cursor: not-allowed; }

/* Legacy answer-btn for other uses */
.answer-btn {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 15px;
  padding: 14px;
  background: var(--mondrian-white);
  color: var(--mondrian-black);
  border: 2px solid var(--mondrian-black);
  cursor: pointer;
  transition: all 0.2s ease;
  text-align: center;
}

.answer-btn:hover {
  background: var(--mondrian-yellow);
}

.answer-btn.correct {
  border-color: var(--green);
  background: #eaffea;
  animation: correctGlow 0.5s;
}

.answer-btn.wrong {
  border-color: var(--mondrian-red);
  background: #fff0f0;
  animation: shake 0.4s;
}

@keyframes correctGlow {
  0%, 100% { box-shadow: 0 0 0 transparent; }
  50% { box-shadow: 0 0 0 3px rgba(45,138,86,0.3); }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-6px); }
  50% { transform: translateX(6px); }
  75% { transform: translateX(-3px); }
}

/* Combo & feedback */
.combo-display {
  text-align: center;
  font-family: 'Syne', sans-serif;
  font-size: 13px;
  margin: 6px 0 0;
  min-height: 20px;
  color: #555;
}

.combo-fire { color: var(--mondrian-red); }
.combo-blaze { color: var(--mondrian-red); font-size: 15px; font-weight: 700; }
.combo-legendary { color: var(--mondrian-black); font-size: 17px; font-weight: 800; }

.feedback-text {
  text-align: center;
  font-size: 13px;
  padding: 4px 10px;
  margin: 0;
  min-height: 32px;
  line-height: 1.6;
  color: #333;
}

/* Pattern legend */
.pattern-legend {
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
  padding: 14px;
  margin-top: 12px;
}

.pattern-legend h3 {
  font-family: 'Syne', sans-serif;
  font-size: 14px;
  color: var(--mondrian-black);
  margin-bottom: 12px;
  font-weight: 600;
  letter-spacing: 0.5px;
}

.pattern-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.pattern-tag {
  font-size: 11px;
  padding: 5px 12px;
  border: 2px solid var(--mondrian-black);
  cursor: pointer;
  opacity: 0.6;
  transition: all 0.2s;
  font-weight: 600;
}
.pattern-tag:hover, .pattern-tag.active {
  opacity: 1;
  background: var(--mondrian-yellow);
}

/* Arena controls */
.arena-controls {
  display: flex;
  gap: 8px;
  justify-content: center;
  margin-bottom: 16px;
  flex-wrap: wrap;
}

.ctrl-btn {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 12px;
  padding: 8px 16px;
  background: var(--mondrian-white);
  color: #555;
  border: 2px solid var(--mondrian-black);
  cursor: pointer;
  transition: all 0.2s;
  font-weight: 600;
  letter-spacing: 0.5px;
}
.ctrl-btn:hover { background: var(--mondrian-yellow); color: var(--mondrian-black); }
.ctrl-btn.active { background: var(--mondrian-red); color: #fff; border-color: var(--mondrian-black); }

/* Export buttons */
.export-btn {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 12px;
  padding: 8px 18px;
  background: var(--mondrian-white);
  color: var(--mondrian-blue);
  border: 2px solid var(--mondrian-blue);
  cursor: pointer;
  transition: all 0.2s;
  font-weight: 600;
}
.export-btn:hover { background: var(--mondrian-blue); color: #fff; }

.export-bar {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 16px;
  padding-top: 16px;
  border-top: 3px solid var(--mondrian-black);
}

/* ===== TAB 2: DE STAD (ADVENTURES) ===== */
.adventure-container { max-width: 750px; margin: 0 auto; }

.adventure-card {
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
  padding: 28px 32px;
  margin-bottom: 20px;
}

.adventure-card .scene-icon {
  font-size: 42px;
  text-align: center;
  margin-bottom: 8px;
}

.adventure-card .scene-location {
  font-family: 'Syne', sans-serif;
  font-size: 18px;
  font-weight: 700;
  color: var(--mondrian-black);
  text-align: center;
  margin-bottom: 4px;
}

.adventure-card .scene-sublocation {
  font-size: 12px;
  color: #666;
  text-align: center;
  margin-bottom: 16px;
  font-weight: 400;
}

.adventure-card .narrative {
  font-size: 15px;
  line-height: 1.8;
  color: #333;
  margin-bottom: 20px;
}

.adventure-card .narrative em { color: var(--mondrian-red); }

.adventure-card .dialogue {
  background: rgba(19,86,162,0.08);
  border-left: 4px solid var(--mondrian-blue);
  padding: 14px 18px;
  margin: 12px 0;
  font-style: italic;
  color: #222;
  font-size: 15px;
  line-height: 1.7;
}

.adventure-card .dialogue .speaker {
  font-weight: 600;
  font-style: normal;
  color: var(--mondrian-blue);
}

/* Choice cards */
.choice-grid {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 16px;
}

.choice-card {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 14px;
  padding: 16px 20px;
  background: var(--mondrian-white);
  color: #333;
  border: 2px solid var(--mondrian-black);
  cursor: pointer;
  text-align: left;
  line-height: 1.6;
  transition: all 0.2s ease;
}

.choice-card:hover {
  background: var(--mondrian-yellow);
  transform: translateX(4px);
}

.choice-card .choice-dutch {
  font-weight: 600;
  color: var(--mondrian-black);
  display: block;
  margin-bottom: 4px;
  font-size: 15px;
}

.choice-card .choice-hint {
  font-size: 12px;
  color: #666;
  font-weight: 400;
}

.choice-card.correct { border-color: var(--green); background: #eaffea; }
.choice-card.wrong { border-color: var(--mondrian-red); background: #fff0f0; }
.choice-card:disabled, .choice-card[disabled] { pointer-events: none; opacity: 0.6; }

/* Adventure progress */
.adventure-progress {
  display: flex;
  gap: 6px;
  justify-content: center;
  margin-bottom: 16px;
}

.adv-dot {
  width: 10px; height: 10px;
  background: #ddd;
  border: 2px solid var(--mondrian-black);
  transition: all 0.3s;
}
.adv-dot.visited { background: var(--mondrian-blue); border-color: var(--mondrian-black); }
.adv-dot.current { background: var(--mondrian-red); border-color: var(--mondrian-black); }

/* Scenario selector */
.scenario-bar {
  display: flex;
  gap: 8px;
  justify-content: center;
  margin-bottom: 16px;
  flex-wrap: wrap;
}

.scenario-btn {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 12px;
  padding: 8px 14px;
  background: var(--mondrian-white);
  color: #555;
  border: 2px solid var(--mondrian-black);
  cursor: pointer;
  transition: all 0.2s;
  font-weight: 600;
}
.scenario-btn:hover { background: var(--mondrian-yellow); color: var(--mondrian-black); }
.scenario-btn.active { background: var(--mondrian-red); color: #fff; border-color: var(--mondrian-black); }

.adventure-feedback {
  text-align: center;
  font-size: 14px;
  padding: 10px;
  min-height: 40px;
  color: #333;
  line-height: 1.7;
}

/* ===== LEESHOEK (NEWS) ===== */
.news-container { max-width: 800px; margin: 0 auto; }

.news-article-box {
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
  padding: 24px;
  margin-bottom: 20px;
}

.news-article-box h3 {
  font-family: 'Syne', sans-serif;
  font-size: 20px;
  color: var(--mondrian-black);
  margin-bottom: 12px;
  line-height: 1.5;
  font-weight: 700;
}

.news-level-badge {
  display: inline-block;
  font-size: 11px;
  padding: 3px 12px;
  border: 2px solid var(--mondrian-blue);
  color: var(--mondrian-blue);
  margin-bottom: 10px;
  font-weight: 600;
}

.news-text {
  font-size: 15px;
  line-height: 2;
  margin-bottom: 16px;
  color: #333;
}

.news-text .vocab-word {
  color: var(--mondrian-red);
  border-bottom: 2px solid var(--mondrian-red);
  cursor: pointer;
  position: relative;
  font-weight: 600;
}

.vocab-tooltip {
  display: none;
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: var(--mondrian-blue);
  color: #fff;
  padding: 6px 12px;
  font-size: 12px;
  white-space: nowrap;
  z-index: 100;
  font-weight: 400;
}
.vocab-word:hover .vocab-tooltip { display: block; }

.news-questions { border-top: 3px solid var(--mondrian-black); padding-top: 16px; }

.news-questions h4 {
  font-family: 'Syne', sans-serif;
  font-size: 16px;
  color: var(--mondrian-black);
  margin-bottom: 14px;
  font-weight: 600;
}

.news-q { margin-bottom: 16px; }
.news-q p { font-size: 14px; margin-bottom: 8px; line-height: 1.6; color: #333; }

.news-q-options { display: flex; flex-direction: column; gap: 6px; }

.news-q-btn {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 14px;
  padding: 10px 14px;
  background: var(--mondrian-white);
  color: #333;
  border: 2px solid var(--mondrian-black);
  cursor: pointer;
  text-align: left;
  line-height: 1.5;
  transition: all 0.15s;
}
.news-q-btn:hover { background: var(--mondrian-yellow); }
.news-q-btn.correct { border-color: var(--green); background: #eaffea; }
.news-q-btn.wrong { border-color: var(--mondrian-red); background: #fff0f0; }
.news-q-btn:disabled { cursor: default; opacity: 0.6; }

.news-nav {
  display: flex;
  gap: 8px;
  justify-content: center;
  margin-bottom: 14px;
  flex-wrap: wrap;
}

.news-nav-btn {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 12px;
  padding: 8px 14px;
  background: var(--mondrian-white);
  color: #555;
  border: 2px solid var(--mondrian-black);
  cursor: pointer;
  transition: all 0.2s;
  font-weight: 600;
}
.news-nav-btn:hover { background: var(--mondrian-yellow); color: var(--mondrian-black); }
.news-nav-btn.active { background: var(--mondrian-blue); color: #fff; }

.news-sub-nav { display: flex; justify-content: center; gap: 0; }
.news-sub-btn {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 13px;
  font-weight: 700;
  padding: 8px 18px;
  background: var(--mondrian-white);
  color: #555;
  border: 2px solid var(--mondrian-black);
  cursor: pointer;
  transition: all 0.2s;
}
.news-sub-btn + .news-sub-btn { border-left: none; }
.news-sub-btn:hover { background: var(--mondrian-yellow); color: var(--mondrian-black); }
.news-sub-btn.active { background: var(--mondrian-blue); color: #fff; }

.nos-header { margin-bottom: 16px; }
.nos-desc { font-size: 14px; color: #555; margin-bottom: 10px; line-height: 1.5; }

.nos-card {
  background: var(--mondrian-white);
  border: 2px solid var(--mondrian-black);
  padding: 18px;
  margin-bottom: 12px;
  transition: box-shadow 0.2s;
  cursor: pointer;
}
.nos-card:hover { box-shadow: 4px 4px 0 var(--mondrian-black); }
.nos-card-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; margin-bottom: 8px; }
.nos-card h4 { font-family: 'Syne', sans-serif; font-size: 16px; margin: 0; line-height: 1.3; color: var(--mondrian-black); }
.nos-card-time { font-size: 11px; color: #888; white-space: nowrap; flex-shrink: 0; }
.nos-card p { font-size: 14px; color: #444; line-height: 1.6; margin: 0 0 10px 0; }
.nos-card-link {
  display: inline-block;
  font-size: 12px;
  font-weight: 700;
  color: var(--mondrian-blue);
  text-decoration: none;
  border-bottom: 2px solid var(--mondrian-blue);
  padding-bottom: 1px;
}
.nos-card-link:hover { color: var(--mondrian-red); border-color: var(--mondrian-red); }
.nos-card-accent { width: 100%; height: 4px; margin-bottom: 12px; }

.nos-error-box {
  background: rgba(212,9,32,0.08);
  border: 2px solid var(--mondrian-red);
  padding: 18px;
  text-align: center;
  color: var(--mondrian-red);
  font-weight: 600;
}
.nos-stale-banner {
  background: rgba(247,216,66,0.15);
  border: 2px solid var(--mondrian-yellow);
  padding: 12px 18px;
  margin-bottom: 14px;
  text-align: center;
  color: #666;
  font-size: 13px;
}
.nos-stale-retry {
  background: var(--mondrian-blue);
  color: #fff;
  border: none;
  padding: 4px 12px;
  margin-left: 8px;
  cursor: pointer;
  font-family: inherit;
  font-size: 12px;
  font-weight: 600;
}

.nos-spinner {
  width: 32px; height: 32px;
  border: 4px solid #eee;
  border-top: 4px solid var(--mondrian-blue);
  border-radius: 50%;
  animation: nosSpin 0.8s linear infinite;
  margin: 0 auto;
}
@keyframes nosSpin { to { transform: rotate(360deg); } }

.news-vocab-box {
  background: rgba(247,216,66,0.15);
  border: 2px solid var(--mondrian-black);
  padding: 14px;
  margin-top: 14px;
}

.news-vocab-box h4 {
  font-family: 'Syne', sans-serif;
  font-size: 14px;
  color: var(--mondrian-blue);
  margin-bottom: 10px;
  font-weight: 600;
}

.news-vocab-list {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 4px;
  font-size: 13px;
  line-height: 1.8;
}

.news-vocab-list .nl-word { color: var(--mondrian-red); font-weight: 600; }
.news-vocab-list .en-word { color: #666; }

/* ===== TAB 5: DAILY CHALLENGE ===== */
.daily-container { max-width: 700px; margin: 0 auto; text-align: center; }

.daily-header {
  font-family: 'Syne', sans-serif;
  font-size: 20px;
  color: var(--mondrian-black);
  margin-bottom: 8px;
  font-weight: 700;
}

.daily-streak {
  font-size: 14px;
  color: var(--mondrian-red);
  margin-bottom: 20px;
  font-weight: 400;
}

.daily-challenge-box {
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
  padding: 28px;
  margin-bottom: 20px;
}

.daily-type {
  font-size: 12px;
  color: #666;
  margin-bottom: 12px;
  font-weight: 400;
  letter-spacing: 1px;
  text-transform: uppercase;
}

.daily-question {
  font-family: 'Syne', sans-serif;
  font-size: 18px;
  margin-bottom: 20px;
  line-height: 1.6;
  color: var(--mondrian-black);
  font-weight: 600;
}

.daily-input {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 16px;
  padding: 12px;
  background: var(--mondrian-white);
  color: var(--mondrian-black);
  border: 3px solid var(--mondrian-black);
  width: 100%;
  max-width: 320px;
  text-align: center;
  margin-bottom: 14px;
}
.daily-input:focus { outline: none; border-color: var(--mondrian-blue); }

.daily-submit {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 14px;
  font-weight: 600;
  padding: 12px 28px;
  background: var(--mondrian-blue);
  color: #fff;
  border: 3px solid var(--mondrian-black);
  cursor: pointer;
  transition: all 0.2s;
}
.daily-submit:hover { background: var(--mondrian-red); }

.daily-results {
  margin-top: 16px;
  font-size: 15px;
  line-height: 1.7;
  color: #333;
}

/* Particles */
.particle {
  position: fixed;
  pointer-events: none;
  font-size: 18px;
  z-index: 1000;
  animation: particleFly 1s forwards;
}

@keyframes particleFly {
  0% { transform: translateY(0) scale(1); opacity: 1; }
  100% { transform: translateY(-80px) scale(0.3); opacity: 0; }
}

/* Floating XP */
.xp-float {
  position: absolute;
  font-family: 'Syne', sans-serif;
  font-size: 16px;
  font-weight: 700;
  color: var(--green);
  pointer-events: none;
  animation: xpFloat 1.2s forwards;
  z-index: 100;
}

@keyframes xpFloat {
  0% { transform: translateY(0); opacity: 1; }
  100% { transform: translateY(-40px); opacity: 0; }
}

/* Level up overlay */
.level-up-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 5000;
  align-items: center;
  justify-content: center;
}
.level-up-overlay.show { display: flex; }

.level-up-box {
  background: var(--mondrian-yellow);
  border: 4px solid var(--mondrian-black);
  padding: 48px;
  text-align: center;
  animation: levelUpPop 0.5s;
}

@keyframes levelUpPop {
  0% { transform: scale(0.5); opacity: 0; }
  60% { transform: scale(1.05); }
  100% { transform: scale(1); opacity: 1; }
}

.level-up-box h2 {
  font-family: 'Syne', sans-serif;
  font-size: 28px;
  color: var(--mondrian-black);
  margin-bottom: 14px;
}

.level-up-box p {
  font-size: 15px;
  color: #333;
  margin-bottom: 20px;
  line-height: 1.7;
}

.level-up-close {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 14px;
  font-weight: 600;
  padding: 12px 28px;
  background: var(--mondrian-blue);
  color: #fff;
  border: 3px solid var(--mondrian-black);
  cursor: pointer;
  transition: all 0.2s;
}
.level-up-close:hover { background: var(--mondrian-red); }

/* Help system */
.help-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 34px;
  height: 34px;
  font-family: 'Space Grotesk', sans-serif;
  font-size: 14px;
  font-weight: 600;
  background: var(--mondrian-white);
  color: #555;
  border: 2px solid var(--mondrian-black);
  cursor: pointer;
  transition: all 0.2s;
  flex-shrink: 0;
}
.help-btn:hover { background: var(--mondrian-yellow); color: var(--mondrian-black); }

.help-row {
  display: flex;
  align-items: center;
  gap: 10px;
}

.help-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 6000;
  align-items: center;
  justify-content: center;
  padding: 16px;
}
.help-overlay.show { display: flex; }

.help-modal {
  background: var(--mondrian-white);
  border: 4px solid var(--mondrian-black);
  max-width: 640px;
  width: 100%;
  max-height: 80vh;
  overflow-y: auto;
  padding: 28px;
}

.help-modal h2 {
  font-family: 'Syne', sans-serif;
  font-size: 20px;
  color: var(--mondrian-black);
  margin-bottom: 16px;
  font-weight: 700;
}

.help-modal h3 {
  font-family: 'Syne', sans-serif;
  font-size: 15px;
  color: var(--mondrian-red);
  margin: 16px 0 8px;
  padding-top: 12px;
  border-top: 3px solid var(--mondrian-black);
  font-weight: 600;
}
.help-modal h3:first-of-type { border-top: none; padding-top: 0; }

.help-modal p, .help-modal li {
  font-size: 14px;
  line-height: 1.8;
  color: #333;
}

.help-modal ul { list-style: none; padding-left: 0; }
.help-modal li::before { content: '\25B8 '; color: var(--mondrian-blue); }

.help-modal .help-example {
  background: rgba(247,216,66,0.15);
  border-left: 4px solid var(--mondrian-blue);
  padding: 12px 14px;
  margin: 10px 0;
  font-size: 13px;
  line-height: 2;
  color: #333;
}

.help-modal .help-example .hl { color: var(--mondrian-red); font-weight: 700; }
.help-modal .help-example .gr { color: var(--green); font-weight: 600; }
.help-modal .help-example .ac { color: var(--mondrian-red); }

.help-close {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 14px;
  font-weight: 600;
  padding: 12px 28px;
  background: var(--mondrian-blue);
  color: #fff;
  border: 3px solid var(--mondrian-black);
  cursor: pointer;
  margin-top: 16px;
  display: block;
  transition: all 0.2s;
}
.help-close:hover { background: var(--mondrian-red); }

/* ===== TAB 6: TEKSTLEZER ===== */
.reader-container { max-width: 1100px; margin: 0 auto; }

.reader-url-bar {
  display: flex;
  gap: 10px;
  align-items: center;
}
.reader-url-icon { font-size: 20px; opacity: 0.5; }
.reader-url-input {
  flex: 1;
  min-width: 180px;
  padding: 10px 16px;
  font-family: 'Space Grotesk', sans-serif;
  font-size: 14px;
  background: var(--mondrian-white);
  color: var(--mondrian-black);
  border: 3px solid var(--mondrian-black);
  outline: none;
  transition: all 0.2s;
}
.reader-url-input:focus { border-color: var(--mondrian-blue); }
.reader-url-input::placeholder { color: #aaa; }

.reader-load-btn {
  font-family: 'Space Grotesk', sans-serif;
  font-weight: 600;
  font-size: 13px;
  padding: 10px 24px;
  background: var(--mondrian-red);
  color: #fff;
  border: 3px solid var(--mondrian-black);
  cursor: pointer;
  transition: all 0.2s;
  letter-spacing: 2px;
  text-transform: uppercase;
}
.reader-load-btn:hover { background: var(--mondrian-blue); }
.reader-load-btn:disabled { opacity: 0.4; cursor: not-allowed; }

.reader-url-hints { display: flex; gap: 10px; margin: 10px 0 16px; }
.reader-hint-chip {
  font-size: 11px;
  color: #555;
  padding: 3px 10px;
  background: var(--mondrian-white);
  border: 2px solid var(--mondrian-black);
  cursor: pointer;
  transition: all 0.2s;
  font-weight: 600;
}
.reader-hint-chip:hover { background: var(--mondrian-yellow); color: var(--mondrian-black); }

.reader-layout {
  display: flex;
  gap: 16px;
  min-height: 60vh;
}

.reader-article-area {
  flex: 1;
  min-width: 0;
}

/* Empty state */
.reader-empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #666;
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
}
.reader-empty-icon { font-size: 52px; margin-bottom: 16px; opacity: 0.4; }
.reader-empty-state h3 { font-family: 'Syne', sans-serif; color: var(--mondrian-black); margin-bottom: 8px; font-size: 18px; letter-spacing: 1px; font-weight: 700; }
.reader-empty-state p { font-size: 13px; max-width: 400px; margin: 0 auto; line-height: 1.7; }
.reader-tips { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-top: 24px; }
.reader-tip {
  background: var(--mondrian-white);
  border: 2px solid var(--mondrian-black);
  padding: 12px 14px;
  max-width: 160px;
  text-align: left;
  font-size: 11px;
  line-height: 1.5;
  transition: all 0.2s;
}
.reader-tip:hover { background: var(--mondrian-yellow); }
.reader-tip-icon { font-size: 18px; margin-bottom: 4px; display: block; }
.reader-tip-title { color: var(--mondrian-red); font-weight: 600; display: block; margin-bottom: 3px; font-family: 'Syne', sans-serif; font-size: 12px; }

/* Loading */
.reader-loading { text-align: center; padding: 60px 20px; color: #333; }
.reader-loading-spinner {
  display: inline-block; width: 36px; height: 36px;
  border: 3px solid #ddd; border-top-color: var(--mondrian-red);
  border-radius: 50%; animation: fadeIn 0.3s ease;
  margin-bottom: 14px;
}
@keyframes readerSpin { to { transform: rotate(360deg); } }
.reader-loading-spinner { animation: readerSpin 0.8s linear infinite; }

/* Error */
.reader-error {
  text-align: center; padding: 40px; color: #333;
  background: #fff0f0; border: 2px solid var(--mondrian-red);
}
.reader-error h4 { font-family: 'Syne', sans-serif; color: var(--mondrian-red); margin-bottom: 8px; }

/* Article card */
.reader-article-card {
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
  animation: fadeIn 0.5s ease;
  overflow: hidden;
}
.reader-article-accent { height: 6px; background: var(--mondrian-red); }
.reader-article-inner { padding: 28px 32px; }
.reader-article-meta { display: flex; align-items: center; gap: 10px; margin-bottom: 14px; }
.reader-source-badge {
  font-size: 10px; padding: 3px 10px; font-weight: 700;
  letter-spacing: 1px; text-transform: uppercase; font-family: 'Space Grotesk', sans-serif;
}
.reader-badge-nos { background: rgba(19,86,162,0.1); color: var(--mondrian-blue); border: 2px solid var(--mondrian-blue); }
.reader-badge-wiki { background: rgba(212,9,32,0.08); color: var(--mondrian-red); border: 2px solid var(--mondrian-red); }
.reader-article-wc { font-size: 11px; color: #666; margin-left: auto; }
.reader-article-title {
  font-family: 'Syne', sans-serif; font-size: 22px; font-weight: 800;
  color: var(--mondrian-black); margin-bottom: 6px; line-height: 1.3;
}
.reader-article-url { font-size: 11px; color: #999; margin-bottom: 20px; word-break: break-all; padding-bottom: 16px; border-bottom: 3px solid var(--mondrian-black); opacity: 0.5; }
.reader-article-text { line-height: 2; font-size: 15px; color: var(--ink); }
.reader-article-text p { margin-bottom: 16px; text-align: justify; }
.reader-article-text p:first-child::first-letter {
  font-family: 'Syne', sans-serif; font-size: 2.6em; float: left;
  line-height: 0.8; margin: 4px 6px 0 0; color: var(--mondrian-red); font-weight: 800;
}

/* Interactive words */
.reader-word {
  cursor: pointer; transition: all 0.15s; padding: 0 1px; position: relative;
}
.reader-word:hover { background: var(--mondrian-yellow); color: var(--mondrian-black); }
.reader-word.saved {
  background: rgba(212,9,32,0.12);
  color: var(--mondrian-red); font-weight: 700;
}
.reader-word.verb-form { border-bottom: 2px dotted var(--mondrian-blue); }
.reader-word.verb-form:hover { border-bottom-style: solid; }
.reader-word.verb-form.saved { border-bottom-color: var(--mondrian-red); }

/* Tooltip */
.reader-tooltip {
  position: fixed;
  background: var(--mondrian-white);
  color: var(--mondrian-black); padding: 0;
  font-size: 13px; max-width: 320px; min-width: 200px; z-index: 10000;
  pointer-events: none;
  box-shadow: 4px 4px 0 var(--mondrian-black);
  border: 3px solid var(--mondrian-black);
  opacity: 0; transition: opacity 0.15s; line-height: 1.5; overflow: hidden;
}
.reader-tooltip.show { opacity: 1; }
.reader-tt-accent { height: 4px; background: var(--mondrian-red); }
.reader-tt-body { padding: 12px 16px; }
.reader-tt-word { font-family: 'Syne', sans-serif; font-size: 17px; font-weight: 800; color: var(--mondrian-red); margin-bottom: 2px; letter-spacing: 1px; }
.reader-tt-translation { color: #333; font-size: 13px; margin-bottom: 4px; }
.reader-tt-loading { color: #999; font-style: italic; font-size: 12px; }
.reader-tt-click { font-size: 10px; color: #999; margin-top: 5px; opacity: 0.5; }
.reader-tt-verb { margin-top: 8px; padding-top: 8px; border-top: 2px solid var(--mondrian-black); font-size: 12px; }
.reader-tt-verb-label { font-family: 'Syne', sans-serif; color: var(--mondrian-blue); font-weight: 700; font-size: 13px; margin-bottom: 5px; }
.reader-tt-verb-grid { display: grid; grid-template-columns: auto 1fr; gap: 2px 10px; }
.reader-tt-verb-key { color: #666; font-size: 11px; }
.reader-tt-verb-val { color: var(--mondrian-black); font-weight: 700; }
.reader-tt-verb-pattern {
  display: inline-block; margin-top: 5px; padding: 2px 8px;
  border: 2px solid var(--mondrian-blue); font-size: 11px; color: var(--mondrian-blue); font-weight: 600;
}

/* Sentence button & popup */
.reader-sentence-btn {
  position: fixed; z-index: 9998;
  background: var(--mondrian-blue);
  color: #fff; border: 3px solid var(--mondrian-black);
  padding: 8px 18px;
  font-family: 'Space Grotesk', sans-serif; font-size: 12px; font-weight: 600;
  cursor: pointer; box-shadow: 3px 3px 0 var(--mondrian-black);
  display: none; letter-spacing: 0.5px;
}
.reader-sentence-btn:hover { background: var(--mondrian-red); }

.reader-sentence-popup {
  position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
  background: var(--mondrian-white);
  color: var(--mondrian-black); border: 3px solid var(--mondrian-black);
  max-width: 600px; width: 90%; z-index: 10001;
  box-shadow: 4px 4px 0 var(--mondrian-black); display: none; overflow: hidden;
}
.reader-sp-accent { height: 4px; background: var(--mondrian-blue); }
.reader-sp-body { padding: 18px 22px; }
.reader-sp-label { font-family: 'Syne', sans-serif; font-size: 11px; color: var(--mondrian-red); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 6px; font-weight: 700; }
.reader-sp-original { color: #666; font-size: 13px; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 2px solid var(--mondrian-black); font-style: italic; }
.reader-sp-translation { color: #333; font-size: 15px; font-weight: 600; line-height: 1.7; }
.reader-sp-close { position: absolute; top: 10px; right: 14px; background: none; border: none; color: #999; cursor: pointer; font-size: 18px; z-index: 1; }
.reader-sp-close:hover { color: var(--mondrian-black); }

/* Sidebar */
.reader-sidebar {
  width: 280px; min-width: 280px;
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
  display: flex; flex-direction: column;
  overflow: hidden;
}
.reader-sidebar-header {
  font-family: 'Syne', sans-serif; font-size: 14px; font-weight: 700;
  color: var(--mondrian-black); padding: 14px 16px;
  border-bottom: 3px solid var(--mondrian-black);
  display: flex; justify-content: space-between; align-items: center;
}
.reader-sidebar-count {
  font-family: 'Space Grotesk', sans-serif; font-size: 11px; color: var(--mondrian-red); font-weight: 600;
  padding: 2px 8px; background: rgba(212,9,32,0.08); border: 2px solid var(--mondrian-red);
}
.reader-word-list { flex: 1; overflow-y: auto; padding: 10px; max-height: 50vh; }
.reader-word-list::-webkit-scrollbar { width: 5px; }
.reader-word-list::-webkit-scrollbar-thumb { background: #ccc; }
.reader-word-entry {
  background: var(--mondrian-white); border: 2px solid var(--mondrian-black);
  padding: 10px 12px; margin-bottom: 6px;
  position: relative; transition: all 0.2s; animation: fadeIn 0.3s ease;
}
.reader-word-entry:hover { background: var(--mondrian-yellow); }
.reader-we-dutch { font-family: 'Syne', sans-serif; font-weight: 800; color: var(--mondrian-red); font-size: 15px; }
.reader-we-english { color: #333; font-size: 12px; margin-top: 2px; }
.reader-we-verb {
  font-size: 10px; color: var(--mondrian-blue); margin-top: 4px; line-height: 1.4;
  padding: 4px 8px; background: rgba(19,86,162,0.06); border-left: 3px solid var(--mondrian-blue);
}
.reader-we-remove {
  position: absolute; top: 8px; right: 8px; background: none; border: none;
  color: #999; cursor: pointer; font-size: 14px; opacity: 0.3;
  width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;
}
.reader-we-remove:hover { opacity: 1; color: var(--mondrian-red); background: #fff0f0; }
.reader-sidebar-empty { text-align: center; padding: 30px 16px; color: #999; font-size: 12px; font-style: italic; }
.reader-sidebar-footer {
  padding: 10px; border-top: 3px solid var(--mondrian-black);
  display: flex; gap: 6px;
}
.reader-export-btn {
  flex: 1; font-family: 'Space Grotesk', sans-serif; font-weight: 600; font-size: 12px;
  padding: 10px; background: var(--mondrian-blue);
  color: #fff; border: 2px solid var(--mondrian-black);
  cursor: pointer; transition: all 0.2s; letter-spacing: 0.5px; text-transform: uppercase;
}
.reader-export-btn:hover { background: var(--mondrian-red); }
.reader-export-btn:disabled { opacity: 0.3; cursor: not-allowed; }
.reader-clear-btn {
  font-size: 14px; padding: 10px 14px;
  background: #fff0f0; color: var(--mondrian-red);
  border: 2px solid var(--mondrian-red); cursor: pointer; transition: all 0.2s;
}
.reader-clear-btn:hover { background: var(--mondrian-red); color: #fff; }

@media (max-width: 700px) {
  .reader-layout { flex-direction: column; }
  .reader-sidebar { width: 100%; min-width: 100%; }
  .reader-word-list { max-height: 30vh; }
  .reader-url-bar { flex-direction: column; }
}

/* Responsive */
@media (max-width: 600px) {
  .game-header { grid-template-columns: 8px 1fr 8px; grid-template-rows: 8px auto 8px; gap: 2px; }
  .header-center { padding: 14px 12px 10px; }
  .game-title { letter-spacing: 4px; margin-bottom: 4px; }
  .game-subtitle { letter-spacing: 1px; }

  .tab-bar { justify-content: flex-start; -webkit-overflow-scrolling: touch; }
  .tab-btn { padding: 10px 12px; font-size: 11px; flex-shrink: 0; }

  .tab-content { padding: 16px 10px; }

  .cefr-bar { padding: 6px 10px; gap: 4px; }
  .cefr-label { font-size: 10px; margin-right: 6px; }
  .cefr-btn { padding: 4px 10px; font-size: 11px; }
  .cefr-toggle { margin-left: 8px; }
  .cefr-toggle-label { font-size: 10px; }

  .answer-grid { grid-template-columns: 1fr; }
  .adventure-card { padding: 16px 12px; }
  .thought-card { padding: 16px 12px; }
  .card { padding: 16px 12px; }

  .help-row { flex-wrap: wrap; justify-content: center; }
  .help-btn { order: -1; }

  .news-container { padding: 0; }
  .news-card { padding: 16px 12px; }
}

@keyframes pulse {
  0%, 100% { box-shadow: 0 0 0 rgba(196,165,90,0); }
  50% { box-shadow: 0 0 12px rgba(196,165,90,0.5); }
}

@keyframes comboPulse {
  0% { transform: scale(1.5); opacity: 0; }
  50% { transform: scale(1.2); opacity: 1; }
  100% { transform: scale(1); }
}

/* ===== TAB 7: WOORDENSCHAT ===== */
.vocab-container { max-width: 900px; margin: 0 auto; }
.vocab-sub-nav { display: flex; justify-content: center; gap: 0; }
.vocab-sub-btn {
  font-family: 'Space Grotesk', sans-serif; font-size: 12px; font-weight: 600;
  padding: 8px 18px; background: var(--mondrian-white); color: #555;
  border: 2px solid var(--mondrian-black); cursor: pointer; transition: all 0.2s;
}
.vocab-sub-btn.active { background: var(--mondrian-red); color: #fff; }
.vocab-sub-btn:hover:not(.active) { background: var(--mondrian-yellow); color: var(--mondrian-black); }
.vocab-sub-content { display: none; }
.vocab-sub-content.active { display: block; }

.vocab-exercise-card {
  background: var(--mondrian-white); border: 3px solid var(--mondrian-black);
  padding: 32px 24px; max-width: 600px; margin: 20px auto; text-align: center;
}
.vocab-exercise-type {
  font-family: 'Space Grotesk', sans-serif; font-size: 11px; font-weight: 600;
  color: var(--mondrian-red); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 16px;
}
.vocab-exercise-prompt {
  font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 600; color: var(--mondrian-black);
  line-height: 1.6; margin-bottom: 8px;
}
.vocab-exercise-prompt .blank {
  display: inline-block; min-width: 80px; border-bottom: 3px solid var(--mondrian-red);
  color: var(--mondrian-red); padding: 0 4px; margin: 0 2px;
}
.vocab-exercise-hint {
  font-size: 13px; color: #666; margin-bottom: 16px; font-style: italic;
}
.vocab-exercise-input-wrap {
  display: flex; gap: 8px; max-width: 400px; margin: 0 auto 16px;
}
.vocab-exercise-input {
  flex: 1; font-family: 'Space Grotesk', sans-serif; font-size: 16px; font-weight: 500;
  padding: 12px 16px; background: var(--mondrian-white); color: var(--mondrian-black);
  border: 3px solid var(--mondrian-black); outline: none; transition: all 0.2s;
}
.vocab-exercise-input:focus { border-color: var(--mondrian-blue); }
.vocab-exercise-check {
  font-family: 'Space Grotesk', sans-serif; font-size: 14px; font-weight: 600;
  padding: 12px 24px; background: var(--mondrian-blue);
  color: #fff; border: 3px solid var(--mondrian-black); cursor: pointer; transition: all 0.2s;
}
.vocab-exercise-check:hover { background: var(--mondrian-red); }
.vocab-exercise-feedback {
  font-size: 14px; min-height: 24px; margin-bottom: 12px; font-weight: 500; line-height: 1.5;
}
.vocab-exercise-feedback.correct { color: var(--green); }
.vocab-exercise-feedback.incorrect { color: var(--mondrian-red); }
.vocab-exercise-score { font-size: 13px; color: #666; display: flex; align-items: center; justify-content: center; gap: 16px; }
.vocab-exercise-score strong { color: var(--mondrian-red); }
.vocab-exercise-next {
  font-family: 'Space Grotesk', sans-serif; font-size: 12px; font-weight: 600;
  padding: 6px 16px; background: var(--mondrian-white); color: #333;
  border: 2px solid var(--mondrian-black); cursor: pointer; transition: all 0.2s;
}
.vocab-exercise-next:hover { background: var(--mondrian-yellow); }

.vocab-list-toggle { display: flex; justify-content: center; gap: 0; margin-bottom: 12px; }
.vocab-list-btn {
  font-family: 'Space Grotesk', sans-serif; font-size: 12px; font-weight: 600;
  padding: 8px 16px; background: var(--mondrian-white); color: #555;
  border: 2px solid var(--mondrian-black); cursor: pointer; transition: all 0.2s;
}
.vocab-list-btn.active { background: var(--mondrian-blue); color: #fff; }
.vocab-list-btn:hover:not(.active) { background: var(--mondrian-yellow); }
.vocab-filter-bar { display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; align-items: center; }
.vocab-search {
  font-family: 'Space Grotesk', sans-serif; font-size: 13px; padding: 8px 14px;
  background: var(--mondrian-white); color: var(--mondrian-black); border: 3px solid var(--mondrian-black);
  outline: none; min-width: 180px; transition: all 0.2s;
}
.vocab-search:focus { border-color: var(--mondrian-blue); }
.vocab-filter-chips { display: flex; gap: 4px; flex-wrap: wrap; }
.vocab-chip {
  font-family: 'Space Grotesk', sans-serif; font-size: 11px; font-weight: 600;
  padding: 4px 10px; background: var(--mondrian-white); color: #555;
  border: 2px solid var(--mondrian-black); cursor: pointer; transition: all 0.2s;
}
.vocab-chip.active { background: var(--mondrian-blue); color: #fff; }
.vocab-chip:hover:not(.active) { background: var(--mondrian-yellow); }
.vocab-table-wrap { max-height: 60vh; overflow-y: auto; border: 3px solid var(--mondrian-black); }
.vocab-table {
  width: 100%; border-collapse: collapse; font-size: 13px;
}
.vocab-table th {
  position: sticky; top: 0; background: var(--mondrian-yellow); color: var(--mondrian-black);
  font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;
  padding: 10px 12px; text-align: left; border-bottom: 3px solid var(--mondrian-black);
}
.vocab-table td {
  padding: 8px 12px; border-bottom: 1px solid #ddd; color: #333;
}
.vocab-table tr:hover td { background: rgba(247,216,66,0.15); }
.vocab-table .vt-dutch { color: var(--mondrian-black); font-weight: 600; }
.vocab-table .vt-prep { color: var(--mondrian-red); font-weight: 700; }
.vocab-table .vt-pattern {
  font-size: 10px; padding: 2px 8px; background: #f0f0f0; border: 1px solid #ddd;
  display: inline-block;
}

@media (max-width: 600px) {
  .vocab-exercise-card { padding: 20px 16px; }
  .vocab-exercise-prompt { font-size: 17px; }
  .vocab-exercise-input-wrap { flex-direction: column; }
  .vocab-filter-bar { flex-direction: column; }
  .vocab-search { min-width: 100%; }
}

/* ===== TAB 8: SPIEKBRIEFJES ===== */
.sheets-container { max-width: 1000px; margin: 0 auto; }
.sheets-sub-nav { display: flex; justify-content: center; gap: 0; }
.sheets-sub-btn {
  font-family: 'Space Grotesk', sans-serif; font-size: 12px; font-weight: 600;
  padding: 8px 18px; background: var(--mondrian-white); color: #555;
  border: 2px solid var(--mondrian-black); cursor: pointer; transition: all 0.2s;
}
.sheets-sub-btn.active { background: var(--mondrian-red); color: #fff; }
.sheets-sub-btn:hover:not(.active) { background: var(--mondrian-yellow); color: var(--mondrian-black); }
.sheets-sub-content { display: none; }
.sheets-sub-content.active { display: block; }

/* Ready-made grid */
.sheets-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 16px; margin-top: 16px;
}
.sheet-card {
  background: var(--mondrian-white); border: 3px solid var(--mondrian-black);
  padding: 20px 20px 20px 28px; cursor: pointer; position: relative;
  transition: transform 0.15s, box-shadow 0.15s;
}
.sheet-card::before {
  content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 8px;
}
.sheet-card:nth-child(3n+1)::before { background: var(--mondrian-red); }
.sheet-card:nth-child(3n+2)::before { background: var(--mondrian-blue); }
.sheet-card:nth-child(3n+0)::before { background: var(--mondrian-yellow); }
.sheet-card:hover { transform: translateY(-2px); box-shadow: 4px 4px 0 var(--mondrian-black); }
.sheet-card-icon { font-size: 28px; margin-bottom: 8px; }
.sheet-card-title {
  font-family: 'Syne', sans-serif; font-size: 15px; font-weight: 700;
  color: var(--mondrian-black); margin-bottom: 6px;
}
.sheet-card-desc { font-size: 12px; color: #666; line-height: 1.5; margin-bottom: 8px; }
.sheet-card-count {
  font-size: 11px; font-weight: 600; color: var(--mondrian-blue);
  text-transform: uppercase; letter-spacing: 1px;
}

/* Custom builder */
.sheets-builder { margin-top: 16px; }
.sheets-step {
  background: var(--mondrian-white); border: 3px solid var(--mondrian-black);
  padding: 20px; margin-bottom: 16px;
}
.sheets-step-header {
  font-family: 'Syne', sans-serif; font-size: 16px; font-weight: 700;
  color: var(--mondrian-black); margin-bottom: 16px; display: flex; align-items: center; gap: 10px;
}
.sheets-step-num {
  display: inline-flex; align-items: center; justify-content: center;
  width: 28px; height: 28px; background: var(--mondrian-red); color: #fff;
  font-family: 'Syne', sans-serif; font-size: 14px; font-weight: 800;
}
.sheets-step-label { font-size: 12px; font-weight: 600; color: #555; margin-bottom: 8px; }
.sheets-word-tabs { display: flex; gap: 0; margin-bottom: 12px; }
.sheets-word-tab {
  font-family: 'Space Grotesk', sans-serif; font-size: 12px; font-weight: 600;
  padding: 6px 16px; background: var(--mondrian-white); color: #555;
  border: 2px solid var(--mondrian-black); cursor: pointer; transition: all 0.2s;
}
.sheets-word-tab.active { background: var(--mondrian-blue); color: #fff; }
.sheets-word-toolbar { display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap; align-items: center; }
.sheets-search {
  font-family: 'Space Grotesk', sans-serif; font-size: 13px; padding: 6px 12px;
  border: 2px solid var(--mondrian-black); background: var(--mondrian-white);
  outline: none; min-width: 200px;
}
.sheets-search:focus { border-color: var(--mondrian-blue); }
.sheets-filter-chips { display: flex; gap: 4px; flex-wrap: wrap; }
.sheets-filter-chip {
  font-size: 10px; padding: 3px 8px; border: 1px solid #ccc; background: #f5f5f5;
  cursor: pointer; transition: all 0.2s; font-weight: 500;
}
.sheets-filter-chip.active { background: var(--mondrian-red); color: #fff; border-color: var(--mondrian-red); }
.sheets-select-actions { display: flex; gap: 8px; align-items: center; margin-bottom: 10px; flex-wrap: wrap; }
.sheets-select-btn {
  font-family: 'Space Grotesk', sans-serif; font-size: 11px; font-weight: 600;
  padding: 4px 12px; background: var(--mondrian-white); color: var(--mondrian-blue);
  border: 2px solid var(--mondrian-blue); cursor: pointer; transition: all 0.2s;
}
.sheets-select-btn:hover { background: var(--mondrian-blue); color: #fff; }
.sheets-selected-count { font-size: 12px; font-weight: 600; color: var(--mondrian-red); margin-left: auto; }
.sheets-word-list {
  max-height: 300px; overflow-y: auto; border: 2px solid var(--mondrian-black);
  background: var(--mondrian-white);
}
.sheets-word-item {
  display: flex; align-items: center; gap: 10px; padding: 6px 12px;
  border-bottom: 1px solid #eee; font-size: 13px; cursor: pointer; transition: background 0.1s;
}
.sheets-word-item:hover { background: rgba(247,216,66,0.15); }
.sheets-word-item input[type="checkbox"] {
  appearance: none; -webkit-appearance: none; width: 16px; height: 16px;
  border: 2px solid var(--mondrian-black); background: var(--mondrian-white);
  cursor: pointer; flex-shrink: 0; position: relative;
}
.sheets-word-item input[type="checkbox"]:checked {
  background: var(--mondrian-red);
}
.sheets-word-item input[type="checkbox"]:checked::after {
  content: '\2713'; color: #fff; font-size: 11px; font-weight: 700;
  position: absolute; top: -1px; left: 2px;
}
.sheets-word-nl { font-weight: 600; color: var(--mondrian-black); }
.sheets-word-en { color: #666; }
.sheets-custom-word { margin-top: 16px; padding-top: 12px; border-top: 2px solid #eee; }
.sheets-custom-inputs { display: flex; gap: 6px; margin-bottom: 8px; }
.sheets-custom-input {
  font-family: 'Space Grotesk', sans-serif; font-size: 13px; padding: 6px 10px;
  border: 2px solid var(--mondrian-black); background: var(--mondrian-white); flex: 1;
}
.sheets-custom-add {
  font-family: 'Syne', sans-serif; font-size: 18px; font-weight: 800;
  width: 36px; background: var(--mondrian-blue); color: #fff;
  border: 2px solid var(--mondrian-black); cursor: pointer;
}
.sheets-custom-add:hover { background: var(--mondrian-red); }
.sheets-custom-list { display: flex; flex-wrap: wrap; gap: 6px; }
.sheets-custom-tag {
  font-size: 11px; padding: 4px 8px; background: var(--mondrian-yellow);
  border: 1px solid var(--mondrian-black); display: flex; align-items: center; gap: 4px;
}
.sheets-custom-tag button {
  background: none; border: none; font-size: 14px; cursor: pointer; color: var(--mondrian-red); font-weight: 700;
}

/* Layout selector */
.sheets-layout-options { display: flex; gap: 10px; flex-wrap: wrap; }
.sheets-layout-card {
  display: flex; flex-direction: column; align-items: center; gap: 6px;
  padding: 16px 20px; background: var(--mondrian-white); border: 3px solid var(--mondrian-black);
  cursor: pointer; transition: all 0.2s; min-width: 100px;
}
.sheets-layout-card.active { border-color: var(--mondrian-blue); background: rgba(19,86,162,0.05); }
.sheets-layout-card:hover { background: rgba(247,216,66,0.15); }
.sheets-layout-icon { font-size: 24px; }
.sheets-layout-name { font-size: 12px; font-weight: 600; text-align: center; }

/* Download button */
.sheets-download-btn {
  font-family: 'Space Grotesk', sans-serif; font-size: 14px; font-weight: 700;
  padding: 14px 32px; background: var(--mondrian-blue); color: #fff;
  border: 3px solid var(--mondrian-black); cursor: pointer; transition: all 0.2s;
  text-transform: uppercase; letter-spacing: 1px;
}
.sheets-download-btn:hover { background: var(--mondrian-red); }

/* Download all grid */
.sheets-download-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 16px; margin-top: 16px;
}
.sheets-dl-card {
  background: var(--mondrian-white); border: 3px solid var(--mondrian-black);
  padding: 20px; display: flex; flex-direction: column; gap: 8px;
}
.sheets-dl-title {
  font-family: 'Syne', sans-serif; font-size: 14px; font-weight: 700;
  color: var(--mondrian-black);
}
.sheets-dl-desc { font-size: 12px; color: #666; line-height: 1.4; }
.sheets-dl-btn {
  font-family: 'Space Grotesk', sans-serif; font-size: 12px; font-weight: 600;
  padding: 8px 16px; background: var(--mondrian-blue); color: #fff;
  border: 2px solid var(--mondrian-black); cursor: pointer; transition: all 0.2s;
  align-self: flex-start; margin-top: auto;
}
.sheets-dl-btn:hover { background: var(--mondrian-red); }

@media (max-width: 600px) {
  .sheets-grid { grid-template-columns: 1fr; }
  .sheets-sub-nav { overflow-x: auto; }
  .sheets-layout-options { flex-direction: column; }
  .sheets-custom-inputs { flex-direction: column; }
  .sheets-download-grid { grid-template-columns: 1fr; }
  .sheets-search { min-width: 100%; }
}

/* ===== TAB 9: UITDRUKKINGEN ===== */
.phrases-container { max-width: 900px; margin: 0 auto; }
.phrases-sub-nav { display: flex; gap: 0; flex-wrap: wrap; }
.phrases-cat-btn {
  font-family: 'Space Grotesk', sans-serif; font-size: 11px; font-weight: 600;
  padding: 6px 14px; background: var(--mondrian-white); color: #555;
  border: 2px solid var(--mondrian-black); cursor: pointer; transition: all 0.2s;
}
.phrases-cat-btn.active { background: var(--mondrian-red); color: #fff; }
.phrases-cat-btn:hover:not(.active) { background: var(--mondrian-yellow); color: var(--mondrian-black); }
.phrases-search-bar { margin-bottom: 12px; }
.phrases-search {
  font-family: 'Space Grotesk', sans-serif; font-size: 13px; padding: 8px 14px;
  border: 3px solid var(--mondrian-black); background: var(--mondrian-white);
  outline: none; width: 100%;
}
.phrases-search:focus { border-color: var(--mondrian-blue); }
.phrases-list { display: flex; flex-direction: column; gap: 10px; }
.phrase-card {
  background: var(--mondrian-white); border: 3px solid var(--mondrian-black);
  padding: 16px 16px 16px 24px; position: relative;
}
.phrase-card::before {
  content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 6px;
}
.phrase-card[data-cat="opinion"]::before { background: var(--mondrian-red); }
.phrase-card[data-cat="conversation"]::before { background: var(--mondrian-blue); }
.phrase-card[data-cat="connectors"]::before { background: var(--mondrian-yellow); }
.phrase-card[data-cat="time"]::before { background: #2d8a56; }
.phrase-card[data-cat="emotion"]::before { background: #b08600; }
.phrase-card[data-cat="argument"]::before { background: #8B4513; }
.phrase-card[data-cat="formal"]::before { background: #555; }
.phrase-card[data-cat="idiom"]::before { background: var(--mondrian-red); }
.phrase-nl {
  font-family: 'Syne', sans-serif; font-size: 16px; font-weight: 700;
  color: var(--mondrian-black); margin-bottom: 4px;
}
.phrase-en { font-size: 13px; color: var(--mondrian-blue); margin-bottom: 6px; }
.phrase-example { font-size: 12px; color: #666; font-style: italic; line-height: 1.5; }
.phrase-example-en { font-size: 11px; color: #999; }
.phrase-cat-label {
  position: absolute; top: 8px; right: 10px; font-size: 9px; font-weight: 700;
  text-transform: uppercase; letter-spacing: 1px; color: #aaa;
}
.phrases-export-bar { margin-top: 20px; text-align: center; padding-top: 16px; border-top: 3px solid var(--mondrian-black); }

@media (max-width: 600px) {
  .phrases-sub-nav { overflow-x: auto; flex-wrap: nowrap; }
  .phrases-cat-btn { white-space: nowrap; font-size: 10px; padding: 5px 10px; }
}

/* ===== TAB 10: GRAMMATICA ===== */
.grammar-container { max-width: 1000px; margin: 0 auto; }
.grammar-sub-nav { display: flex; gap: 0; flex-wrap: wrap; }
.grammar-cat-btn {
  font-family: 'Space Grotesk', sans-serif; font-size: 11px; font-weight: 600;
  padding: 6px 14px; background: var(--mondrian-white); color: #555;
  border: 2px solid var(--mondrian-black); cursor: pointer; transition: all 0.2s;
}
.grammar-cat-btn.active { background: var(--mondrian-red); color: #fff; }
.grammar-cat-btn:hover:not(.active) { background: var(--mondrian-yellow); color: var(--mondrian-black); }
.grammar-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 16px; margin-top: 16px;
}
.grammar-card {
  background: var(--mondrian-white); border: 3px solid var(--mondrian-black);
  cursor: pointer; position: relative; transition: transform 0.15s, box-shadow 0.15s;
  overflow: hidden;
}
.grammar-card:hover { transform: translateY(-2px); box-shadow: 4px 4px 0 var(--mondrian-black); }
.grammar-card-header {
  padding: 16px 16px 12px; border-bottom: 2px solid var(--mondrian-black);
  position: relative;
}
.grammar-card-accent {
  position: absolute; top: 0; left: 0; right: 0; height: 6px;
}
.grammar-card-icon { font-size: 24px; margin-bottom: 6px; }
.grammar-card-title {
  font-family: 'Syne', sans-serif; font-size: 15px; font-weight: 700;
  color: var(--mondrian-black);
}
.grammar-card-subtitle { font-size: 11px; color: #888; margin-top: 2px; }
.grammar-card-body { padding: 12px 16px; font-size: 12px; color: #555; line-height: 1.6; }
.grammar-card-body code {
  background: var(--mondrian-yellow); padding: 1px 5px; font-family: 'Space Grotesk', monospace;
  font-size: 11px; font-weight: 600; border: 1px solid rgba(0,0,0,0.15);
}
.grammar-card-body .gr-rule {
  background: #f5f5f5; border-left: 4px solid var(--mondrian-blue); padding: 8px 10px;
  margin: 6px 0; font-size: 12px;
}
.grammar-card-body .gr-example {
  font-style: italic; color: #666; margin: 4px 0;
}
.grammar-card-body .gr-mnemonic {
  background: rgba(247,216,66,0.3); padding: 6px 10px; margin: 6px 0;
  font-weight: 600; font-size: 13px; text-align: center;
}
.grammar-card-body table {
  width: 100%; border-collapse: collapse; margin: 6px 0; font-size: 11px;
}
.grammar-card-body th {
  background: var(--mondrian-yellow); padding: 4px 8px; text-align: left;
  border: 1px solid var(--mondrian-black); font-size: 10px;
}
.grammar-card-body td {
  padding: 4px 8px; border: 1px solid #ddd;
}
.grammar-card-print {
  display: block; text-align: center; padding: 8px; font-size: 11px; font-weight: 600;
  color: var(--mondrian-blue); border-top: 2px solid #eee; text-transform: uppercase;
  letter-spacing: 1px; background: none; border-left: none; border-right: none;
  border-bottom: none; width: 100%; cursor: pointer; transition: background 0.2s;
}
.grammar-card-print:hover { background: rgba(19,86,162,0.08); }

@media (max-width: 600px) {
  .grammar-grid { grid-template-columns: 1fr; }
  .grammar-sub-nav { overflow-x: auto; flex-wrap: nowrap; }
  .grammar-cat-btn { white-space: nowrap; }
}

/* ===== SUBTAB SYSTEM ===== */
.subtab-bar {
  display: flex;
  justify-content: center;
  gap: 0;
  flex-wrap: wrap;
  margin-bottom: 16px;
}
.subtab-btn {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 12px;
  font-weight: 600;
  padding: 8px 18px;
  background: var(--mondrian-white);
  color: #555;
  border: 2px solid var(--mondrian-black);
  cursor: pointer;
  transition: all 0.2s;
}
.subtab-btn + .subtab-btn { border-left: none; }
.subtab-btn:hover:not(.active) { background: var(--mondrian-yellow); color: var(--mondrian-black); }
.subtab-btn.active { background: var(--mondrian-red); color: #fff; }
.subtab-content { display: none; }
.subtab-content.active { display: block; }

@media (max-width: 600px) {
  .subtab-bar { overflow-x: auto; flex-wrap: nowrap; }
  .subtab-btn { white-space: nowrap; font-size: 11px; padding: 6px 12px; }
}

/* ===== LEESHOEK TRANSLATE TOOLBAR ===== */
.translate-toolbar {
  position: fixed;
  z-index: 9999;
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
  box-shadow: 3px 3px 0 var(--mondrian-black);
  padding: 6px 12px;
  display: none;
  gap: 8px;
  align-items: center;
}
.translate-toolbar.show { display: flex; }
.translate-toolbar-btn {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 12px;
  font-weight: 600;
  padding: 6px 14px;
  background: var(--mondrian-blue);
  color: #fff;
  border: 2px solid var(--mondrian-black);
  cursor: pointer;
  transition: all 0.2s;
}
.translate-toolbar-btn:hover { background: var(--mondrian-red); }

.translate-popup {
  position: fixed;
  z-index: 10001;
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
  box-shadow: 4px 4px 0 var(--mondrian-black);
  max-width: 500px;
  width: 90%;
  display: none;
  overflow: hidden;
}
.translate-popup.show { display: block; }
.translate-popup-accent { height: 4px; background: var(--mondrian-blue); }
.translate-popup-body { padding: 18px 22px; }
.translate-popup-nl {
  font-family: 'Syne', sans-serif;
  font-size: 15px;
  font-weight: 700;
  color: var(--mondrian-black);
  margin-bottom: 8px;
  line-height: 1.5;
}
.translate-popup-en {
  font-size: 14px;
  color: var(--mondrian-blue);
  line-height: 1.6;
  margin-bottom: 12px;
}
.translate-popup-actions { display: flex; gap: 8px; }
.translate-popup-save {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 12px;
  font-weight: 600;
  padding: 6px 16px;
  background: var(--mondrian-red);
  color: #fff;
  border: 2px solid var(--mondrian-black);
  cursor: pointer;
  transition: all 0.2s;
}
.translate-popup-save:hover { background: var(--mondrian-blue); }
.translate-popup-close {
  position: absolute;
  top: 10px;
  right: 14px;
  background: none;
  border: none;
  color: #999;
  cursor: pointer;
  font-size: 18px;
}
.translate-popup-close:hover { color: var(--mondrian-black); }

/* Saved translations panel */
.saved-translations-panel {
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
  margin-top: 20px;
}
.saved-translations-header {
  font-family: 'Syne', sans-serif;
  font-size: 14px;
  font-weight: 700;
  color: var(--mondrian-black);
  padding: 14px 16px;
  border-bottom: 3px solid var(--mondrian-black);
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.saved-translations-count {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 11px;
  color: var(--mondrian-red);
  font-weight: 600;
  padding: 2px 8px;
  background: rgba(212,9,32,0.08);
  border: 2px solid var(--mondrian-red);
}
.saved-translations-list {
  max-height: 300px;
  overflow-y: auto;
  padding: 10px;
}
.saved-translation-entry {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: 8px 10px;
  border-bottom: 1px solid #eee;
  font-size: 13px;
  gap: 12px;
}
.saved-translation-entry:last-child { border-bottom: none; }
.saved-translation-nl { font-weight: 600; color: var(--mondrian-black); flex: 1; }
.saved-translation-en { color: var(--mondrian-blue); flex: 1; }
.saved-translation-remove {
  background: none;
  border: none;
  color: #999;
  cursor: pointer;
  font-size: 14px;
  opacity: 0.3;
  flex-shrink: 0;
}
.saved-translation-remove:hover { opacity: 1; color: var(--mondrian-red); }
.saved-translations-empty {
  text-align: center;
  padding: 20px;
  color: #999;
  font-size: 12px;
  font-style: italic;
}
.saved-translations-footer {
  padding: 10px;
  border-top: 3px solid var(--mondrian-black);
  display: flex;
  gap: 6px;
}
.saved-translations-export {
  flex: 1;
  font-family: 'Space Grotesk', sans-serif;
  font-weight: 600;
  font-size: 12px;
  padding: 10px;
  background: var(--mondrian-blue);
  color: #fff;
  border: 2px solid var(--mondrian-black);
  cursor: pointer;
  transition: all 0.2s;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.saved-translations-export:hover { background: var(--mondrian-red); }
.saved-translations-export:disabled { opacity: 0.3; cursor: not-allowed; }

/* ===== MAIN TAB: SPEL ===== */
.spel-container { max-width: 750px; margin: 0 auto; }

.spel-welcome { text-align: center; margin-bottom: 24px; }
.spel-welcome-icon { font-size: 48px; margin-bottom: 8px; }
.spel-welcome-title {
  font-family: 'Syne', sans-serif;
  font-size: 24px;
  font-weight: 800;
  color: var(--mondrian-black);
  margin: 0 0 8px;
}
.spel-welcome-desc {
  font-size: 14px;
  color: #666;
  line-height: 1.6;
  max-width: 500px;
  margin: 0 auto;
}

.spel-diff-buttons {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
}
.spel-diff-btn {
  font-family: 'Space Grotesk', sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: 16px 24px;
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
  cursor: pointer;
  transition: all 0.2s ease;
  min-width: 140px;
}
.spel-diff-btn:hover { transform: translateY(-2px); }
.spel-diff-btn.active {
  background: var(--mondrian-yellow);
  border-color: var(--mondrian-black);
  box-shadow: 4px 4px 0 var(--mondrian-black);
}
.spel-diff-icon { font-size: 28px; }
.spel-diff-label {
  font-weight: 700;
  font-size: 15px;
  color: var(--mondrian-black);
}
.spel-diff-desc {
  font-size: 11px;
  color: #666;
  font-weight: 400;
}

.spel-start-btn {
  font-family: 'Space Grotesk', sans-serif;
  display: block;
  margin: 0 auto;
  padding: 14px 40px;
  font-size: 16px;
  font-weight: 700;
  background: var(--mondrian-red);
  color: #fff;
  border: 3px solid var(--mondrian-black);
  cursor: pointer;
  transition: all 0.2s ease;
  text-transform: uppercase;
  letter-spacing: 1px;
}
.spel-start-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 4px 4px 0 var(--mondrian-black);
}
.spel-start-btn:disabled { opacity: 0.3; cursor: not-allowed; }

/* === Disco Elysium Dialogue System (Mondrian De Stijl) === */

.de-hud {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 16px;
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
  margin-bottom: 0;
  flex-wrap: wrap;
}
.de-hud-location {
  font-family: 'Syne', sans-serif;
  font-size: 15px;
  font-weight: 700;
  color: var(--mondrian-black);
  flex: 1;
}
.de-hud-location .loc-icon { margin-right: 6px; }
.de-hud-skills {
  display: flex;
  gap: 6px;
  align-items: center;
}
.de-hud-pip {
  font-size: 14px;
  padding: 2px 6px;
  border: 1px solid #ccc;
  border-radius: 2px;
  cursor: help;
  position: relative;
}
.de-hud-pip[title]:hover { background: #f5f5f5; }
.de-hud-xp {
  font-family: 'Syne', sans-serif;
  font-size: 14px;
  font-weight: 700;
  color: var(--mondrian-red);
}

.de-dialogue-container {
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
  border-top: none;
  max-height: 55vh;
  min-height: 200px;
  overflow-y: auto;
  padding: 20px 24px;
  scroll-behavior: smooth;
}

.de-entry {
  margin-bottom: 16px;
  padding: 0;
  animation: deEntryIn 0.5s ease forwards;
  opacity: 0;
  transform: translateY(8px);
  line-height: 1.7;
  font-size: 14px;
}
@keyframes deEntryIn {
  to { opacity: 1; transform: translateY(0); }
}
.de-entry.narrator {
  font-style: italic;
  color: #666;
  padding-left: 12px;
}
.de-entry.narrator em { color: var(--mondrian-red); font-style: italic; }
.de-entry.npc {
  color: #111;
  border-left: 4px solid #999;
  padding-left: 14px;
}
.de-entry.npc .de-speaker {
  font-weight: 700;
  display: block;
  margin-bottom: 2px;
}
.de-entry.skill-voice {
  font-style: italic;
  padding-left: 14px;
  font-size: 13px;
}
.de-entry.player {
  border-left: 4px solid var(--mondrian-yellow);
  padding-left: 14px;
  font-weight: 500;
}
.de-entry.result-success {
  border-left: 4px solid var(--green, #2d8a56);
  padding-left: 14px;
  color: #1a5e2a;
}
.de-entry.result-fail {
  border-left: 4px solid var(--mondrian-red);
  padding-left: 14px;
  color: #8b1a1a;
}

.de-choices {
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
  border-top: none;
  padding: 16px 24px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.de-choice-btn {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 14px;
  padding: 14px 20px;
  background: var(--mondrian-white);
  color: #333;
  border: 2px solid var(--mondrian-black);
  cursor: pointer;
  text-align: left;
  line-height: 1.6;
  transition: all 0.2s ease;
  position: relative;
}
.de-choice-btn:hover:not(:disabled) {
  background: var(--mondrian-yellow);
  transform: translateX(4px);
}
.de-choice-btn.correct {
  border-color: var(--green, #2d8a56);
  background: #eaffea;
}
.de-choice-btn.wrong {
  border-color: var(--mondrian-red);
  background: #fff0f0;
}
.de-choice-btn:disabled { pointer-events: none; opacity: 0.6; }
.de-check-badge {
  display: inline-block;
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  padding: 2px 8px;
  margin-right: 8px;
  border: 1px solid;
  vertical-align: middle;
}

/* Skill overview panel */
.de-skill-overview {
  margin-top: 24px;
  padding: 20px;
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
}
.de-skill-overview h3 {
  font-family: 'Syne', sans-serif;
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 14px;
  border-bottom: 2px solid var(--mondrian-black);
  padding-bottom: 6px;
}
.de-skill-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 8px;
  font-size: 13px;
}
.de-skill-row .skill-icon { font-size: 16px; width: 24px; text-align: center; }
.de-skill-row .skill-name {
  width: 150px;
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.de-skill-bar {
  flex: 1;
  height: 10px;
  background: #eee;
  border: 1px solid var(--mondrian-black);
  position: relative;
}
.de-skill-bar-fill {
  height: 100%;
  transition: width 0.5s ease;
}
.de-skill-row .skill-level {
  width: 30px;
  text-align: right;
  font-weight: 700;
  font-size: 12px;
}

/* Thought cabinet */
.de-thought-cabinet {
  margin-top: 16px;
  padding: 20px;
  background: var(--mondrian-white);
  border: 3px solid var(--mondrian-black);
}
.de-thought-cabinet h3 {
  font-family: 'Syne', sans-serif;
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 14px;
  border-bottom: 2px solid var(--mondrian-black);
  padding-bottom: 6px;
}
.de-thought-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 10px;
}
.de-thought-card {
  background: var(--mondrian-white);
  border: 2px solid var(--mondrian-black);
  padding: 12px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
}
.de-thought-card.locked {
  border-style: dashed;
  opacity: 0.5;
  cursor: not-allowed;
}
.de-thought-card.active {
  background: var(--mondrian-yellow);
  box-shadow: 3px 3px 0 var(--mondrian-black);
}
.de-thought-card .thought-name {
  font-weight: 700;
  font-size: 13px;
  margin-bottom: 4px;
}
.de-thought-card .thought-desc {
  color: #666;
  line-height: 1.4;
}
.de-thought-card .thought-bonus {
  margin-top: 6px;
  font-weight: 600;
  font-size: 11px;
}

/* Timer in HUD */
.de-timer-bar {
  width: 100%;
  height: 6px;
  background: #eee;
  border: 1px solid var(--mondrian-black);
  overflow: hidden;
  margin-top: 4px;
}
.de-timer-fill {
  height: 100%;
  background: var(--green, #2d8a56);
  transition: width 1s linear, background-color 0.5s;
  width: 100%;
}
.de-timer-fill.warning { background: var(--mondrian-yellow); }
.de-timer-fill.danger { background: var(--mondrian-red); }

.spel-source {
  font-size: 11px;
  color: #999;
  text-align: right;
}
.spel-source a { color: #999; text-decoration: underline; }
.spel-source a:hover { color: var(--mondrian-blue); }

@media (max-width: 600px) {
  .spel-diff-buttons { flex-direction: column; align-items: center; }
  .spel-diff-btn { min-width: 200px; }
  .de-dialogue-container { padding: 14px 16px; max-height: 45vh; }
  .de-choices { padding: 12px 16px; }
  .de-hud { padding: 8px 12px; }
  .de-skill-row .skill-name { width: 100px; font-size: 11px; }
  .de-thought-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
}

/* CEFR Level Selector */
.cefr-bar { display:flex; justify-content:center; align-items:center; gap:0; padding:6px 18px; background:#fff; border-bottom:3px solid #000; flex-wrap:wrap; }
.cefr-label { font-family:'Space Grotesk',sans-serif; font-size:12px; font-weight:600; color:#666; margin-right:10px; text-transform:uppercase; letter-spacing:0.5px; }
.cefr-btn { font-family:'Space Grotesk',sans-serif; font-size:12px; font-weight:700; padding:4px 14px; background:#fff; border:2px solid #000; border-right:none; cursor:pointer; transition:all 0.2s; }
.cefr-btn:last-of-type { border-right:2px solid #000; }
.cefr-btn:hover { background:#F7D842; }
.cefr-btn.active { background:#D40920; color:#fff; }
.cefr-toggle { display:flex; align-items:center; gap:5px; margin-left:16px; cursor:pointer; font-family:'Space Grotesk',sans-serif; font-size:11px; color:#666; }
.cefr-toggle input { cursor:pointer; }
.cefr-toggle-label { user-select:none; }
</style>
</head>
<body>

<!-- Header -->
<header class="game-header">
  <div class="header-corner-tl"></div>
  <div class="header-bar-top"></div>
  <div class="header-corner-tr"></div>
  <div class="header-side-l"></div>
  <div class="header-center">
    <h1 class="game-title">DUTCHMAXXING</h1>
    <p class="game-subtitle"><span>A2 tot C1</span></p>
  </div>
  <div class="header-side-r"></div>
  <div class="header-corner-bl"></div>
  <div class="header-bar-bottom"></div>
  <div class="header-corner-br"></div>
</header>

<!-- Tabs -->
<nav class="tab-bar">
  <button class="tab-btn active" data-tab="oefeningen">Oefeningen</button>
  <button class="tab-btn" data-tab="spel">Spel</button>
  <button class="tab-btn" data-tab="news">Leeshoek</button>
  <button class="tab-btn" data-tab="vocab">Woordenschat</button>
  <button class="tab-btn" data-tab="spiekbriefjes">Spiekbriefjes</button>
</nav>

<!-- CEFR Level Selector -->
<div class="cefr-bar" id="cefrBar">
  <span class="cefr-label">Niveau:</span>
  <button class="cefr-btn" data-level="A2" onclick="setCEFR('A2')">A2</button>
  <button class="cefr-btn" data-level="B1" onclick="setCEFR('B1')">B1</button>
  <button class="cefr-btn active" data-level="B2" onclick="setCEFR('B2')">B2</button>
  <button class="cefr-btn" data-level="C1" onclick="setCEFR('C1')">C1</button>
  <label class="cefr-toggle" title="Alleen dit niveau tonen">
    <input type="checkbox" id="cefrExclusive" onchange="toggleCEFRExclusive(this.checked)">
    <span class="cefr-toggle-label">Alleen dit niveau</span>
  </label>
</div>

<!-- MAIN TAB: OEFENINGEN -->
<div class="tab-content active" id="tab-oefeningen">
  <div class="subtab-bar">
    <button class="subtab-btn active" data-subtab="arena" data-maintab="oefeningen">Werkwoorden</button>
    <button class="subtab-btn" data-subtab="adventure" data-maintab="oefeningen">De Stad</button>
    <button class="subtab-btn" data-subtab="daily" data-maintab="oefeningen">Dagelijkse Uitdaging</button>
    <button class="subtab-btn" data-subtab="reader" data-maintab="oefeningen">Tekstlezer</button>
  </div>
  <div class="subtab-content active" id="sub-arena">
  <div class="cabinet-container">
    <div class="help-row">
      <div class="arena-controls" style="flex:1">
        <button class="ctrl-btn active" data-mode="perfectum">Perfectum</button>
        <button class="ctrl-btn" data-mode="imperfectum">Imperfectum</button>
        <button class="ctrl-btn" data-mode="mixed">Gemengd</button>
        <button class="ctrl-btn" data-mode="reverse">Omgekeerd</button>
      </div>
      <button class="help-btn" onclick="showHelp('arena')" title="Hulp">?</button>
    </div>

    <div class="thought-card-area" id="battleScene">
      <div class="thought-card" id="thoughtCard">
        <div class="verb-emoji" id="monsterSprite">&#128214;</div>
        <div class="verb-name" id="verbInfinitive">eten</div>
        <div class="verb-meaning" id="verbMeaning">to eat</div>
        <div class="verb-flavor" id="verbFlavor">"Every meal is a small negotiation with the self."</div>
        <div class="challenge-text" id="verbChallenge">Wat is het voltooid deelwoord?</div>
        <div class="pattern-badge" id="patternBadge">Sterk werkwoord</div>
        <button class="hint-btn" id="hintBtn" onclick="toggleHint()">Hint</button>
        <div class="hint-bubble" id="hintBubble"></div>
      </div>
      <div style="display:none"><span id="monsterName"></span><span id="monsterHP"></span></div>

      <div class="answer-grid" id="answerGrid">
        <div class="answer-input-wrap">
          <input type="text" class="answer-input" id="arenaInput" placeholder="Typ je antwoord..." autocomplete="off" autocapitalize="none" />
          <button class="answer-submit-btn" id="arenaSubmit" onclick="submitArenaAnswer()">Check</button>
        </div>
      </div>
      <div class="combo-display" id="comboDisplay"></div>
      <div class="feedback-text" id="feedbackText">Typ de juiste vorm...</div>
    </div>

    <div class="pattern-legend">
      <h3>Werkwoord Patronen — Klik om te filteren</h3>
      <div class="pattern-list" id="patternList"></div>
      <div class="export-bar">
        <button class="export-btn" onclick="exportWrongVerbs()">Download fouten als PDF</button>
        <button class="export-btn" onclick="exportAllVerbs()">Download alle werkwoorden</button>
      </div>
    </div>
  </div>
  </div><!-- /sub-arena -->
  <div class="subtab-content" id="sub-adventure">
  <div class="adventure-container">
    <div class="help-row">
      <div class="scenario-bar" id="scenarioBar" style="flex:1"></div>
      <button class="help-btn" onclick="showHelp('adventure')" title="Hulp">?</button>
    </div>
    <div class="adventure-progress" id="adventureProgress"></div>
    <div id="adventureScene"></div>
    <div class="adventure-feedback" id="adventureFeedback"></div>
  </div>
  </div><!-- /sub-adventure -->

  <div class="subtab-content" id="sub-daily">
    <div class="daily-container">
      <div class="help-row" style="justify-content:center;margin-bottom:8px;">
        <div class="daily-header">Dagelijkse Uitdaging</div>
        <button class="help-btn" onclick="showHelp('daily')" title="Hulp">?</button>
      </div>
      <div class="daily-streak" id="dailyStreak">Huidige reeks: 0 dagen</div>
      <div class="daily-challenge-box" id="dailyChallengeBox"></div>
      <div class="daily-results" id="dailyResults"></div>
    </div>
  </div><!-- /sub-daily -->

  <div class="subtab-content" id="sub-reader">
  <div class="reader-container">
    <div class="help-row">
      <div class="reader-url-bar" style="flex:1">
        <span class="reader-url-icon">&#128279;</span>
        <input type="text" class="reader-url-input" id="readerUrlInput" placeholder="Plak een URL van NOS.nl of Wikipedia NL..." />
        <button class="reader-load-btn" id="readerLoadBtn" onclick="readerFetchArticle()">Laden</button>
      </div>
      <button class="help-btn" onclick="showHelp('reader')" title="Hulp">?</button>
    </div>
    <div class="reader-url-hints">
      <span class="reader-hint-chip" onclick="document.getElementById('readerUrlInput').value='https://nos.nl/artikel/';document.getElementById('readerUrlInput').focus();">&#128240; NOS.nl</span>
      <span class="reader-hint-chip" onclick="document.getElementById('readerUrlInput').value='https://nl.wikipedia.org/wiki/';document.getElementById('readerUrlInput').focus();">&#128214; Wikipedia NL</span>
    </div>

    <div class="reader-layout">
      <div class="reader-article-area" id="readerArticleArea">
        <div class="reader-empty-state" id="readerEmptyState">
          <div class="reader-empty-icon">&#128220;</div>
          <h3>Plak een URL om te beginnen</h3>
          <p>Plak een link van NOS.nl of de Nederlandse Wikipedia hierboven en klik op "Laden" om het artikel interactief te lezen.</p>
          <div class="reader-tips">
            <div class="reader-tip"><span class="reader-tip-icon">&#128065;</span><span class="reader-tip-title">Hover</span>Vertaling bij elk woord</div>
            <div class="reader-tip"><span class="reader-tip-icon">&#128161;</span><span class="reader-tip-title">Werkwoorden</span>Onderstreepte woorden tonen vervoegingen</div>
            <div class="reader-tip"><span class="reader-tip-icon">&#11088;</span><span class="reader-tip-title">Opslaan</span>Klik om woorden te bewaren</div>
            <div class="reader-tip"><span class="reader-tip-icon">&#128196;</span><span class="reader-tip-title">Exporteer</span>Download als PDF</div>
          </div>
        </div>
      </div>

      <div class="reader-sidebar" id="readerSidebar">
        <div class="reader-sidebar-header">
          <span>&#128218; Mijn Woordenlijst</span>
          <span class="reader-sidebar-count" id="readerWordCount">0 woorden</span>
        </div>
        <div class="reader-word-list" id="readerWordList">
          <div class="reader-sidebar-empty">&#9997; Klik op woorden in de tekst om ze op te slaan.</div>
        </div>
        <div class="reader-sidebar-footer">
          <button class="reader-export-btn" id="readerExportBtn" onclick="readerExportPDF()" disabled>&#128196; Exporteer PDF</button>
          <button class="reader-clear-btn" onclick="readerClearAllWords()">&#128465;</button>
        </div>
      </div>
    </div>
  </div>
  </div><!-- /sub-reader -->
</div><!-- /tab-oefeningen -->

<!-- MAIN TAB: SPEL -->
<div class="tab-content" id="tab-spel">
  <div class="spel-container">
    <div class="help-row" style="margin-bottom:12px;">
      <div style="flex:1"></div>
      <button class="help-btn" onclick="showHelp('spel')" title="Hulp">?</button>
    </div>
    <div class="spel-difficulty-bar" id="spelDifficultyBar">
      <div class="spel-welcome">
        <div class="spel-welcome-icon">&#127470;&#127473;</div>
        <h2 class="spel-welcome-title">Het Nederlandse Avontuur</h2>
        <p class="spel-welcome-desc">Overleef het dagelijks leven in Nederland. Echte NOS-koppen worden verweven in absurde scenario's met taaloefeningen.</p>
      </div>
      <div class="spel-diff-buttons">
        <button class="spel-diff-btn" data-diff="easy" onclick="setSpelDifficulty('easy')">
          <span class="spel-diff-icon">&#127807;</span>
          <span class="spel-diff-label">Makkelijk</span>
          <span class="spel-diff-desc">Meerkeuze, hints, geen timer</span>
        </button>
        <button class="spel-diff-btn" data-diff="medium" onclick="setSpelDifficulty('medium')">
          <span class="spel-diff-icon">&#9889;</span>
          <span class="spel-diff-label">Gemiddeld</span>
          <span class="spel-diff-desc">Meer gaten, 30s timer</span>
        </button>
        <button class="spel-diff-btn" data-diff="hard" onclick="setSpelDifficulty('hard')">
          <span class="spel-diff-icon">&#128293;</span>
          <span class="spel-diff-label">Moeilijk</span>
          <span class="spel-diff-desc">Typ antwoord, 15s timer</span>
        </button>
      </div>
      <button class="spel-start-btn" id="spelStartBtn" onclick="startSpelRound()" disabled>Start Avontuur</button>
      <div class="de-skill-overview" id="deSkillOverview">
        <h3>Vaardigheden</h3>
        <div id="deSkillRows"></div>
      </div>
      <div class="de-thought-cabinet" id="deThoughtCabinet">
        <h3>Gedachtenkabinet</h3>
        <div class="de-thought-grid" id="deThoughtGrid"></div>
      </div>
    </div>
    <div class="spel-game-area" id="spelGameArea" style="display:none;">
      <div class="de-hud" id="deHud">
        <div class="de-hud-location" id="deHudLocation"></div>
        <div class="de-hud-skills" id="deHudSkills"></div>
        <div class="de-hud-xp" id="deHudXp">&#11088; 0 XP</div>
        <div class="de-timer-bar" id="deTimerBar" style="display:none;width:100%;">
          <div class="de-timer-fill" id="deTimerFill"></div>
        </div>
      </div>
      <div class="de-dialogue-container" id="deDialogueLog"></div>
      <div class="de-choices" id="deChoices" style="display:none;"></div>
      <div class="spel-source" id="spelSource"></div>
    </div>
  </div>
</div>

<!-- MAIN TAB: LEESHOEK -->
<div class="tab-content" id="tab-news">
  <div class="news-container">
    <div class="help-row" style="justify-content:space-between;margin-bottom:12px;">
      <div class="news-sub-nav">
        <button class="news-sub-btn active" onclick="switchNewsSub('practice')">Oefenartikelen</button>
        <button class="news-sub-btn" onclick="switchNewsSub('nos')">NOS Nieuws</button>
      </div>
      <button class="help-btn" onclick="showHelp('news')" title="Hulp">?</button>
    </div>
    <div id="newsPractice">
      <div class="news-nav" id="newsNav"></div>
      <div id="newsContent"></div>
    </div>
    <div id="newsNOS" style="display:none;">
      <div class="nos-header">
        <p class="nos-desc">Lees elke dag het laatste Nederlandse nieuws van NOS.nl. Goed voor je leesvaardigheid!</p>
        <button class="export-btn" onclick="fetchNOSFeed()" id="nosRefreshBtn">Vernieuwen</button>
      </div>
      <div id="nosLoading" style="display:none;text-align:center;padding:40px;">
        <div class="nos-spinner"></div>
        <p style="margin-top:12px;color:#666;">Nieuws laden...</p>
      </div>
      <div id="nosFeed"></div>
      <div id="nosError" style="display:none;" class="nos-error-box">
        <p>Kon het NOS-nieuws niet laden. Controleer je internetverbinding en probeer het opnieuw.</p>
      </div>
    </div>

    <!-- Saved Translations Panel -->
    <div class="saved-translations-panel" id="savedTranslationsPanel">
      <div class="saved-translations-header">
        <span>&#128221; Mijn Vertalingen</span>
        <span class="saved-translations-count" id="savedTranslationsCount">0</span>
      </div>
      <div class="saved-translations-list" id="savedTranslationsList">
        <div class="saved-translations-empty">Selecteer tekst in een artikel en klik "Vertalen" om vertalingen op te slaan.</div>
      </div>
      <div class="saved-translations-footer">
        <button class="saved-translations-export" id="savedTranslationsExport" onclick="exportSavedTranslations()" disabled>&#128196; Download PDF</button>
      </div>
    </div>
  </div>
</div>

<!-- Translate Toolbar (floating, used for Leeshoek) -->
<div class="translate-toolbar" id="translateToolbar">
  <button class="translate-toolbar-btn" onclick="translateSelectedText()">&#127760; Vertalen</button>
</div>

<!-- Translate Popup -->
<div class="translate-popup" id="translatePopup">
  <div class="translate-popup-accent"></div>
  <button class="translate-popup-close" onclick="closeTranslatePopup()">&#215;</button>
  <div class="translate-popup-body">
    <div class="translate-popup-nl" id="translatePopupNL"></div>
    <div class="translate-popup-en" id="translatePopupEN"></div>
    <div class="translate-popup-actions">
      <button class="translate-popup-save" onclick="saveCurrentTranslation()">&#128190; Opslaan</button>
    </div>
  </div>
</div>

<!-- MAIN TAB: WOORDENSCHAT -->
<div class="tab-content" id="tab-vocab">
  <div class="vocab-container">
    <div class="help-row" style="margin-bottom:12px;">
      <div class="vocab-sub-nav" style="flex:1">
        <button class="vocab-sub-btn active" data-vsub="exercise" onclick="switchVocabSub('exercise')">Oefenen</button>
        <button class="vocab-sub-btn" data-vsub="list" onclick="switchVocabSub('list')">Lijst</button>
      </div>
      <button class="help-btn" onclick="showHelp('vocab')" title="Hulp">?</button>
    </div>

    <!-- Exercise Mode -->
    <div class="vocab-sub-content active" id="vocab-exercise">
      <div class="vocab-exercise-card">
        <div class="vocab-exercise-type" id="vocabExType">Vul het voorzetsel in</div>
        <div class="vocab-exercise-prompt" id="vocabExPrompt">Laden...</div>
        <div class="vocab-exercise-hint" id="vocabExHint"></div>
        <div class="vocab-exercise-input-wrap">
          <input type="text" class="vocab-exercise-input" id="vocabExInput" placeholder="Typ je antwoord..." autocomplete="off" autocapitalize="none" />
          <button class="vocab-exercise-check" id="vocabExCheck" onclick="checkVocabExercise()">Check</button>
        </div>
        <div class="vocab-exercise-feedback" id="vocabExFeedback"></div>
        <div class="vocab-exercise-score">
          <span>Score: <strong id="vocabExCorrect">0</strong> / <strong id="vocabExTotal">0</strong></span>
          <button class="vocab-exercise-next" id="vocabExNext" onclick="nextVocabExercise()" style="display:none">Volgende</button>
        </div>
      </div>
    </div>

    <!-- List Mode -->
    <div class="vocab-sub-content" id="vocab-list">
      <div class="vocab-list-toggle">
        <button class="vocab-list-btn active" data-vlist="verbs" onclick="switchVocabList('verbs')">Werkwoorden (<span id="vocabVerbCount">0</span>)</button>
        <button class="vocab-list-btn" data-vlist="prep" onclick="switchVocabList('prep')">Vaste Voorzetsels (<span id="vocabPrepCount">0</span>)</button>
      </div>
      <div class="vocab-filter-bar">
        <input type="text" class="vocab-search" id="vocabSearch" placeholder="Zoeken..." oninput="renderVocabList()" />
        <div class="vocab-filter-chips" id="vocabFilterChips"></div>
      </div>
      <div class="vocab-table-wrap" id="vocabTableWrap"></div>
    </div>
  </div>
</div>

<!-- MAIN TAB: SPIEKBRIEFJES -->
<div class="tab-content" id="tab-spiekbriefjes">
  <div class="subtab-bar">
    <button class="subtab-btn active" data-subtab="sheets" data-maintab="spiekbriefjes">Werkwoorden</button>
    <button class="subtab-btn" data-subtab="sheets-prep" data-maintab="spiekbriefjes">Voorzetsels</button>
    <button class="subtab-btn" data-subtab="phrases" data-maintab="spiekbriefjes">Uitdrukkingen</button>
    <button class="subtab-btn" data-subtab="grammar" data-maintab="spiekbriefjes">Grammatica</button>
  </div>

  <div class="subtab-content active" id="sub-sheets">
  <div class="sheets-container">
    <div class="help-row" style="margin-bottom:12px;">
      <div class="sheets-sub-nav" style="flex:1">
        <button class="sheets-sub-btn active" data-ssub="ready" onclick="switchSheetSub('ready')">Kant-en-klaar</button>
        <button class="sheets-sub-btn" data-ssub="custom" onclick="switchSheetSub('custom')">Eigen Selectie</button>
        <button class="sheets-sub-btn" data-ssub="download" onclick="switchSheetSub('download')">Alles Downloaden</button>
      </div>
      <button class="help-btn" onclick="showHelp('sheets')" title="Hulp">?</button>
    </div>

    <!-- Sub 1: Kant-en-klaar -->
    <div class="sheets-sub-content active" id="sheets-ready">
      <div class="sheets-grid" id="sheetsGrid"></div>
    </div>

    <!-- Sub 2: Eigen Selectie -->
    <div class="sheets-sub-content" id="sheets-custom">
      <div class="sheets-builder">
        <div class="sheets-step">
          <div class="sheets-step-header"><span class="sheets-step-num">1</span> Kies woorden</div>
          <div class="sheets-word-tabs">
            <button class="sheets-word-tab active" onclick="switchSheetWordTab('verbs')">Werkwoorden</button>
            <button class="sheets-word-tab" onclick="switchSheetWordTab('prep')">Vaste Voorzetsels</button>
          </div>
          <div class="sheets-word-toolbar">
            <input type="text" class="sheets-search" id="sheetsSearch" placeholder="Zoeken..." oninput="renderSheetWordList()" />
            <div class="sheets-filter-chips" id="sheetsFilterChips"></div>
          </div>
          <div class="sheets-select-actions">
            <button class="sheets-select-btn" onclick="sheetSelectAll()">Alles selecteren</button>
            <button class="sheets-select-btn" onclick="sheetSelectNone()">Niets selecteren</button>
            <span class="sheets-selected-count" id="sheetsSelectedCount">0 woorden geselecteerd</span>
          </div>
          <div class="sheets-word-list" id="sheetsWordList"></div>
          <div class="sheets-custom-word">
            <div class="sheets-step-label">Eigen woord toevoegen:</div>
            <div class="sheets-custom-inputs">
              <input type="text" class="sheets-custom-input" id="sheetsCustomNL" placeholder="Nederlands" />
              <input type="text" class="sheets-custom-input" id="sheetsCustomEN" placeholder="Engels" />
              <button class="sheets-custom-add" onclick="addCustomWord()">+</button>
            </div>
            <div class="sheets-custom-list" id="sheetsCustomList"></div>
          </div>
        </div>

        <div class="sheets-step">
          <div class="sheets-step-header"><span class="sheets-step-num">2</span> Kies lay-out</div>
          <div class="sheets-layout-options" id="sheetsLayoutOptions">
            <label class="sheets-layout-card active" data-layout="table">
              <input type="radio" name="sheetLayout" value="table" checked hidden />
              <span class="sheets-layout-icon">&#9638;</span>
              <span class="sheets-layout-name">Tabel</span>
            </label>
            <label class="sheets-layout-card" data-layout="flashcards">
              <input type="radio" name="sheetLayout" value="flashcards" hidden />
              <span class="sheets-layout-icon">&#9641;</span>
              <span class="sheets-layout-name">Flashcards</span>
            </label>
            <label class="sheets-layout-card" data-layout="mindmap">
              <input type="radio" name="sheetLayout" value="mindmap" hidden />
              <span class="sheets-layout-icon">&#10040;</span>
              <span class="sheets-layout-name">Mindmap</span>
            </label>
            <label class="sheets-layout-card" data-layout="twocol">
              <input type="radio" name="sheetLayout" value="twocol" hidden />
              <span class="sheets-layout-icon">&#9646;&#9646;</span>
              <span class="sheets-layout-name">Twee kolommen</span>
            </label>
            <label class="sheets-layout-card" data-layout="sentences">
              <input type="radio" name="sheetLayout" value="sentences" hidden />
              <span class="sheets-layout-icon">&#9776;</span>
              <span class="sheets-layout-name">Zinnen</span>
            </label>
          </div>
        </div>

        <div class="sheets-step">
          <div class="sheets-step-header"><span class="sheets-step-num">3</span> Download</div>
          <button class="sheets-download-btn" onclick="generateCustomSheet()">Download Spiekbriefje</button>
        </div>
      </div>
    </div>

    <!-- Sub 3: Alles Downloaden -->
    <div class="sheets-sub-content" id="sheets-download">
      <div class="sheets-download-grid" id="sheetsDownloadGrid"></div>
    </div>
  </div>
  </div><!-- /sub-sheets -->

  <div class="subtab-content" id="sub-sheets-prep">
    <div class="sheets-container">
      <p style="color:#666;margin-bottom:16px;">Klik op een kaart om een spiekbriefje met vaste voorzetsels te genereren.</p>
      <div class="sheets-grid" id="sheetsPrepGrid"></div>
    </div>
  </div><!-- /sub-sheets-prep -->

  <div class="subtab-content" id="sub-phrases">
  <div class="phrases-container">
    <div class="help-row" style="margin-bottom:12px;">
      <div class="phrases-sub-nav" style="flex:1">
        <button class="phrases-cat-btn active" data-pcat="all" onclick="switchPhrasesCat('all')">Alles</button>
        <button class="phrases-cat-btn" data-pcat="opinion" onclick="switchPhrasesCat('opinion')">Mening</button>
        <button class="phrases-cat-btn" data-pcat="conversation" onclick="switchPhrasesCat('conversation')">Gesprek</button>
        <button class="phrases-cat-btn" data-pcat="connectors" onclick="switchPhrasesCat('connectors')">Voegwoorden</button>
        <button class="phrases-cat-btn" data-pcat="time" onclick="switchPhrasesCat('time')">Tijd</button>
        <button class="phrases-cat-btn" data-pcat="emotion" onclick="switchPhrasesCat('emotion')">Emotie</button>
        <button class="phrases-cat-btn" data-pcat="argument" onclick="switchPhrasesCat('argument')">Argumentatie</button>
        <button class="phrases-cat-btn" data-pcat="formal" onclick="switchPhrasesCat('formal')">Formeel</button>
        <button class="phrases-cat-btn" data-pcat="idiom" onclick="switchPhrasesCat('idiom')">Spreekwoorden</button>
      </div>
      <button class="help-btn" onclick="showHelp('phrases')" title="Hulp">?</button>
    </div>
    <div class="phrases-search-bar">
      <input type="text" class="phrases-search" id="phrasesSearch" placeholder="Zoek een uitdrukking..." oninput="renderPhrases()" />
    </div>
    <div class="phrases-list" id="phrasesList"></div>
    <div class="phrases-export-bar">
      <button class="export-btn" onclick="exportPhrases()">Download alle uitdrukkingen als PDF</button>
    </div>
  </div>
  </div><!-- /sub-phrases -->

  <div class="subtab-content" id="sub-grammar">
  <div class="grammar-container">
    <div class="help-row" style="margin-bottom:12px;">
      <div class="grammar-sub-nav" style="flex:1">
        <button class="grammar-cat-btn active" data-gcat="all" onclick="switchGrammarCat('all')">Alles</button>
        <button class="grammar-cat-btn" data-gcat="verbs" onclick="switchGrammarCat('verbs')">Werkwoorden</button>
        <button class="grammar-cat-btn" data-gcat="spelling" onclick="switchGrammarCat('spelling')">Spelling</button>
        <button class="grammar-cat-btn" data-gcat="articles" onclick="switchGrammarCat('articles')">De / Het</button>
        <button class="grammar-cat-btn" data-gcat="wordorder" onclick="switchGrammarCat('wordorder')">Woordvolgorde</button>
        <button class="grammar-cat-btn" data-gcat="pronouns" onclick="switchGrammarCat('pronouns')">Voornaamwoorden</button>
        <button class="grammar-cat-btn" data-gcat="other" onclick="switchGrammarCat('other')">Overig</button>
      </div>
      <button class="help-btn" onclick="showHelp('grammar')" title="Hulp">?</button>
    </div>
    <div class="grammar-grid" id="grammarGrid"></div>
  </div>
  </div><!-- /sub-grammar -->
</div><!-- /tab-spiekbriefjes -->

<!-- Reader Tooltip -->
<div class="reader-tooltip" id="readerTooltip"></div>

<!-- Reader Sentence Translate Button -->
<button class="reader-sentence-btn" id="readerSentenceBtn" onclick="readerTranslateSelection()">&#127760; Vertaal selectie</button>

<!-- Reader Sentence Popup -->
<div class="reader-sentence-popup" id="readerSentencePopup">
  <div class="reader-sp-accent"></div>
  <button class="reader-sp-close" onclick="readerCloseSentencePopup()">&#215;</button>
  <div class="reader-sp-body">
    <div class="reader-sp-label">Vertaling</div>
    <div class="reader-sp-original" id="readerSpOriginal"></div>
    <div class="reader-sp-translation" id="readerSpTranslation"></div>
  </div>
</div>

<!-- Help Overlay -->
<div class="help-overlay" id="helpOverlay" onclick="if(event.target===this)closeHelp()">
  <div class="help-modal" id="helpModal"></div>
</div>

<!-- Level Up Overlay -->
<div class="level-up-overlay" id="levelUpOverlay">
  <div class="level-up-box">
    <h2 id="levelUpTitle">LEVEL UP!</h2>
    <p id="levelUpText">Je bent nu level 2!</p>
    <button class="level-up-close" onclick="document.getElementById('levelUpOverlay').classList.remove('show')">Doorgaan</button>
  </div>
</div>


<script>
// ==========================================
// GAME STATE
// ==========================================
const state = {
  xp: 0,
  level: 1,
  streak: 0,
  bestStreak: 0,
  mastered: new Set(),
  verbHistory: {},
  arenaMode: 'perfectum',
  activePattern: null,
  dailyStreak: 0,
  lastDaily: null,
};

function saveState() {
  const s = {...state, mastered: [...state.mastered]};
  try { localStorage.setItem('dutchquest_state', JSON.stringify(s)); } catch(e) {}
}

function loadState() {
  try {
    const s = JSON.parse(localStorage.getItem('dutchquest_state'));
    if (s) {
      Object.assign(state, s);
      state.mastered = new Set(s.mastered || []);
    }
  } catch(e) {}
  updateStats();
}

function xpForLevel(lvl) { return 80 + lvl * 40; }

function addXP(amount) {
  state.xp += amount;
  const needed = xpForLevel(state.level);
  if (state.xp >= needed) {
    state.xp -= needed;
    state.level++;
    showLevelUp();
  }
  updateStats();
  saveState();
}

function showLevelUp() {
  const titles = ['Gefeliciteerd!', 'Level Up!', 'Uitstekend!', 'Voortreffelijk!'];
  document.getElementById('levelUpTitle').textContent = titles[state.level % titles.length];
  const msgs = [
    `Level ${state.level} — Je gedachten worden scherper.`,
    `Level ${state.level} — De stad openbaart zich langzaam.`,
    `Level ${state.level} — Je taalgevoel groeit.`,
    `Level ${state.level} — De woorden gehoorzamen je nu.`,
  ];
  document.getElementById('levelUpText').textContent = msgs[state.level % msgs.length];
  document.getElementById('levelUpOverlay').classList.add('show');
}

function updateStats() {
  const el = (id) => document.getElementById(id);
  if (el('playerLevel')) el('playerLevel').textContent = state.level;
  if (el('playerXP')) el('playerXP').textContent = state.xp;
  if (el('xpNeeded')) el('xpNeeded').textContent = xpForLevel(state.level);
  if (el('streakCount')) el('streakCount').textContent = state.streak;
  if (el('masteredCount')) el('masteredCount').textContent = state.mastered.size;
}

// ==========================================
// VERB DATABASE
// ==========================================
const VERB_PATTERNS = {
  'ij→ee→e': { color: '#D40920', label: 'ij \u2192 ee \u2192 e', example: 'schrijven' },
  'ie→oo→o': { color: '#1356A2', label: 'ie \u2192 oo \u2192 o', example: 'vliegen' },
  'i→o→o':   { color: '#b08600', label: 'i \u2192 o \u2192 o', example: 'beginnen' },
  'e→a→e':   { color: '#2d8a56', label: 'e \u2192 a \u2192 e', example: 'eten' },
  'e→a→o':   { color: '#8B4513', label: 'e \u2192 a \u2192 o', example: 'spreken' },
  'a→oe→a':  { color: '#555', label: 'a \u2192 oe \u2192 a', example: 'dragen' },
  'special':  { color: '#D40920', label: 'Bijzonder', example: 'zijn' },
  'modal':    { color: '#1356A2', label: 'Modaal', example: 'kunnen' },
  'mixed':    { color: '#8B4513', label: 'Gemengd (t/d)', example: 'brengen' },
  'regular':  { color: '#2d8a56', label: 'Regelmatig (t/d)', example: 'werken' },
};

const VERBS = [
  { id:'eten', inf:'eten', en:'to eat', imp_s:'at', imp_p:'aten', pp:'gegeten', aux:'heeft', pattern:'e→a→e', level:'B1' },
  { id:'lezen', inf:'lezen', en:'to read', imp_s:'las', imp_p:'lazen', pp:'gelezen', aux:'heeft', pattern:'e→a→e', level:'B1' },
  { id:'geven', inf:'geven', en:'to give', imp_s:'gaf', imp_p:'gaven', pp:'gegeven', aux:'heeft', pattern:'e→a→e', level:'B1' },
  { id:'vergeten', inf:'vergeten', en:'to forget', imp_s:'vergat', imp_p:'vergaten', pp:'vergeten', aux:'is/heeft', pattern:'e→a→e', level:'B1' },
  { id:'meten', inf:'meten', en:'to measure', imp_s:'mat', imp_p:'maten', pp:'gemeten', aux:'heeft', pattern:'e→a→e', level:'B1' },
  { id:'treden', inf:'treden', en:'to step', imp_s:'trad', imp_p:'traden', pp:'getreden', aux:'is/heeft', pattern:'e→a→e', level:'B1' },
  { id:'genezen', inf:'genezen', en:'to heal', imp_s:'genas', imp_p:'genazen', pp:'genezen', aux:'is/heeft', pattern:'e→a→e', level:'B1' },
  { id:'spreken', inf:'spreken', en:'to speak', imp_s:'sprak', imp_p:'spraken', pp:'gesproken', aux:'heeft', pattern:'e→a→o', level:'B1' },
  { id:'nemen', inf:'nemen', en:'to take', imp_s:'nam', imp_p:'namen', pp:'genomen', aux:'heeft', pattern:'e→a→o', level:'B1' },
  { id:'breken', inf:'breken', en:'to break', imp_s:'brak', imp_p:'braken', pp:'gebroken', aux:'heeft', pattern:'e→a→o', level:'B1' },
  { id:'stelen', inf:'stelen', en:'to steal', imp_s:'stal', imp_p:'stalen', pp:'gestolen', aux:'heeft', pattern:'e→a→o', level:'B1' },
  { id:'bevelen', inf:'bevelen', en:'to command', imp_s:'beval', imp_p:'bevalen', pp:'bevolen', aux:'heeft', pattern:'e→a→o', level:'B1' },
  { id:'schrijven', inf:'schrijven', en:'to write', imp_s:'schreef', imp_p:'schreven', pp:'geschreven', aux:'heeft', pattern:'ij→ee→e', level:'B1' },
  { id:'rijden', inf:'rijden', en:'to drive/ride', imp_s:'reed', imp_p:'reden', pp:'gereden', aux:'heeft/is', pattern:'ij→ee→e', level:'B1' },
  { id:'blijven', inf:'blijven', en:'to stay', imp_s:'bleef', imp_p:'bleven', pp:'gebleven', aux:'is', pattern:'ij→ee→e', level:'B1' },
  { id:'krijgen', inf:'krijgen', en:'to get/receive', imp_s:'kreeg', imp_p:'kregen', pp:'gekregen', aux:'heeft', pattern:'ij→ee→e', level:'B1' },
  { id:'kijken', inf:'kijken', en:'to look', imp_s:'keek', imp_p:'keken', pp:'gekeken', aux:'heeft', pattern:'ij→ee→e', level:'B1' },
  { id:'lijken', inf:'lijken', en:'to seem', imp_s:'leek', imp_p:'leken', pp:'geleken', aux:'heeft', pattern:'ij→ee→e', level:'B1' },
  { id:'snijden', inf:'snijden', en:'to cut', imp_s:'sneed', imp_p:'sneden', pp:'gesneden', aux:'heeft', pattern:'ij→ee→e', level:'B1' },
  { id:'stijgen', inf:'stijgen', en:'to rise', imp_s:'steeg', imp_p:'stegen', pp:'gestegen', aux:'is', pattern:'ij→ee→e', level:'B1' },
  { id:'verdwijnen', inf:'verdwijnen', en:'to disappear', imp_s:'verdween', imp_p:'verdwenen', pp:'verdwenen', aux:'is', pattern:'ij→ee→e', level:'B1' },
  { id:'bijten', inf:'bijten', en:'to bite', imp_s:'beet', imp_p:'beten', pp:'gebeten', aux:'heeft', pattern:'ij→ee→e', level:'B1' },
  { id:'vliegen', inf:'vliegen', en:'to fly', imp_s:'vloog', imp_p:'vlogen', pp:'gevlogen', aux:'heeft/is', pattern:'ie→oo→o', level:'B1' },
  { id:'bieden', inf:'bieden', en:'to offer', imp_s:'bood', imp_p:'boden', pp:'geboden', aux:'heeft', pattern:'ie→oo→o', level:'B1' },
  { id:'liegen', inf:'liegen', en:'to lie', imp_s:'loog', imp_p:'logen', pp:'gelogen', aux:'heeft', pattern:'ie→oo→o', level:'B1' },
  { id:'verbieden', inf:'verbieden', en:'to forbid', imp_s:'verbood', imp_p:'verboden', pp:'verboden', aux:'heeft', pattern:'ie→oo→o', level:'B1' },
  { id:'gieten', inf:'gieten', en:'to pour', imp_s:'goot', imp_p:'goten', pp:'gegoten', aux:'heeft', pattern:'ie→oo→o', level:'B1' },
  { id:'schieten', inf:'schieten', en:'to shoot', imp_s:'schoot', imp_p:'schoten', pp:'geschoten', aux:'heeft', pattern:'ie→oo→o', level:'B1' },
  { id:'kiezen', inf:'kiezen', en:'to choose', imp_s:'koos', imp_p:'kozen', pp:'gekozen', aux:'heeft', pattern:'ie→oo→o', level:'B1' },
  { id:'verliezen', inf:'verliezen', en:'to lose', imp_s:'verloor', imp_p:'verloren', pp:'verloren', aux:'heeft', pattern:'ie→oo→o', level:'B1' },
  { id:'beginnen', inf:'beginnen', en:'to begin', imp_s:'begon', imp_p:'begonnen', pp:'begonnen', aux:'is/heeft', pattern:'i→o→o', level:'B1' },
  { id:'winnen', inf:'winnen', en:'to win', imp_s:'won', imp_p:'wonnen', pp:'gewonnen', aux:'heeft', pattern:'i→o→o', level:'B1' },
  { id:'zwemmen', inf:'zwemmen', en:'to swim', imp_s:'zwom', imp_p:'zwommen', pp:'gezwommen', aux:'heeft', pattern:'i→o→o', level:'B1' },
  { id:'drinken', inf:'drinken', en:'to drink', imp_s:'dronk', imp_p:'dronken', pp:'gedronken', aux:'heeft', pattern:'i→o→o', level:'B1' },
  { id:'vinden', inf:'vinden', en:'to find', imp_s:'vond', imp_p:'vonden', pp:'gevonden', aux:'heeft', pattern:'i→o→o', level:'B1' },
  { id:'zingen', inf:'zingen', en:'to sing', imp_s:'zong', imp_p:'zongen', pp:'gezongen', aux:'heeft', pattern:'i→o→o', level:'B1' },
  { id:'springen', inf:'springen', en:'to jump', imp_s:'sprong', imp_p:'sprongen', pp:'gesprongen', aux:'is/heeft', pattern:'i→o→o', level:'B1' },
  { id:'klinken', inf:'klinken', en:'to sound', imp_s:'klonk', imp_p:'klonken', pp:'geklonken', aux:'heeft', pattern:'i→o→o', level:'B1' },
  { id:'binden', inf:'binden', en:'to bind', imp_s:'bond', imp_p:'bonden', pp:'gebonden', aux:'heeft', pattern:'i→o→o', level:'B1' },
  { id:'dragen', inf:'dragen', en:'to carry/wear', imp_s:'droeg', imp_p:'droegen', pp:'gedragen', aux:'heeft', pattern:'a→oe→a', level:'B1' },
  { id:'slaan', inf:'slaan', en:'to hit', imp_s:'sloeg', imp_p:'sloegen', pp:'geslagen', aux:'heeft', pattern:'a→oe→a', level:'B1' },
  { id:'graven', inf:'graven', en:'to dig', imp_s:'groef', imp_p:'groeven', pp:'gegraven', aux:'heeft', pattern:'a→oe→a', level:'B1' },
  { id:'varen', inf:'varen', en:'to sail', imp_s:'voer', imp_p:'voeren', pp:'gevaren', aux:'heeft/is', pattern:'a→oe→a', level:'B1' },
  { id:'zijn', inf:'zijn', en:'to be', imp_s:'was', imp_p:'waren', pp:'geweest', aux:'is', pattern:'special', level:'B1' },
  { id:'hebben', inf:'hebben', en:'to have', imp_s:'had', imp_p:'hadden', pp:'gehad', aux:'heeft', pattern:'special', level:'B1' },
  { id:'gaan', inf:'gaan', en:'to go', imp_s:'ging', imp_p:'gingen', pp:'gegaan', aux:'is', pattern:'special', level:'B1' },
  { id:'komen', inf:'komen', en:'to come', imp_s:'kwam', imp_p:'kwamen', pp:'gekomen', aux:'is', pattern:'special', level:'B1' },
  { id:'doen', inf:'doen', en:'to do', imp_s:'deed', imp_p:'deden', pp:'gedaan', aux:'heeft', pattern:'special', level:'B1' },
  { id:'staan', inf:'staan', en:'to stand', imp_s:'stond', imp_p:'stonden', pp:'gestaan', aux:'heeft', pattern:'special', level:'B1' },
  { id:'zien', inf:'zien', en:'to see', imp_s:'zag', imp_p:'zagen', pp:'gezien', aux:'heeft', pattern:'special', level:'B1' },
  { id:'zitten', inf:'zitten', en:'to sit', imp_s:'zat', imp_p:'zaten', pp:'gezeten', aux:'heeft', pattern:'special', level:'B1' },
  { id:'liggen', inf:'liggen', en:'to lie (down)', imp_s:'lag', imp_p:'lagen', pp:'gelegen', aux:'heeft', pattern:'special', level:'B1' },
  { id:'slapen', inf:'slapen', en:'to sleep', imp_s:'sliep', imp_p:'sliepen', pp:'geslapen', aux:'heeft', pattern:'special', level:'B1' },
  { id:'lopen', inf:'lopen', en:'to walk', imp_s:'liep', imp_p:'liepen', pp:'gelopen', aux:'heeft/is', pattern:'special', level:'B1' },
  { id:'houden', inf:'houden', en:'to hold/keep', imp_s:'hield', imp_p:'hielden', pp:'gehouden', aux:'heeft', pattern:'special', level:'B1' },
  { id:'worden', inf:'worden', en:'to become', imp_s:'werd', imp_p:'werden', pp:'geworden', aux:'is', pattern:'special', level:'B1' },
  { id:'weten', inf:'weten', en:'to know', imp_s:'wist', imp_p:'wisten', pp:'geweten', aux:'heeft', pattern:'special', level:'B1' },
  { id:'denken', inf:'denken', en:'to think', imp_s:'dacht', imp_p:'dachten', pp:'gedacht', aux:'heeft', pattern:'special', level:'B1' },
  { id:'brengen', inf:'brengen', en:'to bring', imp_s:'bracht', imp_p:'brachten', pp:'gebracht', aux:'heeft', pattern:'mixed', level:'B1' },
  { id:'kopen', inf:'kopen', en:'to buy', imp_s:'kocht', imp_p:'kochten', pp:'gekocht', aux:'heeft', pattern:'mixed', level:'B1' },
  { id:'zoeken', inf:'zoeken', en:'to search', imp_s:'zocht', imp_p:'zochten', pp:'gezocht', aux:'heeft', pattern:'mixed', level:'B1' },
  { id:'vragen', inf:'vragen', en:'to ask', imp_s:'vroeg', imp_p:'vroegen', pp:'gevraagd', aux:'heeft', pattern:'mixed', level:'B1' },
  { id:'wegen', inf:'wegen', en:'to weigh', imp_s:'woog', imp_p:'wogen', pp:'gewogen', aux:'heeft', pattern:'mixed', level:'B1' },
  { id:'lachen', inf:'lachen', en:'to laugh', imp_s:'lachte', imp_p:'lachten', pp:'gelachen', aux:'heeft', pattern:'mixed', level:'B1' },
  { id:'kunnen', inf:'kunnen', en:'can/to be able', imp_s:'kon', imp_p:'konden', pp:'gekund', aux:'heeft', pattern:'modal', level:'B1' },
  { id:'moeten', inf:'moeten', en:'must/to have to', imp_s:'moest', imp_p:'moesten', pp:'gemoeten', aux:'heeft', pattern:'modal', level:'B1' },
  { id:'mogen', inf:'mogen', en:'may/to be allowed', imp_s:'mocht', imp_p:'mochten', pp:'gemogen', aux:'heeft', pattern:'modal', level:'B1' },
  { id:'willen', inf:'willen', en:'to want', imp_s:'wilde', imp_p:'wilden', pp:'gewild', aux:'heeft', pattern:'modal', level:'B1' },
  { id:'zullen', inf:'zullen', en:'shall/will', imp_s:'zou', imp_p:'zouden', pp:'-', aux:'-', pattern:'modal', level:'B1' },
  { id:'werken', inf:'werken', en:'to work', imp_s:'werkte', imp_p:'werkten', pp:'gewerkt', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'wonen', inf:'wonen', en:'to live', imp_s:'woonde', imp_p:'woonden', pp:'gewoond', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'maken', inf:'maken', en:'to make', imp_s:'maakte', imp_p:'maakten', pp:'gemaakt', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'praten', inf:'praten', en:'to talk', imp_s:'praatte', imp_p:'praatten', pp:'gepraat', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'betalen', inf:'betalen', en:'to pay', imp_s:'betaalde', imp_p:'betaalden', pp:'betaald', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'wachten', inf:'wachten', en:'to wait', imp_s:'wachtte', imp_p:'wachtten', pp:'gewacht', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'antwoorden', inf:'antwoorden', en:'to answer', imp_s:'antwoordde', imp_p:'antwoordden', pp:'geantwoord', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'geloven', inf:'geloven', en:'to believe', imp_s:'geloofde', imp_p:'geloofden', pp:'geloofd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'hopen', inf:'hopen', en:'to hope', imp_s:'hoopte', imp_p:'hoopten', pp:'gehoopt', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'leren', inf:'leren', en:'to learn/teach', imp_s:'leerde', imp_p:'leerden', pp:'geleerd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'leven', inf:'leven', en:'to live (be alive)', imp_s:'leefde', imp_p:'leefden', pp:'geleefd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'luisteren', inf:'luisteren', en:'to listen', imp_s:'luisterde', imp_p:'luisterden', pp:'geluisterd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'gebruiken', inf:'gebruiken', en:'to use', imp_s:'gebruikte', imp_p:'gebruikten', pp:'gebruikt', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'proberen', inf:'proberen', en:'to try', imp_s:'probeerde', imp_p:'probeerden', pp:'geprobeerd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'vertellen', inf:'vertellen', en:'to tell', imp_s:'vertelde', imp_p:'vertelden', pp:'verteld', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'studeren', inf:'studeren', en:'to study', imp_s:'studeerde', imp_p:'studeerden', pp:'gestudeerd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'reizen', inf:'reizen', en:'to travel', imp_s:'reisde', imp_p:'reisden', pp:'gereisd', aux:'heeft/is', pattern:'regular', level:'B1' },
  { id:'spelen', inf:'spelen', en:'to play', imp_s:'speelde', imp_p:'speelden', pp:'gespeeld', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'veranderen', inf:'veranderen', en:'to change', imp_s:'veranderde', imp_p:'veranderden', pp:'veranderd', aux:'is/heeft', pattern:'regular', level:'B1' },
  { id:'stoppen', inf:'stoppen', en:'to stop', imp_s:'stopte', imp_p:'stopten', pp:'gestopt', aux:'is/heeft', pattern:'regular', level:'B1' },
  { id:'tekenen', inf:'tekenen', en:'to draw/sign', imp_s:'tekende', imp_p:'tekenden', pp:'getekend', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'herinneren', inf:'herinneren', en:'to remember', imp_s:'herinnerde', imp_p:'herinnerden', pp:'herinnerd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'missen', inf:'missen', en:'to miss', imp_s:'miste', imp_p:'misten', pp:'gemist', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'verhuizen', inf:'verhuizen', en:'to move (house)', imp_s:'verhuisde', imp_p:'verhuisden', pp:'verhuisd', aux:'is', pattern:'regular', level:'B1' },
  { id:'bedoelen', inf:'bedoelen', en:'to mean', imp_s:'bedoelde', imp_p:'bedoelden', pp:'bedoeld', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'uitleggen', inf:'uitleggen', en:'to explain', imp_s:'legde uit', imp_p:'legden uit', pp:'uitgelegd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'opbellen', inf:'opbellen', en:'to call up', imp_s:'belde op', imp_p:'belden op', pp:'opgebeld', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'kennismaken', inf:'kennismaken', en:'to get acquainted', imp_s:'maakte kennis', imp_p:'maakten kennis', pp:'kennisgemaakt', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'voorstellen', inf:'voorstellen', en:'to introduce/suggest', imp_s:'stelde voor', imp_p:'stelden voor', pp:'voorgesteld', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'ontmoeten', inf:'ontmoeten', en:'to meet', imp_s:'ontmoette', imp_p:'ontmoetten', pp:'ontmoet', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'bestellen', inf:'bestellen', en:'to order', imp_s:'bestelde', imp_p:'bestelden', pp:'besteld', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'beloven', inf:'beloven', en:'to promise', imp_s:'beloofde', imp_p:'beloofden', pp:'beloofd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'vertrouwen', inf:'vertrouwen', en:'to trust', imp_s:'vertrouwde', imp_p:'vertrouwden', pp:'vertrouwd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'bezoeken', inf:'bezoeken', en:'to visit', imp_s:'bezocht', imp_p:'bezochten', pp:'bezocht', aux:'heeft', pattern:'mixed', level:'B1' },
  { id:'schrikken', inf:'schrikken', en:'to be startled', imp_s:'schrok', imp_p:'schrokken', pp:'geschrokken', aux:'is', pattern:'i→o→o', level:'B1' },
  { id:'sterven', inf:'sterven', en:'to die', imp_s:'stierf', imp_p:'stierven', pp:'gestorven', aux:'is', pattern:'special', level:'B1' },
  { id:'groeien', inf:'groeien', en:'to grow', imp_s:'groeide', imp_p:'groeiden', pp:'gegroeid', aux:'is', pattern:'regular', level:'B1' },
  { id:'gebeuren', inf:'gebeuren', en:'to happen', imp_s:'gebeurde', imp_p:'gebeurden', pp:'gebeurd', aux:'is', pattern:'regular', level:'B1' },
  { id:'lijden', inf:'lijden', en:'to suffer', imp_s:'leed', imp_p:'leden', pp:'geleden', aux:'heeft', pattern:'ij→ee→e', level:'B1' },
  { id:'trekken', inf:'trekken', en:'to pull/hike', imp_s:'trok', imp_p:'trokken', pp:'getrokken', aux:'heeft/is', pattern:'i→o→o', level:'B1' },
  { id:'sturen', inf:'sturen', en:'to send', imp_s:'stuurde', imp_p:'stuurden', pp:'gestuurd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'helpen', inf:'helpen', en:'to help', imp_s:'hielp', imp_p:'hielpen', pp:'geholpen', aux:'heeft', pattern:'special', level:'B1' },
  { id:'vallen', inf:'vallen', en:'to fall', imp_s:'viel', imp_p:'vielen', pp:'gevallen', aux:'is', pattern:'special', level:'B1' },
  { id:'roepen', inf:'roepen', en:'to call/shout', imp_s:'riep', imp_p:'riepen', pp:'geroepen', aux:'heeft', pattern:'special', level:'B1' },
  { id:'hangen', inf:'hangen', en:'to hang', imp_s:'hing', imp_p:'hingen', pp:'gehangen', aux:'heeft', pattern:'special', level:'B1' },
  { id:'blazen', inf:'blazen', en:'to blow', imp_s:'blies', imp_p:'bliezen', pp:'geblazen', aux:'heeft', pattern:'special', level:'B1' },
  { id:'schuiven', inf:'schuiven', en:'to slide/push', imp_s:'schoof', imp_p:'schoven', pp:'geschoven', aux:'heeft', pattern:'special', level:'B1' },
  { id:'sluiten', inf:'sluiten', en:'to close', imp_s:'sloot', imp_p:'sloten', pp:'gesloten', aux:'heeft', pattern:'special', level:'B1' },
  { id:'kruipen', inf:'kruipen', en:'to crawl', imp_s:'kroop', imp_p:'kropen', pp:'gekropen', aux:'is/heeft', pattern:'special', level:'B1' },
  { id:'ruiken', inf:'ruiken', en:'to smell', imp_s:'rook', imp_p:'roken', pp:'geroken', aux:'heeft', pattern:'special', level:'B1' },
  { id:'buigen', inf:'buigen', en:'to bend/bow', imp_s:'boog', imp_p:'bogen', pp:'gebogen', aux:'heeft', pattern:'special', level:'B1' },
  // === TEXTBOOK ONREGELMATIGE WERKWOORDEN (from TaalCompleet) ===
  { id:'aanbieden', inf:'aanbieden', en:'to offer', imp_s:'bood aan', imp_p:'boden aan', pp:'aangeboden', aux:'heeft', pattern:'ie→oo→o', level:'B1' },
  { id:'aankomen', inf:'aankomen', en:'to arrive', imp_s:'kwam aan', imp_p:'kwamen aan', pp:'aangekomen', aux:'is', pattern:'special', level:'B1' },
  { id:'aantrekken', inf:'aantrekken', en:'to put on (clothes)', imp_s:'trok aan', imp_p:'trokken aan', pp:'aangetrokken', aux:'heeft', pattern:'special', level:'B1' },
  { id:'aanvragen', inf:'aanvragen', en:'to apply for/request', imp_s:'vroeg aan', imp_p:'vroegen aan', pp:'aangevraagd', aux:'heeft', pattern:'mixed', level:'B1' },
  { id:'aanwijzen', inf:'aanwijzen', en:'to indicate/appoint', imp_s:'wees aan', imp_p:'wezen aan', pp:'aangewezen', aux:'heeft', pattern:'ij→ee→e', level:'B1' },
  { id:'afspreken', inf:'afspreken', en:'to arrange/agree', imp_s:'sprak af', imp_p:'spraken af', pp:'afgesproken', aux:'heeft', pattern:'e→a→o', level:'B1' },
  { id:'bakken', inf:'bakken', en:'to bake/fry', imp_s:'bakte', imp_p:'bakten', pp:'gebakken', aux:'heeft', pattern:'mixed', level:'B1' },
  { id:'bedenken', inf:'bedenken', en:'to think up', imp_s:'bedacht', imp_p:'bedachten', pp:'bedacht', aux:'heeft', pattern:'mixed', level:'B1' },
  { id:'begrijpen', inf:'begrijpen', en:'to understand', imp_s:'begreep', imp_p:'begrepen', pp:'begrepen', aux:'heeft', pattern:'ij→ee→e', level:'B1' },
  { id:'beschrijven', inf:'beschrijven', en:'to describe', imp_s:'beschreef', imp_p:'beschreven', pp:'beschreven', aux:'heeft', pattern:'ij→ee→e', level:'B1' },
  { id:'besluiten', inf:'besluiten', en:'to decide', imp_s:'besloot', imp_p:'besloten', pp:'besloten', aux:'heeft', pattern:'special', level:'B1' },
  { id:'bespreken', inf:'bespreken', en:'to discuss', imp_s:'besprak', imp_p:'bespraken', pp:'besproken', aux:'heeft', pattern:'e→a→o', level:'B1' },
  { id:'bestaan', inf:'bestaan', en:'to exist', imp_s:'bestond', imp_p:'bestonden', pp:'bestaan', aux:'heeft', pattern:'special', level:'B1' },
  { id:'bevallen', inf:'bevallen', en:'to give birth/please', imp_s:'beviel', imp_p:'bevielen', pp:'bevallen', aux:'is', pattern:'special', level:'B1' },
  { id:'bewegen', inf:'bewegen', en:'to move', imp_s:'bewoog', imp_p:'bewogen', pp:'bewogen', aux:'heeft/is', pattern:'special', level:'B1' },
  { id:'binnenkomen', inf:'binnenkomen', en:'to enter', imp_s:'kwam binnen', imp_p:'kwamen binnen', pp:'binnengekomen', aux:'is', pattern:'special', level:'B1' },
  { id:'doorgaan', inf:'doorgaan', en:'to continue', imp_s:'ging door', imp_p:'gingen door', pp:'doorgegaan', aux:'is', pattern:'special', level:'B1' },
  { id:'doorgeven', inf:'doorgeven', en:'to pass on', imp_s:'gaf door', imp_p:'gaven door', pp:'doorgegeven', aux:'heeft', pattern:'e→a→e', level:'B1' },
  { id:'eruitzien', inf:'eruitzien', en:'to look/appear', imp_s:'zag eruit', imp_p:'zagen eruit', pp:'-', aux:'-', pattern:'special', level:'B1' },
  { id:'genieten', inf:'genieten', en:'to enjoy', imp_s:'genoot', imp_p:'genoten', pp:'genoten', aux:'heeft', pattern:'ie→oo→o', level:'B1' },
  { id:'heten', inf:'heten', en:'to be called', imp_s:'heette', imp_p:'heetten', pp:'-', aux:'-', pattern:'regular', level:'B1' },
  { id:'hoeven', inf:'hoeven', en:'to need to', imp_s:'hoefde', imp_p:'hoefden', pp:'gehoeven', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'inschrijven', inf:'inschrijven', en:'to enroll/register', imp_s:'schreef in', imp_p:'schreven in', pp:'ingeschreven', aux:'heeft', pattern:'ij→ee→e', level:'B1' },
  { id:'laten', inf:'laten', en:'to let/leave', imp_s:'liet', imp_p:'lieten', pp:'gelaten', aux:'heeft', pattern:'special', level:'B1' },
  { id:'lesgeven', inf:'lesgeven', en:'to teach', imp_s:'gaf les', imp_p:'gaven les', pp:'lesgegeven', aux:'heeft', pattern:'e→a→e', level:'B1' },
  { id:'meenemen', inf:'meenemen', en:'to take along', imp_s:'nam mee', imp_p:'namen mee', pp:'meegenomen', aux:'heeft', pattern:'special', level:'B1' },
  { id:'omgaan', inf:'omgaan', en:'to deal with', imp_s:'ging om', imp_p:'gingen om', pp:'omgegaan', aux:'is', pattern:'special', level:'B1' },
  { id:'onthouden', inf:'onthouden', en:'to remember', imp_s:'onthield', imp_p:'onthielden', pp:'onthouden', aux:'heeft', pattern:'special', level:'B1' },
  { id:'ontvangen', inf:'ontvangen', en:'to receive', imp_s:'ontving', imp_p:'ontvingen', pp:'ontvangen', aux:'heeft', pattern:'special', level:'B1' },
  { id:'ophangen', inf:'ophangen', en:'to hang up', imp_s:'hing op', imp_p:'hingen op', pp:'opgehangen', aux:'heeft', pattern:'special', level:'B1' },
  { id:'opnemen', inf:'opnemen', en:'to record/pick up', imp_s:'nam op', imp_p:'namen op', pp:'opgenomen', aux:'heeft', pattern:'special', level:'B1' },
  { id:'opstaan', inf:'opstaan', en:'to get up', imp_s:'stond op', imp_p:'stonden op', pp:'opgestaan', aux:'is', pattern:'special', level:'B1' },
  { id:'opzoeken', inf:'opzoeken', en:'to look up/visit', imp_s:'zocht op', imp_p:'zochten op', pp:'opgezocht', aux:'heeft', pattern:'mixed', level:'B1' },
  { id:'overlijden', inf:'overlijden', en:'to pass away', imp_s:'overleed', imp_p:'overleden', pp:'overleden', aux:'is', pattern:'ij→ee→e', level:'B1' },
  { id:'oversteken', inf:'oversteken', en:'to cross (road)', imp_s:'stak over', imp_p:'staken over', pp:'overgestoken', aux:'is', pattern:'e→a→o', level:'B1' },
  { id:'scheiden', inf:'scheiden', en:'to separate/divorce', imp_s:'scheidde', imp_p:'scheidden', pp:'gescheiden', aux:'is', pattern:'regular', level:'B1' },
  { id:'schijnen', inf:'schijnen', en:'to shine/seem', imp_s:'scheen', imp_p:'schenen', pp:'geschenen', aux:'heeft', pattern:'ij→ee→e', level:'B1' },
  { id:'vangen', inf:'vangen', en:'to catch', imp_s:'ving', imp_p:'vingen', pp:'gevangen', aux:'heeft', pattern:'special', level:'B1' },
  { id:'vasthouden', inf:'vasthouden', en:'to hold on to', imp_s:'hield vast', imp_p:'hielden vast', pp:'vastgehouden', aux:'heeft', pattern:'special', level:'B1' },
  { id:'vechten', inf:'vechten', en:'to fight', imp_s:'vocht', imp_p:'vochten', pp:'gevochten', aux:'heeft', pattern:'special', level:'B1' },
  { id:'verkopen', inf:'verkopen', en:'to sell', imp_s:'verkocht', imp_p:'verkochten', pp:'verkocht', aux:'heeft', pattern:'mixed', level:'B1' },
  { id:'verstaan', inf:'verstaan', en:'to understand (hearing)', imp_s:'verstond', imp_p:'verstonden', pp:'verstaan', aux:'heeft', pattern:'special', level:'B1' },
  { id:'vertrekken', inf:'vertrekken', en:'to depart', imp_s:'vertrok', imp_p:'vertrokken', pp:'vertrokken', aux:'is', pattern:'special', level:'B1' },
  { id:'vriezen', inf:'vriezen', en:'to freeze', imp_s:'vroor', imp_p:'vroren', pp:'gevroren', aux:'heeft', pattern:'special', level:'B1' },
  { id:'wassen', inf:'wassen', en:'to wash', imp_s:'waste', imp_p:'wasten', pp:'gewassen', aux:'heeft', pattern:'mixed', level:'B1' },
  { id:'weggaan', inf:'weggaan', en:'to go away', imp_s:'ging weg', imp_p:'gingen weg', pp:'weggegaan', aux:'is', pattern:'special', level:'B1' },
  { id:'zeggen', inf:'zeggen', en:'to say', imp_s:'zei', imp_p:'zeiden', pp:'gezegd', aux:'heeft', pattern:'special', level:'B1' },
  { id:'stinken', inf:'stinken', en:'to stink', imp_s:'stonk', imp_p:'stonken', pp:'gestonken', aux:'heeft', pattern:'i→o→o', level:'B1' },
  { id:'strijken', inf:'strijken', en:'to iron/stroke', imp_s:'streek', imp_p:'streken', pp:'gestreken', aux:'heeft', pattern:'ij→ee→e', level:'B1' },
  { id:'uitgaan', inf:'uitgaan', en:'to go out', imp_s:'ging uit', imp_p:'gingen uit', pp:'uitgegaan', aux:'is', pattern:'special', level:'B1' },
  { id:'uitzoeken', inf:'uitzoeken', en:'to figure out/sort out', imp_s:'zocht uit', imp_p:'zochten uit', pp:'uitgezocht', aux:'heeft', pattern:'mixed', level:'B1' },
  // === MORE B1/B2 REGULAR VERBS ===
  { id:'wandelen', inf:'wandelen', en:'to walk/hike', imp_s:'wandelde', imp_p:'wandelden', pp:'gewandeld', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'fietsen', inf:'fietsen', en:'to cycle', imp_s:'fietste', imp_p:'fietsten', pp:'gefietst', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'koken', inf:'koken', en:'to cook', imp_s:'kookte', imp_p:'kookten', pp:'gekookt', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'schoonmaken', inf:'schoonmaken', en:'to clean', imp_s:'maakte schoon', imp_p:'maakten schoon', pp:'schoongemaakt', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'huren', inf:'huren', en:'to rent', imp_s:'huurde', imp_p:'huurden', pp:'gehuurd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'verdienen', inf:'verdienen', en:'to earn', imp_s:'verdiende', imp_p:'verdienden', pp:'verdiend', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'ontwikkelen', inf:'ontwikkelen', en:'to develop', imp_s:'ontwikkelde', imp_p:'ontwikkelden', pp:'ontwikkeld', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'reageren', inf:'reageren', en:'to react', imp_s:'reageerde', imp_p:'reageerden', pp:'gereageerd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'bouwen', inf:'bouwen', en:'to build', imp_s:'bouwde', imp_p:'bouwden', pp:'gebouwd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'dansen', inf:'dansen', en:'to dance', imp_s:'danste', imp_p:'dansten', pp:'gedanst', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'dromen', inf:'dromen', en:'to dream', imp_s:'droomde', imp_p:'droomden', pp:'gedroomd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'duwen', inf:'duwen', en:'to push', imp_s:'duwde', imp_p:'duwden', pp:'geduwd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'feliciteren', inf:'feliciteren', en:'to congratulate', imp_s:'feliciteerde', imp_p:'feliciteerden', pp:'gefeliciteerd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'fluisteren', inf:'fluisteren', en:'to whisper', imp_s:'fluisterde', imp_p:'fluisterden', pp:'gefluisterd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'halen', inf:'halen', en:'to fetch/get', imp_s:'haalde', imp_p:'haalden', pp:'gehaald', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'huilen', inf:'huilen', en:'to cry', imp_s:'huilde', imp_p:'huilden', pp:'gehuild', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'klagen', inf:'klagen', en:'to complain', imp_s:'klaagde', imp_p:'klaagden', pp:'geklaagd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'klimmen', inf:'klimmen', en:'to climb', imp_s:'klom', imp_p:'klommen', pp:'geklommen', aux:'heeft/is', pattern:'i→o→o', level:'B1' },
  { id:'kussen', inf:'kussen', en:'to kiss', imp_s:'kuste', imp_p:'kusten', pp:'gekust', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'lenen', inf:'lenen', en:'to lend/borrow', imp_s:'leende', imp_p:'leenden', pp:'geleend', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'merken', inf:'merken', en:'to notice', imp_s:'merkte', imp_p:'merkten', pp:'gemerkt', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'noemen', inf:'noemen', en:'to name/call', imp_s:'noemde', imp_p:'noemden', pp:'genoemd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'oefenen', inf:'oefenen', en:'to practice', imp_s:'oefende', imp_p:'oefenden', pp:'geoefend', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'onderzoeken', inf:'onderzoeken', en:'to investigate', imp_s:'onderzocht', imp_p:'onderzochten', pp:'onderzocht', aux:'heeft', pattern:'mixed', level:'B1' },
  { id:'ontdekken', inf:'ontdekken', en:'to discover', imp_s:'ontdekte', imp_p:'ontdekten', pp:'ontdekt', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'ontspannen', inf:'ontspannen', en:'to relax', imp_s:'ontspande', imp_p:'ontspanden', pp:'ontspannen', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'parkeren', inf:'parkeren', en:'to park', imp_s:'parkeerde', imp_p:'parkeerden', pp:'geparkeerd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'passen', inf:'passen', en:'to fit', imp_s:'paste', imp_p:'pasten', pp:'gepast', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'poetsen', inf:'poetsen', en:'to brush/polish', imp_s:'poetste', imp_p:'poetsten', pp:'gepoetst', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'redden', inf:'redden', en:'to save/rescue', imp_s:'redde', imp_p:'redden', pp:'gered', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'regelen', inf:'regelen', en:'to arrange', imp_s:'regelde', imp_p:'regelden', pp:'geregeld', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'rekenen', inf:'rekenen', en:'to calculate', imp_s:'rekende', imp_p:'rekenden', pp:'gerekend', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'rennen', inf:'rennen', en:'to run', imp_s:'rende', imp_p:'renden', pp:'gerend', aux:'heeft/is', pattern:'regular', level:'B1' },
  { id:'reserveren', inf:'reserveren', en:'to reserve', imp_s:'reserveerde', imp_p:'reserveerden', pp:'gereserveerd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'roken', inf:'roken', en:'to smoke', imp_s:'rookte', imp_p:'rookten', pp:'gerookt', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'sparen', inf:'sparen', en:'to save (money)', imp_s:'spaarde', imp_p:'spaarden', pp:'gespaard', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'trouwen', inf:'trouwen', en:'to marry', imp_s:'trouwde', imp_p:'trouwden', pp:'getrouwd', aux:'is/heeft', pattern:'regular', level:'B1' },
  { id:'twijfelen', inf:'twijfelen', en:'to doubt', imp_s:'twijfelde', imp_p:'twijfelden', pp:'getwijfeld', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'verbeteren', inf:'verbeteren', en:'to improve', imp_s:'verbeterde', imp_p:'verbeterden', pp:'verbeterd', aux:'heeft/is', pattern:'regular', level:'B1' },
  { id:'vergelijken', inf:'vergelijken', en:'to compare', imp_s:'vergeleek', imp_p:'vergeleken', pp:'vergeleken', aux:'heeft', pattern:'ij→ee→e', level:'B1' },
  { id:'vermijden', inf:'vermijden', en:'to avoid', imp_s:'vermeed', imp_p:'vermeden', pp:'vermeden', aux:'heeft', pattern:'ij→ee→e', level:'B1' },
  { id:'verrassen', inf:'verrassen', en:'to surprise', imp_s:'verraste', imp_p:'verrasten', pp:'verrast', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'verschijnen', inf:'verschijnen', en:'to appear', imp_s:'verscheen', imp_p:'verschenen', pp:'verschenen', aux:'is', pattern:'ij→ee→e', level:'B1' },
  { id:'vertalen', inf:'vertalen', en:'to translate', imp_s:'vertaalde', imp_p:'vertaalden', pp:'vertaald', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'verwachten', inf:'verwachten', en:'to expect', imp_s:'verwachtte', imp_p:'verwachtten', pp:'verwacht', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'voelen', inf:'voelen', en:'to feel', imp_s:'voelde', imp_p:'voelden', pp:'gevoeld', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'volgen', inf:'volgen', en:'to follow', imp_s:'volgde', imp_p:'volgden', pp:'gevolgd', aux:'heeft/is', pattern:'regular', level:'B1' },
  { id:'voorbereiden', inf:'voorbereiden', en:'to prepare', imp_s:'bereidde voor', imp_p:'bereidden voor', pp:'voorbereid', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'vullen', inf:'vullen', en:'to fill', imp_s:'vulde', imp_p:'vulden', pp:'gevuld', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'waarschuwen', inf:'waarschuwen', en:'to warn', imp_s:'waarschuwde', imp_p:'waarschuwden', pp:'gewaarschuwd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'weigeren', inf:'weigeren', en:'to refuse', imp_s:'weigerde', imp_p:'weigerden', pp:'geweigerd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'wensen', inf:'wensen', en:'to wish', imp_s:'wenste', imp_p:'wensten', pp:'gewenst', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'wijzen', inf:'wijzen', en:'to point', imp_s:'wees', imp_p:'wezen', pp:'gewezen', aux:'heeft', pattern:'ij→ee→e', level:'B1' },
  { id:'winkelen', inf:'winkelen', en:'to shop', imp_s:'winkelde', imp_p:'winkelden', pp:'gewinkeld', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'zetten', inf:'zetten', en:'to set/put', imp_s:'zette', imp_p:'zetten', pp:'gezet', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'zwijgen', inf:'zwijgen', en:'to be silent', imp_s:'zweeg', imp_p:'zwegen', pp:'gezwegen', aux:'heeft', pattern:'ij→ee→e', level:'B1' },
  // === SEPARABLE VERBS ===
  { id:'aanraken', inf:'aanraken', en:'to touch', imp_s:'raakte aan', imp_p:'raakten aan', pp:'aangeraakt', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'aannemen', inf:'aannemen', en:'to accept/assume', imp_s:'nam aan', imp_p:'namen aan', pp:'aangenomen', aux:'heeft', pattern:'special', level:'B1' },
  { id:'aanpassen', inf:'aanpassen', en:'to adjust/adapt', imp_s:'paste aan', imp_p:'pasten aan', pp:'aangepast', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'afmaken', inf:'afmaken', en:'to finish', imp_s:'maakte af', imp_p:'maakten af', pp:'afgemaakt', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'bijdragen', inf:'bijdragen', en:'to contribute', imp_s:'droeg bij', imp_p:'droegen bij', pp:'bijgedragen', aux:'heeft', pattern:'a→oe→a', level:'B1' },
  { id:'instappen', inf:'instappen', en:'to get in/board', imp_s:'stapte in', imp_p:'stapten in', pp:'ingestapt', aux:'is', pattern:'regular', level:'B1' },
  { id:'invullen', inf:'invullen', en:'to fill in', imp_s:'vulde in', imp_p:'vulden in', pp:'ingevuld', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'meebrengen', inf:'meebrengen', en:'to bring along', imp_s:'bracht mee', imp_p:'brachten mee', pp:'meegebracht', aux:'heeft', pattern:'mixed', level:'B1' },
  { id:'meedoen', inf:'meedoen', en:'to participate', imp_s:'deed mee', imp_p:'deden mee', pp:'meegedaan', aux:'heeft', pattern:'special', level:'B1' },
  { id:'nadenken', inf:'nadenken', en:'to think about', imp_s:'dacht na', imp_p:'dachten na', pp:'nagedacht', aux:'heeft', pattern:'mixed', level:'B1' },
  { id:'ophalen', inf:'ophalen', en:'to pick up', imp_s:'haalde op', imp_p:'haalden op', pp:'opgehaald', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'opletten', inf:'opletten', en:'to pay attention', imp_s:'lette op', imp_p:'letten op', pp:'opgelet', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'oplossen', inf:'oplossen', en:'to solve', imp_s:'loste op', imp_p:'losten op', pp:'opgelost', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'opruimen', inf:'opruimen', en:'to tidy up', imp_s:'ruimde op', imp_p:'ruimden op', pp:'opgeruimd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'terugkomen', inf:'terugkomen', en:'to come back', imp_s:'kwam terug', imp_p:'kwamen terug', pp:'teruggekomen', aux:'is', pattern:'special', level:'B1' },
  { id:'thuiskomen', inf:'thuiskomen', en:'to come home', imp_s:'kwam thuis', imp_p:'kwamen thuis', pp:'thuisgekomen', aux:'is', pattern:'special', level:'B1' },
  { id:'uitnodigen', inf:'uitnodigen', en:'to invite', imp_s:'nodigde uit', imp_p:'nodigden uit', pp:'uitgenodigd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'uitstappen', inf:'uitstappen', en:'to get out', imp_s:'stapte uit', imp_p:'stapten uit', pp:'uitgestapt', aux:'is', pattern:'regular', level:'B1' },
  { id:'weggooien', inf:'weggooien', en:'to throw away', imp_s:'gooide weg', imp_p:'gooiden weg', pp:'weggegooid', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'samenwerken', inf:'samenwerken', en:'to cooperate', imp_s:'werkte samen', imp_p:'werkten samen', pp:'samengewerkt', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'deelnemen', inf:'deelnemen', en:'to participate', imp_s:'nam deel', imp_p:'namen deel', pp:'deelgenomen', aux:'heeft', pattern:'special', level:'B1' },
  { id:'opgroeien', inf:'opgroeien', en:'to grow up', imp_s:'groeide op', imp_p:'groeiden op', pp:'opgegroeid', aux:'is', pattern:'regular', level:'B1' },
  { id:'tegenkomen', inf:'tegenkomen', en:'to run into', imp_s:'kwam tegen', imp_p:'kwamen tegen', pp:'tegengekomen', aux:'is', pattern:'special', level:'B1' },
  { id:'toevoegen', inf:'toevoegen', en:'to add', imp_s:'voegde toe', imp_p:'voegden toe', pp:'toegevoegd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'uitvoeren', inf:'uitvoeren', en:'to carry out', imp_s:'voerde uit', imp_p:'voerden uit', pp:'uitgevoerd', aux:'heeft', pattern:'regular', level:'B1' },
  // === MORE IRREGULAR/MIXED/SPECIAL ===
  { id:'ervaren', inf:'ervaren', en:'to experience', imp_s:'ervoer', imp_p:'ervoeren', pp:'ervaren', aux:'heeft', pattern:'special', level:'B1' },
  { id:'glijden', inf:'glijden', en:'to slide', imp_s:'gleed', imp_p:'gleden', pp:'gegleden', aux:'is', pattern:'ij→ee→e', level:'B1' },
  { id:'smelten', inf:'smelten', en:'to melt', imp_s:'smolt', imp_p:'smolten', pp:'gesmolten', aux:'is/heeft', pattern:'special', level:'B1' },
  { id:'dwingen', inf:'dwingen', en:'to force', imp_s:'dwong', imp_p:'dwongen', pp:'gedwongen', aux:'heeft', pattern:'i→o→o', level:'B1' },
  { id:'verbinden', inf:'verbinden', en:'to connect', imp_s:'verbond', imp_p:'verbonden', pp:'verbonden', aux:'heeft', pattern:'i→o→o', level:'B1' },
  { id:'bedriegen', inf:'bedriegen', en:'to deceive', imp_s:'bedroog', imp_p:'bedrogen', pp:'bedrogen', aux:'heeft', pattern:'ie→oo→o', level:'B1' },
  { id:'overwegen', inf:'overwegen', en:'to consider', imp_s:'overwoog', imp_p:'overwogen', pp:'overwogen', aux:'heeft', pattern:'special', level:'B1' },
  { id:'verlaten', inf:'verlaten', en:'to leave', imp_s:'verliet', imp_p:'verlieten', pp:'verlaten', aux:'heeft', pattern:'special', level:'B1' },
  { id:'vervangen', inf:'vervangen', en:'to replace', imp_s:'verving', imp_p:'vervingen', pp:'vervangen', aux:'heeft', pattern:'special', level:'B1' },
  { id:'verdragen', inf:'verdragen', en:'to tolerate', imp_s:'verdroeg', imp_p:'verdroegen', pp:'verdragen', aux:'heeft', pattern:'a→oe→a', level:'B1' },
  { id:'onderbreken', inf:'onderbreken', en:'to interrupt', imp_s:'onderbrak', imp_p:'onderbraken', pp:'onderbroken', aux:'heeft', pattern:'e→a→o', level:'B1' },
  { id:'onderhouden', inf:'onderhouden', en:'to maintain', imp_s:'onderhield', imp_p:'onderhielden', pp:'onderhouden', aux:'heeft', pattern:'special', level:'B1' },
  { id:'voorkomen', inf:'voorkomen', en:'to prevent/occur', imp_s:'kwam voor', imp_p:'kwamen voor', pp:'voorgekomen', aux:'is', pattern:'special', level:'B1' },
  { id:'overtuigen', inf:'overtuigen', en:'to convince', imp_s:'overtuigde', imp_p:'overtuigden', pp:'overtuigd', aux:'heeft', pattern:'regular', level:'B1' },
  { id:'betrekken', inf:'betrekken', en:'to involve', imp_s:'betrok', imp_p:'betrokken', pp:'betrokken', aux:'heeft', pattern:'special', level:'B1' },
  // === MORE B1/B2 REGULAR ===
  { id:'controleren', inf:'controleren', en:'to check/control', imp_s:'controleerde', imp_p:'controleerden', pp:'gecontroleerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'delen', inf:'delen', en:'to share/divide', imp_s:'deelde', imp_p:'deelden', pp:'gedeeld', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'douchen', inf:'douchen', en:'to shower', imp_s:'douchte', imp_p:'douchten', pp:'gedoucht', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'draaien', inf:'draaien', en:'to turn/rotate', imp_s:'draaide', imp_p:'draaiden', pp:'gedraaid', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'drukken', inf:'drukken', en:'to press/print', imp_s:'drukte', imp_p:'drukten', pp:'gedrukt', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'eindigen', inf:'eindigen', en:'to end', imp_s:'eindigde', imp_p:'eindigden', pp:'geëindigd', aux:'is', pattern:'regular', level:'B2' },
  { id:'gooien', inf:'gooien', en:'to throw', imp_s:'gooide', imp_p:'gooiden', pp:'gegooid', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'herhalen', inf:'herhalen', en:'to repeat', imp_s:'herhaalde', imp_p:'herhaalden', pp:'herhaald', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'herkennen', inf:'herkennen', en:'to recognize', imp_s:'herkende', imp_p:'herkenden', pp:'herkend', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'informeren', inf:'informeren', en:'to inform', imp_s:'informeerde', imp_p:'informeerden', pp:'geïnformeerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'kennen', inf:'kennen', en:'to know (person)', imp_s:'kende', imp_p:'kenden', pp:'gekend', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'kosten', inf:'kosten', en:'to cost', imp_s:'kostte', imp_p:'kostten', pp:'gekost', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'leggen', inf:'leggen', en:'to lay/put', imp_s:'legde', imp_p:'legden', pp:'gelegd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'leiden', inf:'leiden', en:'to lead', imp_s:'leidde', imp_p:'leidden', pp:'geleid', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'leveren', inf:'leveren', en:'to deliver/supply', imp_s:'leverde', imp_p:'leverden', pp:'geleverd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'melden', inf:'melden', en:'to report', imp_s:'meldde', imp_p:'meldden', pp:'gemeld', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'beschermen', inf:'beschermen', en:'to protect', imp_s:'beschermde', imp_p:'beschermden', pp:'beschermd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'beslissen', inf:'beslissen', en:'to decide', imp_s:'besliste', imp_p:'beslisten', pp:'beslist', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'besteden', inf:'besteden', en:'to spend (time/money)', imp_s:'besteedde', imp_p:'besteedden', pp:'besteed', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'bewaren', inf:'bewaren', en:'to keep/preserve', imp_s:'bewaarde', imp_p:'bewaarden', pp:'bewaard', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'bezorgen', inf:'bezorgen', en:'to deliver', imp_s:'bezorgde', imp_p:'bezorgden', pp:'bezorgd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'boeken', inf:'boeken', en:'to book', imp_s:'boekte', imp_p:'boekten', pp:'geboekt', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'concentreren', inf:'concentreren', en:'to concentrate', imp_s:'concentreerde', imp_p:'concentreerden', pp:'geconcentreerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'discussiëren', inf:'discussiëren', en:'to discuss/debate', imp_s:'discussieerde', imp_p:'discussieerden', pp:'gediscussieerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'organiseren', inf:'organiseren', en:'to organize', imp_s:'organiseerde', imp_p:'organiseerden', pp:'georganiseerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'plannen', inf:'plannen', en:'to plan', imp_s:'plande', imp_p:'planden', pp:'gepland', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'presenteren', inf:'presenteren', en:'to present', imp_s:'presenteerde', imp_p:'presenteerden', pp:'gepresenteerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'produceren', inf:'produceren', en:'to produce', imp_s:'produceerde', imp_p:'produceerden', pp:'geproduceerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'repareren', inf:'repareren', en:'to repair', imp_s:'repareerde', imp_p:'repareerden', pp:'gerepareerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'slagen', inf:'slagen', en:'to succeed/pass', imp_s:'slaagde', imp_p:'slaagden', pp:'geslaagd', aux:'is', pattern:'regular', level:'B2' },
  { id:'snappen', inf:'snappen', en:'to understand', imp_s:'snapte', imp_p:'snapten', pp:'gesnapt', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'trainen', inf:'trainen', en:'to train', imp_s:'trainde', imp_p:'trainden', pp:'getraind', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'verzamelen', inf:'verzamelen', en:'to collect', imp_s:'verzamelde', imp_p:'verzamelden', pp:'verzameld', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'zorgen', inf:'zorgen', en:'to care/ensure', imp_s:'zorgde', imp_p:'zorgden', pp:'gezorgd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'wennen', inf:'wennen', en:'to get used to', imp_s:'wende', imp_p:'wenden', pp:'gewend', aux:'is', pattern:'regular', level:'B2' },
  { id:'verwijderen', inf:'verwijderen', en:'to remove', imp_s:'verwijderde', imp_p:'verwijderden', pp:'verwijderd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'accepteren', inf:'accepteren', en:'to accept', imp_s:'accepteerde', imp_p:'accepteerden', pp:'geaccepteerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'bepalen', inf:'bepalen', en:'to determine', imp_s:'bepaalde', imp_p:'bepaalden', pp:'bepaald', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'beperken', inf:'beperken', en:'to limit', imp_s:'beperkte', imp_p:'beperkten', pp:'beperkt', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'bevestigen', inf:'bevestigen', en:'to confirm', imp_s:'bevestigde', imp_p:'bevestigden', pp:'bevestigd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'behandelen', inf:'behandelen', en:'to treat', imp_s:'behandelde', imp_p:'behandelden', pp:'behandeld', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'bereiken', inf:'bereiken', en:'to reach', imp_s:'bereikte', imp_p:'bereikten', pp:'bereikt', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'waarderen', inf:'waarderen', en:'to appreciate', imp_s:'waardeerde', imp_p:'waardeerden', pp:'gewaardeerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'investeren', inf:'investeren', en:'to invest', imp_s:'investeerde', imp_p:'investeerden', pp:'geïnvesteerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'communiceren', inf:'communiceren', en:'to communicate', imp_s:'communiceerde', imp_p:'communiceerden', pp:'gecommuniceerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'combineren', inf:'combineren', en:'to combine', imp_s:'combineerde', imp_p:'combineerden', pp:'gecombineerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'functioneren', inf:'functioneren', en:'to function', imp_s:'functioneerde', imp_p:'functioneerden', pp:'gefunctioneerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'registreren', inf:'registreren', en:'to register', imp_s:'registreerde', imp_p:'registreerden', pp:'geregistreerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'respecteren', inf:'respecteren', en:'to respect', imp_s:'respecteerde', imp_p:'respecteerden', pp:'gerespecteerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'stimuleren', inf:'stimuleren', en:'to stimulate', imp_s:'stimuleerde', imp_p:'stimuleerden', pp:'gestimuleerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'dalen', inf:'dalen', en:'to descend/decline', imp_s:'daalde', imp_p:'daalden', pp:'gedaald', aux:'is', pattern:'regular', level:'B2' },
  { id:'erkennen', inf:'erkennen', en:'to acknowledge', imp_s:'erkende', imp_p:'erkenden', pp:'erkend', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'falen', inf:'falen', en:'to fail', imp_s:'faalde', imp_p:'faalden', pp:'gefaald', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'glimlachen', inf:'glimlachen', en:'to smile', imp_s:'glimlachte', imp_p:'glimlachten', pp:'geglimlacht', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'handelen', inf:'handelen', en:'to act/trade', imp_s:'handelde', imp_p:'handelden', pp:'gehandeld', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'smaken', inf:'smaken', en:'to taste', imp_s:'smaakte', imp_p:'smaakten', pp:'gesmaakt', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'steunen', inf:'steunen', en:'to support', imp_s:'steunde', imp_p:'steunden', pp:'gesteund', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'toepassen', inf:'toepassen', en:'to apply', imp_s:'paste toe', imp_p:'pasten toe', pp:'toegepast', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'uitbreiden', inf:'uitbreiden', en:'to expand', imp_s:'breidde uit', imp_p:'breidden uit', pp:'uitgebreid', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'verlagen', inf:'verlagen', en:'to lower', imp_s:'verlaagde', imp_p:'verlaagden', pp:'verlaagd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'vermelden', inf:'vermelden', en:'to mention', imp_s:'vermeldde', imp_p:'vermeldden', pp:'vermeld', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'vernieuwen', inf:'vernieuwen', en:'to renew', imp_s:'vernieuwde', imp_p:'vernieuwden', pp:'vernieuwd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'veroorzaken', inf:'veroorzaken', en:'to cause', imp_s:'veroorzaakte', imp_p:'veroorzaakten', pp:'veroorzaakt', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'versturen', inf:'versturen', en:'to send', imp_s:'verstuurde', imp_p:'verstuurden', pp:'verstuurd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'verwerken', inf:'verwerken', en:'to process', imp_s:'verwerkte', imp_p:'verwerkten', pp:'verwerkt', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'voltooien', inf:'voltooien', en:'to complete', imp_s:'voltooide', imp_p:'voltooiden', pp:'voltooid', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'wisselen', inf:'wisselen', en:'to change/exchange', imp_s:'wisselde', imp_p:'wisselden', pp:'gewisseld', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'branden', inf:'branden', en:'to burn', imp_s:'brandde', imp_p:'brandden', pp:'gebrand', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'plaatsen', inf:'plaatsen', en:'to place', imp_s:'plaatste', imp_p:'plaatsten', pp:'geplaatst', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'tonen', inf:'tonen', en:'to show', imp_s:'toonde', imp_p:'toonden', pp:'getoond', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'vormen', inf:'vormen', en:'to form', imp_s:'vormde', imp_p:'vormden', pp:'gevormd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'bezuinigen', inf:'bezuinigen', en:'to cut costs', imp_s:'bezuinigde', imp_p:'bezuinigden', pp:'bezuinigd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'solliciteren', inf:'solliciteren', en:'to apply (for job)', imp_s:'solliciteerde', imp_p:'solliciteerden', pp:'gesolliciteerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'condoleren', inf:'condoleren', en:'to offer condolences', imp_s:'condoleerde', imp_p:'condoleerden', pp:'gecondoleerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'proeven', inf:'proeven', en:'to taste/sample', imp_s:'proefde', imp_p:'proefden', pp:'geproefd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'tillen', inf:'tillen', en:'to lift', imp_s:'tilde', imp_p:'tilden', pp:'getild', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'letten', inf:'letten', en:'to pay attention', imp_s:'lette', imp_p:'letten', pp:'gelet', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'kleden', inf:'kleden', en:'to dress', imp_s:'kleedde', imp_p:'kleedden', pp:'gekleed', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'plakken', inf:'plakken', en:'to stick/paste', imp_s:'plakte', imp_p:'plakten', pp:'geplakt', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'verspreiden', inf:'verspreiden', en:'to spread', imp_s:'verspreidde', imp_p:'verspreidden', pp:'verspreid', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'beïnvloeden', inf:'beïnvloeden', en:'to influence', imp_s:'beïnvloedde', imp_p:'beïnvloedden', pp:'beïnvloed', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'slinken', inf:'slinken', en:'to shrink', imp_s:'slonk', imp_p:'slonken', pp:'geslonken', aux:'is', pattern:'i→o→o', level:'B2' },
  { id:'verdrinken', inf:'verdrinken', en:'to drown', imp_s:'verdronk', imp_p:'verdronken', pp:'verdronken', aux:'is', pattern:'i→o→o', level:'B2' },
  { id:'zweren', inf:'zweren', en:'to swear (oath)', imp_s:'zwoer', imp_p:'zwoeren', pp:'gezworen', aux:'heeft', pattern:'special', level:'B2' },
  { id:'schenken', inf:'schenken', en:'to pour/donate', imp_s:'schonk', imp_p:'schonken', pp:'geschonken', aux:'heeft', pattern:'special', level:'B2' },
  { id:'verslaan', inf:'verslaan', en:'to defeat', imp_s:'versloeg', imp_p:'versloegen', pp:'verslagen', aux:'heeft', pattern:'special', level:'B2' },
  { id:'ontstaan', inf:'ontstaan', en:'to originate', imp_s:'ontstond', imp_p:'ontstonden', pp:'ontstaan', aux:'is', pattern:'special', level:'B2' },
  { id:'gelden', inf:'gelden', en:'to apply/be valid', imp_s:'gold', imp_p:'golden', pp:'gegolden', aux:'heeft', pattern:'special', level:'B2' },
  { id:'scheppen', inf:'scheppen', en:'to create/scoop', imp_s:'schiep', imp_p:'schiepen', pp:'geschapen', aux:'heeft', pattern:'special', level:'B2' },
  { id:'voorzien', inf:'voorzien', en:'to foresee/provide', imp_s:'voorzag', imp_p:'voorzagen', pp:'voorzien', aux:'heeft', pattern:'special', level:'B2' },
  { id:'verzoeken', inf:'verzoeken', en:'to request', imp_s:'verzocht', imp_p:'verzochten', pp:'verzocht', aux:'heeft', pattern:'mixed', level:'B2' },
  { id:'raden', inf:'raden', en:'to guess/advise', imp_s:'raadde', imp_p:'raadden', pp:'geraden', aux:'heeft', pattern:'mixed', level:'B2' },
  // === B2/C1 IRREGULAR & MIXED VERBS ===
  { id:'uitspreken', inf:'uitspreken', en:'to pronounce/express', imp_s:'sprak uit', imp_p:'spraken uit', pp:'uitgesproken', aux:'heeft', pattern:'e→a→o', level:'B2' },
  { id:'optreden', inf:'optreden', en:'to perform/act', imp_s:'trad op', imp_p:'traden op', pp:'opgetreden', aux:'is/heeft', pattern:'e→a→e', level:'B2' },
  { id:'bijhouden', inf:'bijhouden', en:'to keep up/maintain', imp_s:'hield bij', imp_p:'hielden bij', pp:'bijgehouden', aux:'heeft', pattern:'special', level:'B2' },
  { id:'doorbrengen', inf:'doorbrengen', en:'to spend (time)', imp_s:'bracht door', imp_p:'brachten door', pp:'doorgebracht', aux:'heeft', pattern:'mixed', level:'B2' },
  { id:'toelaten', inf:'toelaten', en:'to admit/allow', imp_s:'liet toe', imp_p:'lieten toe', pp:'toegelaten', aux:'heeft', pattern:'special', level:'B2' },
  { id:'afdwingen', inf:'afdwingen', en:'to enforce', imp_s:'dwong af', imp_p:'dwongen af', pp:'afgedwongen', aux:'heeft', pattern:'i→o→o', level:'B2' },
  { id:'doorbreken', inf:'doorbreken', en:'to break through', imp_s:'brak door', imp_p:'braken door', pp:'doorgebroken', aux:'is/heeft', pattern:'e→a→o', level:'B2' },
  { id:'inschatten', inf:'inschatten', en:'to estimate/assess', imp_s:'schatte in', imp_p:'schatten in', pp:'ingeschat', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'uitdragen', inf:'uitdragen', en:'to promote/convey', imp_s:'droeg uit', imp_p:'droegen uit', pp:'uitgedragen', aux:'heeft', pattern:'a→oe→a', level:'B2' },
  { id:'tegenvallen', inf:'tegenvallen', en:'to disappoint', imp_s:'viel tegen', imp_p:'vielen tegen', pp:'tegengevallen', aux:'is', pattern:'special', level:'B2' },
  { id:'meevallen', inf:'meevallen', en:'to be better than expected', imp_s:'viel mee', imp_p:'vielen mee', pp:'meegevallen', aux:'is', pattern:'special', level:'B2' },
  { id:'uitkomen', inf:'uitkomen', en:'to turn out/come out', imp_s:'kwam uit', imp_p:'kwamen uit', pp:'uitgekomen', aux:'is', pattern:'special', level:'B2' },
  { id:'doorzetten', inf:'doorzetten', en:'to persevere', imp_s:'zette door', imp_p:'zetten door', pp:'doorgezet', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'aannemen2', inf:'aanspreken', en:'to address/appeal to', imp_s:'sprak aan', imp_p:'spraken aan', pp:'aangesproken', aux:'heeft', pattern:'e→a→o', level:'B2' },
  { id:'uitvinden', inf:'uitvinden', en:'to invent/find out', imp_s:'vond uit', imp_p:'vonden uit', pp:'uitgevonden', aux:'heeft', pattern:'i→o→o', level:'B2' },
  { id:'doorgeven2', inf:'aangeven', en:'to indicate/declare', imp_s:'gaf aan', imp_p:'gaven aan', pp:'aangegeven', aux:'heeft', pattern:'e→a→e', level:'B2' },
  { id:'teruggeven', inf:'teruggeven', en:'to give back', imp_s:'gaf terug', imp_p:'gaven terug', pp:'teruggegeven', aux:'heeft', pattern:'e→a→e', level:'B2' },
  { id:'ondernemen', inf:'ondernemen', en:'to undertake', imp_s:'ondernam', imp_p:'ondernamen', pp:'ondernomen', aux:'heeft', pattern:'special', level:'B2' },
  { id:'innemen', inf:'innemen', en:'to take (medicine)/occupy', imp_s:'nam in', imp_p:'namen in', pp:'ingenomen', aux:'heeft', pattern:'special', level:'B2' },
  { id:'afnemen', inf:'afnemen', en:'to decrease/take off', imp_s:'nam af', imp_p:'namen af', pp:'afgenomen', aux:'is/heeft', pattern:'special', level:'B2' },
  { id:'toenemen', inf:'toenemen', en:'to increase', imp_s:'nam toe', imp_p:'namen toe', pp:'toegenomen', aux:'is', pattern:'special', level:'B2' },
  { id:'voortbrengen', inf:'voortbrengen', en:'to produce/create', imp_s:'bracht voort', imp_p:'brachten voort', pp:'voortgebracht', aux:'heeft', pattern:'mixed', level:'B2' },
  { id:'waarnemen', inf:'waarnemen', en:'to observe/perceive', imp_s:'nam waar', imp_p:'namen waar', pp:'waargenomen', aux:'heeft', pattern:'special', level:'B2' },
  { id:'overweldigen', inf:'overweldigen', en:'to overwhelm', imp_s:'overweldigde', imp_p:'overweldigden', pp:'overweldigd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'benadelen', inf:'benadelen', en:'to disadvantage', imp_s:'benadeelde', imp_p:'benadeelden', pp:'benadeeld', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'bevorderen', inf:'bevorderen', en:'to promote/foster', imp_s:'bevorderde', imp_p:'bevorderden', pp:'bevorderd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'handhaven', inf:'handhaven', en:'to maintain/enforce', imp_s:'handhaafde', imp_p:'handhaafden', pp:'gehandhaafd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'verwezenlijken', inf:'verwezenlijken', en:'to realize/accomplish', imp_s:'verwezenlijkte', imp_p:'verwezenlijkten', pp:'verwezenlijkt', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'benadrukken', inf:'benadrukken', en:'to emphasize', imp_s:'benadrukte', imp_p:'benadrukten', pp:'benadrukt', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'garanderen', inf:'garanderen', en:'to guarantee', imp_s:'garandeerde', imp_p:'garandeerden', pp:'gegarandeerd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'veronderstellen', inf:'veronderstellen', en:'to assume/suppose', imp_s:'veronderstelde', imp_p:'veronderstelden', pp:'verondersteld', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'teweegbrengen', inf:'teweegbrengen', en:'to cause/bring about', imp_s:'bracht teweeg', imp_p:'brachten teweeg', pp:'teweeggebracht', aux:'heeft', pattern:'mixed', level:'B2' },
  { id:'onderscheiden', inf:'onderscheiden', en:'to distinguish', imp_s:'onderscheidde', imp_p:'onderscheidden', pp:'onderscheiden', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'aanmerken', inf:'aanmerken', en:'to regard/consider', imp_s:'merkte aan', imp_p:'merkten aan', pp:'aangemerkt', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'tegenspreken', inf:'tegenspreken', en:'to contradict', imp_s:'sprak tegen', imp_p:'spraken tegen', pp:'tegengesproken', aux:'heeft', pattern:'e→a→o', level:'B2' },
  { id:'uitbuiten', inf:'uitbuiten', en:'to exploit', imp_s:'buitte uit', imp_p:'buitten uit', pp:'uitgebuit', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'misbruiken', inf:'misbruiken', en:'to abuse/misuse', imp_s:'misbruikte', imp_p:'misbruikten', pp:'misbruikt', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'betwisten', inf:'betwisten', en:'to dispute/contest', imp_s:'betwistte', imp_p:'betwistten', pp:'betwist', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'aanmoedigen', inf:'aanmoedigen', en:'to encourage', imp_s:'moedigde aan', imp_p:'moedigden aan', pp:'aangemoedigd', aux:'heeft', pattern:'regular', level:'B2' },
  { id:'ontslaan', inf:'ontslaan', en:'to dismiss/fire', imp_s:'ontsloeg', imp_p:'ontsloegen', pp:'ontslagen', aux:'heeft', pattern:'special', level:'B2' },
  { id:'afdalen', inf:'afdalen', en:'to descend', imp_s:'daalde af', imp_p:'daalden af', pp:'afgedaald', aux:'is', pattern:'regular', level:'B2' },
  { id:'ontbinden', inf:'ontbinden', en:'to dissolve/decompose', imp_s:'ontbond', imp_p:'ontbonden', pp:'ontbonden', aux:'heeft/is', pattern:'i→o→o', level:'B2' },
  { id:'verwerpen', inf:'verwerpen', en:'to reject', imp_s:'verwierp', imp_p:'verwierpen', pp:'verworpen', aux:'heeft', pattern:'special', level:'B2' },
  { id:'inzien', inf:'inzien', en:'to realize/understand', imp_s:'zag in', imp_p:'zagen in', pp:'ingezien', aux:'heeft', pattern:'special', level:'B2' },
  { id:'doordringen', inf:'doordringen', en:'to penetrate/sink in', imp_s:'drong door', imp_p:'drongen door', pp:'doorgedrongen', aux:'is', pattern:'i→o→o', level:'B2' },
  { id:'uitwijzen', inf:'uitwijzen', en:'to show/prove', imp_s:'wees uit', imp_p:'wezen uit', pp:'uitgewezen', aux:'heeft', pattern:'ij→ee→e', level:'B2' },
  // === B2/C1 REGULAR VERBS ===
  { id:'analyseren', inf:'analyseren', en:'to analyze', imp_s:'analyseerde', imp_p:'analyseerden', pp:'geanalyseerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'evalueren', inf:'evalueren', en:'to evaluate', imp_s:'evalueerde', imp_p:'evalueerden', pp:'geëvalueerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'implementeren', inf:'implementeren', en:'to implement', imp_s:'implementeerde', imp_p:'implementeerden', pp:'geïmplementeerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'interpreteren', inf:'interpreteren', en:'to interpret', imp_s:'interpreteerde', imp_p:'interpreteerden', pp:'geïnterpreteerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'formuleren', inf:'formuleren', en:'to formulate', imp_s:'formuleerde', imp_p:'formuleerden', pp:'geformuleerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'motiveren', inf:'motiveren', en:'to motivate', imp_s:'motiveerde', imp_p:'motiveerden', pp:'gemotiveerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'profileren', inf:'profileren', en:'to profile/position', imp_s:'profileerde', imp_p:'profileerden', pp:'geprofileerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'realiseren', inf:'realiseren', en:'to realize/achieve', imp_s:'realiseerde', imp_p:'realiseerden', pp:'gerealiseerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'signaleren', inf:'signaleren', en:'to signal/identify', imp_s:'signaleerde', imp_p:'signaleerden', pp:'gesignaleerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'specificeren', inf:'specificeren', en:'to specify', imp_s:'specificeerde', imp_p:'specificeerden', pp:'gespecificeerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'structureren', inf:'structureren', en:'to structure', imp_s:'structureerde', imp_p:'structureerden', pp:'gestructureerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'transformeren', inf:'transformeren', en:'to transform', imp_s:'transformeerde', imp_p:'transformeerden', pp:'getransformeerd', aux:'heeft/is', pattern:'regular', level:'C1' },
  { id:'nuanceren', inf:'nuanceren', en:'to nuance/qualify', imp_s:'nuanceerde', imp_p:'nuanceerden', pp:'genuanceerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'faciliteren', inf:'faciliteren', en:'to facilitate', imp_s:'faciliteerde', imp_p:'faciliteerden', pp:'gefaciliteerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'coördineren', inf:'coördineren', en:'to coordinate', imp_s:'coördineerde', imp_p:'coördineerden', pp:'gecoördineerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'legitimeren', inf:'legitimeren', en:'to legitimize', imp_s:'legitimeerde', imp_p:'legitimeerden', pp:'gelegitimeerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'confronteren', inf:'confronteren', en:'to confront', imp_s:'confronteerde', imp_p:'confronteerden', pp:'geconfronteerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'compenseren', inf:'compenseren', en:'to compensate', imp_s:'compenseerde', imp_p:'compenseerden', pp:'gecompenseerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'domineren', inf:'domineren', en:'to dominate', imp_s:'domineerde', imp_p:'domineerden', pp:'gedomineerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'integreren', inf:'integreren', en:'to integrate', imp_s:'integreerde', imp_p:'integreerden', pp:'geïntegreerd', aux:'heeft/is', pattern:'regular', level:'C1' },
  { id:'innoveren', inf:'innoveren', en:'to innovate', imp_s:'innoveerde', imp_p:'innoveerden', pp:'geïnnoveerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'optimaliseren', inf:'optimaliseren', en:'to optimize', imp_s:'optimaliseerde', imp_p:'optimaliseerden', pp:'geoptimaliseerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'demonstreren', inf:'demonstreren', en:'to demonstrate/protest', imp_s:'demonstreerde', imp_p:'demonstreerden', pp:'gedemonstreerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'debatteren', inf:'debatteren', en:'to debate', imp_s:'debatteerde', imp_p:'debatteerden', pp:'gedebatteerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'manipuleren', inf:'manipuleren', en:'to manipulate', imp_s:'manipuleerde', imp_p:'manipuleerden', pp:'gemanipuleerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'elimineren', inf:'elimineren', en:'to eliminate', imp_s:'elimineerde', imp_p:'elimineerden', pp:'geëlimineerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'exploiteren', inf:'exploiteren', en:'to operate/exploit', imp_s:'exploiteerde', imp_p:'exploiteerden', pp:'geëxploiteerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'normaliseren', inf:'normaliseren', en:'to normalize', imp_s:'normaliseerde', imp_p:'normaliseerden', pp:'genormaliseerd', aux:'heeft/is', pattern:'regular', level:'C1' },
  { id:'relativeren', inf:'relativeren', en:'to put into perspective', imp_s:'relativeerde', imp_p:'relativeerden', pp:'gerelativeerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'ondermijnen', inf:'ondermijnen', en:'to undermine', imp_s:'ondermijnde', imp_p:'ondermijnden', pp:'ondermijnd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'vergemakkelijken', inf:'vergemakkelijken', en:'to facilitate/simplify', imp_s:'vergemakkelijkte', imp_p:'vergemakkelijkten', pp:'vergemakkelijkt', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'uitputten', inf:'uitputten', en:'to exhaust/deplete', imp_s:'putte uit', imp_p:'putten uit', pp:'uitgeput', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'aanpakken', inf:'aanpakken', en:'to tackle/address', imp_s:'pakte aan', imp_p:'pakten aan', pp:'aangepakt', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'instellen', inf:'instellen', en:'to set up/establish', imp_s:'stelde in', imp_p:'stelden in', pp:'ingesteld', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'vaststellen', inf:'vaststellen', en:'to determine/establish', imp_s:'stelde vast', imp_p:'stelden vast', pp:'vastgesteld', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'vrijlaten', inf:'vrijlaten', en:'to release/free', imp_s:'liet vrij', imp_p:'lieten vrij', pp:'vrijgelaten', aux:'heeft', pattern:'special', level:'C1' },
  { id:'overhandigen', inf:'overhandigen', en:'to hand over', imp_s:'overhandigde', imp_p:'overhandigden', pp:'overhandigd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'verzekeren', inf:'verzekeren', en:'to insure/assure', imp_s:'verzekerde', imp_p:'verzekerden', pp:'verzekerd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'vermoeden', inf:'vermoeden', en:'to suspect', imp_s:'vermoedde', imp_p:'vermoedden', pp:'vermoed', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'nastreven', inf:'nastreven', en:'to pursue/strive for', imp_s:'streefde na', imp_p:'streefden na', pp:'nagestreefd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'ontkennen', inf:'ontkennen', en:'to deny', imp_s:'ontkende', imp_p:'ontkenden', pp:'ontkend', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'overleggen', inf:'overleggen', en:'to consult/deliberate', imp_s:'overlegde', imp_p:'overlegden', pp:'overlegd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'tegenwerken', inf:'tegenwerken', en:'to obstruct/thwart', imp_s:'werkte tegen', imp_p:'werkten tegen', pp:'tegengewerkt', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'inleveren', inf:'inleveren', en:'to hand in/submit', imp_s:'leverde in', imp_p:'leverden in', pp:'ingeleverd', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'afschaffen', inf:'afschaffen', en:'to abolish', imp_s:'schafte af', imp_p:'schaften af', pp:'afgeschaft', aux:'heeft', pattern:'regular', level:'C1' },
  { id:'doorvoeren', inf:'doorvoeren', en:'to implement/carry through', imp_s:'voerde door', imp_p:'voerden door', pp:'doorgevoerd', aux:'heeft', pattern:'regular', level:'C1' },
];

const PREPOSITION_VERBS = [
  // ===== OP =====
  { id:'abonneren_op', phrase:'zich abonneren op', en:'to subscribe to', prep:'op', example:'Ik heb me geabonneerd op de lokale krant.', example_en:'I subscribed to the local newspaper.', level:'B1' },
  { id:'rekenen_op', phrase:'rekenen op', en:'to count on', prep:'op', example:'Je kunt altijd op mij rekenen.', example_en:'You can always count on me.', level:'B1' },
  { id:'wachten_op', phrase:'wachten op', en:'to wait for', prep:'op', example:'Ik wacht hier op je.', example_en:'I am waiting here for you.', level:'B1' },
  { id:'lijken_op', phrase:'lijken op', en:'to look like', prep:'op', example:'Je lijkt echt op je moeder.', example_en:'You really look like your mother.', level:'B1' },
  { id:'letten_op', phrase:'letten op', en:'to pay attention to', prep:'op', example:'Let op de kinderen!', example_en:'Watch the children!', level:'B1' },
  { id:'vertrouwen_op', phrase:'vertrouwen op', en:'to trust in', prep:'op', example:'Ik vertrouw op jouw oordeel.', example_en:'I trust your judgment.', level:'B1' },
  { id:'reageren_op', phrase:'reageren op', en:'to react to', prep:'op', example:'Kun je even reageren op die e-mail?', example_en:'Can you respond to that e-mail?', level:'B1' },
  { id:'stemmen_op', phrase:'stemmen op', en:'to vote for', prep:'op', example:'Op wie ga jij stemmen bij de volgende verkiezingen?', example_en:'Who will you vote for in the next elections?', level:'B1' },
  { id:'trots_zijn_op', phrase:'trots zijn op', en:'to be proud of', prep:'op', example:'Gefeliciteerd met je nieuwe baan. Ik ben zo trots op je!', example_en:'Congratulations on your new job. I am so proud of you!', level:'B1' },
  { id:'boos_zijn_op', phrase:'boos zijn op', en:'to be angry at', prep:'op', example:'Ze is boos op haar vriend, want hij is weer te laat.', example_en:'She is angry at her boyfriend because he is late again.', level:'B1' },
  { id:'concentreren_op', phrase:'zich concentreren op', en:'to concentrate on', prep:'op', example:'Ik moet me goed concentreren op deze tekst.', example_en:'I need to concentrate well on this text.', level:'B1' },
  { id:'invloed_hebben_op', phrase:'invloed hebben op', en:'to have influence on', prep:'op', example:'Het weer heeft veel invloed op zijn humeur.', example_en:'The weather has a lot of influence on his mood.', level:'B1' },
  { id:'voorbereiden_op', phrase:'zich voorbereiden op', en:'to prepare for', prep:'op', example:'Heb jij je goed voorbereid op de test?', example_en:'Have you prepared well for the test?', level:'B1' },
  { id:'verheugen_op', phrase:'zich verheugen op', en:'to look forward to', prep:'op', example:'Ik verheug me op Kerstmis met mijn familie.', example_en:'I look forward to Christmas with my family.', level:'B1' },
  { id:'verliefd_zijn_op', phrase:'verliefd zijn op', en:'to be in love with', prep:'op', example:'Ik ben verliefd op je.', example_en:'I am in love with you.', level:'B1' },
  { id:'gek_zijn_op', phrase:'gek zijn op', en:'to be crazy about', prep:'op', example:'Ze is echt gek op haar vriend.', example_en:'She is really crazy about her boyfriend.', level:'B1' },
  { id:'antwoord_geven_op', phrase:'antwoord geven op', en:'to answer', prep:'op', example:'Kun jij antwoord geven op die vraag?', example_en:'Can you answer that question?', level:'B1' },
  { id:'kritiek_hebben_op', phrase:'kritiek hebben op', en:'to criticize', prep:'op', example:'De mensen hebben veel kritiek op zijn ideeën.', example_en:'People have a lot of criticism of his ideas.', level:'B1' },
  { id:'bezuinigen_op', phrase:'bezuinigen op', en:'to cut back on', prep:'op', example:'De regering wil meer bezuinigen op kunst en cultuur.', example_en:'The government wants to cut back more on art and culture.', level:'B1' },
  { id:'hopen_op', phrase:'hopen op', en:'to hope for', prep:'op', example:'We hopen op mooi weer morgen.', example_en:'We hope for nice weather tomorrow.', level:'B1' },
  { id:'wijzen_op', phrase:'wijzen op', en:'to point to', prep:'op', example:'De docent wees op een fout in het rapport.', example_en:'The teacher pointed to an error in the report.', level:'B1' },
  { id:'passen_op', phrase:'passen op', en:'to look after', prep:'op', example:'Kun je op de hond passen?', example_en:'Can you look after the dog?', level:'B1' },
  { id:'ingaan_op', phrase:'ingaan op', en:'to respond to', prep:'op', example:'De minister ging niet in op de vraag.', example_en:'The minister did not respond to the question.', level:'B1' },
  { id:'terugkomen_op', phrase:'terugkomen op', en:'to come back to', prep:'op', example:'Ik kom later terug op dit onderwerp.', example_en:'I will come back to this topic later.', level:'B1' },
  { id:'steunen_op', phrase:'steunen op', en:'to rely on', prep:'op', example:'Ze steunt op haar familie in moeilijke tijden.', example_en:'She relies on her family in difficult times.', level:'B1' },
  // ===== VAN =====
  { id:'afhankelijk_zijn_van', phrase:'afhankelijk zijn van', en:'to depend on', prep:'van', example:'Hij is nog steeds financieel afhankelijk van zijn ouders.', example_en:'He is still financially dependent on his parents.', level:'B1' },
  { id:'houden_van', phrase:'houden van', en:'to love', prep:'van', example:'Ik hou van jou!', example_en:'I love you!', level:'B1' },
  { id:'dromen_van', phrase:'dromen van', en:'to dream of', prep:'van', example:'Ze droomt van een reis naar Japan.', example_en:'She dreams of a trip to Japan.', level:'B1' },
  { id:'genieten_van', phrase:'genieten van', en:'to enjoy', prep:'van', example:'Ze genieten van de vakantie.', example_en:'They are enjoying the vacation.', level:'B1' },
  { id:'schrikken_van', phrase:'schrikken van', en:'to be startled by', prep:'van', example:'We zijn erg geschrokken van het slechte nieuws.', example_en:'We were very shocked by the bad news.', level:'B1' },
  { id:'gebruik_maken_van', phrase:'gebruik maken van', en:'to make use of', prep:'van', example:'Kan ik even gebruik maken van jullie toilet?', example_en:'May I use your toilet?', level:'B1' },
  { id:'op_de_hoogte_zijn_van', phrase:'op de hoogte zijn van', en:'to be informed about', prep:'van', example:'Hij is op de hoogte van het laatste nieuws.', example_en:'He is informed about the latest news.', level:'B1' },
  { id:'spijt_hebben_van', phrase:'spijt hebben van', en:'to regret', prep:'van', example:'Zij heeft spijt van haar studiekeuze.', example_en:'She regrets her study choice.', level:'B1' },
  { id:'verliezen_van', phrase:'verliezen van', en:'to lose from', prep:'van', example:'Als we gaan tennissen, verlies ik altijd van jou.', example_en:'When we play tennis, I always lose from you.', level:'B1' },
  { id:'verstand_hebben_van', phrase:'verstand hebben van', en:'to know about', prep:'van', example:'Heb jij verstand van computers?', example_en:'Do you know about computers?', level:'B1' },
  { id:'verschillen_van', phrase:'verschillen van', en:'to differ from', prep:'van', example:'Zijn mening verschilt van de mijne.', example_en:'His opinion differs from mine.', level:'B1' },
  { id:'profiteren_van', phrase:'profiteren van', en:'to benefit from', prep:'van', example:'Studenten profiteren van de korting.', example_en:'Students benefit from the discount.', level:'B1' },
  { id:'beschuldigen_van', phrase:'beschuldigen van', en:'to accuse of', prep:'van', example:'Ze beschuldigden hem van fraude.', example_en:'They accused him of fraud.', level:'B1' },
  { id:'balen_van', phrase:'balen van', en:'to be fed up with', prep:'van', example:'Ik baal van dit slechte weer.', example_en:'I am fed up with this bad weather.', level:'B1' },
  { id:'afzien_van', phrase:'afzien van', en:'to refrain from', prep:'van', example:'Hij zag af van verdere actie.', example_en:'He refrained from further action.', level:'B1' },
  { id:'uitgaan_van', phrase:'uitgaan van', en:'to assume', prep:'van', example:'Ik ga ervan uit dat je komt.', example_en:'I assume that you are coming.', level:'B1' },
  { id:'scheiden_van', phrase:'scheiden van', en:'to divorce from', prep:'van', example:'Ze is gescheiden van haar man.', example_en:'She is divorced from her husband.', level:'B1' },
  { id:'last_hebben_van', phrase:'last hebben van', en:'to suffer from', prep:'van', example:'Ik heb last van hoofdpijn.', example_en:'I suffer from headaches.', level:'B1' },
  { id:'leren_van', phrase:'leren van', en:'to learn from', prep:'van', example:'Je kunt veel leren van je fouten.', example_en:'You can learn a lot from your mistakes.', level:'B1' },
  { id:'afwijken_van', phrase:'afwijken van', en:'to deviate from', prep:'van', example:'Je mag niet afwijken van het protocol.', example_en:'You must not deviate from the protocol.', level:'B1' },
  // ===== AAN =====
  { id:'denken_aan', phrase:'denken aan', en:'to think of', prep:'aan', example:'We denken vaak aan onze familie.', example_en:'We often think of our family.', level:'B1' },
  { id:'wennen_aan', phrase:'wennen aan', en:'to get used to', prep:'aan', example:'Zij kan niet wennen aan het gebruik van een agenda.', example_en:'She cannot get used to using a planner.', level:'B1' },
  { id:'deelnemen_aan', phrase:'deelnemen aan', en:'to take part in', prep:'aan', example:'Hij neemt dit jaar deel aan een zomerschool in Utrecht.', example_en:'He is taking part in a summer school in Utrecht this year.', level:'B1' },
  { id:'ergeren_aan', phrase:'zich ergeren aan', en:'to be annoyed by', prep:'aan', example:'Hij ergert zich aan mensen die een appel eten in de trein.', example_en:'He is annoyed by people who eat an apple on the train.', level:'B1' },
  { id:'houden_aan', phrase:'zich houden aan', en:'to stick to', prep:'aan', example:'Zij houdt zich altijd aan haar afspraken.', example_en:'She always sticks to her appointments.', level:'B1' },
  { id:'hekel_hebben_aan', phrase:'een hekel hebben aan', en:'to hate/dislike', prep:'aan', example:'Ze heeft een hekel aan mensen die te laat komen.', example_en:'She hates people who arrive late.', level:'B1' },
  { id:'geld_uitgeven_aan', phrase:'geld uitgeven aan', en:'to spend money on', prep:'aan', example:'Hij geeft veel geld uit aan muziek.', example_en:'He spends a lot of money on music.', level:'B1' },
  { id:'twijfelen_aan', phrase:'twijfelen aan', en:'to doubt', prep:'aan', example:'Ik twijfel aan zijn eerlijkheid.', example_en:'I doubt his honesty.', level:'B1' },
  { id:'meedoen_aan', phrase:'meedoen aan', en:'to participate in', prep:'aan', example:'Wil je meedoen met ons spel?', example_en:'Do you want to participate in our game?', level:'B1' },
  { id:'beginnen_aan', phrase:'beginnen aan', en:'to start on', prep:'aan', example:'We beginnen morgen aan het project.', example_en:'We start on the project tomorrow.', level:'B1' },
  { id:'werken_aan', phrase:'werken aan', en:'to work on', prep:'aan', example:'Hij werkt aan een nieuw boek.', example_en:'He is working on a new book.', level:'B1' },
  { id:'bijdragen_aan', phrase:'bijdragen aan', en:'to contribute to', prep:'aan', example:'Iedereen kan bijdragen aan een betere wereld.', example_en:'Everyone can contribute to a better world.', level:'B1' },
  { id:'verslaafd_zijn_aan', phrase:'verslaafd zijn aan', en:'to be addicted to', prep:'aan', example:'Hij is verslaafd aan gamen.', example_en:'He is addicted to gaming.', level:'B1' },
  { id:'voorstellen_aan', phrase:'zich voorstellen aan', en:'to introduce oneself to', prep:'aan', example:'Ik zal me even aan jullie voorstellen. Ik ben Jan de Graaf.', example_en:'Let me introduce myself to you. I am Jan de Graaf.', level:'B1' },
  { id:'werk_overdragen_aan', phrase:'werk overdragen aan', en:'to hand over work to', prep:'aan', example:'Zij zal het werk aan jou overdragen.', example_en:'She will hand over the work to you.', level:'B1' },
  { id:'herinneren_aan', phrase:'herinneren aan', en:'to remind of', prep:'aan', example:'Dit lied herinnert me aan mijn jeugd.', example_en:'This song reminds me of my youth.', level:'B1' },
  { id:'lijden_aan', phrase:'lijden aan', en:'to suffer from', prep:'aan', example:'Hij lijdt aan suikerziekte.', example_en:'He suffers from diabetes.', level:'B1' },
  { id:'voldoen_aan', phrase:'voldoen aan', en:'to meet/comply with', prep:'aan', example:'Het product voldoet aan alle eisen.', example_en:'The product meets all requirements.', level:'B1' },
  { id:'gehecht_zijn_aan', phrase:'gehecht zijn aan', en:'to be attached to', prep:'aan', example:'Ze is erg gehecht aan haar kat.', example_en:'She is very attached to her cat.', level:'B1' },
  // ===== MET =====
  { id:'beginnen_met', phrase:'beginnen met', en:'to begin with', prep:'met', example:'Zullen we beginnen met de les?', example_en:'Shall we begin with the lesson?', level:'B1' },
  { id:'bemoeien_met', phrase:'zich bemoeien met', en:'to interfere with', prep:'met', example:'Zijn ouders bemoeien zich altijd met zijn huiswerk.', example_en:'His parents always interfere with his homework.', level:'B1' },
  { id:'bezig_zijn_met', phrase:'bezig zijn met', en:'to be busy with', prep:'met', example:'Ze zijn druk bezig met het kerstdiner.', example_en:'They are busy with the Christmas dinner.', level:'B1' },
  { id:'condoleren_met', phrase:'condoleren met', en:'to offer condolences for', prep:'met', example:'Gecondoleerd met het overlijden van je oma.', example_en:'My condolences on the passing of your grandmother.', level:'B1' },
  { id:'eens_zijn_met', phrase:'het eens zijn met', en:'to agree with', prep:'met', example:'Ik ben het niet met je eens!', example_en:'I do not agree with you!', level:'B1' },
  { id:'ervaring_hebben_met', phrase:'ervaring hebben met', en:'to have experience with', prep:'met', example:'Ik zie dat je veel ervaring hebt met dit werk.', example_en:'I see that you have a lot of experience with this work.', level:'B1' },
  { id:'feliciteren_met', phrase:'feliciteren met', en:'to congratulate on', prep:'met', example:'Gefeliciteerd met jullie trouwdag!', example_en:'Congratulations on your wedding day!', level:'B1' },
  { id:'kennismaken_met', phrase:'kennismaken met', en:'to get acquainted with', prep:'met', example:'Zullen we even kennismaken met de nieuwe buren?', example_en:'Shall we get acquainted with the new neighbors?', level:'B1' },
  { id:'stoppen_met', phrase:'stoppen met', en:'to stop', prep:'met', example:'Hij is gestopt met zijn muzieklessen.', example_en:'He stopped his music lessons.', level:'B1' },
  { id:'tevreden_zijn_met', phrase:'tevreden zijn met', en:'to be satisfied with', prep:'met', example:'Ben je tevreden met je salaris?', example_en:'Are you satisfied with your salary?', level:'B1' },
  { id:'trouwen_met', phrase:'trouwen met', en:'to marry', prep:'met', example:'Hij is getrouwd met zijn jeugdliefde.', example_en:'He married his childhood sweetheart.', level:'B1' },
  { id:'vergelijken_met', phrase:'vergelijken met', en:'to compare with', prep:'met', example:'Dat is appels met peren vergelijken.', example_en:'That is comparing apples with pears.', level:'B1' },
  { id:'rekening_houden_met', phrase:'rekening houden met', en:'to take into account', prep:'met', example:'Hij houdt nooit rekening met haar gevoelens.', example_en:'He never takes her feelings into account.', level:'B1' },
  { id:'samenwerken_met', phrase:'samenwerken met', en:'to cooperate with', prep:'met', example:'We willen met internationale bedrijven samenwerken.', example_en:'We want to cooperate with international companies.', level:'B1' },
  { id:'ophouden_met', phrase:'ophouden met', en:'to stop', prep:'met', example:'Houd op met schreeuwen!', example_en:'Stop shouting!', level:'B1' },
  { id:'omgaan_met', phrase:'omgaan met', en:'to deal with', prep:'met', example:'Ze kan goed omgaan met stress.', example_en:'She can deal well with stress.', level:'B1' },
  { id:'praten_met', phrase:'praten met', en:'to talk with', prep:'met', example:'Hij praat met zijn collega\'s nooit over zijn problemen.', example_en:'He never talks with his colleagues about his problems.', level:'B1' },
  { id:'helpen_met', phrase:'helpen met', en:'to help with', prep:'met', example:'Kun je me helpen met verhuizen?', example_en:'Can you help me with moving?', level:'B1' },
  // ===== VOOR =====
  { id:'bang_zijn_voor', phrase:'bang zijn voor', en:'to be afraid of', prep:'voor', example:'Ben je bang voor spinnen?', example_en:'Are you afraid of spiders?', level:'B1' },
  { id:'zorgen_voor', phrase:'zorgen voor', en:'to take care of', prep:'voor', example:'Wil je tijdens mijn vakantie voor de planten zorgen?', example_en:'Will you take care of the plants during my vacation?', level:'B1' },
  { id:'schamen_voor', phrase:'zich schamen voor', en:'to be ashamed of', prep:'voor', example:'Zij schaamt zich voor haar grote neus.', example_en:'She is ashamed of her big nose.', level:'B1' },
  { id:'inschrijven_voor', phrase:'zich inschrijven voor', en:'to enroll for', prep:'voor', example:'Kan ik me nog inschrijven voor een cursus Japans?', example_en:'Can I still enroll for a Japanese course?', level:'B1' },
  { id:'waarschuwen_voor', phrase:'waarschuwen voor', en:'to warn about', prep:'voor', example:'De weerman heeft gewaarschuwd voor mist op de weg.', example_en:'The weatherman has warned about fog on the road.', level:'B1' },
  { id:'verantwoordelijk_zijn_voor', phrase:'verantwoordelijk zijn voor', en:'to be responsible for', prep:'voor', example:'Vandaag ben hij verantwoordelijk voor dat werk.', example_en:'Today he is responsible for that work.', level:'B1' },
  { id:'vluchten_voor', phrase:'vluchten voor', en:'to flee from', prep:'voor', example:'Zij zijn gevlucht voor de oorlog.', example_en:'They have fled from the war.', level:'B1' },
  { id:'slagen_voor', phrase:'slagen voor', en:'to pass (an exam)', prep:'voor', example:'Hij is geslaagd voor zijn rijexamen.', example_en:'He passed his driving exam.', level:'B1' },
  { id:'sparen_voor', phrase:'sparen voor', en:'to save for', prep:'voor', example:'Zij heeft lang gespaard voor een goede gitaar.', example_en:'She has saved for a long time for a good guitar.', level:'B1' },
  { id:'reclame_maken_voor', phrase:'reclame maken voor', en:'to advertise for', prep:'voor', example:'In deze folder wordt reclame gemaakt voor elektronica.', example_en:'In this brochure electronics are advertised.', level:'B1' },
  { id:'respect_hebben_voor', phrase:'respect hebben voor', en:'to have respect for', prep:'voor', example:'Kinderen moeten respect hebben voor hun docent.', example_en:'Children must have respect for their teacher.', level:'B1' },
  { id:'kiezen_voor', phrase:'kiezen voor', en:'to choose', prep:'voor', example:'Ze koos voor een studie geneeskunde.', example_en:'She chose to study medicine.', level:'B1' },
  { id:'bedanken_voor', phrase:'bedanken voor', en:'to thank for', prep:'voor', example:'Ik wil je bedanken voor je hulp.', example_en:'I want to thank you for your help.', level:'B1' },
  { id:'opkomen_voor', phrase:'opkomen voor', en:'to stand up for', prep:'voor', example:'Ze komt op voor de rechten van vrouwen.', example_en:'She stands up for women\'s rights.' },
  { id:'interesseren_voor', phrase:'zich interesseren voor', en:'to be interested in', prep:'voor', example:'Ze interesseert zich voor kunst.', example_en:'She is interested in art.', level:'B1' },
  // ===== OVER =====
  { id:'bezorgd_zijn_over', phrase:'bezorgd zijn over', en:'to be worried about', prep:'over', example:'Hij is bezorgd over de slechte situatie in zijn land.', example_en:'He is worried about the bad situation in his country.', level:'B1' },
  { id:'discussieren_over', phrase:'discussiëren over', en:'to discuss', prep:'over', example:'Zij discussiëren thuis vaak over politiek.', example_en:'They often discuss politics at home.', level:'B1' },
  { id:'nadenken_over', phrase:'nadenken over', en:'to think about', prep:'over', example:'Heb je al over mijn voorstel nagedacht?', example_en:'Have you already thought about my proposal?', level:'B1' },
  { id:'praten_over', phrase:'praten over', en:'to talk about', prep:'over', example:'Hij praat met zijn collega\'s nooit over zijn problemen.', example_en:'He never talks with his colleagues about his problems.', level:'B1' },
  { id:'klagen_over', phrase:'klagen over', en:'to complain about', prep:'over', example:'Hij klaagt altijd over het eten.', example_en:'He always complains about the food.', level:'B1' },
  { id:'verbazen_over', phrase:'zich verbazen over', en:'to be surprised at', prep:'over', example:'Zij verbaast zich over de voorzetsels in het Nederlands.', example_en:'She is surprised at the prepositions in Dutch.', level:'B1' },
  { id:'zorgen_maken_over', phrase:'zich zorgen maken over', en:'to worry about', prep:'over', example:'Ik maak me zorgen over zijn schoolprestaties.', example_en:'I worry about his school performance.', level:'B1' },
  { id:'vraag_stellen_over', phrase:'een vraag stellen over', en:'to ask a question about', prep:'over', example:'Mag ik nog een vraag stellen over oefening 6?', example_en:'May I still ask a question about exercise 6?', level:'B1' },
  { id:'beslissen_over', phrase:'beslissen over', en:'to decide on', prep:'over', example:'De rechter beslist over de zaak.', example_en:'The judge decides on the case.', level:'B1' },
  { id:'vertellen_over', phrase:'vertellen over', en:'to tell about', prep:'over', example:'Ze vertelde over haar vakantie.', example_en:'She told about her holiday.', level:'B1' },
  { id:'beschikken_over', phrase:'beschikken over', en:'to have at one\'s disposal', prep:'over', example:'Het hotel beschikt over een zwembad.', example_en:'The hotel has a swimming pool.', level:'B1' },
  // ===== IN =====
  { id:'geinteresseerd_zijn_in', phrase:'geïnteresseerd zijn in', en:'to be interested in', prep:'in', example:'Hij is erg geïnteresseerd in fotografie.', example_en:'He is very interested in photography.', level:'B1' },
  { id:'geloven_in', phrase:'geloven in', en:'to believe in', prep:'in', example:'Ik geloof in een betere toekomst.', example_en:'I believe in a better future.', level:'B1' },
  { id:'slagen_in', phrase:'slagen in', en:'to succeed in', prep:'in', example:'Ik ben erg slecht in het onthouden van namen.', example_en:'I am very bad at remembering names.', level:'B1' },
  { id:'slecht_zijn_in', phrase:'slecht zijn in', en:'to be bad at', prep:'in', example:'Ik ben erg slecht in het onthouden van namen.', example_en:'I am very bad at remembering names.', level:'B1' },
  { id:'trek_hebben_in', phrase:'trek hebben in', en:'to feel like (food)', prep:'in', example:'Ik heb trek in een kroket!', example_en:'I feel like a croquette!', level:'B1' },
  { id:'zin_hebben_in', phrase:'zin hebben in', en:'to feel like', prep:'in', example:'Heb je zin in een ijsje?', example_en:'Do you feel like an ice cream?', level:'B1' },
  { id:'vergissen_in', phrase:'zich vergissen in', en:'to be mistaken about', prep:'in', example:'Hij heeft zich vergist in de datum.', example_en:'He was mistaken about the date.', level:'B1' },
  { id:'investeren_in', phrase:'investeren in', en:'to invest in', prep:'in', example:'Het bedrijf investeert in nieuwe technologie.', example_en:'The company invests in new technology.', level:'B1' },
  { id:'verdiepen_in', phrase:'zich verdiepen in', en:'to immerse oneself in', prep:'in', example:'Hij verdiepte zich in de geschiedenis van Nederland.', example_en:'He immersed himself in Dutch history.', level:'B1' },
  { id:'specialiseren_in', phrase:'zich specialiseren in', en:'to specialize in', prep:'in', example:'De arts specialiseert zich in hartziekten.', example_en:'The doctor specializes in heart diseases.', level:'B1' },
  // ===== NAAR =====
  { id:'luisteren_naar', phrase:'luisteren naar', en:'to listen to', prep:'naar', example:'Hij luistert nooit naar zijn ouders.', example_en:'He never listens to his parents.', level:'B1' },
  { id:'kijken_naar', phrase:'kijken naar', en:'to look at/watch', prep:'naar', example:'Kijk je weleens naar een soapserie op de televisie?', example_en:'Do you ever watch a soap opera on television?', level:'B1' },
  { id:'verlangen_naar', phrase:'verlangen naar', en:'to long for', prep:'naar', example:'Verlang jij ook zo naar een kop warme chocolademelk?', example_en:'Do you also long so much for a cup of hot chocolate?', level:'B1' },
  { id:'informeren_naar', phrase:'informeren naar', en:'to inquire about', prep:'naar', example:'Ik wilde graag informeren naar de openingstijden.', example_en:'I would like to inquire about the opening hours.', level:'B1' },
  { id:'solliciteren_naar', phrase:'solliciteren naar', en:'to apply for', prep:'naar', example:'Ik heb gesolliciteerd naar een nieuwe functie.', example_en:'I applied for a new position.', level:'B1' },
  { id:'zoeken_naar', phrase:'zoeken naar', en:'to search for', prep:'naar', example:'Ze zoekt naar een nieuwe baan.', example_en:'She is searching for a new job.', level:'B1' },
  { id:'streven_naar', phrase:'streven naar', en:'to strive for', prep:'naar', example:'Hij streeft naar perfectie.', example_en:'He strives for perfection.', level:'B1' },
  { id:'verwijzen_naar', phrase:'verwijzen naar', en:'to refer to', prep:'naar', example:'De dokter verwees me naar een specialist.', example_en:'The doctor referred me to a specialist.', level:'B1' },
  { id:'geld_overmaken_naar', phrase:'geld overmaken naar', en:'to transfer money to', prep:'naar', example:'Je kunt het geld overmaken naar onze rekening.', example_en:'You can transfer the money to our account.', level:'B1' },
  { id:'uitzien_naar', phrase:'uitzien naar', en:'to look forward to', prep:'naar', example:'Ik zie uit naar het weekend.', example_en:'I look forward to the weekend.', level:'B1' },
  // ===== OM =====
  { id:'lachen_om', phrase:'lachen om', en:'to laugh at', prep:'om', example:'De kinderen lachen om de grapjes van de clown.', example_en:'The children laugh at the clown\'s jokes.' },
  { id:'vragen_om', phrase:'vragen om', en:'to ask for', prep:'om', example:'Hij vroeg om een glas water.', example_en:'He asked for a glass of water.', level:'B1' },
  { id:'geven_om', phrase:'geven om', en:'to care about', prep:'om', example:'Ze geeft veel om haar vrienden.', example_en:'She cares a lot about her friends.', level:'B1' },
  { id:'huilen_om', phrase:'huilen om', en:'to cry about', prep:'om', example:'Het kind huilt om zijn moeder.', example_en:'The child is crying for his mother.', level:'B1' },
  { id:'roepen_om', phrase:'roepen om', en:'to call for', prep:'om', example:'De kinderen riepen om hulp.', example_en:'The children called for help.', level:'B1' },
  { id:'smeken_om', phrase:'smeken om', en:'to beg for', prep:'om', example:'De gevangene smeekte om genade.', example_en:'The prisoner begged for mercy.', level:'B1' },
  { id:'bekend_staan_om', phrase:'bekend staan om', en:'to be known for', prep:'om', example:'Nederland staat bekend om zijn tulpen.', example_en:'The Netherlands is known for its tulips.', level:'B1' },
  // ===== TEGEN =====
  { id:'vechten_tegen', phrase:'vechten tegen', en:'to fight against', prep:'tegen', example:'Ze vechten tegen onrecht.', example_en:'They fight against injustice.', level:'B1' },
  { id:'protesteren_tegen', phrase:'protesteren tegen', en:'to protest against', prep:'tegen', example:'Duizenden mensen protesteerden tegen het beleid.', example_en:'Thousands protested against the policy.', level:'B1' },
  { id:'beschermen_tegen', phrase:'beschermen tegen', en:'to protect against', prep:'tegen', example:'De crème beschermt je huid tegen de zon.', example_en:'The cream protects your skin against the sun.', level:'B1' },
  { id:'opzien_tegen', phrase:'opzien tegen', en:'to dread', prep:'tegen', example:'Ik zie op tegen het gesprek met mijn baas.', example_en:'I dread the conversation with my boss.', level:'B1' },
  { id:'verzetten_tegen', phrase:'zich verzetten tegen', en:'to resist', prep:'tegen', example:'De bevolking verzet zich tegen de bezetting.', example_en:'The population resists the occupation.', level:'B1' },
  { id:'stemmen_tegen', phrase:'stemmen tegen', en:'to vote against', prep:'tegen', example:'De meerderheid stemde tegen het voorstel.', example_en:'The majority voted against the proposal.', level:'B1' },
  { id:'zeggen_tegen', phrase:'zeggen tegen', en:'to say to', prep:'tegen', example:'Wat zei je tegen hem?', example_en:'What did you say to him?', level:'B1' },
  // ===== BIJ =====
  { id:'horen_bij', phrase:'horen bij', en:'to belong to', prep:'bij', example:'Deze sleutel hoort bij die deur.', example_en:'This key belongs to that door.', level:'B1' },
  { id:'passen_bij', phrase:'passen bij', en:'to suit/match', prep:'bij', example:'Die schoenen passen goed bij je jurk.', example_en:'Those shoes match your dress well.', level:'B1' },
  { id:'stilstaan_bij', phrase:'stilstaan bij', en:'to reflect on', prep:'bij', example:'We staan even stil bij dit belangrijke moment.', example_en:'We reflect on this important moment.', level:'B1' },
  { id:'aansluiten_bij', phrase:'zich aansluiten bij', en:'to join', prep:'bij', example:'Wil je je aansluiten bij onze groep?', example_en:'Do you want to join our group?', level:'B1' },
  { id:'betrekken_bij', phrase:'betrekken bij', en:'to involve in', prep:'bij', example:'We moeten de bewoners betrekken bij de plannen.', example_en:'We must involve the residents in the plans.', level:'B1' },
  { id:'helpen_bij', phrase:'helpen bij', en:'to help with', prep:'bij', example:'Kan ik je ergens bij helpen?', example_en:'Can I help you with anything?', level:'B1' },
  { id:'stemmen_bij', phrase:'stemmen bij', en:'to vote at', prep:'bij', example:'Op wie ga jij stemmen bij de volgende verkiezingen?', example_en:'Who will you vote for in the next elections?', level:'B1' },
  // ===== UIT =====
  { id:'bestaan_uit', phrase:'bestaan uit', en:'to consist of', prep:'uit', example:'Het team bestaat uit tien leden.', example_en:'The team consists of ten members.', level:'B1' },
  { id:'voortkomen_uit', phrase:'voortkomen uit', en:'to result from', prep:'uit', example:'Veel problemen komen voort uit armoede.', example_en:'Many problems result from poverty.', level:'B1' },
  { id:'kiezen_uit', phrase:'kiezen uit', en:'to choose from', prep:'uit', example:'Je kunt kiezen uit drie opties.', example_en:'You can choose from three options.', level:'B1' },
  { id:'concluderen_uit', phrase:'concluderen uit', en:'to conclude from', prep:'uit', example:'Wat kun je concluderen uit deze gegevens?', example_en:'What can you conclude from this data?', level:'B1' },
  { id:'blijken_uit', phrase:'blijken uit', en:'to appear from', prep:'uit', example:'Uit onderzoek blijkt dat bewegen gezond is.', example_en:'Research shows that exercise is healthy.', level:'B1' },
  { id:'halen_uit', phrase:'halen uit', en:'to get from', prep:'uit', example:'Ik haal veel plezier uit mijn werk.', example_en:'I get a lot of pleasure from my work.', level:'B1' },
  // ===== TOT =====
  { id:'leiden_tot', phrase:'leiden tot', en:'to lead to', prep:'tot', example:'Roken kan leiden tot longkanker.', example_en:'Smoking can lead to lung cancer.', level:'B1' },
  { id:'behoren_tot', phrase:'behoren tot', en:'to belong to', prep:'tot', example:'Nederland behoort tot de Europese Unie.', example_en:'The Netherlands belongs to the EU.', level:'B1' },
  { id:'besluiten_tot', phrase:'besluiten tot', en:'to decide on', prep:'tot', example:'De regering besloot tot strengere maatregelen.', example_en:'The government decided on stricter measures.', level:'B1' },
  { id:'bijdragen_tot', phrase:'bijdragen tot', en:'to contribute to', prep:'tot', example:'Sport draagt bij tot een goede gezondheid.', example_en:'Sports contribute to good health.', level:'B1' },
  { id:'komen_tot', phrase:'komen tot', en:'to come to/reach', prep:'tot', example:'Ze kwamen tot een overeenkomst.', example_en:'They reached an agreement.', level:'B1' },
  { id:'dwingen_tot', phrase:'dwingen tot', en:'to force to', prep:'tot', example:'De situatie dwong hem tot actie.', example_en:'The situation forced him to take action.', level:'B1' },
  { id:'overgaan_tot', phrase:'overgaan tot', en:'to proceed to', prep:'tot', example:'De politie ging over tot arrestatie.', example_en:'The police proceeded to make an arrest.', level:'B1' },
  // ===== B2/C1 PREPOSITION VERBS =====
  // OP
  { id:'aansturen_op', phrase:'aansturen op', en:'to push for/aim at', prep:'op', example:'De directeur stuurt aan op meer samenwerking.', example_en:'The director is pushing for more collaboration.', level:'C1' },
  { id:'neerkijken_op', phrase:'neerkijken op', en:'to look down on', prep:'op', example:'Je moet niet neerkijken op anderen.', example_en:'You should not look down on others.', level:'C1' },
  { id:'terugvallen_op', phrase:'terugvallen op', en:'to fall back on', prep:'op', example:'In noodgevallen kun je terugvallen op je spaargeld.', example_en:'In emergencies you can fall back on your savings.', level:'C1' },
  { id:'toezien_op', phrase:'toezien op', en:'to oversee/supervise', prep:'op', example:'De manager ziet toe op de kwaliteit.', example_en:'The manager oversees the quality.', level:'C1' },
  { id:'zinspelen_op', phrase:'zinspelen op', en:'to allude to/hint at', prep:'op', example:'De minister zinspeelde op mogelijke bezuinigingen.', example_en:'The minister alluded to possible budget cuts.', level:'C1' },
  // VAN
  { id:'afstammen_van', phrase:'afstammen van', en:'to descend from', prep:'van', example:'Alle mensen stammen af van gemeenschappelijke voorouders.', example_en:'All humans descend from common ancestors.', level:'C1' },
  { id:'getuigen_van', phrase:'getuigen van', en:'to testify to/show', prep:'van', example:'Dat getuigt van moed.', example_en:'That shows courage.', level:'C1' },
  { id:'wemelen_van', phrase:'wemelen van', en:'to be swarming with', prep:'van', example:'Het plein wemelt van de toeristen.', example_en:'The square is swarming with tourists.', level:'C1' },
  { id:'afzien_van2', phrase:'abstraheren van', en:'to abstract from', prep:'van', example:'We moeten abstraheren van de details.', example_en:'We need to abstract from the details.', level:'C1' },
  // AAN
  { id:'toegeven_aan', phrase:'toegeven aan', en:'to give in to', prep:'aan', example:'Je moet niet toegeven aan druk.', example_en:'You should not give in to pressure.', level:'C1' },
  { id:'ontlenen_aan', phrase:'ontlenen aan', en:'to derive from', prep:'aan', example:'Dit woord is ontleend aan het Frans.', example_en:'This word is derived from French.', level:'C1' },
  { id:'blootstellen_aan', phrase:'blootstellen aan', en:'to expose to', prep:'aan', example:'Kinderen worden blootgesteld aan veel reclame.', example_en:'Children are exposed to a lot of advertising.', level:'C1' },
  { id:'onderwerpen_aan', phrase:'onderwerpen aan', en:'to subject to', prep:'aan', example:'Het plan werd onderworpen aan strenge controle.', example_en:'The plan was subjected to strict control.', level:'C1' },
  { id:'toeschrijven_aan', phrase:'toeschrijven aan', en:'to attribute to', prep:'aan', example:'Het succes wordt toegeschreven aan hard werken.', example_en:'The success is attributed to hard work.', level:'C1' },
  // MET
  { id:'worstelen_met', phrase:'worstelen met', en:'to struggle with', prep:'met', example:'Veel studenten worstelen met de grammatica.', example_en:'Many students struggle with grammar.', level:'C1' },
  { id:'kampen_met', phrase:'kampen met', en:'to deal with/struggle with', prep:'met', example:'De regio kampt met wateroverlast.', example_en:'The region is dealing with flooding.', level:'C1' },
  { id:'samenhangen_met', phrase:'samenhangen met', en:'to be connected to', prep:'met', example:'Armoede hangt samen met ongelijkheid.', example_en:'Poverty is connected to inequality.', level:'C1' },
  { id:'geconfronteerd_worden_met', phrase:'geconfronteerd worden met', en:'to be confronted with', prep:'met', example:'We worden dagelijks geconfronteerd met keuzes.', example_en:'We are confronted with choices daily.', level:'C1' },
  { id:'instemmen_met', phrase:'instemmen met', en:'to agree with/consent to', prep:'met', example:'De raad stemde in met het voorstel.', example_en:'The council agreed with the proposal.', level:'C1' },
  { id:'overeenkomen_met', phrase:'overeenkomen met', en:'to correspond with', prep:'met', example:'De resultaten komen overeen met onze verwachtingen.', example_en:'The results correspond with our expectations.', level:'C1' },
  // OVER
  { id:'beschikken_over2', phrase:'oordelen over', en:'to judge/assess', prep:'over', example:'Het is moeilijk om over anderen te oordelen.', example_en:'It is difficult to judge others.', level:'C1' },
  { id:'uitweiden_over', phrase:'uitweiden over', en:'to elaborate on', prep:'over', example:'De spreker weidde uit over de gevolgen.', example_en:'The speaker elaborated on the consequences.', level:'C1' },
  { id:'heersen_over', phrase:'heersen over', en:'to rule over', prep:'over', example:'De koning heerste over een groot rijk.', example_en:'The king ruled over a large empire.', level:'C1' },
  // VOOR
  { id:'opkomen_voor2', phrase:'instaan voor', en:'to vouch for/guarantee', prep:'voor', example:'Ik sta in voor de kwaliteit van dit product.', example_en:'I vouch for the quality of this product.', level:'C1' },
  { id:'zwichten_voor', phrase:'zwichten voor', en:'to yield to/succumb to', prep:'voor', example:'Ze zwichtte voor de druk van haar baas.', example_en:'She yielded to the pressure from her boss.', level:'C1' },
  { id:'terugdeinzen_voor', phrase:'terugdeinzen voor', en:'to shrink from/balk at', prep:'voor', example:'Hij deinst nergens voor terug.', example_en:'He does not shrink from anything.', level:'C1' },
  { id:'pleiten_voor', phrase:'pleiten voor', en:'to argue for/advocate for', prep:'voor', example:'De advocaat pleit voor vrijspraak.', example_en:'The lawyer argues for acquittal.', level:'C1' },
  // NAAR
  { id:'verwijzen_naar2', phrase:'handelen naar', en:'to act according to', prep:'naar', example:'Je moet handelen naar je geweten.', example_en:'You must act according to your conscience.', level:'C1' },
  { id:'hunkeren_naar', phrase:'hunkeren naar', en:'to crave/yearn for', prep:'naar', example:'Na maanden in het buitenland hunkerde ze naar huis.', example_en:'After months abroad she yearned for home.', level:'C1' },
  { id:'vernoemen_naar', phrase:'vernoemen naar', en:'to name after', prep:'naar', example:'Het plein is vernoemd naar een beroemde schrijver.', example_en:'The square is named after a famous writer.', level:'C1' },
  // IN
  { id:'slagen_in2', phrase:'uitmonden in', en:'to result in', prep:'in', example:'De discussie mondde uit in een ruzie.', example_en:'The discussion resulted in a fight.', level:'C1' },
  { id:'voorzien_in', phrase:'voorzien in', en:'to provide for', prep:'in', example:'De overheid moet voorzien in basisbehoeften.', example_en:'The government must provide for basic needs.', level:'C1' },
  { id:'opgaan_in', phrase:'opgaan in', en:'to be absorbed in', prep:'in', example:'Ze gaat helemaal op in haar werk.', example_en:'She is completely absorbed in her work.', level:'C1' },
  { id:'resulteren_in', phrase:'resulteren in', en:'to result in', prep:'in', example:'De storm resulteerde in veel schade.', example_en:'The storm resulted in a lot of damage.', level:'C1' },
  // TEGEN
  { id:'opwegen_tegen', phrase:'opwegen tegen', en:'to outweigh/offset', prep:'tegen', example:'De voordelen wegen op tegen de nadelen.', example_en:'The advantages outweigh the disadvantages.', level:'C1' },
  { id:'aanlopen_tegen', phrase:'aanlopen tegen', en:'to run into (problem)', prep:'tegen', example:'We liepen aan tegen onverwachte problemen.', example_en:'We ran into unexpected problems.', level:'C1' },
  { id:'ingaan_tegen', phrase:'ingaan tegen', en:'to go against', prep:'tegen', example:'Dit besluit gaat in tegen het advies van experts.', example_en:'This decision goes against the advice of experts.', level:'C1' },
  // OM
  { id:'draaien_om', phrase:'draaien om', en:'to revolve around', prep:'om', example:'De discussie draait om geld.', example_en:'The discussion revolves around money.', level:'C1' },
  { id:'verlegen_zijn_om', phrase:'verlegen zijn om', en:'to be in need of', prep:'om', example:'Het bedrijf zit verlegen om personeel.', example_en:'The company is in need of staff.', level:'C1' },
  // BIJ
  { id:'aansluiten_bij2', phrase:'stilstaan bij', en:'to reflect on', prep:'bij', example:'Laten we even stilstaan bij dit moment.', example_en:'Let us reflect on this moment.', level:'C1' },
  { id:'achterblijven_bij', phrase:'achterblijven bij', en:'to lag behind', prep:'bij', example:'Nederland blijft achter bij andere landen op dit gebied.', example_en:'The Netherlands lags behind other countries in this area.', level:'C1' },
];

const VERB_FLAVORS = {
  'eten': '"Every meal is a small negotiation with the self."',
  'lezen': '"The words rearrange themselves when you are not looking."',
  'schrijven': '"Your pen hesitates. The page does not."',
  'spreken': '"Words leave your mouth like birds from a cage."',
  'drinken': '"The coffee grows cold. Your resolve does not."',
  'komen': '"Arrival is just the beginning of departure."',
  'gaan': '"Every step away is a step toward something else."',
  'zijn': '"To be is the most irregular of all acts."',
  'hebben': '"Possession is nine-tenths of conjugation."',
  'doen': '"Action precedes understanding. Always."',
  'zien': '"You see, but do you observe?"',
  'denken': '"Thought spirals inward like a Dutch canal."',
  'slapen': '"In sleep, all verbs become regular."',
  'blijven': '"Staying requires more courage than leaving."',
  'vinden': '"What is found was never truly lost."',
  'worden': '"Becoming is the most Dutch of transformations."',
  'lopen': '"Amsterdam reveals itself only to those who walk."',
  'rijden': '"The bicycle knows the way. You merely steer."',
  'beginnen': '"Every beginning contains its own strange music."',
  'winnen': '"Victory tastes like stroopwafel and perseverance."',
};

function getVerbFlavor(v) {
  return VERB_FLAVORS[v.id] || `"The verb ${v.inf} waits patiently to be mastered."`;
}

const VERB_EMOJIS = {
  'eten':'&#127869;', 'lezen':'&#128214;', 'schrijven':'&#9997;', 'spreken':'&#128172;', 'drinken':'&#9749;',
  'komen':'&#128694;', 'gaan':'&#128694;', 'zijn':'&#9734;', 'hebben':'&#128142;', 'doen':'&#9889;',
  'zien':'&#128065;', 'denken':'&#129504;', 'slapen':'&#128164;', 'blijven':'&#127969;', 'vinden':'&#128269;',
  'worden':'&#10024;', 'lopen':'&#128694;', 'rijden':'&#128690;', 'beginnen':'&#127793;', 'winnen':'&#127942;',
  'zwemmen':'&#127946;', 'vliegen':'&#9992;', 'kopen':'&#128176;', 'werken':'&#128188;', 'wonen':'&#127968;',
  'leren':'&#127891;', 'reizen':'&#127758;', 'spelen':'&#127918;', 'luisteren':'&#127911;', 'helpen':'&#129309;',
};

function getVerbEmoji(v) {
  return VERB_EMOJIS[v.id] || '&#128220;';
}


// ==========================================
// TAB 1: THOUGHT CABINET (VERB ARENA)
// ==========================================
let currentVerb = null;
let arenaLocked = false;

function initArena() {
  const list = document.getElementById('patternList');
  list.innerHTML = '';
  const allTag = document.createElement('div');
  allTag.className = 'pattern-tag active';
  allTag.style.borderColor = '#000';
  allTag.style.color = '#000';
  allTag.textContent = 'Alle';
  allTag.onclick = () => { state.activePattern = null; document.querySelectorAll('.pattern-tag').forEach(t => t.classList.remove('active')); allTag.classList.add('active'); nextThought(); };
  list.appendChild(allTag);

  for (const [key, p] of Object.entries(VERB_PATTERNS)) {
    const tag = document.createElement('div');
    tag.className = 'pattern-tag';
    tag.style.borderColor = p.color;
    tag.style.color = p.color;
    tag.textContent = p.label + ' (' + p.example + ')';
    tag.onclick = () => {
      state.activePattern = key;
      document.querySelectorAll('.pattern-tag').forEach(t => t.classList.remove('active'));
      tag.classList.add('active');
      nextThought();
    };
    list.appendChild(tag);
  }

  document.querySelectorAll('.ctrl-btn[data-mode]').forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll('.ctrl-btn[data-mode]').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      state.arenaMode = btn.dataset.mode;
      nextThought();
    };
  });
  nextThought();
}

function getFilteredVerbs() {
  let pool = VERBS.filter(v => isWithinCEFR(v.level));
  if (state.activePattern) pool = pool.filter(v => v.pattern === state.activePattern);
  if (state.arenaMode === 'perfectum') pool = pool.filter(v => v.pp !== '-');
  return pool.length > 0 ? pool : VERBS;
}

function pickVerb() {
  const pool = getFilteredVerbs();
  const weighted = pool.map(v => {
    const h = state.verbHistory[v.id] || { correct: 0, wrong: 0 };
    return { verb: v, weight: Math.max(1, 5 - h.correct + h.wrong * 2) };
  });
  const total = weighted.reduce((s, w) => s + w.weight, 0);
  let r = Math.random() * total;
  for (const w of weighted) { r -= w.weight; if (r <= 0) return w.verb; }
  return weighted[weighted.length - 1].verb;
}

function nextThought() {
  arenaLocked = false;
  currentVerb = pickVerb();
  document.getElementById('monsterSprite').innerHTML = getVerbEmoji(currentVerb);
  document.getElementById('verbInfinitive').textContent = currentVerb.inf;
  document.getElementById('verbMeaning').textContent = currentVerb.en;
  document.getElementById('verbFlavor').textContent = getVerbFlavor(currentVerb);
  const p = VERB_PATTERNS[currentVerb.pattern];
  const badge = document.getElementById('patternBadge');
  badge.textContent = p.label;
  badge.style.borderColor = p.color;
  badge.style.color = p.color;
  generateQuestion();
}

function nextBattle() { nextThought(); }

let currentCorrectAnswer = '';

function generateQuestion() {
  const hintBubble = document.getElementById('hintBubble');
  if (hintBubble) hintBubble.classList.remove('show');
  const v = currentVerb;
  const mode = state.arenaMode === 'mixed' ? (Math.random() < 0.5 ? 'perfectum' : 'imperfectum') : state.arenaMode;
  let question, correct;
  if (mode === 'reverse') {
    const forms = [v.pp, v.imp_s, v.imp_p].filter(f => f && f !== '-');
    const givenForm = forms[Math.floor(Math.random() * forms.length)];
    question = '"' + givenForm + '" \u2014 wat is het infinitief?';
    correct = v.inf;
  } else if (mode === 'perfectum') {
    if (Math.random() < 0.6) {
      question = 'Wat is het voltooid deelwoord van "' + v.inf + '"?';
      correct = v.pp;
    } else {
      question = 'Welk hulpwerkwoord: "??? + ' + v.pp + '"?';
      correct = v.aux.split('/')[0];
    }
  } else {
    if (Math.random() < 0.5) {
      question = 'Imperfectum enkelvoud van "' + v.inf + '"?';
      correct = v.imp_s;
    } else {
      question = 'Imperfectum meervoud van "' + v.inf + '"?';
      correct = v.imp_p;
    }
  }
  currentCorrectAnswer = correct;
  document.getElementById('verbChallenge').textContent = question;
  // Reset input
  const input = document.getElementById('arenaInput');
  const submitBtn = document.getElementById('arenaSubmit');
  if (input) {
    input.value = '';
    input.disabled = false;
    input.className = 'answer-input';
    input.focus();
  }
  if (submitBtn) submitBtn.disabled = false;
}

function submitArenaAnswer() {
  if (arenaLocked) return;
  const input = document.getElementById('arenaInput');
  const chosen = input.value.trim().toLowerCase();
  if (!chosen) return;
  arenaLocked = true;
  const correct = currentCorrectAnswer;
  const isCorrect = chosen === correct.toLowerCase();
  input.disabled = true;
  document.getElementById('arenaSubmit').disabled = true;
  if (isCorrect) {
    input.classList.add('correct');
  } else {
    input.classList.add('wrong');
  }
  if (!state.verbHistory[currentVerb.id]) state.verbHistory[currentVerb.id] = { correct: 0, wrong: 0 };
  if (isCorrect) {
    state.streak++;
    if (state.streak > state.bestStreak) state.bestStreak = state.streak;
    state.verbHistory[currentVerb.id].correct++;
    addXP(12 + state.streak * 2);
    showFloatXP(12 + state.streak * 2);
    spawnParticles(input, ['\u2728', '\u2605']);
    if (state.verbHistory[currentVerb.id].correct >= 5) state.mastered.add(currentVerb.id);
    updateCombo();
    showArenaFeedback(true, correct);
  } else {
    state.streak = 0;
    state.verbHistory[currentVerb.id].wrong++;
    updateCombo();
    showArenaFeedback(false, correct);
  }
  updateStats(); saveState();
  setTimeout(nextThought, 2000);
}

// Arena Enter key support
document.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && document.getElementById('sub-arena')?.classList.contains('active')) {
    const input = document.getElementById('arenaInput');
    if (input && !input.disabled && document.activeElement === input) {
      submitArenaAnswer();
    }
  }
});

function updateMonsterHP() {}

function updateCombo() {
  const el = document.getElementById('comboDisplay');
  if (state.streak === 0) { el.innerHTML = ''; return; }
  if (state.streak >= 10) el.innerHTML = '<span class="combo-legendary">' + state.streak + 'x COMBO</span>';
  else if (state.streak >= 5) el.innerHTML = '<span class="combo-blaze">' + state.streak + 'x COMBO</span>';
  else if (state.streak >= 3) el.innerHTML = '<span class="combo-fire">' + state.streak + 'x combo</span>';
  else el.innerHTML = state.streak + 'x';
}

function showArenaFeedback(ok, answer) {
  const el = document.getElementById('feedbackText');
  const v = currentVerb;
  if (ok) {
    el.style.color = '#55efc4';
    el.innerHTML = 'Gedachte ge\u00EFnternaliseerd. <span style="color:var(--coral)">' + v.inf + '</span>: ' + v.imp_s + ' / ' + v.imp_p + ' / ' + v.pp + ' (' + v.aux + ')';
  } else {
    el.style.color = '#ff6b6b';
    el.innerHTML = 'De gedachte ontsnapt... Het was: <span style="color:var(--gold)">' + answer + '</span><br>' + v.inf + ': ' + v.imp_s + ' / ' + v.imp_p + ' / ' + v.pp;
  }
}

function showFloatXP(amount) {
  const scene = document.getElementById('battleScene');
  const xp = document.createElement('div');
  xp.className = 'xp-float';
  xp.textContent = '+' + amount + ' XP';
  xp.style.left = '50%'; xp.style.top = '30%';
  scene.appendChild(xp);
  setTimeout(() => xp.remove(), 1200);
}

function spawnParticles(el, emojis) {
  const rect = el.getBoundingClientRect();
  for (let i = 0; i < 3; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    p.style.left = (rect.left + Math.random() * rect.width) + 'px';
    p.style.top = (rect.top + Math.random() * rect.height) + 'px';
    document.body.appendChild(p);
    setTimeout(() => p.remove(), 1000);
  }
}


// ==========================================
// TAB 2: DE STAD — ADVENTURE SCENARIOS
// ==========================================
const ADVENTURES = [
  {
    title: 'Op de Markt',
    icon: '\uD83C\uDFEA',
    scenes: [
      {
        icon: '\uD83E\uDD55', location: 'Albert Cuyp Markt', sub: 'Zaterdagochtend, 10:00',
        narrative: 'De Albert Cuyp bruist van leven. Kramen met verse groenten, Surinaamse broodjes en tweedehands kleding strekken zich uit over honderden meters. Je hebt een lijstje: tomaten, kaas en brood. Bij de eerste kraam staat een vriendelijke verkoper.',
        dialogue: { speaker: 'Verkoper', text: 'Goedemorgen! Kan ik u helpen?' },
        choices: [
          { dutch: 'Ja, ik zou graag een kilo tomaten willen.', hint: 'Beleefd verzoek met "zou...willen"', correct: true, next: 1, response: 'De verkoper knikt goedkeurend. "Natuurlijk! Kijk eens, deze zijn van de Betuwe. Heel lekker!"' },
          { dutch: 'Ja, ik wil tomaten geven.', hint: '"geven" = to give', correct: false, next: 1, response: 'De verkoper kijkt verbaasd. "U wilt mij tomaten geven? Dat is aardig, maar ik heb er genoeg!" Je beseft je fout en lacht mee.' },
          { dutch: 'Ja, ik heb tomaten gegaan.', hint: '"gegaan" = gone', correct: false, next: 1, response: 'De verkoper trekt een wenkbrauw op. "U bent naar tomaten gegaan? Dat klinkt als een avontuur!" De mensen achter je grinniken.' },
        ]
      },
      {
        icon: '\uD83E\uDDC0', location: 'Kaaskraam', sub: 'Even later',
        narrative: 'Met een zak tomaten loop je door naar de kaaskraam. De geur van belegen kaas hangt in de lucht. Er staan kleine blokjes om te proeven.',
        dialogue: { speaker: 'Kaasboer', text: 'Proef gerust! Welke kaas zoekt u?' },
        choices: [
          { dutch: 'Ik zoek een stuk belegen kaas, omdat ik vanavond ga koken.', hint: 'Bijzin met "omdat" + werkwoord aan het eind', correct: true, next: 2, response: '"Uitstekende keuze! Belegen kaas smelt het beste. Hoeveel gram mag het zijn?"' },
          { dutch: 'Ik zoek kaas, omdat ik kook vanavond ga.', hint: 'Verkeerde woordvolgorde in bijzin', correct: false, next: 2, response: 'De kaasboer begrijpt je wel, maar corrigeert vriendelijk: "U bedoelt: omdat u vanavond ga koken? Geen probleem!"' },
          { dutch: 'Ik heb kaas gezocht gisteren.', hint: 'Verleden tijd, niet relevant', correct: false, next: 2, response: '"Oh, heeft u gisteren al gezocht? En vandaag zoekt u weer? U bent een echte kaasliefhebber!" Niet helemaal het juiste antwoord.' },
        ]
      },
      {
        icon: '\uD83C\uDF5E', location: 'Broodkraam', sub: 'De laatste stop',
        narrative: 'Je hebt tomaten en kaas. Nu nog brood. Bij de bakker ruikt het heerlijk naar versgebakken brood. Er is een rij, maar het gaat snel.',
        dialogue: { speaker: 'Bakker', text: 'Zeg het maar!' },
        choices: [
          { dutch: 'Twee volkoren broodjes alstublieft. Hoeveel kost dat?', hint: 'Correct bestellen + prijs vragen', correct: true, next: 3, response: '"Twee vijftig alstublieft." Je betaalt en stopt het warme brood in je tas. Een geslaagde marktdag!' },
          { dutch: 'Ik wil broodjes als het u belieft. Wat heeft het gekost?', hint: '"heeft gekost" = verleden tijd, maar je koopt nu', correct: false, next: 3, response: '"Het heeft nog niks gekost, want u moet nog betalen!" zegt de bakker lachend. "Twee vijftig graag."' },
        ]
      },
      {
        icon: '\u2615', location: 'Terras om de hoek', sub: 'Na het boodschappen doen',
        narrative: 'Met je volle tas ga je op een terras zitten. De zon schijnt. Je hebt boodschappen gedaan, Nederlands gesproken, en niemand is overgeschakeld naar Engels. Een kleine overwinning.',
        dialogue: null,
        choices: [
          { dutch: 'Ik heb een goede dag gehad op de markt.', hint: 'Perfectum met "hebben"', correct: true, next: -1, response: 'Je glimlacht. Het is een mooie dag in Amsterdam. Je Nederlands wordt steeds beter.' },
        ]
      },
    ]
  },
  {
    title: 'Het Sollicitatiegesprek',
    icon: '\uD83D\uDCBC',
    scenes: [
      {
        icon: '\uD83C\uDFE2', location: 'Kantoor aan de Herengracht', sub: 'Maandagochtend, 09:00',
        narrative: 'Je staat voor een grachtenpand met een glanzende deur. Vandaag is je sollicitatiegesprek bij een Nederlands bedrijf. Je hebt je goed voorbereid. Een receptionist begroet je in de hal.',
        dialogue: { speaker: 'Receptionist', text: 'Goedemorgen, u heeft een afspraak?' },
        choices: [
          { dutch: 'Ja, ik heb een afspraak om negen uur met mevrouw De Vries.', hint: 'Correcte zinsstructuur', correct: true, next: 1, response: '"Ah ja, ze verwacht u. Neemt u plaats, ze komt er zo aan." Je gaat zitten en haalt diep adem.' },
          { dutch: 'Ja, ik ben een afspraak om negen uur gehad.', hint: '"ben gehad" = onjuist hulpwerkwoord', correct: false, next: 1, response: 'De receptionist aarzelt even. "U bedoelt: u h\u00e9bt een afspraak? Geen probleem. Neemt u plaats." Een zenuwachtig begin.' },
        ]
      },
      {
        icon: '\uD83D\uDC69\u200D\uD83D\uDCBC', location: 'Vergaderruimte', sub: 'Het gesprek begint',
        narrative: 'Mevrouw De Vries komt binnen. Ze geeft je een stevige handdruk en gaat zitten. "Vertel eens, waarom wilt u bij ons werken?"',
        dialogue: null,
        choices: [
          { dutch: 'Ik heb veel ervaring opgedaan bij mijn vorige werkgever, en ik denk dat ik hier veel kan bijdragen.', hint: 'Perfectum + modaal werkwoord', correct: true, next: 2, response: 'Mevrouw De Vries knikt waarderend. "Dat klinkt goed. Kunt u een voorbeeld geven?"' },
          { dutch: 'Ik wil hier werken omdat het salaris goed is.', hint: 'Grammaticaal correct, maar te direct', correct: false, next: 2, response: 'Mevrouw De Vries trekt een wenkbrauw op. "Eerlijkheid is goed, maar... kunt u ook iets over uw vaardigheden vertellen?"' },
          { dutch: 'Ik heb bij mijn vorige werkgever gewerkt en ik wil nu iets nieuws proberen.', hint: 'Correct maar weinig ambitieus', correct: false, next: 2, response: '"Iets nieuws proberen is mooi, maar wat trekt u specifiek aan bij ons bedrijf?" Ze wil meer weten.' },
        ]
      },
      {
        icon: '\uD83E\uDD1D', location: 'Vergaderruimte', sub: 'De afsluiting',
        narrative: 'Het gesprek is bijna afgelopen. Mevrouw De Vries vraagt of je nog vragen hebt.',
        dialogue: null,
        choices: [
          { dutch: 'Zou u mij kunnen vertellen hoe de werksfeer hier is?', hint: '"Zou u kunnen" = beleefde vraag', correct: true, next: 3, response: '"Natuurlijk! We hebben een informele sfeer. We tutoyeren elkaar en lunchen samen." Ze lijkt onder de indruk van je Nederlands.' },
          { dutch: 'Hoeveel vakantiedagen krijg ik?', hint: 'Grammaticaal correct maar te direct voor eerste vraag', correct: false, next: 3, response: 'Ze glimlacht beleefd. "25 dagen. Maar heeft u misschien ook vragen over het werk zelf?" Het Nederlandse directe, maar je ging n\u00f3g directer.' },
        ]
      },
      {
        icon: '\uD83C\uDF89', location: 'Buiten op de gracht', sub: 'Na het gesprek',
        narrative: 'Je loopt langs de gracht. De bomen spiegelen in het water. Het gesprek ging goed. Je hebt jezelf in het Nederlands voorgesteld, vragen beantwoord, en zelfs een grap gemaakt. Wat er ook gebeurt, je hebt vandaag iets bereikt.',
        dialogue: null,
        choices: [
          { dutch: 'Hoewel ik zenuwachtig was, heb ik mijn best gedaan.', hint: 'Onderschikkend voegwoord + perfectum', correct: true, next: -1, response: 'Een gevoel van trots. Je Nederlands is goed genoeg voor een sollicitatiegesprek. Dat is een mijlpaal.' },
        ]
      },
    ]
  },
  {
    title: 'Bij de Huisarts',
    icon: '\uD83C\uDFE5',
    scenes: [
      {
        icon: '\uD83E\uDE7A', location: 'Wachtkamer', sub: 'Dinsdagmiddag, 14:00',
        narrative: 'Je voelt je al een paar dagen niet lekker. Hoofdpijn, vermoeidheid, en een beetje keelpijn. Je zit in de wachtkamer van de huisarts. Er hangt een poster over de griepprik aan de muur.',
        dialogue: { speaker: 'Assistente', text: 'De dokter kan u nu ontvangen. Komt u maar mee.' },
        choices: [
          { dutch: 'Dank u wel. Ik kom eraan.', hint: 'Beleefde reactie', correct: true, next: 1, response: 'Je volgt de assistente naar de spreekkamer. De huisarts zit achter zijn bureau en glimlacht.' },
          { dutch: 'Ik ben al hier gekomen.', hint: '"al gekomen" = je bent al gearriveerd, geen antwoord op uitnodiging', correct: false, next: 1, response: 'De assistente kijkt even verward. "Ja, u bent er... wilt u meekomen?" Je loopt snel achter haar aan.' },
        ]
      },
      {
        icon: '\uD83D\uDC68\u200D\u2695\uFE0F', location: 'Spreekkamer', sub: 'Het consult',
        narrative: 'De huisarts heet je welkom. "Vertel eens, waar heeft u last van?"',
        dialogue: null,
        choices: [
          { dutch: 'Ik heb al drie dagen hoofdpijn en ik voel me erg moe. Bovendien doet mijn keel pijn.', hint: '"Bovendien" = verbindingswoord B2', correct: true, next: 2, response: '"Laat me even kijken." De huisarts pakt een lampje en bekijkt je keel. "Het ziet er een beetje rood uit."' },
          { dutch: 'Mijn hoofd heeft pijn sinds drie dagen.', hint: '"Mijn hoofd heeft pijn" = ongebruikelijk', correct: false, next: 2, response: '"U bedoelt: u h\u00e9bt hoofdpijn? Dat is goed om te weten. Laat me even kijken." De dokter is gewend aan niet-moedertaalsprekers.' },
          { dutch: 'Ik was ziek geweest voor drie dagen.', hint: 'Voltooid verleden tijd niet nodig hier', correct: false, next: 2, response: '"U b\u00e9nt ziek, bedoelt u? Of was u al ziek en bent u nu beter?" Een beetje verwarrend, maar de dokter begrijpt het.' },
        ]
      },
      {
        icon: '\uD83D\uDC8A', location: 'Spreekkamer', sub: 'Het advies',
        narrative: 'Na het onderzoek leunt de huisarts achterover. "Het lijkt op een gewone verkoudheid. Ik schrijf geen antibiotica voor, want dat helpt niet bij een virus."',
        dialogue: { speaker: 'Huisarts', text: 'Heeft u nog vragen over het advies?' },
        choices: [
          { dutch: 'Moet ik thuisblijven, of kan ik gewoon naar mijn werk gaan?', hint: 'Modale werkwoorden + "of"', correct: true, next: 3, response: '"Als u zich niet te ziek voelt, kunt u gewoon gaan. Maar rust is belangrijk. Drink veel water en slaap genoeg."' },
          { dutch: 'Wanneer ben ik beter geworden?', hint: '"geworden" = al gebeurd, maar je vraagt naar de toekomst', correct: false, next: 3, response: '"U bedoelt: wanneer w\u00f3rd ik beter? Dat duurt meestal een week. Geduld is belangrijk!"' },
        ]
      },
      {
        icon: '\uD83C\uDF3F', location: 'Apotheek', sub: 'Even later',
        narrative: 'Je loopt naar de apotheek om paracetamol te halen. De apotheker geeft je het doosje en zegt: "Beterschap!" Je knikt dankbaar. Het was je eerste bezoek aan een Nederlandse huisarts, en het ging prima.',
        dialogue: null,
        choices: [
          { dutch: 'Bedankt! Ik hoop dat ik snel beter word.', hint: '"hopen dat" + bijzin', correct: true, next: -1, response: 'De apotheker glimlacht. "Dat komt goed!" Je loopt naar buiten, een klein beetje trotser op je Nederlands.' },
        ]
      },
    ]
  },
  {
    title: 'Op het Station',
    icon: '\uD83D\uDE82',
    scenes: [
      {
        icon: '\uD83D\uDEE4\uFE0F', location: 'Amsterdam Centraal', sub: 'Vrijdagmiddag, 16:30',
        narrative: 'Het is druk op Amsterdam Centraal. Je moet naar Utrecht voor een verjaardag, maar het bord toont vertragingen. Oranje waarschuwingen flikkeren naast je treinnummer.',
        dialogue: { speaker: 'Omroep', text: 'Let op: de intercity naar Utrecht vertrekt vandaag van spoor 11b in plaats van spoor 8.' },
        choices: [
          { dutch: 'Ik moet naar spoor 11b, want de trein vertrekt niet meer van spoor 8.', hint: '"want" = nevenschikkend voegwoord', correct: true, next: 1, response: 'Je haast je naar spoor 11b. De trein staat er al, maar de deuren zijn nog open.' },
          { dutch: 'De trein heeft vertrokken van spoor 8.', hint: '"heeft vertrokken" = onjuist hulpwerkwoord (is vertrokken)', correct: false, next: 1, response: 'Een medereiziger corrigeert je: "De trein \u00eds vertrokken, met zijn. Maar maak je geen zorgen, de volgende staat op 11b."' },
        ]
      },
      {
        icon: '\uD83D\uDE86', location: 'In de trein', sub: 'Op weg naar Utrecht',
        narrative: 'Je vindt een plekje bij het raam. Naast je zit een oudere vrouw die een boek leest. De trein begint te rijden.',
        dialogue: { speaker: 'Conducteur', text: 'Mag ik uw vervoerbewijs zien?' },
        choices: [
          { dutch: 'Natuurlijk, hier is mijn OV-chipkaart. Ik reis naar Utrecht.', hint: 'Correcte reactie', correct: true, next: 2, response: 'De conducteur scant je kaart. "In orde. Goede reis!" Hij loopt door naar de volgende passagier.' },
          { dutch: 'Ik heb geen kaartje gekocht, maar ik zal betalen.', hint: 'Grammaticaal correct, maar je hebt wel een kaart!', correct: false, next: 2, response: '"U heeft geen kaartje? Dan moet ik u helaas..." Je onderbreekt snel: "Sorry, ik bedoel, hier is mijn OV-chipkaart!" Dat was spannend.' },
        ]
      },
      {
        icon: '\uD83C\uDF06', location: 'Utrecht Centraal', sub: 'Aankomst',
        narrative: 'De trein stopt in Utrecht. Je stapt uit en kijkt om je heen. De Domtoren is zichtbaar boven de daken. Je vriendin zou je ophalen, maar je ziet haar niet.',
        dialogue: null,
        choices: [
          { dutch: 'Ik bel haar even om te vragen waar ze is.', hint: '"om te" + infinitief = doel', correct: true, next: 3, response: 'Je pakt je telefoon. Ze neemt meteen op: "Ik sta bij de uitgang aan de stadskant! Loop maar naar buiten."' },
          { dutch: 'Ik zal haar bellen voor vragend waar is ze.', hint: 'Onjuiste constructie', correct: false, next: 3, response: 'Je probeert te bellen maar je formulering in je hoofd klopt niet helemaal. Gelukkig stuurt ze een berichtje: "Ik sta buiten!"' },
        ]
      },
      {
        icon: '\uD83C\uDF82', location: 'Huis van je vriendin', sub: 'De verjaardag',
        narrative: 'Je vriendin omhelst je bij de deur. Binnen zitten tien mensen in een kring. Iedereen feliciteert iedereen. Je krijgt een stuk appeltaart en koffie. Dit is de echte Nederlandse verjaardagservaring.',
        dialogue: null,
        choices: [
          { dutch: 'Gefeliciteerd! Wat fijn dat ik kon komen.', hint: '"kon" = imperfectum van kunnen', correct: true, next: -1, response: '"Wat leuk dat je er bent!" zegt je vriendin. Je zit in de kring, eet taart, en praat Nederlands. Dit is integratie.' },
        ]
      },
    ]
  },
  {
    title: 'Het Caf\u00e9 Date',
    icon: '\u2615',
    scenes: [
      {
        icon: '\u2615', location: 'Caf\u00e9 De Tuin, De Pijp', sub: 'Zaterdagmiddag, 15:00',
        narrative: 'Je hebt via een app een date. Jullie hebben afgesproken in een gezellig caf\u00e9 in De Pijp. Je bent er als eerste en bestelt een koffie. Na vijf minuten komt je date binnen.',
        dialogue: { speaker: 'Je date', text: 'Hoi! Sorry dat ik een beetje laat ben. De tram had vertraging.' },
        choices: [
          { dutch: 'Geen probleem! Ik zit hier pas vijf minuten. Wil je iets drinken?', hint: 'Informeel, vriendelijk, correct', correct: true, next: 1, response: '"Graag! Een cappuccino alsjeblieft." Jullie gaan zitten bij het raam. Een goed begin.' },
          { dutch: 'Je bent te laat geweest. Ik heb lang gewacht.', hint: 'Grammaticaal correct maar te streng voor een eerste date', correct: false, next: 1, response: 'Je date kijkt geschrokken. "Oh... het spijt me echt." Misschien iets te direct. Je herstelt snel: "Grapje! Ga zitten!"' },
        ]
      },
      {
        icon: '\uD83D\uDCAC', location: 'Aan het tafeltje', sub: 'Het gesprek',
        narrative: 'De koffie is heerlijk. Je date vraagt waar je vandaan komt en wat je in Nederland doet.',
        dialogue: { speaker: 'Je date', text: 'Hoe lang woon je al in Nederland? Je Nederlands is echt goed!' },
        choices: [
          { dutch: 'Dank je! Ik woon hier sinds vorig jaar. Ik ben verhuisd omdat ik een baan heb gevonden.', hint: '"sinds" + "omdat" + perfectum', correct: true, next: 2, response: '"Wat gaaf! En je spreekt al zo goed Nederlands. Dat is echt knap." Het gesprek loopt lekker.' },
          { dutch: 'Ik heb hier gewoond voor een jaar. Ik kwam voor een baan.', hint: '"heb gewoond" impliceert dat je er niet meer woont', correct: false, next: 2, response: '"Oh, woon je hier niet meer dan?" Je corrigeert: "Nee, ik woon hier nog steeds!" Een veelgemaakte fout.' },
        ]
      },
      {
        icon: '\uD83C\uDF1F', location: 'Caf\u00e9 De Tuin', sub: 'Later die middag',
        narrative: 'Het gesprek vloeit makkelijk. Jullie praten over reizen, eten, en Nederlandse gewoontes. Je date lacht om je verhalen over de Albert Heijn en de hagelslag.',
        dialogue: { speaker: 'Je date', text: 'Zullen we een keer samen ergens gaan eten?' },
        choices: [
          { dutch: 'Dat lijkt me heel leuk! Ken je een goed restaurant in de buurt?', hint: 'Enthousiast + tegenvraag', correct: true, next: 3, response: '"Er is een Indonesisch restaurant om de hoek dat heel goed is. Volgende week?" Je glimlacht. Dit gaat goed.' },
          { dutch: 'Ja, als jij betaalt.', hint: 'Grammaticaal correct maar... te direct', correct: false, next: 3, response: 'Je date lacht ongemakkelijk. "Eh... we kunnen wel splitsen?" Je realiseert dat Nederlandse directheid grenzen heeft.' },
        ]
      },
      {
        icon: '\uD83C\uDF06', location: 'Buiten het caf\u00e9', sub: 'Afscheid',
        narrative: 'Jullie staan buiten. De zon gaat onder achter de gevels. Het was een fijne middag.',
        dialogue: null,
        choices: [
          { dutch: 'Ik heb een hele leuke middag gehad. Tot volgende week!', hint: 'Perfectum + afscheid', correct: true, next: -1, response: '"Ik ook!" Je date zwaait en fietst weg. Je loopt naar huis met een glimlach. Nederlands spreken op een date \u2014 check!' },
        ]
      },
    ]
  },
  {
    title: 'De Burenruzie',
    icon: '\uD83C\uDFE0',
    scenes: [
      {
        icon: '\uD83D\uDD0A', location: 'Je appartement', sub: 'Woensdagavond, 22:30',
        narrative: 'Het is halfelf \u2019s avonds en je buurman speelt weer keiharde muziek. Dit is de derde keer deze week. Je muren trillen van de bas. Je moet morgen vroeg op voor je werk.',
        dialogue: null,
        choices: [
          { dutch: 'Ik ga naar mijn buurman toe om te vragen of hij de muziek zachter kan zetten.', hint: '"om te vragen of" + bijzin', correct: true, next: 1, response: 'Je trekt je schoenen aan en loopt naar de deur van je buurman. Je klopt aan. De muziek stopt even.' },
          { dutch: 'Ik ga de politie bellen want hij maakt te veel lawaai.', hint: 'Grammaticaal correct maar misschien een beetje snel', correct: false, next: 1, response: 'Je pakt je telefoon, maar bedenkt je dan. Misschien is het beter om eerst zelf te praten. Je loopt naar zijn deur.' },
        ]
      },
      {
        icon: '\uD83D\uDEAA', location: 'Bij de deur van je buurman', sub: 'Het gesprek',
        narrative: 'Je buurman doet open. Hij draagt een koptelefoon om zijn nek en kijkt verrast.',
        dialogue: { speaker: 'Buurman', text: 'Oh hoi! Is er iets?' },
        choices: [
          { dutch: 'Hoi. Het spijt me dat ik stoor, maar zou je de muziek wat zachter kunnen zetten? Ik moet morgen vroeg op.', hint: '"zou je kunnen" = beleefde vraag', correct: true, next: 2, response: '"Oh sorry man, ik had niet door dat het zo hard stond! Ik zet het meteen zachter." Hij lijkt oprecht verontschuldigend.' },
          { dutch: 'Je muziek is te hard! Je moet stoppen!', hint: 'Direct en onbeleefd', correct: false, next: 2, response: 'Je buurman kijkt ge\u00efrriteerd. "Rustig aan! Het is pas halfelf." Niet de beste aanpak.' },
          { dutch: 'Hoewel ik normaal geen problemen heb met muziek, is het vanavond echt te luid.', hint: '"hoewel" + nuance', correct: true, next: 2, response: '"Oh, dat spijt me. Ik was aan het oefenen voor een optreden. Ik stop voor vanavond!" Een diplomatiek succes.' },
        ]
      },
      {
        icon: '\uD83E\uDD1D', location: 'Op de gang', sub: 'De oplossing',
        narrative: 'Je buurman stelt voor om in de toekomst een afspraak te maken over wanneer hij kan oefenen. Dat klinkt redelijk.',
        dialogue: { speaker: 'Buurman', text: 'Misschien kunnen we afspreken dat ik voor negen uur stop op doordeweekse dagen?' },
        choices: [
          { dutch: 'Dat vind ik een goed voorstel. Zolang we er allebei mee akkoord gaan, is het prima.', hint: '"zolang" + compromis', correct: true, next: 3, response: '"Top! En als er ooit iets is, klop gewoon aan. We zijn tenslotte buren." Jullie schudden de hand.' },
          { dutch: 'Ja, maar als je toch te hard speelt, bel ik de verhuurder.', hint: 'Grammaticaal correct maar dreigend', correct: false, next: 3, response: 'Je buurman zucht. "Ik beloof dat ik me aan de afspraak houd. Geen zorgen." Het conflict is opgelost, maar de sfeer is wat koel.' },
        ]
      },
      {
        icon: '\uD83C\uDF19', location: 'Je appartement', sub: 'Stilte',
        narrative: 'Het is stil. Heerlijk stil. Je kruipt in bed en denkt na over het gesprek. Je hebt een conflict opgelost in het Nederlands. Geen schreeuwen, geen politie, gewoon een goed gesprek tussen buren.',
        dialogue: null,
        choices: [
          { dutch: 'Desondanks was het een leerzame ervaring.', hint: '"desondanks" = B2 verbindingswoord', correct: true, next: -1, response: 'Morgen ga je je buurman groeten op de gang. Zo werkt dat in Nederland. Je slaapt met een glimlach in.' },
        ]
      },
    ]
  },
];

let currentAdventure = 0;
let currentAdvScene = 0;
let advVisited = new Set();

function initAdventure() {
  const bar = document.getElementById('scenarioBar');
  bar.innerHTML = '';
  ADVENTURES.forEach((adv, i) => {
    const btn = document.createElement('button');
    btn.className = 'scenario-btn' + (i === 0 ? ' active' : '');
    btn.textContent = adv.icon + ' ' + adv.title;
    btn.onclick = () => {
      document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentAdventure = i;
      currentAdvScene = 0;
      advVisited = new Set();
      loadAdvScene(0);
    };
    bar.appendChild(btn);
  });
  currentAdvScene = 0;
  advVisited = new Set();
  loadAdvScene(0);
}

function loadAdvScene(idx) {
  currentAdvScene = idx;
  advVisited.add(idx);
  const adv = ADVENTURES[currentAdventure];
  const scene = adv.scenes[idx];

  // Progress dots
  const prog = document.getElementById('adventureProgress');
  prog.innerHTML = '';
  adv.scenes.forEach((_, i) => {
    const dot = document.createElement('div');
    dot.className = 'adv-dot' + (advVisited.has(i) ? ' visited' : '') + (i === idx ? ' current' : '');
    prog.appendChild(dot);
  });

  // Build scene card
  const container = document.getElementById('adventureScene');
  let html = '<div class="adventure-card">';
  html += '<div class="scene-icon">' + scene.icon + '</div>';
  html += '<div class="scene-location">' + scene.location + '</div>';
  html += '<div class="scene-sublocation">' + scene.sub + '</div>';
  html += '<div class="narrative">' + scene.narrative + '</div>';

  if (scene.dialogue) {
    html += '<div class="dialogue"><span class="speaker">' + scene.dialogue.speaker + ':</span> "' + scene.dialogue.text + '"</div>';
  }

  html += '<div class="choice-grid" id="advChoices">';
  scene.choices.forEach((c, ci) => {
    html += '<button class="choice-card" data-idx="' + ci + '" onclick="handleAdvChoice(' + ci + ')">';
    html += '<span class="choice-dutch">' + c.dutch + '</span>';
    html += '<span class="choice-hint">' + c.hint + '</span>';
    html += '</button>';
  });
  html += '</div></div>';

  container.innerHTML = html;
  document.getElementById('adventureFeedback').innerHTML = '';
}

function handleAdvChoice(idx) {
  const adv = ADVENTURES[currentAdventure];
  const scene = adv.scenes[currentAdvScene];
  const choice = scene.choices[idx];
  const cards = document.querySelectorAll('#advChoices .choice-card');

  cards.forEach((c, i) => {
    c.disabled = true;
    c.setAttribute('disabled', 'true');
    if (i === idx) c.classList.add(choice.correct ? 'correct' : 'wrong');
    // Show the correct one
    if (scene.choices[i].correct && !choice.correct) c.classList.add('correct');
  });

  const fb = document.getElementById('adventureFeedback');
  if (choice.correct) {
    fb.style.color = '#1a7a42';
    addXP(15);
    spawnParticles(cards[idx], ['\u2728']);
  } else {
    fb.style.color = '#c0392b';
    addXP(5); // some XP for trying
  }
  fb.innerHTML = '<div style="background:' + (choice.correct ? 'rgba(45,138,86,0.08)' : 'rgba(192,57,43,0.08)') + ';border:2px solid ' + (choice.correct ? '#2d8a56' : '#c0392b') + ';padding:14px 18px;font-size:14px;line-height:1.7;color:#333;text-align:left;"><em>' + choice.response + '</em></div>';
  updateStats(); saveState();

  // Next scene — click to continue
  const nextIdx = choice.next;
  if (nextIdx >= 0) {
    fb.innerHTML += '<button class="scenario-btn" onclick="loadAdvScene(' + nextIdx + ')" style="margin-top:12px;display:block;margin-left:auto;margin-right:auto;">Volgende &#8594;</button>';
  } else {
    fb.innerHTML += '<br><button class="scenario-btn" onclick="initAdventure()" style="margin-top:8px">Kies een nieuw avontuur</button>';
    addXP(25);
  }
}


// TAB 4: NEWS READER (LEESHOEK)
// ==========================================
const NEWS_ARTICLES = [
  {
    title: 'Fietsen in Nederland: meer dan vervoer',
    level: 'B1',
    text: 'Nederland is bekend om zijn fietscultuur. Elke dag <span class="vocab-word">fietsen<span class="vocab-tooltip">to cycle</span></span> miljoenen Nederlanders naar hun werk, school of de supermarkt. Er zijn meer dan 35.000 kilometer aan fietspaden in het land.\n\nDe fiets is niet alleen een <span class="vocab-word">vervoermiddel<span class="vocab-tooltip">means of transport</span></span>, maar ook een <span class="vocab-word">onderdeel<span class="vocab-tooltip">part / component</span></span> van de Nederlandse <span class="vocab-word">identiteit<span class="vocab-tooltip">identity</span></span>. Kinderen leren al op jonge leeftijd fietsen, en veel ouderen fietsen tot op hoge leeftijd.\n\nDe <span class="vocab-word">overheid<span class="vocab-tooltip">government</span></span> <span class="vocab-word">investeert<span class="vocab-tooltip">invests</span></span> veel geld in de <span class="vocab-word">infrastructuur<span class="vocab-tooltip">infrastructure</span></span> voor fietsers. Er komen steeds meer <span class="vocab-word">snelfietspaden<span class="vocab-tooltip">fast cycling paths</span></span> tussen grote steden. <span class="vocab-word">Bovendien<span class="vocab-tooltip">moreover</span></span> zijn er overal gratis <span class="vocab-word">fietsenstallingen<span class="vocab-tooltip">bicycle parking facilities</span></span>.\n\n<span class="vocab-word">Hoewel<span class="vocab-tooltip">although</span></span> het weer in Nederland niet altijd <span class="vocab-word">meewerkt<span class="vocab-tooltip">cooperates</span></span>, blijven de meeste mensen gewoon fietsen.',
    vocab: [['fietscultuur','cycling culture'],['vervoermiddel','means of transport'],['onderdeel','part/component'],['overheid','government'],['investeert','invests'],['snelfietspaden','fast cycling paths'],['bovendien','moreover'],['hoewel','although'],['meewerkt','cooperates'],['fietsenstallingen','bicycle parking']],
    questions: [
      { q: 'Hoeveel kilometer fietspaden heeft Nederland?', options: ['25.000 km','35.000 km','50.000 km','15.000 km'], answer: 1 },
      { q: 'Wat investeert de overheid in?', options: ['Meer auto\'s','Infrastructuur voor fietsers','Nieuwe treinen','Vliegvelden'], answer: 1 },
      { q: 'Wat betekent "hoewel" in het Engels?', options: ['because','therefore','although','while'], answer: 2 },
      { q: 'Waarom is de fiets belangrijk in Nederland?', options: ['Het is goedkoop','Het is onderdeel van de identiteit','Er zijn geen auto\'s','Het is verplicht'], answer: 1 },
    ]
  },
  {
    title: 'De Nederlandse keuken: meer dan kaas',
    level: 'B1',
    text: 'Veel mensen <span class="vocab-word">denken<span class="vocab-tooltip">think</span></span> dat de Nederlandse keuken <span class="vocab-word">saai<span class="vocab-tooltip">boring</span></span> is, maar dat is niet <span class="vocab-word">helemaal<span class="vocab-tooltip">completely</span></span> waar. De traditionele Nederlandse keuken is <span class="vocab-word">eenvoudig<span class="vocab-tooltip">simple</span></span> maar <span class="vocab-word">smakelijk<span class="vocab-tooltip">tasty</span></span>.\n\nEen typisch Nederlands <span class="vocab-word">gerecht<span class="vocab-tooltip">dish</span></span> is <span class="vocab-word">stamppot<span class="vocab-tooltip">mashed pot (potatoes with vegetables)</span></span>: aardappelen gestampt met groenten zoals boerenkool of zuurkool.\n\n<span class="vocab-word">Tegenwoordig<span class="vocab-tooltip">nowadays</span></span> is de Nederlandse keuken <span class="vocab-word">veranderd<span class="vocab-tooltip">changed</span></span> door <span class="vocab-word">invloeden<span class="vocab-tooltip">influences</span></span> uit de hele wereld. <span class="vocab-word">Dankzij<span class="vocab-tooltip">thanks to</span></span> de <span class="vocab-word">koloniale<span class="vocab-tooltip">colonial</span></span> geschiedenis zijn Indonesische gerechten zoals nasi goreng heel normaal in Nederland.',
    vocab: [['saai','boring'],['eenvoudig','simple'],['smakelijk','tasty'],['gerecht','dish'],['stamppot','mashed pot'],['tegenwoordig','nowadays'],['veranderd','changed'],['invloeden','influences'],['dankzij','thanks to'],['proeven','to taste']],
    questions: [
      { q: 'Wat is stamppot?', options: ['Een soort soep','Aardappelen met groenten','Een koekje','Een kaassoort'], answer: 1 },
      { q: 'Welke buitenlandse keuken is heel normaal in Nederland?', options: ['Franse','Indonesische','Japanse','Mexicaanse'], answer: 1 },
      { q: 'Wat betekent "dankzij"?', options: ['despite','thanks to','without','before'], answer: 1 },
    ]
  },
  {
    title: 'Werken in Nederland: de vergadercultuur',
    level: 'B2',
    text: 'Als je in Nederland gaat werken, zul je snel <span class="vocab-word">merken<span class="vocab-tooltip">to notice</span></span> dat Nederlanders veel <span class="vocab-word">vergaderen<span class="vocab-tooltip">to have meetings</span></span>. De vergadercultuur is een <span class="vocab-word">belangrijk<span class="vocab-tooltip">important</span></span> onderdeel van het Nederlandse <span class="vocab-word">bedrijfsleven<span class="vocab-tooltip">business world</span></span>.\n\nIn een Nederlandse vergadering wordt van iedereen <span class="vocab-word">verwacht<span class="vocab-tooltip">expected</span></span> dat ze hun mening geven. Dit noemen we het <span class="vocab-word">poldermodel<span class="vocab-tooltip">polder model (consensus politics)</span></span>.\n\n<span class="vocab-word">Desondanks<span class="vocab-tooltip">nevertheless</span></span> kan dit systeem soms <span class="vocab-word">frustrerend<span class="vocab-tooltip">frustrating</span></span> zijn, <span class="vocab-word">aangezien<span class="vocab-tooltip">since/given that</span></span> het veel tijd kost. Nederlanders staan ook bekend om hun <span class="vocab-word">directheid<span class="vocab-tooltip">directness</span></span>.',
    vocab: [['merken','to notice'],['vergaderen','to have meetings'],['bedrijfsleven','business world'],['verwacht','expected'],['poldermodel','polder model'],['desondanks','nevertheless'],['aangezien','since/given that'],['directheid','directness'],['betrokken','involved'],['besluitvorming','decision-making']],
    questions: [
      { q: 'Wat is het poldermodel?', options: ['Een vergaderruimte','Iedereen moet het eens worden','De baas beslist alles','Een Nederlands bedrijf'], answer: 1 },
      { q: 'Wat betekent "aangezien"?', options: ['although','since/given that','therefore','however'], answer: 1 },
      { q: 'Hoe worden Nederlanders op het werk beschreven?', options: ['Verlegen','Direct en eerlijk','Heel formeel','Stil'], answer: 1 },
    ]
  },
  {
    title: 'Wonen in Nederland: de woningcrisis',
    level: 'B2',
    text: 'Nederland <span class="vocab-word">kampt<span class="vocab-tooltip">struggles with</span></span> al jaren met een <span class="vocab-word">woningtekort<span class="vocab-tooltip">housing shortage</span></span>. <span class="vocab-word">Vooral<span class="vocab-tooltip">especially</span></span> in grote steden is het <span class="vocab-word">moeilijk<span class="vocab-tooltip">difficult</span></span> om een <span class="vocab-word">betaalbare<span class="vocab-tooltip">affordable</span></span> woning te vinden.\n\nDe <span class="vocab-word">huurprijzen<span class="vocab-tooltip">rent prices</span></span> zijn de afgelopen jaren <span class="vocab-word">enorm<span class="vocab-tooltip">enormously</span></span> gestegen. <span class="vocab-word">Doordat<span class="vocab-tooltip">because (of the fact that)</span></span> er te weinig woningen worden gebouwd, <span class="vocab-word">ontstaat<span class="vocab-tooltip">arises</span></span> er een steeds groter tekort.\n\n<span class="vocab-word">Tenzij<span class="vocab-tooltip">unless</span></span> er snel wordt <span class="vocab-word">ingegrepen<span class="vocab-tooltip">intervened</span></span>, zal de situatie alleen maar <span class="vocab-word">verslechteren<span class="vocab-tooltip">worsen</span></span>.',
    vocab: [['kampt','struggles with'],['woningtekort','housing shortage'],['betaalbare','affordable'],['huurprijzen','rent prices'],['doordat','because (of the fact that)'],['ontstaat','arises'],['tenzij','unless'],['verslechteren','worsen']],
    questions: [
      { q: 'Wat is het hoofdprobleem?', options: ['Te veel woningen','Een woningtekort','Te lage huurprijzen','Niemand wil in steden wonen'], answer: 1 },
      { q: 'Wat betekent "doordat"?', options: ['although','therefore','because of the fact that','unless'], answer: 2 },
      { q: 'Wat betekent "tenzij"?', options: ['because','although','while','unless'], answer: 3 },
    ]
  },
  {
    title: 'Het weer en de Nederlanders',
    level: 'B1',
    text: 'Het weer is het <span class="vocab-word">favoriete<span class="vocab-tooltip">favorite</span></span> <span class="vocab-word">gespreksonderwerp<span class="vocab-tooltip">topic of conversation</span></span> van Nederlanders. <span class="vocab-word">Zodra<span class="vocab-tooltip">as soon as</span></span> de zon schijnt, gaat iedereen naar buiten.\n\nHet klimaat in Nederland is <span class="vocab-word">gematigd<span class="vocab-tooltip">moderate/temperate</span></span>. Het regent <span class="vocab-word">gemiddeld<span class="vocab-tooltip">on average</span></span> 130 dagen per jaar. <span class="vocab-word">Desalniettemin<span class="vocab-tooltip">nevertheless</span></span> <span class="vocab-word">klagen<span class="vocab-tooltip">complain</span></span> Nederlanders graag over het weer.\n\n<span class="vocab-word">Wanneer<span class="vocab-tooltip">when</span></span> het in de winter <span class="vocab-word">vriest<span class="vocab-tooltip">freezes</span></span>, hopen alle Nederlanders op de <span class="vocab-word">Elfstedentocht<span class="vocab-tooltip">Eleven Cities Tour</span></span>. Deze tocht is <span class="vocab-word">sinds<span class="vocab-tooltip">since</span></span> 1997 niet meer verreden.',
    vocab: [['gespreksonderwerp','topic of conversation'],['zodra','as soon as'],['gematigd','moderate/temperate'],['gemiddeld','on average'],['desalniettemin','nevertheless'],['klagen','to complain'],['vriest','freezes'],['Elfstedentocht','Eleven Cities Tour'],['sinds','since'],['toch','yet/still']],
    questions: [
      { q: 'Hoeveel dagen per jaar regent het gemiddeld?', options: ['80 dagen','100 dagen','130 dagen','200 dagen'], answer: 2 },
      { q: 'Wat betekent "zodra"?', options: ['although','as soon as','unless','while'], answer: 1 },
      { q: 'Wanneer was de laatste Elfstedentocht?', options: ['1985','1990','1997','2005'], answer: 2 },
    ]
  },
];

let currentArticle = 0;

let filteredNewsIndices = [];

function initNews() {
  const nav = document.getElementById('newsNav');
  nav.innerHTML = '';
  filteredNewsIndices = [];
  NEWS_ARTICLES.forEach((art, i) => { if (isWithinCEFR(art.level)) filteredNewsIndices.push(i); });
  filteredNewsIndices.forEach((origIdx, i) => {
    const art = NEWS_ARTICLES[origIdx];
    const btn = document.createElement('button');
    btn.className = 'news-nav-btn' + (i === 0 ? ' active' : '');
    btn.textContent = art.level + ': ' + art.title.substring(0, 20) + '...';
    btn.onclick = () => {
      document.querySelectorAll('.news-nav-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentArticle = origIdx;
      renderArticle(origIdx);
    };
    nav.appendChild(btn);
  });
  if (filteredNewsIndices.length > 0) {
    currentArticle = filteredNewsIndices[0];
    renderArticle(filteredNewsIndices[0]);
  }
}

function renderArticle(idx) {
  const art = NEWS_ARTICLES[idx];
  const content = document.getElementById('newsContent');
  let vocabHTML = '';
  art.vocab.forEach(([nl, en]) => { vocabHTML += '<div class="nl-word">' + nl + '</div><div class="en-word">' + en + '</div>'; });
  let questionsHTML = '';
  art.questions.forEach((q, qi) => {
    let optHTML = '';
    q.options.forEach((opt, oi) => { optHTML += '<button class="news-q-btn" onclick="checkNewsQ(this,' + qi + ',' + oi + ')">' + opt + '</button>'; });
    questionsHTML += '<div class="news-q"><p>' + (qi + 1) + '. ' + q.q + '</p><div class="news-q-options" id="newsQ' + qi + '">' + optHTML + '</div></div>';
  });
  content.innerHTML = '<div class="news-article-box"><span class="news-level-badge">' + art.level + '</span><h3>' + art.title + '</h3><div class="news-text">' + art.text.replace(/\n/g, '<br>') + '</div><div class="news-vocab-box"><h4>Woordenlijst</h4><div class="news-vocab-list">' + vocabHTML + '</div></div></div><div class="news-article-box"><div class="news-questions"><h4>Begripsvragen</h4>' + questionsHTML + '</div></div><div class="export-bar" style="justify-content:center"><button class="export-btn" onclick="exportArticleVocab(' + idx + ')">Download woordenlijst</button></div>';
}

function checkNewsQ(btn, qIdx, optIdx) {
  const q = NEWS_ARTICLES[currentArticle].questions[qIdx];
  const container = document.getElementById('newsQ' + qIdx);
  container.querySelectorAll('.news-q-btn').forEach((b, i) => {
    b.disabled = true;
    if (i === q.answer) b.classList.add('correct');
    if (i === optIdx && i !== q.answer) b.classList.add('wrong');
  });
  if (optIdx === q.answer) { addXP(10); spawnParticles(btn, ['\u2728']); }
  updateStats(); saveState();
}

function exportArticleVocab(idx) {
  const art = NEWS_ARTICLES[idx];
  let rows = '<h2>' + art.title + ' (' + art.level + ')</h2>';
  rows += '<table><tr><th>Nederlands</th><th>Engels</th></tr>';
  art.vocab.forEach(([nl, en]) => { rows += '<tr><td><strong>' + nl + '</strong></td><td>' + en + '</td></tr>'; });
  rows += '</table>';
  generatePDFContent('Leeshoek \u2014 ' + art.title, rows);
}

// NOS RSS Feed
let nosFeedCache = null;
let nosFeedCacheTime = 0;

// Load persistent cache from localStorage on startup
try {
  const stored = JSON.parse(localStorage.getItem('dutchquest_nos_cache'));
  if (stored && stored.articles && stored.time) {
    nosFeedCache = stored.articles;
    nosFeedCacheTime = stored.time;
  }
} catch(e) {}

function switchNewsSub(sub) {
  document.querySelectorAll('.news-sub-btn').forEach(b => b.classList.remove('active'));
  document.querySelector('.news-sub-btn[onclick*="' + sub + '"]').classList.add('active');
  document.getElementById('newsPractice').style.display = sub === 'practice' ? '' : 'none';
  document.getElementById('newsNOS').style.display = sub === 'nos' ? '' : 'none';
  if (sub === 'nos' && !nosFeedCache) fetchNOSFeed();
}

function parseNOSFeed(xmlStr) {
  const parser = new DOMParser();
  const xml = parser.parseFromString(xmlStr, 'text/xml');
  const items = xml.querySelectorAll('item');
  if (!items.length) throw new Error('No items');
  const articles = [];
  items.forEach((item, i) => {
    if (i >= 15) return;
    const title = item.querySelector('title') ? item.querySelector('title').textContent : '';
    const desc = item.querySelector('description') ? item.querySelector('description').textContent : '';
    const link = item.querySelector('link') ? item.querySelector('link').textContent : '';
    const pubDate = item.querySelector('pubDate') ? item.querySelector('pubDate').textContent : '';
    articles.push({ title, desc, link, pubDate });
  });
  return articles;
}

function fetchWithTimeout(url, timeoutMs) {
  const controller = new AbortController();
  const timer = setTimeout(() => controller.abort(), timeoutMs);
  return fetch(url, { signal: controller.signal }).finally(() => clearTimeout(timer));
}

function fetchNOSFeed() {
  const loading = document.getElementById('nosLoading');
  const feed = document.getElementById('nosFeed');
  const error = document.getElementById('nosError');
  const btn = document.getElementById('nosRefreshBtn');

  // Use memory cache if less than 15 minutes old
  const now = Date.now();
  if (nosFeedCache && (now - nosFeedCacheTime) < 15 * 60 * 1000) {
    renderNOSFeed(nosFeedCache);
    return;
  }

  loading.style.display = '';
  feed.innerHTML = '';
  error.style.display = 'none';
  btn.disabled = true;

  const rssURL = 'https://feeds.nos.nl/nosnieuwsalgemeen';
  const proxies = [
    { url: 'https://api.allorigins.win/get?url=' + encodeURIComponent(rssURL), type: 'json', field: 'contents' },
    { url: 'https://corsproxy.io/?' + encodeURIComponent(rssURL), type: 'text' },
    { url: 'https://api.codetabs.com/v1/proxy?quest=' + encodeURIComponent(rssURL), type: 'text' },
    { url: 'https://api.allorigins.win/raw?url=' + encodeURIComponent(rssURL), type: 'text' },
    { url: 'https://corsproxy.org/?' + encodeURIComponent(rssURL), type: 'text' }
  ];

  // Race all proxies in parallel — first valid response wins
  const TIMEOUT = 8000;
  const racePromises = proxies.map(proxy =>
    fetchWithTimeout(proxy.url, TIMEOUT)
      .then(r => { if (!r.ok) throw new Error('HTTP ' + r.status); return proxy.type === 'json' ? r.json() : r.text(); })
      .then(data => {
        const xmlStr = proxy.field ? data[proxy.field] : data;
        return parseNOSFeed(xmlStr);
      })
  );

  // Promise.any resolves with the first fulfilled promise
  Promise.any(racePromises)
    .then(articles => {
      nosFeedCache = articles;
      nosFeedCacheTime = Date.now();
      try { localStorage.setItem('dutchquest_nos_cache', JSON.stringify({ articles, time: nosFeedCacheTime })); } catch(e) {}
      renderNOSFeed(articles);
    })
    .catch(() => {
      // All proxies failed — fall back to stale localStorage cache if available
      if (nosFeedCache && nosFeedCache.length > 0) {
        renderNOSFeed(nosFeedCache, true);
      } else {
        loading.style.display = 'none';
        error.style.display = '';
      }
      btn.disabled = false;
    });
}

function renderNOSFeed(articles, isStale) {
  const loading = document.getElementById('nosLoading');
  const feed = document.getElementById('nosFeed');
  const btn = document.getElementById('nosRefreshBtn');
  loading.style.display = 'none';
  btn.disabled = false;

  const accents = ['var(--mondrian-red)', 'var(--mondrian-blue)', 'var(--mondrian-yellow)'];

  let html = '';
  if (isStale) {
    html += '<div class="nos-stale-banner">Kon geen nieuw nieuws laden. Je ziet het laatst opgeslagen nieuws. <button class="nos-stale-retry" onclick="nosFeedCacheTime=0;fetchNOSFeed()">Opnieuw proberen</button></div>';
  }
  articles.forEach((art, i) => {
    const timeStr = art.pubDate ? formatNOSDate(art.pubDate) : '';
    const cleanDesc = art.desc.replace(/<[^>]*>/g, '');
    html += '<div class="nos-card" onclick="window.open(\'' + art.link.replace(/'/g, "\\'") + '\', \'_blank\')">';
    html += '<div class="nos-card-accent" style="background:' + accents[i % 3] + ';"></div>';
    html += '<div class="nos-card-header"><h4>' + escapeHTML(art.title) + '</h4>';
    if (timeStr) html += '<span class="nos-card-time">' + timeStr + '</span>';
    html += '</div>';
    if (cleanDesc) html += '<p>' + escapeHTML(cleanDesc) + '</p>';
    html += '<a class="nos-card-link" href="' + escapeHTML(art.link) + '" target="_blank" rel="noopener" onclick="event.stopPropagation()">Lees meer op NOS.nl &rarr;</a>';
    html += '</div>';
  });

  if (articles.length === 0) {
    html = '<div class="nos-error-box"><p>Geen artikelen gevonden.</p></div>';
  }

  feed.innerHTML = html;
}

function formatNOSDate(dateStr) {
  try {
    const d = new Date(dateStr);
    const now = new Date();
    const diff = now - d;
    if (diff < 3600000) return Math.floor(diff / 60000) + ' min geleden';
    if (diff < 86400000) return Math.floor(diff / 3600000) + ' uur geleden';
    const days = ['zo','ma','di','wo','do','vr','za'];
    const months = ['jan','feb','mrt','apr','mei','jun','jul','aug','sep','okt','nov','dec'];
    return days[d.getDay()] + ' ' + d.getDate() + ' ' + months[d.getMonth()] + ', ' + d.getHours().toString().padStart(2,'0') + ':' + d.getMinutes().toString().padStart(2,'0');
  } catch(e) { return dateStr; }
}

function escapeHTML(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}


// ==========================================
// TAB 5: DAILY CHALLENGE
// ==========================================
function initDaily() {
  const today = new Date().toDateString();
  if (state.lastDaily === today) {
    document.getElementById('dailyChallengeBox').innerHTML = '<p style="font-size:15px;color:var(--green);margin:20px;">Je hebt de uitdaging van vandaag al voltooid!<br><br><em>Kom morgen terug.</em></p>';
    return;
  }
  const seed = new Date().getDate() + new Date().getMonth() * 31;
  const challenges = generateDailyChallenges(seed);
  let challengeIdx = 0;
  function showChallenge() {
    if (challengeIdx >= challenges.length) {
      state.lastDaily = today;
      state.dailyStreak++;
      saveState();
      document.getElementById('dailyChallengeBox').innerHTML = '<p style="font-size:18px;color:var(--coral);margin:20px;font-family:Syne,sans-serif;font-weight:700;">Gefeliciteerd!<br><br><em>Uitdaging voltooid.</em></p>';
      document.getElementById('dailyStreak').textContent = 'Huidige reeks: ' + state.dailyStreak + ' dagen';
      addXP(50);
      return;
    }
    const ch = challenges[challengeIdx];
    const box = document.getElementById('dailyChallengeBox');
    box.innerHTML = '<div class="daily-type">' + ch.type + ' (' + (challengeIdx + 1) + '/' + challenges.length + ')</div><div class="daily-question">' + ch.question + '</div><input class="daily-input" id="dailyInput" placeholder="Typ je antwoord..." autocomplete="off" autocapitalize="off"><br><button class="daily-submit" onclick="checkDaily()">Controleer</button>';
    document.getElementById('dailyInput').focus();
    document.getElementById('dailyInput').addEventListener('keydown', e => { if (e.key === 'Enter') checkDaily(); });
    window._dailyAnswer = ch.answer;
    window._dailyNext = () => { challengeIdx++; showChallenge(); };
  }
  showChallenge();
  document.getElementById('dailyStreak').textContent = 'Huidige reeks: ' + state.dailyStreak + ' dagen';
}

function generateDailyChallenges(seed) {
  const challenges = [];
  const pick = (arr, n) => { const r = []; for (let i = 0; i < n && arr.length > 0; i++) { r.push(arr[(seed * (i + 7) * 13) % arr.length]); } return r; };
  pick(VERBS, 5).forEach((v, i) => {
    if (i % 3 === 0) challenges.push({ type: 'Voltooid deelwoord', question: 'Wat is het voltooid deelwoord van "' + v.inf + '"?', answer: v.pp.toLowerCase() });
    else if (i % 3 === 1) challenges.push({ type: 'Imperfectum enkelvoud', question: 'Wat is het imperfectum (ik-vorm) van "' + v.inf + '"?', answer: v.imp_s.toLowerCase() });
    else challenges.push({ type: 'Vertaling', question: 'Hoe zeg je "' + v.en + '" in het Nederlands? (infinitief)', answer: v.inf.toLowerCase() });
  });
  return challenges;
}

function checkDaily() {
  const input = document.getElementById('dailyInput');
  const userAnswer = input.value.trim().toLowerCase();
  const correct = window._dailyAnswer.toLowerCase();
  const results = document.getElementById('dailyResults');
  if (userAnswer === correct) {
    results.innerHTML = '<span style="color:#55efc4">Correct! "' + correct + '"</span>';
    addXP(15);
    spawnParticles(input, ['\u2728']);
    setTimeout(window._dailyNext, 1200);
  } else {
    results.innerHTML = '<span style="color:#ff6b6b">Het was: "' + correct + '"</span>';
    setTimeout(window._dailyNext, 2000);
  }
}

// ==========================================
// HINT SYSTEM
// ==========================================
function toggleHint() {
  const bubble = document.getElementById('hintBubble');
  if (bubble.classList.contains('show')) { bubble.classList.remove('show'); return; }
  if (!currentVerb) return;
  const v = currentVerb;
  const p = VERB_PATTERNS[v.pattern];
  const examples = {
    'eten': 'Ik heb vandaag pasta <span class="hl">gegeten</span>.',
    'lezen': 'Zij heeft het boek <span class="hl">gelezen</span>.',
    'schrijven': 'Hij heeft een brief <span class="hl">geschreven</span>.',
    'spreken': 'Wij hebben Nederlands <span class="hl">gesproken</span>.',
    'drinken': 'Ik heb koffie <span class="hl">gedronken</span>.',
    'komen': 'Zij is gisteren <span class="hl">gekomen</span>.',
    'gaan': 'Wij zijn naar school <span class="hl">gegaan</span>.',
    'zijn': 'Ik ben in Amsterdam <span class="hl">geweest</span>.',
    'hebben': 'Hij heeft een hond <span class="hl">gehad</span>.',
    'doen': 'Wat heb je <span class="hl">gedaan</span>?',
    'zien': 'Ik heb haar <span class="hl">gezien</span>.',
    'nemen': 'Hij heeft de trein <span class="hl">genomen</span>.',
    'geven': 'Zij heeft mij een cadeau <span class="hl">gegeven</span>.',
    'blijven': 'Wij zijn thuis <span class="hl">gebleven</span>.',
    'krijgen': 'Ik heb een brief <span class="hl">gekregen</span>.',
    'vinden': 'Zij heeft de sleutel <span class="hl">gevonden</span>.',
    'beginnen': 'De film is om 8 uur <span class="hl">begonnen</span>.',
  };
  const ex = examples[v.id] || (v.aux.split('/')[0] === 'is' ? 'Ik ben' : 'Ik heb') + ' ... <span class="hl">' + v.pp + '</span>.';
  bubble.innerHTML = '<strong style="color:' + p.color + '">Patroon: ' + p.label + '</strong><br><br><span class="hl">' + v.inf + '</span> (' + v.en + ')<br>Imperfectum: <span class="hl">' + v.imp_s + '</span> (ik) / <span class="hl">' + v.imp_p + '</span> (wij)<br>Voltooid deelwoord: <span class="hl">' + v.pp + '</span><br>Hulpwerkwoord: <span class="hl">' + v.aux + '</span><br><br><em>Voorbeeld:</em> ' + ex + '<br><br><em style="color:var(--muted)">Andere werkwoorden met dit patroon:</em><br>' + VERBS.filter(ov => ov.pattern === v.pattern && ov.id !== v.id).slice(0,4).map(ov => ov.inf + ' \u2192 ' + ov.imp_s + ' \u2192 ' + ov.pp).join('<br>');
  bubble.classList.add('show');
}

// ==========================================
// PDF EXPORT
// ==========================================
function generatePDFContent(title, rows) {
  const html = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>' + title + '</title><style>body{font-family:Inter,sans-serif;padding:30px;background:#fff;color:#111;}h1{font-family:Syne,sans-serif;font-size:22px;border-bottom:4px solid #000;padding-bottom:8px;color:#000;}h2{font-size:16px;color:#1356A2;margin-top:20px;font-family:Syne,sans-serif;}table{width:100%;border-collapse:collapse;margin:10px 0;font-size:12px;border:2px solid #000;}th{background:#F7D842;color:#000;padding:8px;text-align:left;border-bottom:2px solid #000;}td{padding:6px 8px;border-bottom:1px solid #ddd;}tr:nth-child(even){background:#f9f9f9;}.pattern-label{display:inline-block;padding:2px 6px;color:#fff;font-size:10px;background:#1356A2;}.tip{background:#fffde6;border-left:4px solid #D40920;padding:8px 12px;margin:10px 0;font-size:12px;}h2,h3{page-break-after:avoid;}table{page-break-inside:auto;}tr{page-break-inside:avoid;page-break-after:auto;}thead{display:table-header-group;}table+.tip{page-break-before:avoid;}.tip{page-break-inside:avoid;}@media print{body{padding:15px;}h2,h3{page-break-after:avoid;}table{page-break-inside:auto;}tr{page-break-inside:avoid;}thead{display:table-header-group;}}</style></head><body><h1>Dutchmaxxing \u2014 ' + title + '</h1><p style="color:#666;font-size:11px;">Gegenereerd op ' + new Date().toLocaleDateString('nl-NL') + '</p>' + rows + '</body></html>';
  const w = window.open('', '_blank');
  w.document.write(html);
  w.document.close();
  setTimeout(() => w.print(), 500);
}

function exportWrongVerbs() {
  const wrongVerbs = VERBS.filter(v => { const h = state.verbHistory[v.id]; return h && h.wrong > 0; }).sort((a, b) => (state.verbHistory[b.id]?.wrong || 0) - (state.verbHistory[a.id]?.wrong || 0));
  if (wrongVerbs.length === 0) { alert('Nog geen fouten! Speel eerst een paar rondes.'); return; }
  let rows = '<div class="tip">Deze werkwoorden heb je fout beantwoord. Bestudeer de patronen!</div>';
  rows += '<table><tr><th>Infinitief</th><th>Engels</th><th>Imp. (ik)</th><th>Imp. (wij)</th><th>Volt. deelw.</th><th>Hulpww.</th><th>Patroon</th><th>Fouten</th></tr>';
  wrongVerbs.forEach(v => { const h = state.verbHistory[v.id]; const p = VERB_PATTERNS[v.pattern]; rows += '<tr><td><strong>' + v.inf + '</strong></td><td>' + v.en + '</td><td>' + v.imp_s + '</td><td>' + v.imp_p + '</td><td>' + v.pp + '</td><td>' + v.aux + '</td><td><span class="pattern-label" style="background:' + p.color + '">' + p.label + '</span></td><td>' + h.wrong + 'x</td></tr>'; });
  rows += '</table>';
  generatePDFContent('Mijn Fouten \u2014 Werkwoorden om te oefenen', rows);
}

function exportAllVerbs() {
  let rows = '';
  const grouped = {};
  VERBS.forEach(v => { if (!grouped[v.pattern]) grouped[v.pattern] = []; grouped[v.pattern].push(v); });
  for (const [patKey, verbs] of Object.entries(grouped)) {
    const p = VERB_PATTERNS[patKey];
    rows += '<h2><span class="pattern-label" style="background:' + p.color + '">' + p.label + '</span> ' + p.example + '</h2>';
    rows += '<table><tr><th>Infinitief</th><th>Engels</th><th>Imp. (ik)</th><th>Imp. (wij)</th><th>Volt. deelw.</th><th>Hulpww.</th></tr>';
    verbs.forEach(v => { rows += '<tr><td><strong>' + v.inf + '</strong></td><td>' + v.en + '</td><td>' + v.imp_s + '</td><td>' + v.imp_p + '</td><td>' + v.pp + '</td><td>' + v.aux + '</td></tr>'; });
    rows += '</table>';
  }
  rows += '<div class="tip">Totaal: ' + VERBS.length + ' werkwoorden</div>';
  generatePDFContent('Alle Werkwoorden \u2014 A2 / B1 / B2', rows);
}

// ==========================================
// HELP SYSTEM
// ==========================================
const HELP_CONTENT = {
  arena: '<h2>Werkwoorden \u2014 Hulp</h2><h3>Hoe werkt het?</h3><p>Een werkwoord verschijnt als gedachtekaart. Kies de juiste vervoeging om de gedachte te internaliseren. Elk correct antwoord brengt je dichter bij meesterschap.</p><h3>Perfectum</h3><div class="help-example"><span class="hl">hebben/zijn</span> + <span class="gr">voltooid deelwoord</span><br><br>Ik <span class="hl">heb</span> een boek <span class="gr">gelezen</span>.<br>Zij <span class="hl">is</span> naar huis <span class="gr">gegaan</span>.</div><h3>Imperfectum</h3><div class="help-example">Ik <span class="hl">at</span> elke dag een appel.<br>Wij <span class="hl">lazen</span> de hele avond.</div><h3>Patronen herkennen</h3><div class="help-example"><span style="color:#2d8a56">e \u2192 a \u2192 e</span>: eten \u2192 at \u2192 gegeten<br><span style="color:#8B4513">e \u2192 a \u2192 o</span>: spreken \u2192 sprak \u2192 gesproken<br><span style="color:#D40920">ij \u2192 ee \u2192 e</span>: schrijven \u2192 schreef \u2192 geschreven<br><span style="color:#1356A2">ie \u2192 oo \u2192 o</span>: vliegen \u2192 vloog \u2192 gevlogen<br><span style="color:#b08600">i \u2192 o \u2192 o</span>: drinken \u2192 dronk \u2192 gedronken<br><span style="color:#555">a \u2192 oe \u2192 a</span>: dragen \u2192 droeg \u2192 gedragen</div><button class="help-close" onclick="closeHelp()">Begrepen</button>',

  adventure: '<h2>De Stad \u2014 Hulp</h2><h3>Hoe werkt het?</h3><p>Verken zes scenario\'s in het dagelijks leven: de markt, een sollicitatie, de huisarts, het station, een date, en een burenruzie. Elk scenario is een meerdelige dialoog waar je de juiste Nederlandse reactie kiest.</p><h3>Tips</h3><ul><li>Lees de situatie en het gesprek goed door</li><li>Let op grammatica: werkwoordvervoeging, woordvolgorde, voegwoorden</li><li>Foute antwoorden leiden tot grappige situaties \u2014 maar je krijgt minder XP</li><li>Alle scenario\'s oefenen verschillende taalvaardigheden</li></ul><h3>Wat oefen je?</h3><div class="help-example"><span class="hl">Perfectum & imperfectum</span> in context<br><span class="gr">Voegwoorden</span>: omdat, hoewel, terwijl, zolang, tenzij<br><span style="color:var(--purple)">Beleefde vormen</span>: zou u kunnen, alstublieft<br><span class="hl">Dagelijkse uitdrukkingen</span>: bestellen, vragen, klagen</div><button class="help-close" onclick="closeHelp()">Begrepen</button>',

  news: '<h2>Leeshoek \u2014 Hulp</h2><h3>Oefenartikelen</h3><p>Lees Nederlandse artikelen met woordenlijst en begripsvragen. Gekleurde woorden hebben een vertaling \u2014 beweeg je muis erover.</p><h3>NOS Nieuws</h3><p>Lees het laatste Nederlandse nieuws, rechtstreeks van NOS.nl. Elke dag nieuwe artikelen om je leesvaardigheid te oefenen.</p><h3>Vertalen & Opslaan</h3><ul><li><strong>Selecteer tekst</strong> in een artikel om de vertaalknop te zien</li><li>Klik <strong>Vertalen</strong> voor een Engelse vertaling</li><li>Klik <strong>Opslaan</strong> om de vertaling te bewaren</li><li>Bekijk je opgeslagen vertalingen onderaan de pagina</li><li><strong>Download PDF</strong> om je vertalingen te exporteren</li></ul><h3>Leesstrategieën</h3><ul><li>Lees eerst de hele tekst zonder te stoppen</li><li>Lees dan opnieuw met de woordenlijst</li><li>Beantwoord de vragen om je begrip te testen</li><li>Lees elke dag een NOS-artikel voor dagelijkse oefening</li></ul><button class="help-close" onclick="closeHelp()">Begrepen</button>',

  reader: '<h2>Tekstlezer \u2014 Hulp</h2><h3>Hoe werkt het?</h3><p>Plak een URL van NOS.nl of de Nederlandse Wikipedia en lees het artikel interactief. Elk woord is klikbaar.</p><h3>Functies</h3><ul><li><strong>Hover:</strong> Beweeg over een woord voor de Engelse vertaling</li><li><strong>Werkwoorden:</strong> Onderstreepte woorden zijn werkwoordvormen \u2014 met vervoegingdetails</li><li><strong>Opslaan:</strong> Klik op een woord om het toe te voegen aan je woordenlijst</li><li><strong>Zinnen:</strong> Selecteer tekst voor een complete zinsvertaling</li><li><strong>Exporteer:</strong> Download je woordenlijst als printbare PDF</li></ul><button class="help-close" onclick="closeHelp()">Begrepen</button>',

  vocab: '<h2>Woordenschat \u2014 Hulp</h2><h3>Oefenen</h3><p>Drie soorten oefeningen om werkwoorden met vaste voorzetsels te leren:</p><ul><li><strong>Vul het voorzetsel in:</strong> Kies het juiste voorzetsel bij de zin</li><li><strong>Maak de zin af:</strong> Vul het werkwoord + voorzetsel in</li><li><strong>Vertaal de zin:</strong> Vertaal van Engels naar Nederlands</li></ul><h3>Lijst</h3><p>Blader door alle werkwoorden of voorzetsels. Gebruik de zoekbalk en filters om snel te vinden wat je zoekt.</p><button class="help-close" onclick="closeHelp()">Begrepen</button>',

  daily: '<h2>Dagelijkse Uitdaging \u2014 Hulp</h2><h3>Hoe werkt het?</h3><p>Elke dag krijg je vijf uitdagingen. Typ je antwoord in kleine letters en druk op Enter.</p><h3>Types</h3><ul><li><strong>Voltooid deelwoord:</strong> bv. gegeten, geschreven</li><li><strong>Imperfectum:</strong> bv. at, schreef</li><li><strong>Vertaling:</strong> bv. eten, schrijven</li></ul><button class="help-close" onclick="closeHelp()">Begrepen</button>',

  grammar: '<h2>Grammatica \u2014 Hulp</h2><h3>Wat vind je hier?</h3><p>Overzichtelijke spiekbriefjes voor de belangrijkste grammaticaregels van het Nederlands.</p><h3>Categorieën</h3><ul><li><strong>Werkwoorden:</strong> Perfectum, imperfectum, hebben/zijn, scheidbaar, modaal, passief, conditionalis</li><li><strong>Spelling:</strong> \'t Kofschip, dt-regels, open/gesloten lettergrepen, f/v en s/z</li><li><strong>De/Het:</strong> Welk lidwoord? Bijvoeglijk naamwoord-regels</li><li><strong>Woordvolgorde:</strong> Hoofdzin, bijzin, het woordje "er"</li><li><strong>Voornaamwoorden:</strong> Persoonlijk, betrekkelijk</li><li><strong>Overig:</strong> Vergelijkingen, ontkenning, voorzetsels, verkleinwoorden</li></ul><p>Klik op "Print dit spiekbriefje" om een regel als PDF te downloaden.</p><button class="help-close" onclick="closeHelp()">Begrepen</button>',

  phrases: '<h2>Uitdrukkingen \u2014 Hulp</h2><h3>Wat zijn uitdrukkingen?</h3><p>Veelgebruikte zinnen, voegwoorden en idiomen die je helpen om natuurlijk Nederlands te spreken en schrijven.</p><h3>Categorieën</h3><ul><li><strong>Mening:</strong> Je mening geven en reageren</li><li><strong>Gesprek:</strong> Conversatie-uitdrukkingen</li><li><strong>Voegwoorden:</strong> Zodra, terwijl, hoewel, tenzij, etc.</li><li><strong>Tijd:</strong> Tijdsuitdrukkingen (vroeger, tegenwoordig...)</li><li><strong>Emotie:</strong> Gevoelens uitdrukken</li><li><strong>Argumentatie:</strong> Structuurwoorden voor betogen</li><li><strong>Formeel:</strong> Zakelijke en beleefde taal</li><li><strong>Spreekwoorden:</strong> Nederlandse gezegden en idiomen</li></ul><h3>Tips</h3><p>Gebruik de zoekbalk om snel een uitdrukking te vinden. Download alles als PDF voor een handig overzicht.</p><button class="help-close" onclick="closeHelp()">Begrepen</button>',

  spel: '<h2>Het Nederlandse Avontuur \u2014 Hulp</h2><h3>Hoe werkt het?</h3><p>Je bent een nieuwkomer die het dagelijks leven in Nederland probeert te overleven. Elke ronde pakt een \u00e9cht NOS-nieuwsartikel en verweft het in een absurd scenario.</p><h3>Uitdagingen</h3><ul><li><strong>Invuloefening:</strong> Vul de ontbrekende woorden in de zin aan</li><li><strong>Woordvolgorde:</strong> Klik woorden in de juiste volgorde</li><li><strong>Kop aanvullen:</strong> Maak de nieuwskop af</li></ul><h3>Moeilijkheidsgraden</h3><div class="help-example"><span class="hl">Makkelijk:</span> Meerkeuze (3 opties), Engelse hint, geen timer<br><span class="gr">Gemiddeld:</span> Meerkeuze (4 opties), eerste letter hint, 30s timer<br><span style="color:var(--mondrian-red)">Moeilijk:</span> Typ je antwoord, geen hints, 15s timer</div><h3>Tips</h3><ul><li>Lees het NOS-nieuwsbericht goed \u2014 de antwoorden komen uit echte artikelen</li><li>Let op de context van het scenario voor extra aanwijzingen</li><li>Snelheid telt bij gemiddeld en moeilijk!</li></ul><button class="help-close" onclick="closeHelp()">Begrepen</button>',

  sheets: '<h2>Spiekbriefjes \u2014 Hulp</h2><h3>Kant-en-klaar</h3><p>Klik op een kaart om direct een printbaar PDF-spiekbriefje te genereren. Kies uit 8 verschillende overzichten.</p><h3>Eigen Selectie</h3><p>Bouw je eigen spiekbriefje in 3 stappen:</p><ol><li><strong>Kies woorden:</strong> Selecteer werkwoorden en/of vaste voorzetsels, of voeg eigen woorden toe</li><li><strong>Kies lay-out:</strong> Tabel, flashcards, mindmap, twee kolommen of zinnen</li><li><strong>Download:</strong> Genereer en print je spiekbriefje</li></ol><h3>Alles Downloaden</h3><p>Download complete overzichten van alle werkwoorden en vaste voorzetsels in verschillende formaten.</p><button class="help-close" onclick="closeHelp()">Begrepen</button>',
};

function showHelp(tab) {
  document.getElementById('helpModal').innerHTML = HELP_CONTENT[tab] || '';
  document.getElementById('helpOverlay').classList.add('show');
}

function closeHelp() {
  document.getElementById('helpOverlay').classList.remove('show');
}

// ==========================================
// UTILITIES
// ==========================================
function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

// ==========================================
// TAB 6: TEKSTLEZER
// ==========================================
const readerVerbMap = new Map();
(function buildReaderVerbMap() {
  for (const v of VERBS) {
    const forms = [v.inf, v.imp_s, v.imp_p, v.pp];
    for (const form of forms) {
      if (!form || form === '-') continue;
      const parts = form.toLowerCase().split(' ');
      for (const part of parts) {
        if (part.length > 1 && !readerVerbMap.has(part)) readerVerbMap.set(part, v);
      }
      const full = form.toLowerCase().replace(/\s+/g, '');
      if (!readerVerbMap.has(full)) readerVerbMap.set(full, v);
    }
  }
})();

function readerLookupVerb(word) {
  const w = word.toLowerCase();
  if (readerVerbMap.has(w)) return readerVerbMap.get(w);
  const suffixes = ['t', 'en', 'de', 'te', 'den', 'ten', 'dt'];
  for (const suf of suffixes) {
    if (w.length > suf.length + 2 && w.endsWith(suf)) {
      const stem = w.slice(0, -suf.length);
      if (readerVerbMap.has(stem)) return readerVerbMap.get(stem);
      if (readerVerbMap.has(stem + 'en')) return readerVerbMap.get(stem + 'en');
    }
  }
  return null;
}

let readerSavedWords = JSON.parse(sessionStorage.getItem('readerWords') || '[]');
let readerTranslationCache = JSON.parse(sessionStorage.getItem('readerCache') || '{}');
let readerArticleTitle = '';
let readerArticleUrl = '';

async function readerFetchArticle() {
  const url = document.getElementById('readerUrlInput').value.trim();
  if (!url) return;
  if (!url.includes('nos.nl') && !url.includes('nl.wikipedia.org')) {
    readerShowError('Alleen NOS.nl en nl.wikipedia.org URLs worden ondersteund.');
    return;
  }
  const btn = document.getElementById('readerLoadBtn');
  btn.disabled = true; btn.textContent = 'Laden...';
  const area = document.getElementById('readerArticleArea');
  area.innerHTML = '<div class="reader-loading"><div class="reader-loading-spinner"></div><div style="font-family:Syne,sans-serif;font-size:15px;color:var(--cream);letter-spacing:1px;font-weight:600">Artikel ophalen...</div><div style="font-size:12px;color:var(--muted);font-style:italic;margin-top:6px">"Patience is a verb too, in its own way."</div></div>';
  try {
    const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(url);
    const response = await fetch(proxyUrl);
    if (!response.ok) throw new Error('Fout bij ophalen');
    const data = await response.json();
    const parser = new DOMParser();
    const doc = parser.parseFromString(data.contents, 'text/html');
    let title = '', paragraphs = [];
    if (url.includes('nos.nl')) {
      title = doc.querySelector('h1')?.textContent?.trim() || 'NOS Artikel';
      // Try multiple selectors - NOS changes structure often
      const selectors = [
        '.article_textwrap p',
        '.article-body p',
        '.article-content p',
        '[class*="article__body"] p',
        '[class*="contentBody"] p',
        '[class*="content-body"] p',
        'article p',
        '.text-body p',
        '[class*="article"] p',
        'main p'
      ];
      for (const sel of selectors) {
        if (paragraphs.length > 0) break;
        doc.querySelectorAll(sel).forEach(p => {
          const t = p.textContent.trim();
          if (t.length > 20 && !paragraphs.includes(t)) paragraphs.push(t);
        });
      }
      // Fallback: all <p> tags with substantial text
      if (paragraphs.length === 0) doc.querySelectorAll('p').forEach(p => { const t = p.textContent.trim(); if (t.length > 30) paragraphs.push(t); });
    } else if (url.includes('nl.wikipedia.org')) {
      title = doc.querySelector('#firstHeading, .firstHeading, h1')?.textContent?.trim() || 'Wikipedia Artikel';
      const content = doc.querySelector('#mw-content-text .mw-parser-output') || doc.querySelector('#mw-content-text') || doc;
      // Remove reference numbers, tables, infoboxes
      content.querySelectorAll('.reference, .reflist, table, .infobox, .navbox, .metadata, .mw-editsection, sup.reference').forEach(el => el.remove());
      content.querySelectorAll('p').forEach(p => {
        const t = p.textContent.trim().replace(/\[\d+\]/g, '');
        if (t.length > 20) paragraphs.push(t);
      });
    }
    if (paragraphs.length === 0) throw new Error('Geen tekst gevonden in het artikel.');
    readerArticleTitle = title;
    readerArticleUrl = url;
    readerRenderArticle(title, url, paragraphs);
  } catch (err) {
    area.innerHTML = '<div class="reader-error"><h4>\u26A0 Er ging iets mis</h4><p>' + err.message + '</p><p style="font-size:12px;color:var(--muted);margin-top:8px;font-style:italic">Probeer een ander artikel of controleer de URL.</p></div>';
  } finally { btn.disabled = false; btn.textContent = 'Laden'; }
}

function readerShowError(msg) {
  document.getElementById('readerArticleArea').innerHTML = '<div class="reader-error"><h4>\u26A0 Ongeldige URL</h4><p>' + msg + '</p></div>';
}

function readerRenderArticle(title, url, paragraphs) {
  const area = document.getElementById('readerArticleArea');
  const isNos = url.includes('nos.nl');
  let wc = 0; paragraphs.forEach(p => { wc += p.split(/\s+/).length; });
  const card = document.createElement('div');
  card.className = 'reader-article-card';
  card.innerHTML = '<div class="reader-article-accent"></div><div class="reader-article-inner"><div class="reader-article-meta"><span class="reader-source-badge ' + (isNos ? 'reader-badge-nos' : 'reader-badge-wiki') + '">' + (isNos ? 'NOS' : 'Wikipedia') + '</span><span class="reader-article-wc">' + wc + ' woorden</span></div><h3 class="reader-article-title"></h3><div class="reader-article-url"></div><div class="reader-article-text"></div></div>';
  card.querySelector('.reader-article-title').textContent = title;
  card.querySelector('.reader-article-url').textContent = url;
  const textEl = card.querySelector('.reader-article-text');
  for (const para of paragraphs) {
    const p = document.createElement('p');
    readerWrapWords(para, p);
    textEl.appendChild(p);
  }
  area.innerHTML = '';
  area.appendChild(card);
}

function readerWrapWords(text, container) {
  const tokens = text.match(/[\w\u00C0-\u024F]+|[^\w\u00C0-\u024F]+/g) || [];
  for (const token of tokens) {
    if (/[\w\u00C0-\u024F]/.test(token)) {
      const span = document.createElement('span');
      span.className = 'reader-word';
      span.textContent = token;
      if (readerLookupVerb(token)) span.classList.add('verb-form');
      if (readerSavedWords.some(w => w.dutch.toLowerCase() === token.toLowerCase())) span.classList.add('saved');
      span.addEventListener('mouseenter', readerWordMouseEnter);
      span.addEventListener('mouseleave', readerWordMouseLeave);
      span.addEventListener('click', readerHandleWordClick);
      container.appendChild(span);
    } else {
      container.appendChild(document.createTextNode(token));
    }
  }
}

const readerTooltip = document.getElementById('readerTooltip');
let readerHoverTimer = null;
let readerIsSelecting = false;

document.addEventListener('mousedown', () => { readerIsSelecting = true; readerHideTooltip(); });
document.addEventListener('mouseup', () => { setTimeout(() => { readerIsSelecting = false; }, 100); });

function readerWordMouseEnter(e) {
  if (readerIsSelecting) return;
  const span = e.target;
  clearTimeout(readerHoverTimer);
  readerHoverTimer = setTimeout(() => {
    if (readerIsSelecting) return;
    const sel = window.getSelection();
    if (sel && sel.toString().length > 0) return;
    readerShowTooltip(span);
  }, 350);
}

function readerWordMouseLeave() {
  clearTimeout(readerHoverTimer);
  readerHideTooltip();
}

function readerShowTooltip(span) {
  const word = span.textContent;
  const rect = span.getBoundingClientRect();
  let left = rect.left, top = rect.bottom + 10;
  if (left + 320 > window.innerWidth) left = window.innerWidth - 330;
  if (left < 10) left = 10;
  if (top + 200 > window.innerHeight) top = rect.top - 10;
  readerTooltip.style.left = left + 'px';
  readerTooltip.style.top = top + 'px';
  const verb = readerLookupVerb(word);
  const cacheKey = word.toLowerCase();
  let html = '<div class="reader-tt-accent"></div><div class="reader-tt-body">';
  html += '<div class="reader-tt-word">' + word + '</div>';
  if (readerTranslationCache[cacheKey]) {
    html += '<div class="reader-tt-translation">' + readerTranslationCache[cacheKey] + '</div>';
  } else {
    html += '<div class="reader-tt-loading">Vertalen...</div>';
    readerFetchTranslation(word);
  }
  if (verb) {
    html += '<div class="reader-tt-verb"><div class="reader-tt-verb-label">' + verb.inf + ' \u2014 ' + verb.en + '</div>';
    html += '<div class="reader-tt-verb-grid">';
    html += '<span class="reader-tt-verb-key">Imperfectum (ik)</span><span class="reader-tt-verb-val">' + verb.imp_s + '</span>';
    html += '<span class="reader-tt-verb-key">Imperfectum (wij)</span><span class="reader-tt-verb-val">' + verb.imp_p + '</span>';
    html += '<span class="reader-tt-verb-key">Voltooid deelwoord</span><span class="reader-tt-verb-val">' + verb.pp + '</span>';
    html += '<span class="reader-tt-verb-key">Hulpwerkwoord</span><span class="reader-tt-verb-val">' + verb.aux + '</span>';
    html += '</div><span class="reader-tt-verb-pattern">' + verb.pattern + '</span></div>';
  }
  html += '<div class="reader-tt-click">Klik om op te slaan</div></div>';
  readerTooltip.innerHTML = html;
  readerTooltip.classList.add('show');
}

function readerHideTooltip() { readerTooltip.classList.remove('show'); }

async function readerFetchTranslation(word) {
  const cacheKey = word.toLowerCase();
  if (readerTranslationCache[cacheKey]) return;
  try {
    const resp = await fetch('https://api.mymemory.translated.net/get?q=' + encodeURIComponent(word) + '&langpair=nl|en');
    const data = await resp.json();
    const translation = data.responseData?.translatedText || '';
    if (translation && translation.toLowerCase() !== word.toLowerCase()) {
      readerTranslationCache[cacheKey] = translation;
      sessionStorage.setItem('readerCache', JSON.stringify(readerTranslationCache));
      const ttWord = readerTooltip.querySelector('.reader-tt-word');
      if (ttWord && ttWord.textContent === word) {
        const loading = readerTooltip.querySelector('.reader-tt-loading');
        if (loading) { loading.className = 'reader-tt-translation'; loading.textContent = translation; }
      }
    }
  } catch (e) {}
}

function readerHandleWordClick(e) {
  const span = e.target;
  const word = span.textContent;
  const lower = word.toLowerCase();
  const idx = readerSavedWords.findIndex(w => w.dutch.toLowerCase() === lower);
  if (idx >= 0) {
    readerSavedWords.splice(idx, 1);
    document.querySelectorAll('.reader-word').forEach(w => { if (w.textContent.toLowerCase() === lower) w.classList.remove('saved'); });
  } else {
    const verb = readerLookupVerb(word);
    readerSavedWords.push({
      dutch: word,
      english: readerTranslationCache[lower] || '',
      verb: verb ? { inf: verb.inf, en: verb.en, imp_s: verb.imp_s, imp_p: verb.imp_p, pp: verb.pp, aux: verb.aux, pattern: verb.pattern } : null
    });
    document.querySelectorAll('.reader-word').forEach(w => { if (w.textContent.toLowerCase() === lower) w.classList.add('saved'); });
    if (!readerTranslationCache[lower]) {
      readerFetchTranslation(word).then(() => {
        const i = readerSavedWords.findIndex(w => w.dutch.toLowerCase() === lower);
        if (i >= 0 && readerTranslationCache[lower]) { readerSavedWords[i].english = readerTranslationCache[lower]; readerPersistWords(); readerRenderWordList(); }
      });
    }
  }
  readerPersistWords();
  readerRenderWordList();
}

function readerPersistWords() { sessionStorage.setItem('readerWords', JSON.stringify(readerSavedWords)); }

function readerRenderWordList() {
  const list = document.getElementById('readerWordList');
  const count = document.getElementById('readerWordCount');
  const exportBtn = document.getElementById('readerExportBtn');
  count.textContent = readerSavedWords.length + ' woord' + (readerSavedWords.length !== 1 ? 'en' : '');
  exportBtn.disabled = readerSavedWords.length === 0;
  if (readerSavedWords.length === 0) {
    list.innerHTML = '<div class="reader-sidebar-empty">&#9997; Klik op woorden in de tekst om ze op te slaan.</div>';
    return;
  }
  list.innerHTML = '';
  for (let i = readerSavedWords.length - 1; i >= 0; i--) {
    const w = readerSavedWords[i];
    const entry = document.createElement('div');
    entry.className = 'reader-word-entry';
    let html = '<div class="reader-we-dutch">' + w.dutch + '</div>';
    if (w.english) html += '<div class="reader-we-english">' + w.english + '</div>';
    if (w.verb) html += '<div class="reader-we-verb">' + w.verb.inf + ' (' + w.verb.en + ')<br>' + w.verb.imp_s + ' / ' + w.verb.imp_p + ' | ' + w.verb.pp + ' | ' + w.verb.aux + '</div>';
    html += '<button class="reader-we-remove" onclick="readerRemoveWord(' + i + ')">&times;</button>';
    entry.innerHTML = html;
    list.appendChild(entry);
  }
}

function readerRemoveWord(idx) {
  const word = readerSavedWords[idx];
  readerSavedWords.splice(idx, 1);
  readerPersistWords(); readerRenderWordList();
  if (word) {
    const lower = word.dutch.toLowerCase();
    if (!readerSavedWords.some(w => w.dutch.toLowerCase() === lower)) {
      document.querySelectorAll('.reader-word').forEach(w => { if (w.textContent.toLowerCase() === lower) w.classList.remove('saved'); });
    }
  }
}

function readerClearAllWords() {
  if (readerSavedWords.length === 0) return;
  readerSavedWords = [];
  readerPersistWords(); readerRenderWordList();
  document.querySelectorAll('.reader-word.saved').forEach(w => w.classList.remove('saved'));
}

// Sentence selection
const readerSentenceBtn = document.getElementById('readerSentenceBtn');
const readerSentencePopup = document.getElementById('readerSentencePopup');

document.addEventListener('mouseup', () => {
  const sel = window.getSelection();
  const text = sel?.toString().trim();
  // Only show if selection is within reader tab
  const readerTab = document.getElementById('sub-reader');
  if (!readerTab?.classList.contains('active')) return;
  if (text && text.includes(' ') && text.length > 3) {
    const range = sel.getRangeAt(0);
    const rect = range.getBoundingClientRect();
    readerSentenceBtn.style.left = rect.left + 'px';
    readerSentenceBtn.style.top = (rect.top - 40) + 'px';
    readerSentenceBtn.style.display = 'block';
    readerSentenceBtn.dataset.text = text;
  } else {
    readerSentenceBtn.style.display = 'none';
  }
});
document.addEventListener('mousedown', (e) => { if (e.target !== readerSentenceBtn) readerSentenceBtn.style.display = 'none'; });

async function readerTranslateSelection() {
  const text = readerSentenceBtn.dataset.text;
  if (!text) return;
  readerSentenceBtn.style.display = 'none';
  document.getElementById('readerSpOriginal').textContent = text;
  document.getElementById('readerSpTranslation').textContent = 'Vertalen...';
  readerSentencePopup.style.display = 'block';
  try {
    const resp = await fetch('https://api.mymemory.translated.net/get?q=' + encodeURIComponent(text) + '&langpair=nl|en');
    const data = await resp.json();
    document.getElementById('readerSpTranslation').textContent = data.responseData?.translatedText || 'Vertaling niet beschikbaar';
  } catch (e) { document.getElementById('readerSpTranslation').textContent = 'Fout bij vertalen'; }
}

function readerCloseSentencePopup() { readerSentencePopup.style.display = 'none'; }

function readerExportPDF() {
  if (readerSavedWords.length === 0) return;
  let verbRows = '', wordRows = '';
  for (const w of readerSavedWords) {
    if (w.verb) {
      verbRows += '<tr><td style="font-weight:700;color:#1356A2">' + w.dutch + '</td><td>' + w.verb.inf + '</td><td>' + (w.english || w.verb.en) + '</td><td>' + w.verb.imp_s + '</td><td>' + w.verb.imp_p + '</td><td>' + w.verb.pp + '</td><td>' + w.verb.aux + '</td><td>' + w.verb.pattern + '</td></tr>';
    } else {
      wordRows += '<tr><td style="font-weight:700;color:#D40920">' + w.dutch + '</td><td>' + (w.english || '') + '</td></tr>';
    }
  }
  const html = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Woordenlijst \u2014 ' + (readerArticleTitle || 'Tekstlezer') + '</title><link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Syne:wght@400;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet"><style>body{font-family:Inter,sans-serif;max-width:900px;margin:0 auto;padding:40px 20px;color:#111}h1{font-family:Syne,sans-serif;font-size:28px;color:#000;margin-bottom:4px;letter-spacing:3px}.source{font-size:11px;color:#888;margin-bottom:24px;word-break:break-all}.divider{height:4px;background:#000;margin:16px 0 24px}h2{font-family:Syne,sans-serif;font-size:18px;color:#1356A2;margin:28px 0 12px;padding-bottom:6px;border-bottom:3px solid #000}table{width:100%;border-collapse:collapse;margin-bottom:24px;font-size:13px;border:2px solid #000}th{background:#F7D842;color:#000;padding:10px 12px;text-align:left;font-size:11px;letter-spacing:1px;text-transform:uppercase;font-family:Space Grotesk,sans-serif;border-bottom:2px solid #000}td{padding:8px 12px;border-bottom:1px solid #ddd}tr:nth-child(even){background:#f9f9f9}.footer{margin-top:40px;text-align:center;font-size:11px;color:#888;font-style:italic;padding-top:16px;border-top:3px solid #000}@media print{body{padding:20px}}</style></head><body><h1>WOORDENLIJST</h1>' + (readerArticleTitle ? '<p style="font-size:15px;color:#D40920;font-weight:600;margin-bottom:4px">' + readerArticleTitle + '</p>' : '') + (readerArticleUrl ? '<p class="source">' + readerArticleUrl + '</p>' : '') + '<div class="divider"></div>' + (wordRows ? '<h2>Woorden</h2><table><thead><tr><th>Nederlands</th><th>Engels</th></tr></thead><tbody>' + wordRows + '</tbody></table>' : '') + (verbRows ? '<h2>Werkwoorden</h2><table><thead><tr><th>Gevonden</th><th>Infinitief</th><th>Engels</th><th>Imp. (ik)</th><th>Imp. (wij)</th><th>V.D.</th><th>Hulpww.</th><th>Patroon</th></tr></thead><tbody>' + verbRows + '</tbody></table>' : '') + '<div class="footer">\u201CThe words rearrange themselves when you are not looking.\u201D<br>Gegenereerd door TEKSTLEZER \u2014 DUTCHMAXXING</div></body></html>';
  const w = window.open('', '_blank');
  w.document.write(html); w.document.close();
  setTimeout(() => w.print(), 500);
}

function initReader() { readerRenderWordList(); }
document.getElementById('readerUrlInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') readerFetchArticle(); });

// ==========================================
// CEFR LEVEL SELECTOR
// ==========================================
const CEFR_ORDER = ['A2','B1','B2','C1'];
let selectedCEFR = 'B2';
let cefrExclusive = false;

function initCEFR() {
  try { selectedCEFR = localStorage.getItem('dutchquest_cefr') || 'B2'; } catch(e){}
  try { cefrExclusive = localStorage.getItem('dutchquest_cefr_exclusive') === 'true'; } catch(e){}
  const cb = document.getElementById('cefrExclusive');
  if (cb) cb.checked = cefrExclusive;
  updateCEFRButtons();
}

function setCEFR(level) {
  selectedCEFR = level;
  try { localStorage.setItem('dutchquest_cefr', level); } catch(e){}
  updateCEFRButtons();
  refreshActiveTab();
}

function toggleCEFRExclusive(checked) {
  cefrExclusive = checked;
  try { localStorage.setItem('dutchquest_cefr_exclusive', checked ? 'true' : 'false'); } catch(e){}
  refreshActiveTab();
}

function updateCEFRButtons() {
  document.querySelectorAll('.cefr-btn').forEach(b => b.classList.toggle('active', b.dataset.level === selectedCEFR));
}

function isWithinCEFR(itemLevel) {
  if (!itemLevel) return true;
  if (cefrExclusive) return itemLevel === selectedCEFR;
  return CEFR_ORDER.indexOf(itemLevel) <= CEFR_ORDER.indexOf(selectedCEFR);
}

function refreshActiveTab() {
  const activeBtn = document.querySelector('.tab-btn.active');
  if (!activeBtn) return;
  const tab = activeBtn.dataset.tab;
  if (tab === 'oefeningen') {
    const activeSub = document.querySelector('#tab-oefeningen .subtab-btn.active');
    if (activeSub) {
      const sub = activeSub.dataset.subtab;
      if (sub === 'arena') initArena();
      else if (sub === 'adventure') initAdventure();
      else if (sub === 'daily') initDaily();
      else if (sub === 'reader') initReader();
    }
  } else if (tab === 'news') { initNews(); }
  else if (tab === 'vocab') { vocabInitialized = false; initVocab(); renderVocabList(); }
}

function updateCEFRBarVisibility() {
  const bar = document.getElementById('cefrBar');
  if (!bar) return;
  const activeBtn = document.querySelector('.tab-btn.active');
  bar.style.display = (activeBtn && activeBtn.dataset.tab === 'spiekbriefjes') ? 'none' : '';
}

// ==========================================
// TAB SWITCHING
// ==========================================

// Main tab init functions mapped by subtab ID
const SUBTAB_INIT = {
  arena: initArena,
  adventure: initAdventure,
  daily: initDaily,
  reader: initReader,
  sheets: initSheets,
  'sheets-prep': () => initSheetsPrepGrid(),
  phrases: initPhrases,
  grammar: initGrammar,
};

// Main tab switching
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    btn.classList.add('active');
    const tabEl = document.getElementById('tab-' + btn.dataset.tab);
    tabEl.classList.add('active');
    // Init the active subtab within this main tab (if any)
    const activeSubBtn = tabEl.querySelector('.subtab-btn.active');
    if (activeSubBtn) {
      const fn = SUBTAB_INIT[activeSubBtn.dataset.subtab];
      if (fn) fn();
    }
    // Direct init for tabs without subtabs
    if (btn.dataset.tab === 'spel') initSpel();
    if (btn.dataset.tab === 'news') initNews();
    if (btn.dataset.tab === 'vocab') initVocab();
    updateCEFRBarVisibility();
  });
});

// Subtab switching
function switchSubtab(mainTabId, subtabId) {
  const mainTab = document.getElementById('tab-' + mainTabId);
  if (!mainTab) return;
  mainTab.querySelectorAll('.subtab-btn').forEach(b => b.classList.remove('active'));
  mainTab.querySelectorAll('.subtab-content').forEach(c => c.classList.remove('active'));
  const btn = mainTab.querySelector('.subtab-btn[data-subtab="' + subtabId + '"]');
  if (btn) btn.classList.add('active');
  const content = document.getElementById('sub-' + subtabId);
  if (content) content.classList.add('active');
  const fn = SUBTAB_INIT[subtabId];
  if (fn) fn();
}

document.querySelectorAll('.subtab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    switchSubtab(btn.dataset.maintab, btn.dataset.subtab);
  });
});

// Preposition sheets grid init
function initSheetsPrepGrid() {
  const grid = document.getElementById('sheetsPrepGrid');
  if (!grid || grid.children.length > 0) return;
  const preps = {};
  PREPOSITION_VERBS.forEach(pv => {
    if (!preps[pv.prep]) preps[pv.prep] = [];
    preps[pv.prep].push(pv);
  });
  let html = '';
  for (const [prep, verbs] of Object.entries(preps).sort((a, b) => b[1].length - a[1].length)) {
    html += '<div class="sheet-card" onclick="generatePrepSheet(\'' + prep + '\')">';
    html += '<div class="sheet-card-icon">&#128221;</div>';
    html += '<div class="sheet-card-title">Voorzetsels: ' + prep + '</div>';
    html += '<div class="sheet-card-desc">Werkwoorden met vast voorzetsel "' + prep + '"</div>';
    html += '<div class="sheet-card-count">' + verbs.length + ' werkwoorden</div>';
    html += '</div>';
  }
  grid.innerHTML = html;
}

function generatePrepSheet(prep) {
  const verbs = PREPOSITION_VERBS.filter(pv => pv.prep === prep);
  let rows = '<table><tr><th>Werkwoord + Voorzetsel</th><th>Engels</th><th>Voorbeeld</th></tr>';
  verbs.forEach(v => {
    rows += '<tr><td><strong>' + v.phrase + '</strong></td><td>' + v.en + '</td><td>' + (v.example || '') + '</td></tr>';
  });
  rows += '</table>';
  rows += '<div class="tip">Totaal: ' + verbs.length + ' werkwoorden met "' + prep + '"</div>';
  generatePDFContent('Vaste Voorzetsels — ' + prep, rows);
}

// ==========================================
// INIT
// ==========================================
loadState();
initCEFR();
initArena();

// ==========================================
// TAB 7: WOORDENSCHAT
// ==========================================
let vocabInitialized = false;
let vocabListMode = 'verbs';
let vocabActiveFilter = null;
let vocabExScore = { correct: 0, total: 0 };
let vocabCurrentExercise = null;

function initVocab() {
  if (!vocabInitialized) {
    document.getElementById('vocabVerbCount').textContent = VERBS.filter(v => isWithinCEFR(v.level)).length;
    document.getElementById('vocabPrepCount').textContent = PREPOSITION_VERBS.filter(v => isWithinCEFR(v.level)).length;
    vocabInitialized = true;
  }
  const activeSub = document.querySelector('.vocab-sub-content.active');
  if (activeSub && activeSub.id === 'vocab-exercise' && !vocabCurrentExercise) {
    nextVocabExercise();
  }
}

function switchVocabSub(sub) {
  document.querySelectorAll('.vocab-sub-btn').forEach(b => b.classList.remove('active'));
  document.querySelector('.vocab-sub-btn[data-vsub="'+sub+'"]').classList.add('active');
  document.querySelectorAll('.vocab-sub-content').forEach(c => c.classList.remove('active'));
  document.getElementById('vocab-'+sub).classList.add('active');
  if (sub === 'list') renderVocabList();
  if (sub === 'exercise' && !vocabCurrentExercise) nextVocabExercise();
}

function switchVocabList(mode) {
  vocabListMode = mode;
  vocabActiveFilter = null;
  document.querySelectorAll('.vocab-list-btn').forEach(b => b.classList.remove('active'));
  document.querySelector('.vocab-list-btn[data-vlist="'+mode+'"]').classList.add('active');
  document.getElementById('vocabSearch').value = '';
  renderVocabList();
}

function renderVocabList() {
  const search = (document.getElementById('vocabSearch').value || '').toLowerCase().trim();
  const wrap = document.getElementById('vocabTableWrap');
  const chipWrap = document.getElementById('vocabFilterChips');

  if (vocabListMode === 'verbs') {
    // Pattern filter chips
    const cefrVerbs = VERBS.filter(v => isWithinCEFR(v.level));
    const patterns = [...new Set(cefrVerbs.map(v => v.pattern))];
    chipWrap.innerHTML = '<span class="vocab-chip'+(vocabActiveFilter===null?' active':'')+'" onclick="vocabActiveFilter=null;document.querySelectorAll(\'.vocab-chip\').forEach(c=>c.classList.remove(\'active\'));this.classList.add(\'active\');renderVocabList()">Alle</span>';
    for (const p of patterns) {
      const pi = VERB_PATTERNS[p];
      if (!pi) continue;
      chipWrap.innerHTML += '<span class="vocab-chip'+(vocabActiveFilter===p?' active':'')+'" style="border-color:'+pi.color+'" onclick="vocabActiveFilter=\''+p+'\';document.querySelectorAll(\'.vocab-chip\').forEach(c=>c.classList.remove(\'active\'));this.classList.add(\'active\');renderVocabList()">'+pi.label+'</span>';
    }

    let verbs = cefrVerbs;
    if (vocabActiveFilter) verbs = verbs.filter(v => v.pattern === vocabActiveFilter);
    if (search) verbs = verbs.filter(v => v.inf.includes(search) || v.en.includes(search) || v.pp.includes(search));

    let html = '<table class="vocab-table"><thead><tr><th>Werkwoord</th><th>Engels</th><th>Imp. (ik)</th><th>V.D.</th><th>Hulpww.</th><th>Patroon</th></tr></thead><tbody>';
    for (const v of verbs) {
      const pi = VERB_PATTERNS[v.pattern];
      html += '<tr><td class="vt-dutch">'+v.inf+'</td><td>'+v.en+'</td><td>'+v.imp_s+'</td><td>'+v.pp+'</td><td>'+v.aux+'</td><td><span class="vt-pattern" style="color:'+(pi?pi.color:'var(--muted)')+'">'+(pi?pi.label:v.pattern)+'</span></td></tr>';
    }
    html += '</tbody></table>';
    wrap.innerHTML = html;
  } else {
    // Prep filter chips
    const cefrPreps = PREPOSITION_VERBS.filter(v => isWithinCEFR(v.level));
    const preps = [...new Set(cefrPreps.map(v => v.prep))].sort();
    chipWrap.innerHTML = '<span class="vocab-chip'+(vocabActiveFilter===null?' active':'')+'" onclick="vocabActiveFilter=null;document.querySelectorAll(\'.vocab-chip\').forEach(c=>c.classList.remove(\'active\'));this.classList.add(\'active\');renderVocabList()">Alle</span>';
    for (const p of preps) {
      chipWrap.innerHTML += '<span class="vocab-chip'+(vocabActiveFilter===p?' active':'')+'" onclick="vocabActiveFilter=\''+p+'\';document.querySelectorAll(\'.vocab-chip\').forEach(c=>c.classList.remove(\'active\'));this.classList.add(\'active\');renderVocabList()">'+p+'</span>';
    }

    let items = cefrPreps;
    if (vocabActiveFilter) items = items.filter(v => v.prep === vocabActiveFilter);
    if (search) items = items.filter(v => v.phrase.includes(search) || v.en.includes(search) || v.example.toLowerCase().includes(search));

    let html = '<table class="vocab-table"><thead><tr><th>Uitdrukking</th><th>Engels</th><th>Voorzetsel</th><th>Voorbeeld</th></tr></thead><tbody>';
    for (const v of items) {
      html += '<tr><td class="vt-dutch">'+v.phrase+'</td><td>'+v.en+'</td><td class="vt-prep">'+v.prep+'</td><td style="font-size:12px;color:var(--muted)">'+v.example+'</td></tr>';
    }
    html += '</tbody></table>';
    wrap.innerHTML = html;
  }
}

// Exercise logic
function nextVocabExercise() {
  const type = Math.floor(Math.random() * 3); // 0=preposition, 1=complete, 2=translate
  const cefrPool = PREPOSITION_VERBS.filter(v => isWithinCEFR(v.level));
  const item = cefrPool[Math.floor(Math.random() * cefrPool.length)];
  const fb = document.getElementById('vocabExFeedback');
  fb.textContent = '';
  fb.className = 'vocab-exercise-feedback';
  document.getElementById('vocabExInput').value = '';
  document.getElementById('vocabExInput').disabled = false;
  document.getElementById('vocabExNext').style.display = 'none';
  document.getElementById('vocabExInput').focus();

  if (type === 0) {
    // Fill in the preposition
    const sentence = item.example.replace(new RegExp('\\b' + item.prep + '\\b', 'i'), '<span class="blank">___</span>');
    document.getElementById('vocabExType').textContent = 'Vul het voorzetsel in';
    document.getElementById('vocabExPrompt').innerHTML = sentence;
    document.getElementById('vocabExHint').textContent = item.phrase + ' \u2014 ' + item.en;
    vocabCurrentExercise = { type: 0, answer: item.prep.toLowerCase(), item: item };
  } else if (type === 1) {
    // Complete the sentence
    document.getElementById('vocabExType').textContent = 'Maak de zin af';
    document.getElementById('vocabExPrompt').innerHTML = item.example_en;
    document.getElementById('vocabExHint').textContent = 'Vertaal naar Nederlands (' + item.phrase + ')';
    vocabCurrentExercise = { type: 1, answer: item.example.toLowerCase().replace(/[.!?]/g,'').trim(), item: item };
  } else {
    // Translate
    document.getElementById('vocabExType').textContent = 'Vertaal de zin';
    document.getElementById('vocabExPrompt').innerHTML = item.example_en;
    document.getElementById('vocabExHint').textContent = 'Tip: ' + item.phrase;
    vocabCurrentExercise = { type: 2, answer: item.example.toLowerCase().replace(/[.!?]/g,'').trim(), item: item };
  }
}

function checkVocabExercise() {
  if (!vocabCurrentExercise) return;
  const input = document.getElementById('vocabExInput').value.trim().toLowerCase().replace(/[.!?]/g,'').trim();
  if (!input) return;
  const fb = document.getElementById('vocabExFeedback');
  vocabExScore.total++;

  let correct = false;
  if (vocabCurrentExercise.type === 0) {
    correct = input === vocabCurrentExercise.answer;
  } else {
    // For sentence exercises, check if answer is close enough
    const expected = vocabCurrentExercise.answer;
    correct = input === expected || levenshteinDistance(input, expected) <= Math.max(2, Math.floor(expected.length * 0.15));
  }

  if (correct) {
    vocabExScore.correct++;
    fb.textContent = 'Goed! \u2714';
    fb.className = 'vocab-exercise-feedback correct';
  } else {
    fb.innerHTML = 'Helaas. Het juiste antwoord: <strong>' + (vocabCurrentExercise.type === 0 ? vocabCurrentExercise.answer : vocabCurrentExercise.item.example) + '</strong>';
    fb.className = 'vocab-exercise-feedback incorrect';
  }

  document.getElementById('vocabExCorrect').textContent = vocabExScore.correct;
  document.getElementById('vocabExTotal').textContent = vocabExScore.total;
  document.getElementById('vocabExInput').disabled = true;
  document.getElementById('vocabExNext').style.display = 'inline-block';
  addXP(correct ? 15 : 3);
}

function levenshteinDistance(a, b) {
  const m = a.length, n = b.length;
  const dp = Array.from({length: m+1}, () => Array(n+1).fill(0));
  for (let i = 0; i <= m; i++) dp[i][0] = i;
  for (let j = 0; j <= n; j++) dp[0][j] = j;
  for (let i = 1; i <= m; i++) {
    for (let j = 1; j <= n; j++) {
      dp[i][j] = Math.min(dp[i-1][j]+1, dp[i][j-1]+1, dp[i-1][j-1] + (a[i-1]!==b[j-1]?1:0));
    }
  }
  return dp[m][n];
}

document.getElementById('vocabExInput').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    if (document.getElementById('vocabExInput').disabled) nextVocabExercise();
    else checkVocabExercise();
  }
});

// ==========================================
// TAB 8: SPIEKBRIEFJES (CHEAT SHEETS)
// ==========================================
let sheetsInitialized = false;
let sheetWordTab = 'verbs';
let sheetSelectedVerbs = new Set();
let sheetSelectedPreps = new Set();
let sheetCustomWords = [];
let sheetActiveFilter = null;

function initSheets() {
  if (sheetsInitialized) return;
  sheetsInitialized = true;
  renderSheetCards();
  renderSheetDownloadGrid();
  renderSheetWordList();
  renderSheetFilterChips();

  document.querySelectorAll('.sheets-layout-card').forEach(card => {
    card.addEventListener('click', () => {
      document.querySelectorAll('.sheets-layout-card').forEach(c => c.classList.remove('active'));
      card.classList.add('active');
    });
  });
}

function switchSheetSub(sub) {
  document.querySelectorAll('.sheets-sub-btn').forEach(b => b.classList.remove('active'));
  document.querySelector('.sheets-sub-btn[data-ssub="'+sub+'"]').classList.add('active');
  document.querySelectorAll('.sheets-sub-content').forEach(c => c.classList.remove('active'));
  document.getElementById('sheets-' + sub).classList.add('active');
}

function switchSheetWordTab(tab) {
  sheetWordTab = tab;
  sheetActiveFilter = null;
  document.querySelectorAll('.sheets-word-tab').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.sheets-word-tab').forEach(b => {
    if ((tab === 'verbs' && b.textContent === 'Werkwoorden') || (tab === 'prep' && b.textContent === 'Vaste Voorzetsels')) b.classList.add('active');
  });
  document.getElementById('sheetsSearch').value = '';
  renderSheetFilterChips();
  renderSheetWordList();
}

function renderSheetFilterChips() {
  const container = document.getElementById('sheetsFilterChips');
  if (sheetWordTab === 'verbs') {
    const patterns = [...new Set(VERBS.map(v => v.pattern))];
    container.innerHTML = patterns.map(p => {
      const pi = VERB_PATTERNS[p];
      return '<span class="sheets-filter-chip' + (sheetActiveFilter === p ? ' active' : '') + '" onclick="toggleSheetFilter(\'' + p + '\')">' + pi.label + '</span>';
    }).join('');
  } else {
    const preps = [...new Set(PREPOSITION_VERBS.map(v => v.prep))].sort();
    container.innerHTML = preps.map(p =>
      '<span class="sheets-filter-chip' + (sheetActiveFilter === p ? ' active' : '') + '" onclick="toggleSheetFilter(\'' + p + '\')">' + p + '</span>'
    ).join('');
  }
}

function toggleSheetFilter(f) {
  sheetActiveFilter = sheetActiveFilter === f ? null : f;
  renderSheetFilterChips();
  renderSheetWordList();
}

function renderSheetWordList() {
  const search = (document.getElementById('sheetsSearch')?.value || '').toLowerCase();
  const container = document.getElementById('sheetsWordList');
  let html = '';

  if (sheetWordTab === 'verbs') {
    let items = VERBS;
    if (sheetActiveFilter) items = items.filter(v => v.pattern === sheetActiveFilter);
    if (search) items = items.filter(v => v.inf.toLowerCase().includes(search) || v.en.toLowerCase().includes(search));
    items.forEach(v => {
      const checked = sheetSelectedVerbs.has(v.id) ? 'checked' : '';
      html += '<div class="sheets-word-item" onclick="toggleSheetWord(\'verb\',\'' + v.id + '\')">'
        + '<input type="checkbox" ' + checked + ' tabindex="-1" />'
        + '<span class="sheets-word-nl">' + v.inf + '</span>'
        + '<span class="sheets-word-en">' + v.en + '</span></div>';
    });
  } else {
    let items = PREPOSITION_VERBS;
    if (sheetActiveFilter) items = items.filter(v => v.prep === sheetActiveFilter);
    if (search) items = items.filter(v => v.phrase.toLowerCase().includes(search) || v.en.toLowerCase().includes(search));
    items.forEach(v => {
      const checked = sheetSelectedPreps.has(v.id) ? 'checked' : '';
      html += '<div class="sheets-word-item" onclick="toggleSheetWord(\'prep\',\'' + v.id + '\')">'
        + '<input type="checkbox" ' + checked + ' tabindex="-1" />'
        + '<span class="sheets-word-nl">' + v.phrase + '</span>'
        + '<span class="sheets-word-en">' + v.en + '</span></div>';
    });
  }
  container.innerHTML = html || '<div style="padding:20px;text-align:center;color:#999;">Geen woorden gevonden</div>';
  updateSheetCount();
}

function toggleSheetWord(type, id) {
  const set = type === 'verb' ? sheetSelectedVerbs : sheetSelectedPreps;
  if (set.has(id)) set.delete(id); else set.add(id);
  renderSheetWordList();
}

function sheetSelectAll() {
  if (sheetWordTab === 'verbs') {
    const search = (document.getElementById('sheetsSearch')?.value || '').toLowerCase();
    let items = VERBS;
    if (sheetActiveFilter) items = items.filter(v => v.pattern === sheetActiveFilter);
    if (search) items = items.filter(v => v.inf.toLowerCase().includes(search) || v.en.toLowerCase().includes(search));
    items.forEach(v => sheetSelectedVerbs.add(v.id));
  } else {
    const search = (document.getElementById('sheetsSearch')?.value || '').toLowerCase();
    let items = PREPOSITION_VERBS;
    if (sheetActiveFilter) items = items.filter(v => v.prep === sheetActiveFilter);
    if (search) items = items.filter(v => v.phrase.toLowerCase().includes(search) || v.en.toLowerCase().includes(search));
    items.forEach(v => sheetSelectedPreps.add(v.id));
  }
  renderSheetWordList();
}

function sheetSelectNone() {
  if (sheetWordTab === 'verbs') sheetSelectedVerbs.clear();
  else sheetSelectedPreps.clear();
  renderSheetWordList();
}

function updateSheetCount() {
  const count = sheetSelectedVerbs.size + sheetSelectedPreps.size + sheetCustomWords.length;
  document.getElementById('sheetsSelectedCount').textContent = count + ' woorden geselecteerd';
}

function addCustomWord() {
  const nl = document.getElementById('sheetsCustomNL').value.trim();
  const en = document.getElementById('sheetsCustomEN').value.trim();
  if (!nl) return;
  sheetCustomWords.push({ nl, en: en || '—' });
  document.getElementById('sheetsCustomNL').value = '';
  document.getElementById('sheetsCustomEN').value = '';
  renderCustomWordList();
  updateSheetCount();
}

function removeCustomWord(i) {
  sheetCustomWords.splice(i, 1);
  renderCustomWordList();
  updateSheetCount();
}

function renderCustomWordList() {
  document.getElementById('sheetsCustomList').innerHTML = sheetCustomWords.map((w, i) =>
    '<span class="sheets-custom-tag">' + w.nl + ' — ' + w.en + '<button onclick="removeCustomWord(' + i + ')">&#215;</button></span>'
  ).join('');
}

// ==========================================
// READY-MADE SHEET TEMPLATES
// ==========================================
const SHEET_TEMPLATES = [
  { id: 'pattern', icon: '&#127912;', title: 'Werkwoorden per patroon', desc: 'Gegroepeerd op klinkerverandering met kleurcodering', countFn: () => VERBS.length + ' werkwoorden' },
  { id: 'hebben_zijn', icon: '&#9878;', title: 'Hebben vs. Zijn', desc: 'Twee kolommen: werkwoorden met "heeft" vs "is"', countFn: () => VERBS.length + ' werkwoorden' },
  { id: 'alpha', icon: '&#128218;', title: 'Onregelmatig — Alfabet', desc: 'Alle onregelmatige werkwoorden op alfabetische volgorde', countFn: () => VERBS.filter(v => v.pattern !== 'regular').length + ' werkwoorden' },
  { id: 'prep_by_prep', icon: '&#128279;', title: 'Voorzetsels per voorzetsel', desc: 'Vaste voorzetsels gegroepeerd per voorzetsel', countFn: () => PREPOSITION_VERBS.length + ' uitdrukkingen' },
  { id: 'prep_alpha', icon: '&#128214;', title: 'Voorzetsels — Alfabet', desc: 'Alle vaste voorzetsels op alfabetische volgorde', countFn: () => PREPOSITION_VERBS.length + ' uitdrukkingen' },
  { id: 'flashcards', icon: '&#127183;', title: 'Compact Flashcard Grid', desc: 'Uitknipbare flashcards: infinitief | imperfectum | voltooid deelwoord', countFn: () => VERBS.length + ' kaarten' },
  { id: 'wrong', icon: '&#10060;', title: 'Mijn Fouten', desc: 'Werkwoorden die je fout hebt beantwoord, gesorteerd op aantal fouten', countFn: () => { const n = VERBS.filter(v => { const h = state.verbHistory[v.id]; return h && h.wrong > 0; }).length; return n + ' werkwoorden'; } },
  { id: 'separable', icon: '&#9986;', title: 'Scheidbare Werkwoorden', desc: 'Werkwoorden die scheidbaar zijn met gescheiden vormen', countFn: () => getSeparableVerbs().length + ' werkwoorden' },
];

function getSeparableVerbs() {
  return VERBS.filter(v => {
    if (v.imp_s && v.imp_s.includes(' ')) return true;
    if (v.pp && v.pp.includes('ge') && v.inf.length > 4) {
      const prefix = v.inf.replace(/[a-z]*$/, '');
      if (v.pp.includes(prefix) && v.pp !== 'ge' + v.inf.replace(/en$/, '') + 'd' && v.pp !== 'ge' + v.inf.replace(/en$/, '') + 't') {
        return v.imp_s && v.imp_s.includes(' ');
      }
    }
    return false;
  });
}

function renderSheetCards() {
  document.getElementById('sheetsGrid').innerHTML = SHEET_TEMPLATES.map(t =>
    '<div class="sheet-card" onclick="generateReadySheet(\'' + t.id + '\')">'
    + '<div class="sheet-card-icon">' + t.icon + '</div>'
    + '<div class="sheet-card-title">' + t.title + '</div>'
    + '<div class="sheet-card-desc">' + t.desc + '</div>'
    + '<div class="sheet-card-count">' + t.countFn() + '</div></div>'
  ).join('');
}

function generateReadySheet(id) {
  switch(id) {
    case 'pattern': exportAllVerbs(); break;
    case 'hebben_zijn': generateSheetHebbenZijn(); break;
    case 'alpha': generateSheetAlphabetical(); break;
    case 'prep_by_prep': generateSheetPrepByPrep(); break;
    case 'prep_alpha': generateSheetPrepAlpha(); break;
    case 'flashcards': generateSheetFlashcards(VERBS); break;
    case 'wrong': exportWrongVerbs(); break;
    case 'separable': generateSheetSeparable(); break;
  }
}

// ==========================================
// PDF GENERATORS
// ==========================================
function generateSheetHebbenZijn() {
  const heeft = VERBS.filter(v => v.aux.includes('heeft') && !v.aux.includes('is')).sort((a,b) => a.inf.localeCompare(b.inf));
  const is = VERBS.filter(v => v.aux.includes('is') && !v.aux.includes('heeft')).sort((a,b) => a.inf.localeCompare(b.inf));
  const both = VERBS.filter(v => v.aux.includes('/') || (v.aux.includes('heeft') && v.aux.includes('is'))).sort((a,b) => a.inf.localeCompare(b.inf));

  let rows = '<div style="display:flex;gap:20px;flex-wrap:wrap;">';
  rows += '<div style="flex:1;min-width:280px;"><h2 style="color:#1356A2;">HEEFT (' + heeft.length + ')</h2>';
  rows += '<table><tr><th>Infinitief</th><th>Engels</th><th>V.D.</th></tr>';
  heeft.forEach(v => { rows += '<tr><td><strong>' + v.inf + '</strong></td><td>' + v.en + '</td><td>' + v.pp + '</td></tr>'; });
  rows += '</table></div>';

  rows += '<div style="flex:1;min-width:280px;"><h2 style="color:#D40920;">IS (' + is.length + ')</h2>';
  rows += '<table><tr><th>Infinitief</th><th>Engels</th><th>V.D.</th></tr>';
  is.forEach(v => { rows += '<tr><td><strong>' + v.inf + '</strong></td><td>' + v.en + '</td><td>' + v.pp + '</td></tr>'; });
  rows += '</table></div></div>';

  if (both.length > 0) {
    rows += '<h2 style="color:#b08600;">HEEFT / IS (' + both.length + ')</h2>';
    rows += '<table><tr><th>Infinitief</th><th>Engels</th><th>V.D.</th><th>Hulpww.</th></tr>';
    both.forEach(v => { rows += '<tr><td><strong>' + v.inf + '</strong></td><td>' + v.en + '</td><td>' + v.pp + '</td><td>' + v.aux + '</td></tr>'; });
    rows += '</table>';
  }
  rows += '<div class="tip">Tip: Werkwoorden van beweging/verandering gebruiken vaak "zijn".</div>';
  generatePDFContent('Hebben vs. Zijn', rows);
}

function generateSheetAlphabetical() {
  const irregular = VERBS.filter(v => v.pattern !== 'regular').sort((a,b) => a.inf.localeCompare(b.inf));
  let rows = '<div class="tip">' + irregular.length + ' onregelmatige werkwoorden op alfabetische volgorde</div>';
  rows += '<table><tr><th>Infinitief</th><th>Engels</th><th>Imp. (ik)</th><th>Imp. (wij)</th><th>Volt. deelw.</th><th>Hulpww.</th><th>Patroon</th></tr>';
  irregular.forEach(v => {
    const p = VERB_PATTERNS[v.pattern];
    rows += '<tr><td><strong>' + v.inf + '</strong></td><td>' + v.en + '</td><td>' + v.imp_s + '</td><td>' + v.imp_p + '</td><td>' + v.pp + '</td><td>' + v.aux + '</td><td><span class="pattern-label" style="background:' + p.color + '">' + p.label + '</span></td></tr>';
  });
  rows += '</table>';
  generatePDFContent('Onregelmatige Werkwoorden — Alfabetisch', rows);
}

function generateSheetPrepByPrep() {
  const grouped = {};
  PREPOSITION_VERBS.forEach(v => { if (!grouped[v.prep]) grouped[v.prep] = []; grouped[v.prep].push(v); });
  const preps = Object.keys(grouped).sort();
  let rows = '';
  preps.forEach(prep => {
    const items = grouped[prep].sort((a,b) => a.phrase.localeCompare(b.phrase));
    rows += '<h2 style="color:#1356A2;text-transform:uppercase;">' + prep + ' (' + items.length + ')</h2>';
    rows += '<table><tr><th>Uitdrukking</th><th>Engels</th><th>Voorbeeld</th></tr>';
    items.forEach(v => { rows += '<tr><td><strong>' + v.phrase + '</strong></td><td>' + v.en + '</td><td style="font-style:italic;color:#666;">' + v.example + '</td></tr>'; });
    rows += '</table>';
  });
  rows += '<div class="tip">Totaal: ' + PREPOSITION_VERBS.length + ' vaste voorzetsels</div>';
  generatePDFContent('Vaste Voorzetsels — Per Voorzetsel', rows);
}

function generateSheetPrepAlpha() {
  const sorted = [...PREPOSITION_VERBS].sort((a,b) => a.phrase.localeCompare(b.phrase));
  let rows = '<table><tr><th>Uitdrukking</th><th>Engels</th><th>Voorzetsel</th><th>Voorbeeld</th></tr>';
  sorted.forEach(v => {
    rows += '<tr><td><strong>' + v.phrase + '</strong></td><td>' + v.en + '</td><td style="color:#D40920;font-weight:700;">' + v.prep + '</td><td style="font-style:italic;color:#666;">' + v.example + '</td></tr>';
  });
  rows += '</table>';
  rows += '<div class="tip">Totaal: ' + sorted.length + ' vaste voorzetsels</div>';
  generatePDFContent('Vaste Voorzetsels — Alfabetisch', rows);
}

function generateSheetFlashcards(verbs) {
  let rows = '<style>.fc-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:0;}.fc-card{border:2px dashed #999;padding:12px 10px;text-align:center;page-break-inside:avoid;}.fc-inf{font-weight:700;font-size:14px;color:#000;}.fc-en{font-size:10px;color:#666;margin:4px 0;}.fc-forms{font-size:11px;color:#1356A2;}.fc-aux{font-size:9px;color:#D40920;margin-top:2px;}</style>';
  rows += '<div class="fc-grid">';
  verbs.forEach(v => {
    rows += '<div class="fc-card"><div class="fc-inf">' + v.inf + '</div><div class="fc-en">' + v.en + '</div><div class="fc-forms">' + v.imp_s + ' / ' + v.pp + '</div><div class="fc-aux">' + v.aux + '</div></div>';
  });
  rows += '</div>';
  rows += '<div class="tip">Knip langs de stippellijnen voor flashcards. ' + verbs.length + ' kaarten.</div>';
  generatePDFContent('Flashcards — Werkwoorden', rows);
}

function generateSheetSeparable() {
  const sep = getSeparableVerbs().sort((a,b) => a.inf.localeCompare(b.inf));
  if (sep.length === 0) { alert('Geen scheidbare werkwoorden gevonden.'); return; }
  let rows = '<div class="tip">' + sep.length + ' scheidbare werkwoorden — let op de woordvolgorde!</div>';
  rows += '<table><tr><th>Infinitief</th><th>Engels</th><th>Gescheiden (imp.)</th><th>Volt. deelw.</th></tr>';
  sep.forEach(v => {
    rows += '<tr><td><strong>' + v.inf + '</strong></td><td>' + v.en + '</td><td>' + v.imp_s + '</td><td>' + v.pp + '</td></tr>';
  });
  rows += '</table>';
  generatePDFContent('Scheidbare Werkwoorden', rows);
}

function generateSheetCombined() {
  let rows = '<h2 style="color:#D40920;">WERKWOORDEN (' + VERBS.length + ')</h2>';
  const grouped = {};
  VERBS.forEach(v => { if (!grouped[v.pattern]) grouped[v.pattern] = []; grouped[v.pattern].push(v); });
  for (const [patKey, verbs] of Object.entries(grouped)) {
    const p = VERB_PATTERNS[patKey];
    rows += '<h3><span class="pattern-label" style="background:' + p.color + '">' + p.label + '</span> ' + p.example + '</h3>';
    rows += '<table><tr><th>Infinitief</th><th>Engels</th><th>Imp. (ik)</th><th>V.D.</th><th>Hulpww.</th></tr>';
    verbs.forEach(v => { rows += '<tr><td><strong>' + v.inf + '</strong></td><td>' + v.en + '</td><td>' + v.imp_s + '</td><td>' + v.pp + '</td><td>' + v.aux + '</td></tr>'; });
    rows += '</table>';
  }
  rows += '<h2 style="color:#1356A2;margin-top:30px;">VASTE VOORZETSELS (' + PREPOSITION_VERBS.length + ')</h2>';
  const prepGrouped = {};
  PREPOSITION_VERBS.forEach(v => { if (!prepGrouped[v.prep]) prepGrouped[v.prep] = []; prepGrouped[v.prep].push(v); });
  for (const [prep, items] of Object.entries(prepGrouped)) {
    rows += '<h3 style="text-transform:uppercase;">' + prep + '</h3>';
    rows += '<table><tr><th>Uitdrukking</th><th>Engels</th><th>Voorbeeld</th></tr>';
    items.forEach(v => { rows += '<tr><td><strong>' + v.phrase + '</strong></td><td>' + v.en + '</td><td style="font-style:italic;">' + v.example + '</td></tr>'; });
    rows += '</table>';
  }
  rows += '<div class="tip">Totaal: ' + VERBS.length + ' werkwoorden + ' + PREPOSITION_VERBS.length + ' vaste voorzetsels</div>';
  generatePDFContent('Alles Samen — Compleet Overzicht', rows);
}

// ==========================================
// CUSTOM SHEET BUILDER
// ==========================================
function generateCustomSheet() {
  const selVerbs = VERBS.filter(v => sheetSelectedVerbs.has(v.id));
  const selPreps = PREPOSITION_VERBS.filter(v => sheetSelectedPreps.has(v.id));
  const total = selVerbs.length + selPreps.length + sheetCustomWords.length;
  if (total === 0) { alert('Selecteer eerst woorden om te downloaden.'); return; }

  const layout = document.querySelector('input[name="sheetLayout"]:checked')?.value || 'table';
  let rows = '';

  if (layout === 'table') {
    if (selVerbs.length > 0) {
      rows += '<h2>Werkwoorden (' + selVerbs.length + ')</h2>';
      rows += '<table><tr><th>Infinitief</th><th>Engels</th><th>Imp. (ik)</th><th>Imp. (wij)</th><th>Volt. deelw.</th><th>Hulpww.</th></tr>';
      selVerbs.forEach(v => { rows += '<tr><td><strong>' + v.inf + '</strong></td><td>' + v.en + '</td><td>' + v.imp_s + '</td><td>' + v.imp_p + '</td><td>' + v.pp + '</td><td>' + v.aux + '</td></tr>'; });
      rows += '</table>';
    }
    if (selPreps.length > 0) {
      rows += '<h2>Vaste Voorzetsels (' + selPreps.length + ')</h2>';
      rows += '<table><tr><th>Uitdrukking</th><th>Engels</th><th>Voorzetsel</th><th>Voorbeeld</th></tr>';
      selPreps.forEach(v => { rows += '<tr><td><strong>' + v.phrase + '</strong></td><td>' + v.en + '</td><td style="color:#D40920;font-weight:700;">' + v.prep + '</td><td style="font-style:italic;">' + v.example + '</td></tr>'; });
      rows += '</table>';
    }
    if (sheetCustomWords.length > 0) {
      rows += '<h2>Eigen Woorden (' + sheetCustomWords.length + ')</h2>';
      rows += '<table><tr><th>Nederlands</th><th>Engels</th></tr>';
      sheetCustomWords.forEach(w => { rows += '<tr><td><strong>' + w.nl + '</strong></td><td>' + w.en + '</td></tr>'; });
      rows += '</table>';
    }
  } else if (layout === 'flashcards') {
    rows += '<style>.fc-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:0;}.fc-card{border:2px dashed #999;padding:12px 10px;text-align:center;page-break-inside:avoid;}.fc-inf{font-weight:700;font-size:14px;}.fc-en{font-size:10px;color:#666;margin:4px 0;}.fc-forms{font-size:11px;color:#1356A2;}.fc-aux{font-size:9px;color:#D40920;margin-top:2px;}</style>';
    rows += '<div class="fc-grid">';
    selVerbs.forEach(v => { rows += '<div class="fc-card"><div class="fc-inf">' + v.inf + '</div><div class="fc-en">' + v.en + '</div><div class="fc-forms">' + v.imp_s + ' / ' + v.pp + '</div><div class="fc-aux">' + v.aux + '</div></div>'; });
    selPreps.forEach(v => { rows += '<div class="fc-card"><div class="fc-inf">' + v.phrase + '</div><div class="fc-en">' + v.en + '</div><div class="fc-forms">' + v.prep + '</div></div>'; });
    sheetCustomWords.forEach(w => { rows += '<div class="fc-card"><div class="fc-inf">' + w.nl + '</div><div class="fc-en">' + w.en + '</div></div>'; });
    rows += '</div>';
  } else if (layout === 'mindmap') {
    if (selVerbs.length > 0) {
      const grouped = {};
      selVerbs.forEach(v => { if (!grouped[v.pattern]) grouped[v.pattern] = []; grouped[v.pattern].push(v); });
      rows += '<h2>Werkwoorden — Gegroepeerd</h2>';
      for (const [patKey, verbs] of Object.entries(grouped)) {
        const p = VERB_PATTERNS[patKey];
        rows += '<div style="margin:16px 0;padding:12px;border-left:6px solid ' + p.color + ';background:#fafafa;">';
        rows += '<h3 style="margin:0 0 8px;"><span class="pattern-label" style="background:' + p.color + '">' + p.label + '</span></h3>';
        rows += '<div style="display:flex;flex-wrap:wrap;gap:8px;">';
        verbs.forEach(v => { rows += '<span style="background:#fff;border:1px solid #ddd;padding:4px 10px;font-size:13px;"><strong>' + v.inf + '</strong> <span style="color:#666;">(' + v.en + ')</span></span>'; });
        rows += '</div></div>';
      }
    }
    if (selPreps.length > 0) {
      const grouped = {};
      selPreps.forEach(v => { if (!grouped[v.prep]) grouped[v.prep] = []; grouped[v.prep].push(v); });
      rows += '<h2>Vaste Voorzetsels — Gegroepeerd</h2>';
      for (const [prep, items] of Object.entries(grouped)) {
        rows += '<div style="margin:16px 0;padding:12px;border-left:6px solid #1356A2;background:#fafafa;">';
        rows += '<h3 style="margin:0 0 8px;color:#1356A2;text-transform:uppercase;">' + prep + '</h3>';
        rows += '<div style="display:flex;flex-wrap:wrap;gap:8px;">';
        items.forEach(v => { rows += '<span style="background:#fff;border:1px solid #ddd;padding:4px 10px;font-size:13px;"><strong>' + v.phrase + '</strong> <span style="color:#666;">(' + v.en + ')</span></span>'; });
        rows += '</div></div>';
      }
    }
    if (sheetCustomWords.length > 0) {
      rows += '<div style="margin:16px 0;padding:12px;border-left:6px solid #F7D842;background:#fafafa;">';
      rows += '<h3 style="margin:0 0 8px;">Eigen Woorden</h3>';
      rows += '<div style="display:flex;flex-wrap:wrap;gap:8px;">';
      sheetCustomWords.forEach(w => { rows += '<span style="background:#fff;border:1px solid #ddd;padding:4px 10px;font-size:13px;"><strong>' + w.nl + '</strong> <span style="color:#666;">(' + w.en + ')</span></span>'; });
      rows += '</div></div>';
    }
  } else if (layout === 'twocol') {
    rows += '<style>.tc-grid{display:grid;grid-template-columns:1fr 1fr;border:2px solid #000;}.tc-header{background:#F7D842;padding:8px 12px;font-weight:700;border-bottom:2px solid #000;}.tc-left{padding:6px 12px;border-right:2px solid #000;border-bottom:1px solid #eee;font-weight:600;}.tc-right{padding:6px 12px;border-bottom:1px solid #eee;color:#666;}</style>';
    rows += '<div class="tip">Vouw het blad in de helft om jezelf te testen!</div>';
    rows += '<div class="tc-grid"><div class="tc-header" style="border-right:2px solid #000;">Nederlands</div><div class="tc-header">Engels</div>';
    selVerbs.forEach(v => { rows += '<div class="tc-left">' + v.inf + '</div><div class="tc-right">' + v.en + '</div>'; });
    selPreps.forEach(v => { rows += '<div class="tc-left">' + v.phrase + '</div><div class="tc-right">' + v.en + '</div>'; });
    sheetCustomWords.forEach(w => { rows += '<div class="tc-left">' + w.nl + '</div><div class="tc-right">' + w.en + '</div>'; });
    rows += '</div>';
  } else if (layout === 'sentences') {
    if (selVerbs.length > 0) {
      rows += '<h2>Werkwoorden met voorbeelden</h2>';
      selVerbs.forEach(v => {
        rows += '<div style="margin:10px 0;padding:10px;border-left:4px solid #1356A2;background:#fafafa;">';
        rows += '<div style="font-weight:700;font-size:14px;">' + v.inf + ' <span style="color:#666;font-weight:400;">— ' + v.en + '</span></div>';
        rows += '<div style="font-size:12px;color:#555;margin-top:4px;">Imp: ' + v.imp_s + ' / ' + v.imp_p + ' | V.D.: ' + v.pp + ' | ' + v.aux + '</div>';
        rows += '</div>';
      });
    }
    if (selPreps.length > 0) {
      rows += '<h2>Vaste Voorzetsels met voorbeelden</h2>';
      selPreps.forEach(v => {
        rows += '<div style="margin:10px 0;padding:10px;border-left:4px solid #D40920;background:#fafafa;">';
        rows += '<div style="font-weight:700;font-size:14px;">' + v.phrase + ' <span style="color:#666;font-weight:400;">— ' + v.en + '</span></div>';
        rows += '<div style="font-size:12px;color:#555;margin-top:4px;font-style:italic;">' + v.example + '</div>';
        rows += '<div style="font-size:11px;color:#888;margin-top:2px;">' + v.example_en + '</div>';
        rows += '</div>';
      });
    }
    if (sheetCustomWords.length > 0) {
      rows += '<h2>Eigen Woorden</h2>';
      sheetCustomWords.forEach(w => {
        rows += '<div style="margin:10px 0;padding:10px;border-left:4px solid #F7D842;background:#fafafa;">';
        rows += '<div style="font-weight:700;font-size:14px;">' + w.nl + ' <span style="color:#666;font-weight:400;">— ' + w.en + '</span></div>';
        rows += '</div>';
      });
    }
  }

  rows += '<div class="tip">Totaal: ' + total + ' woorden</div>';
  generatePDFContent('Mijn Spiekbriefje', rows);
}

// ==========================================
// DOWNLOAD ALL GRID
// ==========================================
const DOWNLOAD_ALL_ITEMS = [
  { title: 'Alle werkwoorden (tabel)', desc: 'Volledige werkwoordentabel met alle vormen', countFn: () => VERBS.length, fn: () => { let rows = '<table><tr><th>Infinitief</th><th>Engels</th><th>Imp. (ik)</th><th>Imp. (wij)</th><th>Volt. deelw.</th><th>Hulpww.</th><th>Patroon</th></tr>'; VERBS.sort((a,b)=>a.inf.localeCompare(b.inf)).forEach(v => { const p = VERB_PATTERNS[v.pattern]; rows += '<tr><td><strong>' + v.inf + '</strong></td><td>' + v.en + '</td><td>' + v.imp_s + '</td><td>' + v.imp_p + '</td><td>' + v.pp + '</td><td>' + v.aux + '</td><td><span class="pattern-label" style="background:'+p.color+'">'+p.label+'</span></td></tr>'; }); rows += '</table><div class="tip">Totaal: '+VERBS.length+' werkwoorden</div>'; generatePDFContent('Alle Werkwoorden — Tabel', rows); } },
  { title: 'Alle werkwoorden (flashcards)', desc: 'Uitknipbare flashcards voor alle werkwoorden', countFn: () => VERBS.length, fn: () => generateSheetFlashcards(VERBS) },
  { title: 'Alle werkwoorden (per patroon)', desc: 'Gegroepeerd op klinkerverandering', countFn: () => VERBS.length, fn: () => exportAllVerbs() },
  { title: 'Alle vaste voorzetsels (tabel)', desc: 'Alfabetische lijst van alle vaste voorzetsels', countFn: () => PREPOSITION_VERBS.length, fn: () => generateSheetPrepAlpha() },
  { title: 'Alle vaste voorzetsels (per voorzetsel)', desc: 'Gegroepeerd per voorzetsel', countFn: () => PREPOSITION_VERBS.length, fn: () => generateSheetPrepByPrep() },
  { title: 'Alles samen', desc: 'Alle werkwoorden + alle vaste voorzetsels gecombineerd', countFn: () => VERBS.length + PREPOSITION_VERBS.length, fn: () => generateSheetCombined() },
];

function renderSheetDownloadGrid() {
  document.getElementById('sheetsDownloadGrid').innerHTML = DOWNLOAD_ALL_ITEMS.map((item, i) =>
    '<div class="sheets-dl-card">'
    + '<div class="sheets-dl-title">' + item.title + '</div>'
    + '<div class="sheets-dl-desc">' + item.desc + ' (' + item.countFn() + ' woorden)</div>'
    + '<button class="sheets-dl-btn" onclick="DOWNLOAD_ALL_ITEMS[' + i + '].fn()">Download PDF</button></div>'
  ).join('');
}

// ==========================================
// TAB 9: UITDRUKKINGEN (PHRASES)
// ==========================================
const PHRASES = [
  // === MENING (Opinion) ===
  { nl:'Ik ben het (helemaal) met je eens', en:'I (completely) agree with you', cat:'opinion', example:'Ik ben het helemaal met je eens dat we meer moeten investeren.', example_en:'I completely agree with you that we need to invest more.', level:'B1' },
  { nl:'Ik ben het niet met je eens', en:'I disagree with you', cat:'opinion', example:'Sorry, maar ik ben het niet met je eens.', example_en:'Sorry, but I disagree with you.', level:'B1' },
  { nl:'Naar mijn mening...', en:'In my opinion...', cat:'opinion', example:'Naar mijn mening moeten we anders aanpakken.', example_en:'In my opinion we need to approach this differently.', level:'B1' },
  { nl:'Ik vind dat...', en:'I think that...', cat:'opinion', example:'Ik vind dat iedereen gelijke kansen moet krijgen.', example_en:'I think everyone should get equal opportunities.', level:'B1' },
  { nl:'Wat mij betreft...', en:'As far as I\'m concerned...', cat:'opinion', example:'Wat mij betreft gaan we morgen al beginnen.', example_en:'As far as I\'m concerned we start tomorrow.' , level:'B1' },
  { nl:'Ik denk eerlijk gezegd dat...', en:'Honestly, I think that...', cat:'opinion', example:'Ik denk eerlijk gezegd dat het te duur is.', example_en:'Honestly, I think it\'s too expensive.' , level:'B1' },
  { nl:'Aan de ene kant... aan de andere kant...', en:'On the one hand... on the other hand...', cat:'opinion', example:'Aan de ene kant is het handig, aan de andere kant kost het veel tijd.', example_en:'On the one hand it\'s convenient, on the other hand it takes a lot of time.' , level:'B1' },
  { nl:'Dat hangt ervan af', en:'That depends', cat:'opinion', example:'Dat hangt ervan af of het morgen regent.', example_en:'That depends on whether it rains tomorrow.', level:'B1' },
  { nl:'Je hebt gelijk', en:'You\'re right', cat:'opinion', example:'Je hebt gelijk, ik had dat anders moeten doen.', example_en:'You\'re right, I should have done that differently.' , level:'B1' },
  { nl:'Daar ben ik het niet mee eens', en:'I don\'t agree with that', cat:'opinion', example:'Daar ben ik het niet mee eens, want de cijfers laten iets anders zien.', example_en:'I don\'t agree with that, because the numbers show something different.' , level:'B1' },
  { nl:'Ik sta er anders tegenover', en:'I see it differently', cat:'opinion', example:'Interessant, maar ik sta er anders tegenover.', example_en:'Interesting, but I see it differently.', level:'B1' },
  { nl:'Dat is een goed punt', en:'That\'s a good point', cat:'opinion', example:'Dat is een goed punt, daar had ik niet aan gedacht.', example_en:'That\'s a good point, I hadn\'t thought of that.' , level:'B1' },

  // === GESPREK (Conversation) ===
  { nl:'Dat doet me denken aan...', en:'That reminds me of...', cat:'conversation', example:'Dat doet me denken aan mijn tijd in Texel.', example_en:'That reminds me of my time in Texel.', level:'B1' },
  { nl:'Trouwens,...', en:'By the way,...', cat:'conversation', example:'Trouwens, heb je dat bericht al gezien?', example_en:'By the way, have you seen that message yet?', level:'B1' },
  { nl:'Hoe bedoel je?', en:'What do you mean?', cat:'conversation', example:'Hoe bedoel je precies? Kun je dat uitleggen?', example_en:'What exactly do you mean? Can you explain that?', level:'B1' },
  { nl:'Dat klopt', en:'That\'s correct', cat:'conversation', example:'Ja, dat klopt helemaal.', example_en:'Yes, that\'s exactly right.' , level:'B1' },
  { nl:'Klopt het dat...?', en:'Is it true that...?', cat:'conversation', example:'Klopt het dat je volgend jaar gaat verhuizen?', example_en:'Is it true that you\'re moving next year?' , level:'B1' },
  { nl:'Waar het op neerkomt is...', en:'What it comes down to is...', cat:'conversation', example:'Waar het op neerkomt is dat we te weinig geld hebben.', example_en:'What it comes down to is that we don\'t have enough money.' , level:'B1' },
  { nl:'Om eerlijk te zijn...', en:'To be honest...', cat:'conversation', example:'Om eerlijk te zijn vond ik het niet zo leuk.', example_en:'To be honest I didn\'t enjoy it much.' , level:'B1' },
  { nl:'Mag ik je iets vragen?', en:'May I ask you something?', cat:'conversation', example:'Mag ik je iets vragen? Hoe lang woon je hier al?', example_en:'May I ask you something? How long have you lived here?', level:'B1' },
  { nl:'Het punt is dat...', en:'The point is that...', cat:'conversation', example:'Het punt is dat we niet genoeg tijd hebben.', example_en:'The point is that we don\'t have enough time.' , level:'B1' },
  { nl:'Zo te zien...', en:'By the looks of it...', cat:'conversation', example:'Zo te zien wordt het mooi weer vandaag.', example_en:'By the looks of it, the weather will be nice today.', level:'B1' },
  { nl:'Laat ik het zo zeggen...', en:'Let me put it this way...', cat:'conversation', example:'Laat ik het zo zeggen: het was geen succes.', example_en:'Let me put it this way: it was not a success.', level:'B1' },
  { nl:'Weet je wat ik bedoel?', en:'Do you know what I mean?', cat:'conversation', example:'Het is moeilijk uit te leggen, weet je wat ik bedoel?', example_en:'It\'s hard to explain, do you know what I mean?' , level:'B1' },
  { nl:'Dat is precies wat ik wilde zeggen', en:'That\'s exactly what I wanted to say', cat:'conversation', example:'Ja! Dat is precies wat ik wilde zeggen.', example_en:'Yes! That\'s exactly what I wanted to say.' , level:'B1' },
  { nl:'Ik wilde nog even zeggen dat...', en:'I just wanted to say that...', cat:'conversation', example:'Ik wilde nog even zeggen dat de vergadering is verplaatst.', example_en:'I just wanted to say that the meeting has been moved.', level:'B1' },

  // === VOEGWOORDEN (Connectors/Conjunctions) ===
  { nl:'zodra', en:'as soon as', cat:'connectors', example:'Zodra ik thuiskom, bel ik je.', example_en:'As soon as I get home, I\'ll call you.' , level:'B1' },
  { nl:'terwijl', en:'while / whereas', cat:'connectors', example:'Terwijl ik kookte, las hij de krant.', example_en:'While I was cooking, he read the newspaper.', level:'B1' },
  { nl:'hoewel / alhoewel', en:'although', cat:'connectors', example:'Hoewel het regende, gingen we toch wandelen.', example_en:'Although it was raining, we went for a walk anyway.', level:'B1' },
  { nl:'omdat / doordat', en:'because', cat:'connectors', example:'Ik ben te laat omdat de trein vertraging had.', example_en:'I\'m late because the train was delayed.' , level:'B1' },
  { nl:'tenzij', en:'unless', cat:'connectors', example:'We gaan picknicken, tenzij het regent.', example_en:'We\'re going for a picnic, unless it rains.' , level:'B1' },
  { nl:'mits', en:'provided that', cat:'connectors', example:'Je mag mee, mits je je gedraagt.', example_en:'You can come along, provided you behave.', level:'B1' },
  { nl:'zolang', en:'as long as', cat:'connectors', example:'Zolang je je best doet, ben ik tevreden.', example_en:'As long as you do your best, I\'m satisfied.' , level:'B1' },
  { nl:'voordat / voor', en:'before', cat:'connectors', example:'Voordat je weggaat, ruim even op.', example_en:'Before you leave, tidy up.', level:'B1' },
  { nl:'nadat / na', en:'after', cat:'connectors', example:'Nadat we hadden gegeten, gingen we wandelen.', example_en:'After we had eaten, we went for a walk.', level:'B1' },
  { nl:'totdat / tot', en:'until', cat:'connectors', example:'Wacht hier totdat ik terugkom.', example_en:'Wait here until I come back.', level:'B1' },
  { nl:'doordat', en:'because (cause-effect)', cat:'connectors', example:'Doordat de weg was afgesloten, moesten we omrijden.', example_en:'Because the road was closed, we had to take a detour.', level:'B1' },
  { nl:'waardoor', en:'as a result of which', cat:'connectors', example:'Het regende hard, waardoor de wedstrijd werd afgelast.', example_en:'It rained hard, as a result of which the match was cancelled.', level:'B1' },
  { nl:'zodat', en:'so that', cat:'connectors', example:'Ik ben vroeg opgestaan zodat ik de trein kon halen.', example_en:'I got up early so that I could catch the train.', level:'B1' },
  { nl:'aangezien', en:'since/given that', cat:'connectors', example:'Aangezien je al klaar bent, kun je me helpen.', example_en:'Since you\'re already done, you can help me.' , level:'B1' },
  { nl:'naarmate', en:'as / the more... the more', cat:'connectors', example:'Naarmate je ouder wordt, leer je meer.', example_en:'As you get older, you learn more.', level:'B1' },
  { nl:'ofwel... ofwel...', en:'either... or...', cat:'connectors', example:'Je kunt ofwel de trein ofwel de bus nemen.', example_en:'You can take either the train or the bus.', level:'B1' },
  { nl:'noch... noch...', en:'neither... nor...', cat:'connectors', example:'Hij spreekt noch Frans noch Duits.', example_en:'He speaks neither French nor German.', level:'B1' },
  { nl:'niet alleen... maar ook...', en:'not only... but also...', cat:'connectors', example:'Ze is niet alleen slim, maar ook heel aardig.', example_en:'She is not only smart, but also very kind.', level:'B1' },
  { nl:'hoe... hoe...', en:'the more... the more...', cat:'connectors', example:'Hoe meer je oefent, hoe beter je wordt.', example_en:'The more you practice, the better you get.', level:'B1' },
  { nl:'namelijk', en:'namely / that is to say', cat:'connectors', example:'Ik kan niet komen, ik moet namelijk werken.', example_en:'I can\'t come, I have to work, you see.' , level:'B1' },
  { nl:'overigens', en:'by the way / incidentally', cat:'connectors', example:'Overigens, heb je al gehoord over de nieuwe regeling?', example_en:'By the way, have you heard about the new regulation?', level:'B1' },
  { nl:'daarentegen', en:'on the other hand / in contrast', cat:'connectors', example:'Het eten was matig; de bediening was daarentegen uitstekend.', example_en:'The food was mediocre; the service, on the other hand, was excellent.', level:'B1' },
  { nl:'desondanks / desalniettemin', en:'nevertheless / nonetheless', cat:'connectors', example:'Het was moeilijk; desondanks zijn we doorgegaan.', example_en:'It was difficult; nevertheless we continued.', level:'B1' },
  { nl:'vandaar dat...', en:'that\'s why...', cat:'connectors', example:'Ik had haast, vandaar dat ik niet heb gebeld.', example_en:'I was in a hurry, that\'s why I didn\'t call.' , level:'B1' },

  // === TIJD (Time expressions) ===
  { nl:'Toen ik in... was', en:'When I was in...', cat:'time', example:'Toen ik in Texel was, heb ik veel gefietst.', example_en:'When I was in Texel, I cycled a lot.', level:'B1' },
  { nl:'In die tijd...', en:'At that time...', cat:'time', example:'In die tijd woonde ik nog in Amsterdam.', example_en:'At that time I still lived in Amsterdam.', level:'B1' },
  { nl:'Sindsdien...', en:'Since then...', cat:'time', example:'Sindsdien heb ik hem niet meer gezien.', example_en:'Since then I haven\'t seen him again.' , level:'B1' },
  { nl:'Tegenwoordig...', en:'Nowadays...', cat:'time', example:'Tegenwoordig werkt iedereen vanuit huis.', example_en:'Nowadays everyone works from home.', level:'B1' },
  { nl:'Vroeger...', en:'In the past... / Used to...', cat:'time', example:'Vroeger ging ik elke zomer naar het strand.', example_en:'I used to go to the beach every summer.', level:'B1' },
  { nl:'Uiteindelijk...', en:'Eventually...', cat:'time', example:'Uiteindelijk hebben we een oplossing gevonden.', example_en:'Eventually we found a solution.', level:'B1' },
  { nl:'Op een gegeven moment...', en:'At some point...', cat:'time', example:'Op een gegeven moment besloot ik te stoppen.', example_en:'At some point I decided to stop.', level:'B1' },
  { nl:'Het duurde lang voordat...', en:'It took a long time before...', cat:'time', example:'Het duurde lang voordat ik aan het weer gewend was.', example_en:'It took a long time before I got used to the weather.', level:'B1' },
  { nl:'Van tevoren', en:'Beforehand / in advance', cat:'time', example:'Laat het me van tevoren weten.', example_en:'Let me know beforehand.', level:'B1' },
  { nl:'Achteraf gezien...', en:'In hindsight...', cat:'time', example:'Achteraf gezien had ik anders moeten handelen.', example_en:'In hindsight I should have acted differently.', level:'B1' },
  { nl:'In eerste instantie...', en:'Initially...', cat:'time', example:'In eerste instantie leek het een goed idee.', example_en:'Initially it seemed like a good idea.', level:'B1' },
  { nl:'Ten eerste... ten tweede... ten derde...', en:'Firstly... secondly... thirdly...', cat:'time', example:'Ten eerste moet je je inschrijven, ten tweede moet je betalen.', example_en:'Firstly you need to register, secondly you need to pay.', level:'B1' },
  { nl:'Allereerst...', en:'First of all...', cat:'time', example:'Allereerst wil ik jullie bedanken.', example_en:'First of all, I want to thank you.', level:'B1' },
  { nl:'Vervolgens...', en:'Then / Next...', cat:'time', example:'Vervolgens gingen we naar het museum.', example_en:'Then we went to the museum.', level:'B1' },
  { nl:'Daarna...', en:'After that...', cat:'time', example:'Daarna heb ik een kop koffie gedronken.', example_en:'After that I drank a cup of coffee.', level:'B1' },
  { nl:'Tot slot...', en:'Finally / In conclusion...', cat:'time', example:'Tot slot wil ik nog één ding zeggen.', example_en:'Finally, I want to say one more thing.', level:'B1' },
  { nl:'Ondertussen...', en:'Meanwhile...', cat:'time', example:'Ondertussen was het al donker geworden.', example_en:'Meanwhile it had already gotten dark.', level:'B1' },
  { nl:'Inmiddels...', en:'By now / In the meantime...', cat:'time', example:'Inmiddels woon ik al drie jaar in Nederland.', example_en:'By now I have been living in the Netherlands for three years.', level:'B1' },
  { nl:'Destijds...', en:'At that time / Back then...', cat:'time', example:'Destijds was er nog geen internet.', example_en:'Back then there was no internet yet.', level:'B1' },
  { nl:'Voordat... / Voorafgaand aan...', en:'Before... / Prior to...', cat:'time', example:'Voordat je begint, lees eerst de instructies.', example_en:'Before you start, read the instructions first.', level:'B1' },
  { nl:'Nadat...', en:'After...', cat:'time', example:'Nadat hij was afgestudeerd, ging hij reizen.', example_en:'After he graduated, he went traveling.', level:'B1' },
  { nl:'Terwijl...', en:'While...', cat:'time', example:'Terwijl ik kookte, ruimde hij de kamer op.', example_en:'While I was cooking, he tidied up the room.', level:'B1' },
  { nl:'Zodra...', en:'As soon as...', cat:'time', example:'Zodra het stopt met regenen, gaan we naar buiten.', example_en:'As soon as it stops raining, we\'ll go outside.' , level:'B1' },
  { nl:'Pas toen... / Pas nadat...', en:'Only when... / Only after...', cat:'time', example:'Pas toen ik in Nederland woonde, begreep ik het poldermodel.', example_en:'Only when I lived in the Netherlands did I understand the polder model.', level:'B1' },

  // === EMOTIE (Emotion) ===
  { nl:'Wat leuk!', en:'How nice!', cat:'emotion', example:'Wat leuk dat je komt!', example_en:'How nice that you\'re coming!' , level:'B1' },
  { nl:'Wat jammer!', en:'What a pity!', cat:'emotion', example:'Wat jammer dat het niet is gelukt.', example_en:'What a pity that it didn\'t work out.' , level:'B1' },
  { nl:'Ik baal ervan dat...', en:'I\'m annoyed that...', cat:'emotion', example:'Ik baal ervan dat de trein weer vertraging heeft.', example_en:'I\'m annoyed that the train is delayed again.' , level:'B1' },
  { nl:'Ik ben er trots op dat...', en:'I\'m proud that...', cat:'emotion', example:'Ik ben er trots op dat ik het heb gehaald.', example_en:'I\'m proud that I made it.' , level:'B1' },
  { nl:'Ik maak me zorgen over...', en:'I\'m worried about...', cat:'emotion', example:'Ik maak me zorgen over de toekomst.', example_en:'I\'m worried about the future.' , level:'B1' },
  { nl:'Ik kijk ernaar uit', en:'I\'m looking forward to it', cat:'emotion', example:'De vakantie begint morgen — ik kijk ernaar uit!', example_en:'The holiday starts tomorrow — I\'m looking forward to it!' , level:'B1' },
  { nl:'Ik heb er genoeg van', en:'I\'ve had enough of it', cat:'emotion', example:'Ik heb er genoeg van om altijd te moeten wachten.', example_en:'I\'ve had enough of always having to wait.' , level:'B1' },
  { nl:'Ik ben er kapot van', en:'I\'m devastated by it', cat:'emotion', example:'Ze is er kapot van dat haar kat is weggelopen.', example_en:'She\'s devastated that her cat ran away.' , level:'B1' },
  { nl:'Het valt me op dat...', en:'I notice that...', cat:'emotion', example:'Het valt me op dat je er moe uitziet.', example_en:'I notice that you look tired.', level:'B1' },
  { nl:'Gelukkig...', en:'Fortunately...', cat:'emotion', example:'Gelukkig was het niet ernstig.', example_en:'Fortunately it wasn\'t serious.' , level:'B1' },
  { nl:'Helaas...', en:'Unfortunately...', cat:'emotion', example:'Helaas kan ik niet komen.', example_en:'Unfortunately I can\'t come.' , level:'B1' },

  // === ARGUMENTATIE (Argumentation) ===
  { nl:'Ten eerste... ten tweede... ten derde...', en:'Firstly... secondly... thirdly...', cat:'argument', example:'Ten eerste is het te duur, ten tweede is het onpraktisch.', example_en:'Firstly it\'s too expensive, secondly it\'s impractical.' , level:'B2' },
  { nl:'Bovendien...', en:'Moreover... / Besides...', cat:'argument', example:'Bovendien hebben we niet genoeg personeel.', example_en:'Moreover, we don\'t have enough staff.' , level:'B2' },
  { nl:'Daarnaast...', en:'In addition...', cat:'argument', example:'Daarnaast zijn er ook nog andere problemen.', example_en:'In addition, there are also other problems.', level:'B2' },
  { nl:'Sterker nog...', en:'Even more so... / What\'s more...', cat:'argument', example:'Hij was niet blij. Sterker nog, hij was woedend.', example_en:'He wasn\'t happy. What\'s more, he was furious.' , level:'B2' },
  { nl:'Met andere woorden...', en:'In other words...', cat:'argument', example:'Met andere woorden, we moeten opnieuw beginnen.', example_en:'In other words, we need to start again.', level:'B2' },
  { nl:'Samengevat...', en:'In summary...', cat:'argument', example:'Samengevat: we hebben meer tijd en geld nodig.', example_en:'In summary: we need more time and money.', level:'B2' },
  { nl:'Kortom...', en:'In short...', cat:'argument', example:'Kortom, het was een geweldige ervaring.', example_en:'In short, it was a great experience.', level:'B2' },
  { nl:'Dit betekent dat...', en:'This means that...', cat:'argument', example:'Dit betekent dat we het plan moeten aanpassen.', example_en:'This means we need to adjust the plan.', level:'B2' },
  { nl:'Het gevolg is dat...', en:'The consequence is that...', cat:'argument', example:'Het gevolg is dat steeds meer mensen hun baan verliezen.', example_en:'The consequence is that more and more people lose their job.', level:'B2' },
  { nl:'Enerzijds... anderzijds...', en:'On the one hand... on the other hand...', cat:'argument', example:'Enerzijds is het handig, anderzijds is het duur.', example_en:'On the one hand it\'s useful, on the other hand it\'s expensive.' , level:'B2' },
  { nl:'In tegenstelling tot...', en:'In contrast to...', cat:'argument', example:'In tegenstelling tot vorig jaar is de werkloosheid gedaald.', example_en:'In contrast to last year, unemployment has decreased.', level:'B2' },
  { nl:'Vergeleken met...', en:'Compared to...', cat:'argument', example:'Vergeleken met andere landen is Nederland klein.', example_en:'Compared to other countries, the Netherlands is small.', level:'B2' },
  { nl:'Ondanks het feit dat...', en:'Despite the fact that...', cat:'argument', example:'Ondanks het feit dat het regende, ging de markt door.', example_en:'Despite the fact that it rained, the market continued.', level:'B2' },

  // === FORMEEL (Formal) ===
  { nl:'Zou u mij kunnen vertellen...', en:'Could you tell me...', cat:'formal', example:'Zou u mij kunnen vertellen waar het station is?', example_en:'Could you tell me where the station is?', level:'B2' },
  { nl:'Ik zou graag willen weten...', en:'I would like to know...', cat:'formal', example:'Ik zou graag willen weten wanneer de cursus begint.', example_en:'I would like to know when the course starts.', level:'B2' },
  { nl:'Met betrekking tot...', en:'With regard to...', cat:'formal', example:'Met betrekking tot uw klacht willen wij het volgende meedelen.', example_en:'With regard to your complaint, we would like to communicate the following.', level:'B2' },
  { nl:'Naar aanleiding van...', en:'In response to... / Following...', cat:'formal', example:'Naar aanleiding van ons gesprek stuur ik u deze e-mail.', example_en:'Following our conversation, I am sending you this email.', level:'B2' },
  { nl:'Bij voorbaat dank', en:'Thank you in advance', cat:'formal', example:'Bij voorbaat dank voor uw medewerking.', example_en:'Thank you in advance for your cooperation.', level:'B2' },
  { nl:'Met vriendelijke groet', en:'Kind regards', cat:'formal', example:'Met vriendelijke groet, Jan de Vries.', example_en:'Kind regards, Jan de Vries.', level:'B2' },
  { nl:'Ik wil u erop wijzen dat...', en:'I would like to point out that...', cat:'formal', example:'Ik wil u erop wijzen dat de deadline volgende week is.', example_en:'I would like to point out that the deadline is next week.', level:'B2' },
  { nl:'Het is van belang dat...', en:'It is important that...', cat:'formal', example:'Het is van belang dat alle documenten op tijd worden ingeleverd.', example_en:'It is important that all documents are submitted on time.', level:'B2' },
  { nl:'Indien nodig...', en:'If necessary...', cat:'formal', example:'Indien nodig kunnen we een extra vergadering plannen.', example_en:'If necessary, we can schedule an additional meeting.', level:'B2' },
  { nl:'Gelieve...', en:'Please (formal)...', cat:'formal', example:'Gelieve het formulier volledig in te vullen.', example_en:'Please fill in the form completely.', level:'B2' },
  { nl:'Hierbij...', en:'Hereby... / Enclosed...', cat:'formal', example:'Hierbij stuur ik u de gevraagde documenten.', example_en:'Hereby I send you the requested documents.', level:'B2' },

  // === SPREEKWOORDEN & GEZEGDEN (Proverbs & Idioms) ===
  { nl:'Oost west, thuis best', en:'East west, home is best', cat:'idiom', example:'Na drie weken vakantie: oost west, thuis best.', example_en:'After three weeks of holiday: there\'s no place like home.' , level:'B1' },
  { nl:'De appel valt niet ver van de boom', en:'The apple doesn\'t fall far from the tree', cat:'idiom', example:'Hij is net zo eigenwijs als zijn vader — de appel valt niet ver van de boom.', example_en:'He\'s just as stubborn as his father — like father, like son.' , level:'B1' },
  { nl:'Wie het laatst lacht, lacht het best', en:'He who laughs last, laughs best', cat:'idiom', example:'Ze lachten me uit, maar wie het laatst lacht, lacht het best.', example_en:'They laughed at me, but he who laughs last, laughs best.', level:'B1' },
  { nl:'Beter laat dan nooit', en:'Better late than never', cat:'idiom', example:'Je bent twee uur te laat! Nou ja, beter laat dan nooit.', example_en:'You\'re two hours late! Well, better late than never.' , level:'B1' },
  { nl:'Dat is mosterd na de maaltijd', en:'That\'s too late / closing the barn door after the horse has bolted', cat:'idiom', example:'Ze boden hun excuses aan, maar dat was mosterd na de maaltijd.', example_en:'They offered apologies, but it was too little too late.', level:'B1' },
  { nl:'Er zijn kapers op de kust', en:'There are rivals / watch out for competition', cat:'idiom', example:'Pas op, er zijn kapers op de kust.', example_en:'Watch out, there\'s competition.' , level:'B1' },
  { nl:'Met de deur in huis vallen', en:'To get straight to the point', cat:'idiom', example:'Ik val maar met de deur in huis: we moeten praten.', example_en:'I\'ll get straight to the point: we need to talk.' , level:'B1' },
  { nl:'Dat is een ander koek', en:'That\'s a different matter', cat:'idiom', example:'Theorie is leuk, maar de praktijk is een ander koek.', example_en:'Theory is fine, but practice is a different story.', level:'B1' },
  { nl:'Wie A zegt, moet ook B zeggen', en:'If you start something, you have to finish it', cat:'idiom', example:'Je bent ermee begonnen, dus wie A zegt, moet ook B zeggen.', example_en:'You started it, so you have to follow through.', level:'B1' },
  { nl:'Van het een komt het ander', en:'One thing leads to another', cat:'idiom', example:'We begonnen met koffie en van het een kwam het ander.', example_en:'We started with coffee and one thing led to another.', level:'B1' },
  { nl:'Iets door de vingers zien', en:'To turn a blind eye', cat:'idiom', example:'De leraar zag het door de vingers.', example_en:'The teacher turned a blind eye.', level:'B1' },
  { nl:'Op de hoogte zijn', en:'To be informed / up to date', cat:'idiom', example:'Ik ben op de hoogte van de situatie.', example_en:'I am informed about the situation.', level:'B1' },
  { nl:'Het roer omgooien', en:'To change course drastically', cat:'idiom', example:'Na zijn ontslag besloot hij het roer om te gooien.', example_en:'After being fired he decided to make a drastic change.', level:'B1' },
  { nl:'Iemand een hart onder de riem steken', en:'To encourage someone', cat:'idiom', example:'Ik wilde je even een hart onder de riem steken.', example_en:'I wanted to encourage you.', level:'B1' },
  { nl:'De knoop doorhakken', en:'To make a decision / cut the knot', cat:'idiom', example:'We moeten nu de knoop doorhakken.', example_en:'We need to make a decision now.', level:'B1' },
];

const PHRASE_CAT_LABELS = {
  opinion: 'Mening', conversation: 'Gesprek', connectors: 'Voegwoorden',
  time: 'Tijd', emotion: 'Emotie', argument: 'Argumentatie',
  formal: 'Formeel', idiom: 'Spreekwoorden'
};

let phrasesInitialized = false;
let phrasesCat = 'all';

function initPhrases() {
  if (phrasesInitialized) return;
  phrasesInitialized = true;
  renderPhrases();
}

function switchPhrasesCat(cat) {
  phrasesCat = cat;
  document.querySelectorAll('.phrases-cat-btn').forEach(b => b.classList.remove('active'));
  document.querySelector('.phrases-cat-btn[data-pcat="'+cat+'"]').classList.add('active');
  renderPhrases();
}

function renderPhrases() {
  const search = (document.getElementById('phrasesSearch')?.value || '').toLowerCase();
  let items = PHRASES;
  if (phrasesCat !== 'all') items = items.filter(p => p.cat === phrasesCat);
  if (search) items = items.filter(p => p.nl.toLowerCase().includes(search) || p.en.toLowerCase().includes(search));

  document.getElementById('phrasesList').innerHTML = items.map(p =>
    '<div class="phrase-card" data-cat="' + p.cat + '">'
    + '<span class="phrase-cat-label">' + (PHRASE_CAT_LABELS[p.cat] || p.cat) + '</span>'
    + '<div class="phrase-nl">' + p.nl + '</div>'
    + '<div class="phrase-en">' + p.en + '</div>'
    + '<div class="phrase-example">' + p.example + '</div>'
    + '<div class="phrase-example-en">' + p.example_en + '</div>'
    + '</div>'
  ).join('') || '<div style="padding:20px;text-align:center;color:#999;">Geen uitdrukkingen gevonden</div>';
}

function exportPhrases() {
  let rows = '';
  const cats = [...new Set(PHRASES.map(p => p.cat))];
  cats.forEach(cat => {
    const items = PHRASES.filter(p => p.cat === cat);
    rows += '<h2 style="color:#1356A2;text-transform:uppercase;">' + (PHRASE_CAT_LABELS[cat] || cat) + ' (' + items.length + ')</h2>';
    rows += '<table><tr><th>Nederlands</th><th>Engels</th><th>Voorbeeld</th></tr>';
    items.forEach(p => {
      rows += '<tr><td><strong>' + p.nl + '</strong></td><td>' + p.en + '</td><td style="font-style:italic;color:#666;font-size:11px;">' + p.example + '</td></tr>';
    });
    rows += '</table>';
  });
  rows += '<div class="tip">Totaal: ' + PHRASES.length + ' uitdrukkingen</div>';
  generatePDFContent('Uitdrukkingen & Voegwoorden', rows);
}

// ==========================================
// TAB 10: GRAMMATICA
// ==========================================
const GRAMMAR_RULES = [
  // === WERKWOORDEN (Verbs) ===
  {
    id: 'soft_ketchup', cat: 'spelling', icon: '&#127798;',
    title: "'t Kofschip / Soft Ketchup",
    subtitle: 'Wanneer -t of -d in de verleden tijd?',
    accent: '#D40920',
    body: '<div class="gr-mnemonic">\'t&nbsp; K&nbsp; O&nbsp; F&nbsp; S&nbsp; C&nbsp; H&nbsp; I&nbsp; P</div>'
      + '<div class="gr-rule">Als de stam eindigt op een letter uit <strong>\'t kofschip</strong> (t, k, f, s, ch, p) → verleden tijd met <strong>-te / -ten</strong></div>'
      + '<div class="gr-rule">Anders → verleden tijd met <strong>-de / -den</strong></div>'
      + '<div class="gr-example">werk<strong>t</strong>e (stam: werk → k in kofschip ✓)</div>'
      + '<div class="gr-example">leef<strong>d</strong>e (stam: leef... wacht, f zit in kofschip!) → leef<strong>t</strong>e ✓</div>'
      + '<div class="gr-example">woon<strong>d</strong>e (stam: woon → n niet in kofschip → -de ✓)</div>'
      + '<table><tr><th>Stam eindigt op</th><th>Verleden tijd</th><th>Voorbeeld</th></tr>'
      + '<tr><td>t, k, f, s, ch, p</td><td>-<strong>te</strong> / -<strong>ten</strong></td><td>werkte, fietsten</td></tr>'
      + '<tr><td>andere letters</td><td>-<strong>de</strong> / -<strong>den</strong></td><td>woonde, leefden</td></tr></table>'
      + '<div class="gr-rule">Voltooid deelwoord: ge- + stam + <strong>-t</strong> (kofschip) of <strong>-d</strong> (anders)<br>gewerkt, gefietst, gewoond, geleefd</div>'
  },
  {
    id: 'perfectum', cat: 'verbs', icon: '&#9203;',
    title: 'Perfectum (Voltooid Tegenwoordige Tijd)',
    subtitle: 'hebben/zijn + voltooid deelwoord',
    accent: '#1356A2',
    body: '<div class="gr-rule"><strong>hebben / zijn</strong> + voltooid deelwoord</div>'
      + '<div class="gr-example">Ik <strong>heb</strong> een boek <strong>gelezen</strong>.</div>'
      + '<div class="gr-example">Zij <strong>is</strong> naar huis <strong>gegaan</strong>.</div>'
      + '<h4 style="margin:8px 0 4px;">Wanneer ZIJN?</h4>'
      + '<div class="gr-rule">1. Werkwoorden van <strong>beweging</strong> (met richting): gaan, komen, rijden, vliegen, vertrekken<br>'
      + '2. Werkwoorden van <strong>verandering</strong>: worden, groeien, sterven, veranderen<br>'
      + '3. <strong>zijn, blijven, gebeuren</strong></div>'
      + '<div class="gr-rule">Al het andere → <strong>hebben</strong></div>'
      + '<h4 style="margin:8px 0 4px;">Voltooid deelwoord vormen</h4>'
      + '<table><tr><th>Type</th><th>Formule</th><th>Voorbeeld</th></tr>'
      + '<tr><td>Regelmatig</td><td>ge- + stam + -t/-d</td><td>gewerkt, gewoond</td></tr>'
      + '<tr><td>Onregelmatig</td><td>ge- + stam + -en</td><td>geschreven, gelezen</td></tr>'
      + '<tr><td>be-, ver-, ont-, ge-, her-</td><td>GEEN ge-!</td><td>verteld, besloten</td></tr>'
      + '<tr><td>Scheidbaar</td><td>prefix + ge- + stam</td><td>opgebeld, meegenomen</td></tr></table>'
  },
  {
    id: 'imperfectum', cat: 'verbs', icon: '&#128337;',
    title: 'Imperfectum (Onvoltooid Verleden Tijd)',
    subtitle: 'Verleden tijd - regelmatig & onregelmatig',
    accent: '#F7D842',
    body: '<h4 style="margin:0 0 6px;">Regelmatig (\'t kofschip)</h4>'
      + '<div class="gr-rule">Stam + <strong>-te/-ten</strong> (kofschip) of <strong>-de/-den</strong> (anders)</div>'
      + '<div class="gr-example">ik werk<strong>te</strong>, wij werk<strong>ten</strong></div>'
      + '<div class="gr-example">ik woon<strong>de</strong>, wij woon<strong>den</strong></div>'
      + '<h4 style="margin:8px 0 6px;">Onregelmatig</h4>'
      + '<div class="gr-rule">Klinkerverandering — uit het hoofd leren!</div>'
      + '<table><tr><th>Patroon</th><th>Inf → Imp → V.D.</th><th>Voorbeeld</th></tr>'
      + '<tr><td style="color:#2d8a56;">e→a→e</td><td>eten → at → gegeten</td><td>lezen, geven</td></tr>'
      + '<tr><td style="color:#8B4513;">e→a→o</td><td>spreken → sprak → gesproken</td><td>nemen, breken</td></tr>'
      + '<tr><td style="color:#D40920;">ij→ee→e</td><td>schrijven → schreef → geschreven</td><td>rijden, blijven</td></tr>'
      + '<tr><td style="color:#1356A2;">ie→oo→o</td><td>vliegen → vloog → gevlogen</td><td>bieden, kiezen</td></tr>'
      + '<tr><td style="color:#b08600;">i→o→o</td><td>drinken → dronk → gedronken</td><td>vinden, zingen</td></tr>'
      + '<tr><td style="color:#555;">a→oe→a</td><td>dragen → droeg → gedragen</td><td>slaan, graven</td></tr></table>'
      + '<h4 style="margin:8px 0 6px;">Perfectum vs. Imperfectum</h4>'
      + '<div class="gr-rule"><strong>Perfectum:</strong> afgeronde acties, resultaten (ik heb gegeten)<br>'
      + '<strong>Imperfectum:</strong> verhalen, achtergrond, gewoontes (ik at elke dag een appel)</div>'
  },
  {
    id: 'perf_vs_imp', cat: 'verbs', icon: '&#9201;',
    title: 'Perfectum of Imperfectum?',
    subtitle: 'Wanneer gebruik je welke verleden tijd?',
    accent: '#2d8a56',
    body: '<div class="gr-rule"><strong>Perfectum</strong> (hebben/zijn + voltooid deelwoord) gebruik je bij:</div>'
      + '<table><tr><th>Situatie</th><th>Voorbeeld</th></tr>'
      + '<tr><td>Afgeronde acties met resultaat nu</td><td>Ik <strong>heb</strong> mijn huiswerk <strong>gemaakt</strong>. (het is klaar)</td></tr>'
      + '<tr><td>Gesprekken & alledaagse taal</td><td>Heb je al <strong>gegeten</strong>?</td></tr>'
      + '<tr><td>Recente gebeurtenissen</td><td>De trein <strong>is</strong> net <strong>vertrokken</strong>.</td></tr>'
      + '<tr><td>Ervaring (ooit/nooit)</td><td>Ik <strong>heb</strong> nooit sushi <strong>gegeten</strong>.</td></tr></table>'
      + '<div class="gr-rule" style="margin-top:10px;"><strong>Imperfectum</strong> (verleden tijd) gebruik je bij:</div>'
      + '<table><tr><th>Situatie</th><th>Voorbeeld</th></tr>'
      + '<tr><td>Verhalen & beschrijvingen</td><td>Het <strong>was</strong> een koude dag. De zon <strong>scheen</strong> niet.</td></tr>'
      + '<tr><td>Gewoontes in het verleden</td><td>Vroeger <strong>fietste</strong> ik elke dag naar school.</td></tr>'
      + '<tr><td>Achtergrondinformatie</td><td>Terwijl ik <strong>sliep</strong>, belde hij aan.</td></tr>'
      + '<tr><td>Formeel / geschreven taal</td><td>De minister <strong>verklaarde</strong> dat...</td></tr>'
      + '<tr><td>Met tijdsaanduidingen (toen, vroeger)</td><td><strong>Toen</strong> ik klein <strong>was</strong>, woonden we in Utrecht.</td></tr></table>'
      + '<h4 style="margin:10px 0 6px;">Vuistregels</h4>'
      + '<div class="gr-rule">1. <strong>Spreektaal:</strong> Nederlanders gebruiken bijna altijd het <strong>perfectum</strong> in gesprekken.<br>'
      + '2. <strong>Geschreven taal / verhalen:</strong> Het <strong>imperfectum</strong> is standaard in boeken, artikelen en formele teksten.<br>'
      + '3. <strong>was/had/zou/kon/moest/wilde:</strong> Deze werkwoorden staan bijna altijd in het <strong>imperfectum</strong>, zelfs in spreektaal.<br>'
      + '4. <strong>Combinatie:</strong> In verhalen wisselen ze af — imperfectum voor achtergrond, perfectum voor plotselinge acties.</div>'
      + '<h4 style="margin:10px 0 6px;">Voorbeeld: combinatie in een verhaal</h4>'
      + '<div class="gr-example">Ik <strong>liep</strong> door het park. (achtergrond — imperfectum)<br>'
      + 'Het <strong>regende</strong> een beetje. (achtergrond — imperfectum)<br>'
      + 'Opeens <strong>heb</strong> ik een oude vriend <strong>gezien</strong>! (plotseling — perfectum)</div>'
  },
  {
    id: 'hebben_zijn', cat: 'verbs', icon: '&#9878;',
    title: 'Hebben of Zijn?',
    subtitle: 'Welk hulpwerkwoord in de voltooide tijd?',
    accent: '#D40920',
    body: '<div class="gr-rule"><strong>ZIJN</strong> gebruiken bij:</div>'
      + '<table><tr><th>Categorie</th><th>Voorbeelden</th></tr>'
      + '<tr><td>Beweging (met richting)</td><td>gaan, komen, rijden, vliegen, vertrekken, vallen, lopen</td></tr>'
      + '<tr><td>Verandering van toestand</td><td>worden, groeien, sterven, veranderen, stoppen</td></tr>'
      + '<tr><td>zijn, blijven, gebeuren</td><td>Ik ben geweest, zij is gebleven</td></tr></table>'
      + '<div class="gr-rule"><strong>HEBBEN</strong> gebruiken bij: al het andere!</div>'
      + '<div class="gr-example">Ik <strong>heb</strong> gelezen. (geen beweging/verandering)</div>'
      + '<div class="gr-example">Zij <strong>is</strong> vertrokken. (beweging met richting)</div>'
      + '<div class="gr-rule">Let op: sommige werkwoorden kunnen beide!<br>'
      + 'Ik <strong>heb</strong> gereden. (focus op activiteit)<br>'
      + 'Ik <strong>ben</strong> naar huis gereden. (focus op richting)</div>'
  },
  {
    id: 'separable', cat: 'verbs', icon: '&#9986;',
    title: 'Scheidbare Werkwoorden',
    subtitle: 'Wanneer gaat het voorvoegsel los?',
    accent: '#1356A2',
    body: '<div class="gr-rule"><strong>Hoofdzin:</strong> werkwoord splitst — prefix naar einde</div>'
      + '<div class="gr-example">Ik <strong>bel</strong> je morgen <strong>op</strong>.</div>'
      + '<div class="gr-example">Ze <strong>ruimt</strong> haar kamer <strong>op</strong>.</div>'
      + '<div class="gr-rule"><strong>Bijzin:</strong> werkwoord blijft samen</div>'
      + '<div class="gr-example">...omdat ik je morgen <strong>opbel</strong>.</div>'
      + '<div class="gr-rule"><strong>Perfectum:</strong> ge- komt ertussen</div>'
      + '<div class="gr-example">Ik heb je <strong>opgebeld</strong>.</div>'
      + '<div class="gr-example">Ze heeft haar kamer <strong>opgeruimd</strong>.</div>'
      + '<h4 style="margin:8px 0 4px;">Veelvoorkomende scheidbare prefixen</h4>'
      + '<div class="gr-mnemonic">aan, af, bij, in, mee, na, op, over, terug, toe, uit, voor, weg</div>'
      + '<div class="gr-rule"><strong>Niet-scheidbaar</strong> (geen klemtoon op prefix): be-, ver-, ont-, ge-, her-, er-</div>'
  },
  {
    id: 'modal', cat: 'verbs', icon: '&#128172;',
    title: 'Modale Werkwoorden',
    subtitle: 'kunnen, moeten, mogen, willen, zullen',
    accent: '#F7D842',
    body: '<table><tr><th>Werkwoord</th><th>Betekenis</th><th>Ik</th><th>Jij</th><th>Hij/zij</th><th>Wij/zij</th></tr>'
      + '<tr><td>kunnen</td><td>can</td><td>kan</td><td>kan/kunt</td><td>kan</td><td>kunnen</td></tr>'
      + '<tr><td>moeten</td><td>must</td><td>moet</td><td>moet</td><td>moet</td><td>moeten</td></tr>'
      + '<tr><td>mogen</td><td>may</td><td>mag</td><td>mag</td><td>mag</td><td>mogen</td></tr>'
      + '<tr><td>willen</td><td>want</td><td>wil</td><td>wil/wilt</td><td>wil</td><td>willen</td></tr>'
      + '<tr><td>zullen</td><td>shall</td><td>zal</td><td>zal/zult</td><td>zal</td><td>zullen</td></tr></table>'
      + '<div class="gr-rule">Modaal werkwoord = <strong>V2</strong>, infinitief → <strong>einde</strong></div>'
      + '<div class="gr-example">Ik <strong>kan</strong> goed Nederlands <strong>spreken</strong>.</div>'
      + '<div class="gr-example">Je <strong>moet</strong> harder <strong>werken</strong>.</div>'
      + '<div class="gr-rule">Verleden tijd: kon, moest, mocht, wilde, zou</div>'
  },

  // === SPELLING ===
  {
    id: 'open_closed', cat: 'spelling', icon: '&#128290;',
    title: 'Open & Gesloten Lettergrepen',
    subtitle: 'Wanneer verdubbel je de medeklinker?',
    accent: '#2d8a56',
    body: '<div class="gr-rule"><strong>Open lettergreep:</strong> eindigt op klinker → lange klank<br>'
      + '<strong>Gesloten lettergreep:</strong> eindigt op medeklinker → korte klank</div>'
      + '<table><tr><th>Woord</th><th>Stam</th><th>Waarom?</th></tr>'
      + '<tr><td>ma<strong>k</strong>en → ik maa<strong>k</strong></td><td>maak</td><td>Eén a in open lettergreep = lange klank → twee a\'s in stam</td></tr>'
      + '<tr><td>pa<strong>kk</strong>en → ik pa<strong>k</strong></td><td>pak</td><td>Dubbele k = korte klank → één k in stam</td></tr>'
      + '<tr><td>le<strong>z</strong>en → ik lee<strong>s</strong></td><td>lees</td><td>Eén e open = lang → twee e\'s + z→s</td></tr></table>'
      + '<div class="gr-rule"><strong>Spellingregel:</strong><br>'
      + '• Korte klank in gesloten lettergreep: 1 klinker + dubbele medeklinker (pakken, zitten)<br>'
      + '• Lange klank in open lettergreep: 1 klinker (maken, lezen)<br>'
      + '• Lange klank in gesloten lettergreep: 2 klinkers (maakt, leest)</div>'
  },
  {
    id: 'dt_rules', cat: 'spelling', icon: '&#9888;',
    title: 'D, T of DT?',
    subtitle: 'De beruchte dt-fout',
    accent: '#D40920',
    body: '<div class="gr-mnemonic">Stam + t = jij, hij/zij/het, u</div>'
      + '<div class="gr-rule"><strong>Stap 1:</strong> Bepaal de stam (infinitief zonder -en)<br>'
      + '<strong>Stap 2:</strong> Voeg -t toe voor jij/hij/u in de tegenwoordige tijd</div>'
      + '<table><tr><th>Persoon</th><th>worden</th><th>vinden</th></tr>'
      + '<tr><td>ik</td><td>word</td><td>vind</td></tr>'
      + '<tr><td>jij</td><td>word<strong>t</strong></td><td>vind<strong>t</strong></td></tr>'
      + '<tr><td>hij/zij</td><td>word<strong>t</strong></td><td>vind<strong>t</strong></td></tr>'
      + '<tr><td>wij/zij</td><td>worden</td><td>vinden</td></tr></table>'
      + '<div class="gr-rule"><strong>Let op inversie:</strong> bij jij achter het werkwoord → GEEN -t!<br>'
      + 'Jij vind<strong>t</strong>... MAAR: vind jij...? (geen t!)</div>'
      + '<div class="gr-example">Hij <strong>wordt</strong> ziek. ✓</div>'
      + '<div class="gr-example"><strong>Word</strong> jij ook ziek? ✓ (inversie!)</div>'
  },
  {
    id: 'f_v_s_z', cat: 'spelling', icon: '&#128260;',
    title: 'F↔V en S↔Z',
    subtitle: 'Wanneer verandert de klank?',
    accent: '#8B4513',
    body: '<div class="gr-rule">Aan het <strong>einde</strong> van een woord/lettergreep: altijd <strong>f</strong> en <strong>s</strong><br>'
      + 'Aan het <strong>begin</strong> of <strong>midden</strong>: kan <strong>v</strong> of <strong>z</strong> zijn</div>'
      + '<table><tr><th>Infinitief</th><th>Stam</th><th>Regel</th></tr>'
      + '<tr><td>le<strong>v</strong>en</td><td>lee<strong>f</strong></td><td>v → f aan het eind</td></tr>'
      + '<tr><td>schrij<strong>v</strong>en</td><td>schrij<strong>f</strong></td><td>v → f aan het eind</td></tr>'
      + '<tr><td>rei<strong>z</strong>en</td><td>rei<strong>s</strong></td><td>z → s aan het eind</td></tr>'
      + '<tr><td>le<strong>z</strong>en</td><td>lee<strong>s</strong></td><td>z → s aan het eind</td></tr></table>'
      + '<div class="gr-example">Ik <strong>leef</strong> in Amsterdam. (stam van leven)</div>'
      + '<div class="gr-example">Wij <strong>lev</strong>en in Amsterdam. (v terug in meervoud)</div>'
  },

  // === DE / HET ===
  {
    id: 'de_het', cat: 'articles', icon: '&#128214;',
    title: 'De of Het?',
    subtitle: 'Regels en ezelsbruggetjes',
    accent: '#1356A2',
    body: '<div class="gr-rule"><strong>HET</strong> (onzijdig):</div>'
      + '<table><tr><th>Categorie</th><th>Voorbeelden</th></tr>'
      + '<tr><td>Verkleinwoorden (-je, -tje, -pje)</td><td>het huisje, het kopje</td></tr>'
      + '<tr><td>Ge- woorden (geen personen)</td><td>het gebouw, het gevoel, het geluid</td></tr>'
      + '<tr><td>Talen</td><td>het Nederlands, het Frans</td></tr>'
      + '<tr><td>Windrichtingen</td><td>het noorden, het zuiden</td></tr>'
      + '<tr><td>Sporten & spellen</td><td>het voetbal, het schaken</td></tr>'
      + '<tr><td>Metalen</td><td>het goud, het zilver</td></tr>'
      + '<tr><td>Infinitief als zelfst. nw.</td><td>het eten, het lezen</td></tr></table>'
      + '<div class="gr-rule" style="margin-top:10px;"><strong>DE</strong> (mannelijk/vrouwelijk):</div>'
      + '<table><tr><th>Categorie</th><th>Voorbeelden</th></tr>'
      + '<tr><td>Personen</td><td>de man, de vrouw, de leraar</td></tr>'
      + '<tr><td>Beroepen</td><td>de dokter, de bakker</td></tr>'
      + '<tr><td>Bomen, planten, bloemen</td><td>de boom, de roos, de tulp</td></tr>'
      + '<tr><td>Bergen, rivieren</td><td>de Rijn, de Alpen</td></tr>'
      + '<tr><td>-heid, -nis, -schap, -teit, -tie, -ing</td><td>de vrijheid, de kennis, de vriendschap</td></tr>'
      + '<tr><td>Meervoud is altijd DE</td><td>de huizen, de boeken</td></tr></table>'
      + '<div class="gr-mnemonic">Twijfel? → 2/3 van alle woorden is DE</div>'
  },
  {
    id: 'de_het_adj', cat: 'articles', icon: '&#128396;',
    title: 'Bijvoeglijk Naamwoord + De/Het',
    subtitle: 'Wanneer -e achter het bijvoeglijk naamwoord?',
    accent: '#F7D842',
    body: '<div class="gr-rule"><strong>De-woord:</strong> altijd -e<br>'
      + '<strong>Het-woord + bepaald (het/dit/dat):</strong> -e<br>'
      + '<strong>Het-woord + onbepaald (een) enkelvoud:</strong> GEEN -e</div>'
      + '<table><tr><th></th><th>De-woord</th><th>Het-woord</th></tr>'
      + '<tr><td>Bepaald</td><td>de groot<strong>e</strong> stad</td><td>het groot<strong>e</strong> huis</td></tr>'
      + '<tr><td>Onbepaald</td><td>een groot<strong>e</strong> stad</td><td>een groot huis (GEEN -e!)</td></tr>'
      + '<tr><td>Geen lidwoord</td><td>groot<strong>e</strong> steden</td><td>groot bier (GEEN -e!)</td></tr></table>'
      + '<div class="gr-example">De <strong>kleine</strong> kat. (de-woord → altijd -e)</div>'
      + '<div class="gr-example">Het <strong>kleine</strong> kind. (het + bepaald → -e)</div>'
      + '<div class="gr-example">Een <strong>klein</strong> kind. (het + onbepaald → geen -e!)</div>'
  },

  // === WOORDVOLGORDE (Word Order) ===
  {
    id: 'word_order_main', cat: 'wordorder', icon: '&#128295;',
    title: 'Woordvolgorde — Hoofdzin',
    subtitle: 'Het werkwoord staat op positie 2',
    accent: '#D40920',
    body: '<div class="gr-mnemonic">Werkwoord = altijd positie 2 in de hoofdzin</div>'
      + '<table><tr><th>Pos. 1</th><th>Pos. 2 (V)</th><th>Midden</th><th>Einde</th></tr>'
      + '<tr><td>Ik</td><td><strong>heb</strong></td><td>gisteren een boek</td><td><strong>gelezen</strong></td></tr>'
      + '<tr><td>Gisteren</td><td><strong>heb</strong></td><td>ik een boek</td><td><strong>gelezen</strong></td></tr>'
      + '<tr><td>Een boek</td><td><strong>heb</strong></td><td>ik gisteren</td><td><strong>gelezen</strong></td></tr></table>'
      + '<div class="gr-rule"><strong>Inversie:</strong> als iets anders dan het subject op positie 1 staat, dan wisselen subject en werkwoord om</div>'
      + '<div class="gr-example"><strong>Morgen</strong> ga <strong>ik</strong> naar de markt.</div>'
      + '<div class="gr-example"><strong>In Amsterdam</strong> wonen <strong>veel mensen</strong>.</div>'
      + '<div class="gr-rule"><strong>Middenveld-volgorde (STOMPI):</strong><br>'
      + '<code>S</code>ubject - <code>T</code>ijd - <code>O</code>orzaak - <code>M</code>anier - <code>P</code>laats - <code>I</code>nfinitief</div>'
  },
  {
    id: 'word_order_sub', cat: 'wordorder', icon: '&#128279;',
    title: 'Woordvolgorde — Bijzin',
    subtitle: 'Werkwoord naar het einde',
    accent: '#1356A2',
    body: '<div class="gr-mnemonic">Bijzin: voegwoord + ... + werkwoord(en) aan het EINDE</div>'
      + '<div class="gr-rule">Na onderschikkende voegwoorden gaat het werkwoord naar het einde van de zin.</div>'
      + '<div class="gr-example">Ik weet <strong>dat</strong> hij morgen <strong>komt</strong>.</div>'
      + '<div class="gr-example">Ik ga niet <strong>omdat</strong> ik ziek <strong>ben</strong>.</div>'
      + '<div class="gr-example">Ze vraagt <strong>of</strong> je morgen kunt <strong>komen</strong>.</div>'
      + '<h4 style="margin:8px 0 4px;">Onderschikkende voegwoorden</h4>'
      + '<div class="gr-rule">dat, of, omdat, doordat, hoewel, terwijl, voordat, nadat, zodra, tenzij, mits, zolang, totdat, als, wanneer, toen, sinds</div>'
      + '<h4 style="margin:8px 0 4px;">Nevenschikkende voegwoorden (GEEN effect)</h4>'
      + '<div class="gr-rule"><strong>en, maar, of, want, dus</strong> → normale woordvolgorde</div>'
      + '<div class="gr-example">Ik ga niet, <strong>want</strong> ik <strong>ben</strong> ziek. (normaal)</div>'
  },
  {
    id: 'er', cat: 'wordorder', icon: '&#128161;',
    title: 'Het Woordje "Er"',
    subtitle: '5 functies van er',
    accent: '#F7D842',
    body: '<table><tr><th>Functie</th><th>Voorbeeld</th><th>Uitleg</th></tr>'
      + '<tr><td>Plaats (= daar)</td><td>Ik ben <strong>er</strong> geweest.</td><td>= ik ben daar geweest</td></tr>'
      + '<tr><td>Onbepaald subject</td><td><strong>Er</strong> staat een man voor de deur.</td><td>Introductie onbekend subject</td></tr>'
      + '<tr><td>Hoeveelheid</td><td>Ik heb <strong>er</strong> drie.</td><td>= ik heb er drie (van die dingen)</td></tr>'
      + '<tr><td>Voorzetsel-verwijzing</td><td>Ik denk <strong>eraan</strong>.</td><td>= ik denk aan dat/het</td></tr>'
      + '<tr><td>Passief</td><td><strong>Er</strong> wordt veel gedanst.</td><td>Onpersoonlijk passief</td></tr></table>'
      + '<div class="gr-rule"><strong>Er + voorzetsel</strong> combineert tot één woord:<br>'
      + 'er + op = <strong>erop</strong>, er + aan = <strong>eraan</strong>, er + over = <strong>erover</strong>, er + mee = <strong>ermee</strong></div>'
  },

  // === VOORNAAMWOORDEN (Pronouns) ===
  {
    id: 'pronouns_personal', cat: 'pronouns', icon: '&#128100;',
    title: 'Persoonlijke Voornaamwoorden',
    subtitle: 'Subject, object en bezittelijk',
    accent: '#D40920',
    body: '<table><tr><th>Subject</th><th>Object</th><th>Bezittelijk</th><th>Engels</th></tr>'
      + '<tr><td>ik</td><td>mij / me</td><td>mijn</td><td>I / me / my</td></tr>'
      + '<tr><td>jij / je</td><td>jou / je</td><td>jouw / je</td><td>you / your</td></tr>'
      + '<tr><td>hij</td><td>hem</td><td>zijn</td><td>he / him / his</td></tr>'
      + '<tr><td>zij / ze</td><td>haar</td><td>haar</td><td>she / her</td></tr>'
      + '<tr><td>het</td><td>het</td><td>zijn</td><td>it / its</td></tr>'
      + '<tr><td>u</td><td>u</td><td>uw</td><td>you (formal)</td></tr>'
      + '<tr><td>wij / we</td><td>ons</td><td>ons / onze</td><td>we / us / our</td></tr>'
      + '<tr><td>jullie</td><td>jullie</td><td>jullie / je</td><td>you (pl.) / your</td></tr>'
      + '<tr><td>zij / ze</td><td>hen / hun / ze</td><td>hun</td><td>they / them / their</td></tr></table>'
      + '<div class="gr-rule"><strong>Wederkerend:</strong> me, je, zich, ons, je, zich<br>'
      + 'Ik was <strong>me</strong>. Hij scheert <strong>zich</strong>. Wij vermaken <strong>ons</strong>.</div>'
  },
  {
    id: 'pronouns_relative', cat: 'pronouns', icon: '&#128257;',
    title: 'Betrekkelijke Voornaamwoorden',
    subtitle: 'die, dat, wie, wat, waar',
    accent: '#1356A2',
    body: '<div class="gr-rule"><strong>die</strong> → verwijst naar de-woord of meervoud<br>'
      + '<strong>dat</strong> → verwijst naar het-woord enkelvoud</div>'
      + '<div class="gr-example">De man <strong>die</strong> daar staat, is mijn buurman.</div>'
      + '<div class="gr-example">Het boek <strong>dat</strong> ik lees, is spannend.</div>'
      + '<div class="gr-rule"><strong>wie</strong> → na voorzetsel (personen)<br>'
      + '<strong>wat</strong> → na alles, niets, iets, het</div>'
      + '<div class="gr-example">De man <strong>met wie</strong> ik praat...</div>'
      + '<div class="gr-example">Alles <strong>wat</strong> je zegt, klopt.</div>'
      + '<div class="gr-rule"><strong>waar + voorzetsel</strong> → voor dingen<br>'
      + 'Het huis <strong>waarin</strong> ik woon. De stoel <strong>waarop</strong> je zit.</div>'
  },

  // === OVERIG (Other) ===
  {
    id: 'comparatives', cat: 'other', icon: '&#128200;',
    title: 'Vergelijkingen',
    subtitle: 'Vergrotende en overtreffende trap',
    accent: '#2d8a56',
    body: '<table><tr><th>Stellend</th><th>Vergrotend (-er)</th><th>Overtreffend (-st)</th></tr>'
      + '<tr><td>groot</td><td>grot<strong>er</strong></td><td>groot<strong>st</strong></td></tr>'
      + '<tr><td>klein</td><td>klein<strong>er</strong></td><td>klein<strong>st</strong></td></tr>'
      + '<tr><td>mooi</td><td>mooi<strong>er</strong></td><td>mooi<strong>st</strong></td></tr>'
      + '<tr><td>duur</td><td>duur<strong>der</strong></td><td>duur<strong>st</strong></td></tr>'
      + '<tr><td>goed</td><td><strong>beter</strong></td><td><strong>best</strong></td></tr>'
      + '<tr><td>veel</td><td><strong>meer</strong></td><td><strong>meest</strong></td></tr>'
      + '<tr><td>weinig</td><td><strong>minder</strong></td><td><strong>minst</strong></td></tr>'
      + '<tr><td>graag</td><td><strong>liever</strong></td><td><strong>liefst</strong></td></tr></table>'
      + '<div class="gr-rule"><strong>Vergelijking:</strong> net zo... als / ...er dan / het ...st<br>'
      + 'Zij is net zo groot <strong>als</strong> ik. Zij is grot<strong>er</strong> <strong>dan</strong> ik.</div>'
  },
  {
    id: 'negation', cat: 'other', icon: '&#9940;',
    title: 'Ontkenning',
    subtitle: 'niet, geen, nooit, nergens',
    accent: '#D40920',
    body: '<div class="gr-rule"><strong>geen</strong> = niet + een (voor zelfstandig naamwoord)<br>'
      + '<strong>niet</strong> = voor werkwoorden, bijvoeglijk naamwoorden, bijwoorden</div>'
      + '<div class="gr-example">Ik heb <strong>geen</strong> tijd. (niet + een tijd)</div>'
      + '<div class="gr-example">Ik ga <strong>niet</strong> naar huis.</div>'
      + '<h4 style="margin:8px 0 4px;">Positie van NIET</h4>'
      + '<div class="gr-rule">'
      + '1. Vóór bijvoeglijk naamwoord: Het is <strong>niet</strong> mooi.<br>'
      + '2. Vóór voorzetsel: Ik ga <strong>niet</strong> naar school.<br>'
      + '3. Vóór infinitief/V.D.: Ik kan <strong>niet</strong> komen. Ik heb <strong>niet</strong> gegeten.<br>'
      + '4. Aan het einde (anders): Ik weet het <strong>niet</strong>.</div>'
      + '<h4 style="margin:8px 0 4px;">Ontkennende woorden</h4>'
      + '<table><tr><th>Positief</th><th>Negatief</th></tr>'
      + '<tr><td>altijd</td><td>nooit</td></tr>'
      + '<tr><td>overal</td><td>nergens</td></tr>'
      + '<tr><td>iemand</td><td>niemand</td></tr>'
      + '<tr><td>iets</td><td>niets / niks</td></tr></table>'
  },
  {
    id: 'passive', cat: 'verbs', icon: '&#128260;',
    title: 'Passieve Zinnen',
    subtitle: 'worden + voltooid deelwoord',
    accent: '#8B4513',
    body: '<div class="gr-rule"><strong>Actief:</strong> De kok maakt het eten.<br>'
      + '<strong>Passief:</strong> Het eten <strong>wordt</strong> (door de kok) gemaakt.</div>'
      + '<h4 style="margin:8px 0 4px;">Tijden</h4>'
      + '<table><tr><th>Tijd</th><th>Vorm</th><th>Voorbeeld</th></tr>'
      + '<tr><td>Tegenwoordig</td><td>worden + V.D.</td><td>Het huis <strong>wordt gebouwd</strong>.</td></tr>'
      + '<tr><td>Verleden</td><td>werden + V.D.</td><td>Het huis <strong>werd gebouwd</strong>.</td></tr>'
      + '<tr><td>Perfectum</td><td>zijn + V.D.</td><td>Het huis <strong>is gebouwd</strong>.</td></tr></table>'
      + '<div class="gr-rule"><strong>Let op:</strong> perfectum passief gebruikt <strong>zijn</strong> (niet worden!)<br>'
      + 'Het boek <strong>is</strong> geschreven. (niet: is geworden geschreven)</div>'
  },
  {
    id: 'conditional', cat: 'verbs', icon: '&#128300;',
    title: 'Zou + Infinitief (Conditionalis)',
    subtitle: 'Beleefdheid, wensen, hypothetisch',
    accent: '#F7D842',
    body: '<div class="gr-rule"><strong>zou/zouden + infinitief</strong></div>'
      + '<table><tr><th>Functie</th><th>Voorbeeld</th></tr>'
      + '<tr><td>Beleefd verzoek</td><td><strong>Zou</strong> u mij kunnen helpen?</td></tr>'
      + '<tr><td>Wens</td><td>Ik <strong>zou</strong> graag een koffie willen.</td></tr>'
      + '<tr><td>Hypothetisch</td><td>Als ik rijk was, <strong>zou</strong> ik een boot kopen.</td></tr>'
      + '<tr><td>Advies</td><td>Je <strong>zou</strong> meer moeten slapen.</td></tr></table>'
      + '<div class="gr-example">Ik <strong>zou</strong> het fijn vinden als je kwam.</div>'
      + '<div class="gr-example"><strong>Zou</strong> je het raam open willen doen?</div>'
  },
  {
    id: 'prepositions_overview', cat: 'other', icon: '&#128205;',
    title: 'Voorzetsels Overzicht',
    subtitle: 'De belangrijkste voorzetsels',
    accent: '#1356A2',
    body: '<table><tr><th>Voorzetsel</th><th>Betekenis</th><th>Voorbeeld</th></tr>'
      + '<tr><td>aan</td><td>at, on, to</td><td>aan tafel, aan de muur</td></tr>'
      + '<tr><td>achter</td><td>behind</td><td>achter het huis</td></tr>'
      + '<tr><td>bij</td><td>at, near, with</td><td>bij de dokter</td></tr>'
      + '<tr><td>door</td><td>through, by</td><td>door de stad</td></tr>'
      + '<tr><td>in</td><td>in, into</td><td>in de keuken</td></tr>'
      + '<tr><td>langs</td><td>along, past</td><td>langs de rivier</td></tr>'
      + '<tr><td>met</td><td>with</td><td>met de trein</td></tr>'
      + '<tr><td>na</td><td>after</td><td>na het eten</td></tr>'
      + '<tr><td>naar</td><td>to, towards</td><td>naar school</td></tr>'
      + '<tr><td>om</td><td>around, at</td><td>om drie uur</td></tr>'
      + '<tr><td>op</td><td>on, at</td><td>op tafel</td></tr>'
      + '<tr><td>over</td><td>about, over</td><td>over de brug</td></tr>'
      + '<tr><td>tegen</td><td>against</td><td>tegen de muur</td></tr>'
      + '<tr><td>tot</td><td>until, to</td><td>tot morgen</td></tr>'
      + '<tr><td>tussen</td><td>between</td><td>tussen ons</td></tr>'
      + '<tr><td>uit</td><td>from, out of</td><td>uit Amsterdam</td></tr>'
      + '<tr><td>van</td><td>of, from</td><td>van mijn vader</td></tr>'
      + '<tr><td>voor</td><td>for, before</td><td>voor jou</td></tr>'
      + '<tr><td>zonder</td><td>without</td><td>zonder suiker</td></tr></table>'
  },
  {
    id: 'om_te', cat: 'other', icon: '&#127919;',
    title: 'Om... te + Infinitief',
    subtitle: 'Doelzinnen en te-constructies',
    accent: '#2d8a56',
    body: '<div class="gr-rule"><strong>Om... te + infinitief</strong> = in order to / to</div>'
      + '<div class="gr-example">Ik ga naar de winkel <strong>om</strong> boodschappen <strong>te doen</strong>.</div>'
      + '<div class="gr-example">Hij belt <strong>om</strong> een afspraak <strong>te maken</strong>.</div>'
      + '<h4 style="margin:8px 0 4px;">Te + infinitief (zonder om)</h4>'
      + '<div class="gr-rule">Na sommige werkwoorden/bijvoeglijke naamwoorden:</div>'
      + '<div class="gr-example">Ik probeer <strong>te</strong> slapen.</div>'
      + '<div class="gr-example">Het is moeilijk <strong>te</strong> begrijpen.</div>'
      + '<div class="gr-example">Hij zit <strong>te</strong> lezen. (aan het lezen)</div>'
      + '<div class="gr-rule"><strong>Scheidbaar werkwoord + te:</strong> te komt ertussen!<br>'
      + 'Ik probeer op <strong>te</strong> bellen. (niet: te opbellen)</div>'
  },
  {
    id: 'diminutives', cat: 'other', icon: '&#128044;',
    title: 'Verkleinwoorden',
    subtitle: '-je, -tje, -pje, -etje, -kje',
    accent: '#F7D842',
    body: '<div class="gr-rule">Alle verkleinwoorden zijn <strong>het</strong>-woorden!</div>'
      + '<table><tr><th>Eindigt op</th><th>Suffix</th><th>Voorbeeld</th></tr>'
      + '<tr><td>Meeste woorden</td><td>-je</td><td>huis → huisje</td></tr>'
      + '<tr><td>-m</td><td>-pje</td><td>boom → boompje</td></tr>'
      + '<tr><td>-n, -l, -r + lange klinker</td><td>-tje</td><td>stoel → stoeltje</td></tr>'
      + '<tr><td>-ng</td><td>-etje</td><td>ring → ringetje</td></tr>'
      + '<tr><td>-nk</td><td>-je</td><td>bank → bankje</td></tr>'
      + '<tr><td>-lf</td><td>-je</td><td>elf → elfje</td></tr></table>'
      + '<div class="gr-example">de tafel → <strong>het</strong> tafeltje</div>'
      + '<div class="gr-example">de woning → <strong>het</strong> woninkje</div>'
      + '<div class="gr-rule">Verkleinwoorden zijn niet alleen "klein" — ook voor genegenheid, vernedering, of gewoon dagelijks taalgebruik (biertje, broodje, kopje)</div>'
  },
  {
    id: 'pronominal_adverbs', cat: 'other', icon: '&#128260;',
    title: 'Voornaamwoordelijke Bijwoorden',
    subtitle: 'daar+voor, hier+mee, waar+over, er+aan \u2014 de "er/daar/hier/waar + voorzetsel" woorden',
    accent: '#1356A2',
    body: '<div class="gr-mnemonic">er / daar / hier / waar + voorzetsel = voornaamwoordelijk bijwoord</div>'
      + '<div class="gr-rule">In het Nederlands zeg je <strong>niet</strong> "met dat" of "voor het" als je naar een <em>ding</em> verwijst. Gebruik in plaats daarvan een voornaamwoordelijk bijwoord.</div>'
      + '<div class="gr-example"><span style="color:var(--mondrian-red)">&#10008;</span> Ik denk <s>over het</s>. &rarr; <span style="color:#2d8a56">&#10004;</span> Ik denk <strong>erover</strong>.</div>'
      + '<div class="gr-example"><span style="color:var(--mondrian-red)">&#10008;</span> Ik wacht <s>op dat</s>. &rarr; <span style="color:#2d8a56">&#10004;</span> Ik wacht <strong>daarop</strong>.</div>'
      + '<h4 style="margin:12px 0 6px;">De vier vormen</h4>'
      + '<table><tr><th>Prefix</th><th>Gebruik</th><th>Voorbeeld</th></tr>'
      + '<tr><td><strong>er-</strong></td><td>Onbeklemtoond / algemeen (het, dit, dat)</td><td>Ik denk <strong>erover</strong> na.</td></tr>'
      + '<tr><td><strong>daar-</strong></td><td>Beklemtoond / specifiek (dat ding daar)</td><td><strong>Daarvoor</strong> heb ik betaald.</td></tr>'
      + '<tr><td><strong>hier-</strong></td><td>Dichtbij / dit hier</td><td><strong>Hiermee</strong> ben ik het eens.</td></tr>'
      + '<tr><td><strong>waar-</strong></td><td>Vraag of betrekkelijke bijzin</td><td><strong>Waarover</strong> praat je?</td></tr></table>'
      + '<h4 style="margin:12px 0 6px;">Overzicht per voorzetsel</h4>'
      + '<table><tr><th>Voorzetsel</th><th>er-</th><th>daar-</th><th>hier-</th><th>waar-</th></tr>'
      + '<tr><td>aan</td><td>eraan</td><td>daaraan</td><td>hieraan</td><td>waaraan</td></tr>'
      + '<tr><td>achter</td><td>erachter</td><td>daarachter</td><td>hierachter</td><td>waarachter</td></tr>'
      + '<tr><td>bij</td><td>erbij</td><td>daarbij</td><td>hierbij</td><td>waarbij</td></tr>'
      + '<tr><td>door</td><td>erdoor</td><td>daardoor</td><td>hierdoor</td><td>waardoor</td></tr>'
      + '<tr><td>in</td><td>erin</td><td>daarin</td><td>hierin</td><td>waarin</td></tr>'
      + '<tr><td>mee (met)</td><td>ermee</td><td>daarmee</td><td>hiermee</td><td>waarmee</td></tr>'
      + '<tr><td>na</td><td>erna</td><td>daarna</td><td>hierna</td><td>waarna</td></tr>'
      + '<tr><td>naar</td><td>ernaartoe</td><td>daarnaartoe</td><td>hiernaartoe</td><td>waarnaartoe</td></tr>'
      + '<tr><td>om</td><td>erom</td><td>daarom</td><td>hierom</td><td>waarom</td></tr>'
      + '<tr><td>onder</td><td>eronder</td><td>daaronder</td><td>hieronder</td><td>waaronder</td></tr>'
      + '<tr><td>op</td><td>erop</td><td>daarop</td><td>hierop</td><td>waarop</td></tr>'
      + '<tr><td>over</td><td>erover</td><td>daarover</td><td>hierover</td><td>waarover</td></tr>'
      + '<tr><td>tegen</td><td>ertegen</td><td>daartegen</td><td>hiertegen</td><td>waartegen</td></tr>'
      + '<tr><td>tussen</td><td>ertussen</td><td>daartussen</td><td>hiertussen</td><td>waartussen</td></tr>'
      + '<tr><td>uit</td><td>eruit</td><td>daaruit</td><td>hieruit</td><td>waaruit</td></tr>'
      + '<tr><td>van</td><td>ervan</td><td>daarvan</td><td>hiervan</td><td>waarvan</td></tr>'
      + '<tr><td>voor</td><td>ervoor</td><td>daarvoor</td><td>hiervoor</td><td>waarvoor</td></tr></table>'
      + '<h4 style="margin:12px 0 6px;">Splitsen in de bijzin</h4>'
      + '<div class="gr-rule">In de hoofdzin mag het bijwoord gesplitst worden; in de bijzin staat het meestal <strong>aan elkaar</strong>.</div>'
      + '<div class="gr-example"><strong>Hoofdzin (gesplitst):</strong> Ik denk <strong>er</strong> niet <strong>over</strong> na.</div>'
      + '<div class="gr-example"><strong>Bijzin (samen):</strong> \u2026 omdat ik <strong>erover</strong> nadenk.</div>'
      + '<h4 style="margin:12px 0 6px;">Alleen voor dingen, niet voor personen!</h4>'
      + '<div class="gr-rule">Voor <strong>personen</strong> gebruik je gewoon het voorzetsel + pronomen:</div>'
      + '<div class="gr-example"><span style="color:#2d8a56">&#10004;</span> Ik denk aan <strong>haar</strong>. (persoon)</div>'
      + '<div class="gr-example"><span style="color:#2d8a56">&#10004;</span> Ik denk <strong>eraan</strong>. (ding/situatie)</div>'
      + '<div class="gr-example"><span style="color:var(--mondrian-red)">&#10008;</span> <s>Ik denk eraan haar.</s></div>'
      + '<h4 style="margin:12px 0 6px;">Veelgebruikte combinaties</h4>'
      + '<table><tr><th>Nederlands</th><th>Engels</th><th>Voorbeeld</th></tr>'
      + '<tr><td><strong>daarvoor</strong></td><td>for that / before that</td><td>Ik heb <strong>daarvoor</strong> betaald.</td></tr>'
      + '<tr><td><strong>daarmee</strong></td><td>with that</td><td>Wat bedoel je <strong>daarmee</strong>?</td></tr>'
      + '<tr><td><strong>daarom</strong></td><td>that\'s why / therefore</td><td><strong>Daarom</strong> ben ik hier.</td></tr>'
      + '<tr><td><strong>daarna</strong></td><td>after that</td><td><strong>Daarna</strong> gingen we naar huis.</td></tr>'
      + '<tr><td><strong>daarover</strong></td><td>about that</td><td>Ik wil <strong>daarover</strong> praten.</td></tr>'
      + '<tr><td><strong>daardoor</strong></td><td>because of that</td><td><strong>Daardoor</strong> was ik te laat.</td></tr>'
      + '<tr><td><strong>daartegen</strong></td><td>against that</td><td>Ik ben <strong>daartegen</strong>.</td></tr>'
      + '<tr><td><strong>ervan</strong></td><td>of it</td><td>Ik geniet <strong>ervan</strong>.</td></tr>'
      + '<tr><td><strong>erop</strong></td><td>on it</td><td>Ik reken <strong>erop</strong>.</td></tr>'
      + '<tr><td><strong>erin</strong></td><td>in it</td><td>Ik geloof <strong>erin</strong>.</td></tr>'
      + '<tr><td><strong>ermee</strong></td><td>with it</td><td>Ik ben het <strong>ermee</strong> eens.</td></tr>'
      + '<tr><td><strong>eruit</strong></td><td>out of it</td><td>Het ziet <strong>eruit</strong> als regen.</td></tr>'
      + '<tr><td><strong>hieronder</strong></td><td>below this</td><td>Zie <strong>hieronder</strong> voor meer info.</td></tr>'
      + '<tr><td><strong>hierbij</strong></td><td>hereby / enclosed</td><td><strong>Hierbij</strong> stuur ik mijn cv.</td></tr>'
      + '<tr><td><strong>waardoor</strong></td><td>because of which</td><td>De file <strong>waardoor</strong> ik te laat was.</td></tr>'
      + '<tr><td><strong>waarover</strong></td><td>about which</td><td>Het boek <strong>waarover</strong> ik vertelde.</td></tr></table>'
      + '<div class="tip"><strong>Tip:</strong> Let op dubbelzinnigheid! "Daarvoor" kan betekenen "for that" \u00e9n "before that" \u2014 context bepaalt de betekenis. Hetzelfde geldt voor "daarom" (therefore / around that) en "daarin" (in that / therein).</div>'
  },
];

const GRAMMAR_CAT_LABELS = {
  verbs: 'Werkwoorden', spelling: 'Spelling', articles: 'De / Het',
  wordorder: 'Woordvolgorde', pronouns: 'Voornaamwoorden', other: 'Overig'
};

let grammarInitialized = false;
let grammarCat = 'all';

function initGrammar() {
  if (grammarInitialized) return;
  grammarInitialized = true;
  renderGrammarCards();
}

function switchGrammarCat(cat) {
  grammarCat = cat;
  document.querySelectorAll('.grammar-cat-btn').forEach(b => b.classList.remove('active'));
  document.querySelector('.grammar-cat-btn[data-gcat="'+cat+'"]').classList.add('active');
  renderGrammarCards();
}

function renderGrammarCards() {
  let items = GRAMMAR_RULES;
  if (grammarCat !== 'all') items = items.filter(r => r.cat === grammarCat);

  document.getElementById('grammarGrid').innerHTML = items.map(r =>
    '<div class="grammar-card">'
    + '<div class="grammar-card-accent" style="background:' + r.accent + ';"></div>'
    + '<div class="grammar-card-header">'
    + '<div class="grammar-card-icon">' + r.icon + '</div>'
    + '<div class="grammar-card-title">' + r.title + '</div>'
    + '<div class="grammar-card-subtitle">' + r.subtitle + '</div>'
    + '</div>'
    + '<div class="grammar-card-body">' + r.body + '</div>'
    + '<button class="grammar-card-print" onclick="printGrammarCard(\'' + r.id + '\')">&#128424; Print dit spiekbriefje</button>'
    + '</div>'
  ).join('');
}

function printGrammarCard(id) {
  const rule = GRAMMAR_RULES.find(r => r.id === id);
  if (!rule) return;
  generatePDFContent('Grammatica — ' + rule.title, rule.body);
}

function exportAllGrammar() {
  let rows = '';
  GRAMMAR_RULES.forEach(r => {
    rows += '<div style="page-break-inside:avoid;margin-bottom:20px;">';
    rows += '<h2 style="color:' + r.accent + ';">' + r.icon + ' ' + r.title + '</h2>';
    rows += '<p style="color:#888;font-size:11px;">' + r.subtitle + '</p>';
    rows += r.body;
    rows += '</div>';
  });
  rows += '<div class="tip">Totaal: ' + GRAMMAR_RULES.length + ' grammaticaregels</div>';
  generatePDFContent('Alle Grammaticaregels', rows);
}

// ==========================================
// LEESHOEK: HIGHLIGHT + TRANSLATE + SAVE
// ==========================================
let savedTranslations = [];
let currentTranslationText = '';
let currentTranslationResult = '';

// Load saved translations from localStorage
(function loadSavedTranslations() {
  try {
    const saved = JSON.parse(localStorage.getItem('dutchquest_translations'));
    if (Array.isArray(saved)) {
      savedTranslations = saved;
      renderSavedTranslations();
    }
  } catch(e) {}
})();

function saveSavedTranslations() {
  try { localStorage.setItem('dutchquest_translations', JSON.stringify(savedTranslations)); } catch(e) {}
}

// Show translate toolbar on text selection within Leeshoek
document.addEventListener('mouseup', (e) => {
  setTimeout(() => showTranslateToolbar(e), 10);
});
document.addEventListener('touchend', (e) => {
  setTimeout(() => showTranslateToolbar(e), 100);
});

function showTranslateToolbar(e) {
  const toolbar = document.getElementById('translateToolbar');
  const sel = window.getSelection();
  const text = sel?.toString().trim();

  if (!text || text.length < 2) {
    toolbar.classList.remove('show');
    return;
  }

  // Check if selection is within Leeshoek (tab-news)
  const newsTab = document.getElementById('tab-news');
  if (!newsTab?.classList.contains('active')) {
    toolbar.classList.remove('show');
    return;
  }

  // Check if selection is within news content areas
  const anchorNode = sel.anchorNode;
  const parentEl = anchorNode?.parentElement;
  if (!parentEl) { toolbar.classList.remove('show'); return; }
  const inNews = parentEl.closest('#newsContent, #nosFeed, .news-text, .nos-card');
  if (!inNews) { toolbar.classList.remove('show'); return; }

  currentTranslationText = text;
  const range = sel.getRangeAt(0);
  const rect = range.getBoundingClientRect();
  toolbar.style.left = Math.max(10, rect.left) + 'px';
  toolbar.style.top = (rect.top - 45 + window.scrollY) + 'px';
  toolbar.classList.add('show');
}

// Hide toolbar when clicking elsewhere
document.addEventListener('mousedown', (e) => {
  const toolbar = document.getElementById('translateToolbar');
  const popup = document.getElementById('translatePopup');
  if (!toolbar.contains(e.target) && !popup.contains(e.target)) {
    toolbar.classList.remove('show');
  }
});

async function translateSelectedText() {
  const toolbar = document.getElementById('translateToolbar');
  toolbar.classList.remove('show');

  if (!currentTranslationText) return;

  const popup = document.getElementById('translatePopup');
  const nlEl = document.getElementById('translatePopupNL');
  const enEl = document.getElementById('translatePopupEN');

  nlEl.textContent = currentTranslationText;
  enEl.textContent = 'Vertalen...';
  popup.style.top = '50%';
  popup.style.left = '50%';
  popup.style.transform = 'translate(-50%, -50%)';
  popup.classList.add('show');

  try {
    const resp = await fetch('https://api.mymemory.translated.net/get?q=' + encodeURIComponent(currentTranslationText) + '&langpair=nl|en');
    const data = await resp.json();
    const translation = data.responseData?.translatedText || 'Vertaling niet gevonden';
    currentTranslationResult = translation;
    enEl.textContent = translation;
  } catch (e) {
    enEl.textContent = 'Fout bij vertalen. Probeer het opnieuw.';
    currentTranslationResult = '';
  }
}

function closeTranslatePopup() {
  document.getElementById('translatePopup').classList.remove('show');
}

function saveCurrentTranslation() {
  if (!currentTranslationText || !currentTranslationResult) return;

  // Check if already saved
  const exists = savedTranslations.find(t => t.nl === currentTranslationText);
  if (!exists) {
    savedTranslations.push({ nl: currentTranslationText, en: currentTranslationResult });
    saveSavedTranslations();
    renderSavedTranslations();
  }
  closeTranslatePopup();
}

function removeSavedTranslation(index) {
  savedTranslations.splice(index, 1);
  saveSavedTranslations();
  renderSavedTranslations();
}

function renderSavedTranslations() {
  const list = document.getElementById('savedTranslationsList');
  const count = document.getElementById('savedTranslationsCount');
  const exportBtn = document.getElementById('savedTranslationsExport');
  if (!list) return;

  count.textContent = savedTranslations.length;
  exportBtn.disabled = savedTranslations.length === 0;

  if (savedTranslations.length === 0) {
    list.innerHTML = '<div class="saved-translations-empty">Selecteer tekst in een artikel en klik "Vertalen" om vertalingen op te slaan.</div>';
    return;
  }

  list.innerHTML = savedTranslations.map((t, i) =>
    '<div class="saved-translation-entry">'
    + '<span class="saved-translation-nl">' + t.nl + '</span>'
    + '<span class="saved-translation-en">' + t.en + '</span>'
    + '<button class="saved-translation-remove" onclick="removeSavedTranslation(' + i + ')" title="Verwijderen">&#215;</button>'
    + '</div>'
  ).join('');
}

function exportSavedTranslations() {
  if (savedTranslations.length === 0) return;
  let rows = '<table><tr><th>Nederlands</th><th>Engels</th></tr>';
  savedTranslations.forEach(t => {
    rows += '<tr><td style="font-weight:700;color:#D40920">' + t.nl + '</td><td>' + t.en + '</td></tr>';
  });
  rows += '</table>';
  rows += '<div class="tip">Totaal: ' + savedTranslations.length + ' vertalingen</div>';
  generatePDFContent('Mijn Vertalingen — Leeshoek', rows);
}

// ==========================================
// MAIN TAB: SPEL — Het Nederlandse Avontuur
// ==========================================

const DE_SKILLS = {
  grammatica: {
    name: 'Grammatica', color: '#1356A2', icon: '\ud83d\udcd0', vibe: 'Pedantic, corrective',
    passiveComments: {
      cloze: ['GRAMMATICA — Let op de naamval hier. Het zelfstandig naamwoord vereist een specifieke vorm.', 'GRAMMATICA — De zinsstructuur wijst op een bepaald woordtype. Analyseer de bijzin.', 'GRAMMATICA — Kijk naar het lidwoord. Dat vertelt je alles over het geslacht van het woord.'],
      wordorder: ['GRAMMATICA — Vergeet de inversie niet. Bij een bijwoord aan het begin draait het onderwerp.', 'GRAMMATICA — Het werkwoord hoort op de tweede positie. Altijd. Dit is niet optioneel.', 'GRAMMATICA — In een bijzin gaat het werkwoord naar het einde. Dat is de wet.'],
      headline: ['GRAMMATICA — Krantenkoppen laten vaak het lidwoord weg. Vul het mentaal aan.', 'GRAMMATICA — De kop mist een element. Zoek de logische grammaticale afsluiting.']
    },
    failComments: ['GRAMMATICA — *zucht* Dat was grammaticaal een oorlogsmisdaad.', 'GRAMMATICA — Nee. Nee nee nee. De grammaticaregels bestaan met een reden.', 'GRAMMATICA — Ik voel fysieke pijn. Dit is niet hoe de Nederlandse taal werkt.'],
    successComments: ['GRAMMATICA — Correct. De zinsontleding klopt. Ik ben... bijna trots.', 'GRAMMATICA — Adequaat. De grammatica is in orde. Ga zo door.', 'GRAMMATICA — Hmm. Goed. Misschien is er toch hoop voor je taalgevoel.']
  },
  woordenschat: {
    name: 'Woordenschat', color: '#D40920', icon: '\ud83d\udcda', vibe: 'Enthusiastic word collector',
    passiveComments: {
      cloze: ['WOORDENSCHAT — Oh! Dit woord! Weet je dat het oorspronkelijk uit het Frans komt? Prachtig!', 'WOORDENSCHAT — De context! De context! Het nieuwsartikel geeft je de sleutel. Lees het beter!', 'WOORDENSCHAT — Er zit een samengesteld woord verstopt. Nederlanders zijn dol op die dingen.'],
      wordorder: ['WOORDENSCHAT — Elk woord vertelt een verhaal. Luister naar de melodie van de zin!', 'WOORDENSCHAT — Oh, deze woorden samen! Dat is bijna poëzie. Rangschik ze met gevoel!'],
      headline: ['WOORDENSCHAT — Krantenkoppen! Een schatkist van moderne vocabulaire!', 'WOORDENSCHAT — Dit woord is trending in het nieuws. Je moet het kennen. MOET.']
    },
    failComments: ['WOORDENSCHAT — Je mist woorden in je collectie. Dat is oké — elke fout is een nieuw woord om te verzamelen!', 'WOORDENSCHAT — Verkeerd! Maar weet je wat het goede woord WEL betekent? Fascinerende etymologie...', 'WOORDENSCHAT — Schrijf dit woord op! In je woordenboekje! Nu meteen!'],
    successComments: ['WOORDENSCHAT — JA! Dat woord! Je kent het! Voeg het toe aan je collectie!', 'WOORDENSCHAT — Briljant! Je woordenschat groeit als een polder na drooglegging!', 'WOORDENSCHAT — *opgewonden* Ken je ook de synoniemen? Er zijn er minstens vier!']
  },
  cultureel: {
    name: 'Cultureel Bewustzijn', color: '#F7D842', icon: '\ud83c\udfe0', vibe: 'Wry Dutch culture observer',
    passiveComments: {
      cloze: ['CULTUREEL BEWUSTZIJN — Ah, dit gaat over iets typisch Nederlands. Denk aan hoe Nederlanders dit zouden zeggen.', 'CULTUREEL BEWUSTZIJN — In Nederland zeg je dit anders dan je denkt. Directheid is een deugd hier.', 'CULTUREEL BEWUSTZIJN — Dit woord heeft een culturele lading. Nederlanders gebruiken het ironisch.'],
      wordorder: ['CULTUREEL BEWUSTZIJN — Een Nederlander zou deze zin met een zucht uitspreken. Dat helpt bij de volgorde.', 'CULTUREEL BEWUSTZIJN — Denk als een Nederlander: nuchter, direct, en altijd het werkwoord op de juiste plek.'],
      headline: ['CULTUREEL BEWUSTZIJN — NOS-koppen volgen een bepaald patroon. Zakelijk. Beknopt. Nederlands.', 'CULTUREEL BEWUSTZIJN — Dit is typisch NOS-jargon. Je herkent het als je genoeg Journaal hebt gekeken.']
    },
    failComments: ['CULTUREEL BEWUSTZIJN — Tja. Een echte Nederlander had dit geweten. Maar je bent er bijna.', 'CULTUREEL BEWUSTZIJN — Doe maar normaal, dan doe je al gek genoeg. En leer van je fouten.', 'CULTUREEL BEWUSTZIJN — Geen zorgen. Zelfs sommige Nederlanders zouden hier struikelen. Sommige.'],
    successComments: ['CULTUREEL BEWUSTZIJN — Je begint Nederland te snappen. Dat is tegelijk een zegen en een vloek.', 'CULTUREEL BEWUSTZIJN — Goed! Je integreert. Binnenkort klaag je ook over het weer.', 'CULTUREEL BEWUSTZIJN — Precies. Zo denkt een Nederlander. Gefeliciteerd, en gecondoleerd.']
  },
  straattaal: {
    name: 'Straattaal', color: '#E87500', icon: '\ud83c\udfa4', vibe: 'Casual, street-smart',
    passiveComments: {
      cloze: ['STRAATTAAL — Yo, dit is gewoon basic Nederlands man. Je kent dit toch?', 'STRAATTAAL — Check, dit woord hoor je op straat. Niet alleen in boeken.', 'STRAATTAAL — Easy. Gewoon logisch nadenken, niet te moeilijk doen.'],
      wordorder: ['STRAATTAAL — Bro, gewoon zeggen hoe je het hoort. Nederlands is niet zo strict als ze zeggen.', 'STRAATTAAL — Chill. Zet de woorden neer zoals het voelt. Gevoel is key.'],
      headline: ['STRAATTAAL — NOS schrijft altijd zo fancy. Maar de kern is simpel.', 'STRAATTAAL — Krantentaal is anders dan spreektaal. Maar je snapt de vibe.']
    },
    failComments: ['STRAATTAAL — Auw. Dat was niet het moment, gap. Volgende keer beter.', 'STRAATTAAL — Ey, happens. Niet stressen. Gewoon opnieuw proberen.', 'STRAATTAAL — Niet chill, maar ook niet het einde van de wereld.'],
    successComments: ['STRAATTAAL — Yesss, maat! Dat was clean. Respect.', 'STRAATTAAL — Easy money! Je hebt het gewoon door, man.', 'STRAATTAAL — Lekker bezig! Je klinkt al als een local.']
  },
  bureaucratisch: {
    name: 'Bureaucratisch Geduld', color: '#666', icon: '\ud83d\udccb', vibe: 'Patient, formal',
    passiveComments: {
      cloze: ['BUREAUCRATISCH GEDULD — Neem de tijd. Lees de zin opnieuw. Er is geen haast bij nauwkeurigheid.', 'BUREAUCRATISCH GEDULD — Overweeg alle opties zorgvuldig voordat u een keuze maakt.', 'BUREAUCRATISCH GEDULD — Dit type formulering komt voor op officiële documenten. Herken het patroon.'],
      wordorder: ['BUREAUCRATISCH GEDULD — De juiste volgorde is als een goed ingevuld formulier: alles op de juiste plek.', 'BUREAUCRATISCH GEDULD — Systematisch aanpakken. Eerst het onderwerp, dan het werkwoord, dan de rest.'],
      headline: ['BUREAUCRATISCH GEDULD — Officiële berichtgeving volgt vaste conventies. Observeer het patroon.', 'BUREAUCRATISCH GEDULD — Geduld. De kop bevat alle informatie die u nodig heeft.']
    },
    failComments: ['BUREAUCRATISCH GEDULD — Geen nood. Dit formulier kunt u opnieuw indienen.', 'BUREAUCRATISCH GEDULD — Uw aanvraag is helaas afgewezen. U kunt binnen 6 weken bezwaar maken.', 'BUREAUCRATISCH GEDULD — Noteer het juiste antwoord voor uw administratie.'],
    successComments: ['BUREAUCRATISCH GEDULD — Uw aanvraag is goedgekeurd. Bewaar dit bewijs zorgvuldig.', 'BUREAUCRATISCH GEDULD — Correct ingevuld. U ontvangt hiervan een bevestiging per post.', 'BUREAUCRATISCH GEDULD — Goed. Het systeem werkt als u het systeem volgt.']
  }
};

const DE_THOUGHTS = [
  { id: 'doe-normaal', name: 'Doe Maar Normaal', desc: 'Dan doe je al gek genoeg. Accepteer de Nederlandse nuchterheid.', bonus: { skill: 'cultureel', amount: 1 }, unlockSkill: 'cultureel', unlockLevel: 3 },
  { id: 'gezelligheid', name: 'Gezelligheid', desc: 'Het onvertaalbare concept. Je begint het te voelen.', bonus: { skill: 'woordenschat', amount: 1 }, unlockSkill: 'woordenschat', unlockLevel: 3 },
  { id: 'poldermodel', name: 'Poldermodel', desc: 'Consensus is heilig. Elke mening telt. Vergaderingen duren eeuwig.', bonus: { skill: 'bureaucratisch', amount: 1 }, unlockSkill: 'bureaucratisch', unlockLevel: 3 },
  { id: 'stamppot', name: 'Stamppot Filosofie', desc: 'In eenvoud schuilt kracht. Aardappelen, groente, worst. Meer heb je niet nodig.', bonus: { skill: 'grammatica', amount: 1 }, unlockSkill: 'grammatica', unlockLevel: 3 },
  { id: 'fiets-zen', name: 'Fiets-Zen', desc: 'Wind in je haar, regen op je gezicht. De fiets is meditatie.', bonus: { skill: 'straattaal', amount: 1 }, unlockSkill: 'straattaal', unlockLevel: 3 }
];

const SPEL_SCENARIOS = [
  {
    location: 'Gemeente Loket 7B',
    icon: '&#127963;',
    npc: 'Ambtenaar Jansen',
    primarySkill: 'bureaucratisch',
    secondarySkill: 'grammatica',
    introTemplate: 'Je staat al 47 minuten in de rij bij het gemeentehuis. Het nummertje in je hand is nat van het zweet. Op het scherm boven de balie verschijnt het nieuws: <em>{headline}</em>. Ambtenaar Jansen kijkt je aan over haar leesbrillenglazen.',
    dialogueTemplates: [
      'Ambtenaar Jansen — "Formulier 27B is niet correct ingevuld. Kunt u het volgende invullen?"',
      'Ambtenaar Jansen — "Heeft u ook een kopie van uw verblijfsdocument? En kunt u deze zin afmaken?"',
      'Ambtenaar Jansen — "Ik zie dat u nog een formulier mist. Lees dit bericht en vul het gat in."'
    ],
    correctReactions: ['Ambtenaar Jansen knikt goedkeurend. "Uitstekend. Nog maar zes formulieren te gaan."', 'Ze stempelt krachtig op uw formulier. "Volgende stap."', '"Goed zo. U begint het Nederlandse systeem te begrijpen."'],
    wrongReactions: ['Ambtenaar Jansen zucht diep. "Dit is het verkeerde woord. Ik moet nu mijn pauze nemen."', '"Nee. Nee nee nee. Heeft u de taalcursus wel afgerond?"', 'Ze schuift uw formulier terug. "Probeer het nog eens. Loket 7B sluit over 3 minuten."']
  },
  {
    location: 'Albert Heijn Zelfscankassa',
    icon: '&#128722;',
    npc: 'De Zelfscankassa',
    primarySkill: 'woordenschat',
    secondarySkill: 'straattaal',
    introTemplate: 'De zelfscankassa piept boos. Achter je groeit de rij. Op het scherm naast de kassa scrollt het nieuws voorbij: <em>{headline}</em>. De machine eist je aandacht.',
    dialogueTemplates: [
      'Zelfscankassa — "ONVERWACHT ARTIKEL IN VERPAKZONE. Lees het scherm en bevestig:"',
      'Medewerker — "Ik kom even helpen. Kunt u dit woord lezen op het scherm?"',
      'Zelfscankassa — "BONUSKAART NIET HERKEND. Beantwoord de vraag om door te gaan:"'
    ],
    correctReactions: ['De kassa piept vrolijk. Je bonuskorting is geactiveerd!', 'De medewerker glimlacht. "U heeft het door! Fijne dag."', 'De machine accepteert je antwoord. De rij achter je applaudisseert zachtjes.'],
    wrongReactions: ['STORING! STORING! Een rode lamp begint te knipperen boven je hoofd.', 'De medewerker trekt een wenkbrauw op. "Dat staat er toch niet?"', 'De kassa weigert. De persoon achter je zucht hoorbaar.']
  },
  {
    location: 'Huisarts Wachtkamer',
    icon: '&#127973;',
    npc: 'Dokter Van der Berg',
    primarySkill: 'grammatica',
    secondarySkill: 'bureaucratisch',
    introTemplate: 'De wachtkamer ruikt naar koffie en bezorgdheid. Op de televisie in de hoek loopt NOS Journaal: <em>{headline}</em>. Na 40 minuten wachten voor een afspraak van 10 minuten roept de huisarts je naam.',
    dialogueTemplates: [
      'Dokter Van der Berg — "Vertel, wat zijn uw klachten? Maak deze zin af:"',
      'Dokter Van der Berg — "Hmm, ik begrijp het. Kunt u het volgende beschrijven?"',
      'Dokter Van der Berg — "Neemt u twee keer per dag een paracetamol. Nog één vraag:"'
    ],
    correctReactions: ['"Heel goed uitgelegd. Ik schrijf een recept voor."', '"Duidelijk! Dat klinkt als een standaard geval."', '"Precies. Komt u over twee weken terug als het niet beter wordt."'],
    wrongReactions: ['"Hmm, dat klinkt... ongebruikelijk. Neemt u toch maar paracetamol."', '"Dat is medisch gezien niet... een woord. Maar goed, paracetamol."', 'De dokter kijkt bezorgd. "Misschien toch even een taalcursus naast de paracetamol?"']
  },
  {
    location: 'NS Intercity naar Den Haag',
    icon: '&#128646;',
    npc: 'Conducteur Pietersen',
    primarySkill: 'cultureel',
    secondarySkill: 'woordenschat',
    introTemplate: 'De trein vertrekt met 12 minuten vertraging. "Reizigers, uw aandacht alstublieft," klinkt het door de speakers. Op de trein-TV: <em>{headline}</em>. De conducteur loopt door het gangpad.',
    dialogueTemplates: [
      'Conducteur — "Mag ik uw OV-chipkaart zien? En kunt u dit omroepbericht begrijpen?"',
      'Omroep — "Reizigers opgelet. In verband met de situatie verzoeken wij u het volgende:"',
      'Conducteur — "We hebben helaas vertraging. Kunt u dit lezen op het informatiebord?"'
    ],
    correctReactions: ['"Dank u wel. Goede reis!" De conducteur loopt tevreden door.', 'Je begrijpt de omroep. Medereizgigers kijken jaloers.', '"Ah, u spreekt Nederlands! Dan snapt u ook waarom we weer vertraging hebben."'],
    wrongReactions: ['"Hmm, misschien moet u in de stiltecoupe gaan zitten en studeren."', 'De trein stopt onverwacht. Toeval? Of je fout?', '"Volgende keer pak de bus. Die heeft tenminste ondertiteling."']
  },
  {
    location: 'Fietsenkelder Centraal Station',
    icon: '&#128690;',
    npc: 'Beheerder Kees',
    primarySkill: 'straattaal',
    secondarySkill: 'cultureel',
    introTemplate: 'Je dwaalt al 15 minuten door de fietsenkelder. 5000 identieke fietsen staren je aan. Boven de uitgang hangt een krant met de kop: <em>{headline}</em>. Beheerder Kees ziet je verdwaalde blik.',
    dialogueTemplates: [
      'Kees — "Etiket kwijt? Dat hebben we vaker. Lees dit bordje even:"',
      'Kees — "Uw fiets staat in vak G-247. Maar eerst moet u dit begrijpen:"',
      'Bordje — "FIETSEN DIE LANGER DAN 28 DAGEN STAAN WORDEN VERWIJDERD." Kees vraagt:'
    ],
    correctReactions: ['"Goed gelezen! Uw fiets staat drie rijen verderop."', 'Kees wijst de weg. "Ziet u? Nederlands is makkelijk. Fietsen terugvinden niet."', '"Precies! U bent hier nu officieel een Nederlander."'],
    wrongReactions: ['"Fout! Uw fiets is nu van de gemeente."', 'Kees schudt zijn hoofd. "Dit is waarom we bordjes in drie talen zetten."', '"Nee. Uw stallingkosten lopen ondertussen wel door, hè."']
  },
  {
    location: 'Bij Buurman Henk',
    icon: '&#127968;',
    npc: 'Buurman Henk',
    primarySkill: 'cultureel',
    secondarySkill: 'grammatica',
    introTemplate: 'Het is 22:01. Buurman Henk staat voor je deur in zijn ochtendjas. Hij heeft een officieel uitziende brief en de krant bij zich. "Heb je het nieuws gezien?" vraagt hij. <em>{headline}</em>.',
    dialogueTemplates: [
      'Henk — "Ik heb een klachtenbrief geschreven aan de VvE. Kun je dit even nalezen?"',
      'Henk — "Het gaat om geluidsoverlast. Wat denk je van deze zin?"',
      'Henk — "Ik wil dit naar de gemeente sturen. Is dit correct Nederlands?"'
    ],
    correctReactions: ['"Uitstekend! Jij bent beter in Nederlands dan mijn kinderen."', 'Henk glimlacht voor het eerst in maanden. "Misschien valt het best mee met nieuwe buren."', '"Dank je. Als beloning: morgen geen klacht over jouw muziek."'],
    wrongReactions: ['"Nee! Dit kan ik niet naar de VvE sturen. Mijn reputatie!"', 'Henk klapt de deur dicht. Je hoort hem mompelen over "de taalverloedering."', '"Tja. Dan stuur ik het maar in het Engels. De schande."']
  },
  {
    location: 'Vrijdagmiddagborrel',
    icon: '&#127866;',
    npc: 'Collega Sophie',
    primarySkill: 'straattaal',
    secondarySkill: 'woordenschat',
    introTemplate: 'Het is vrijdag 16:00. Het hele kantoor verzamelt zich rond de bitterballen. Iemand heeft NOS open op het grote scherm: <em>{headline}</em>. Collega Sophie draait zich naar je toe met een biertje.',
    dialogueTemplates: [
      'Sophie — "Heb je dat gelezen? Wat vind jij? Maak deze zin af:"',
      'Sophie — "Gek hè? Maar goed, kun je dit even in het Nederlands zeggen?"',
      'Sophie — "Haha, typisch Nederlands toch? Nog eentje: wat betekent dit?"'
    ],
    correctReactions: ['"Wow, jouw Nederlands wordt echt goed! Nog een bitterbal?"', 'Sophie is onder de indruk. "Je klinkt bijna als een Nederlander! Bijna."', '"Kijk! Je bent al geïntegreerd. Proost!"'],
    wrongReactions: ['"Eh... niet helemaal. Maar neem nog een bitterbal, dat helpt altijd."', 'Sophie lacht. "Leuk geprobeerd! Ga nog even oefenen dit weekend."', '"Haha, dat is ook een antwoord. Niet het juiste, maar wel grappig."']
  },
  {
    location: 'Albert Cuyp Markt',
    icon: '&#127859;',
    npc: 'Marktkoopman Dirk',
    primarySkill: 'woordenschat',
    secondarySkill: 'cultureel',
    introTemplate: 'De Albert Cuypmarkt is vol en luid. Tussen de stroopwafels en kibbeling hangt een poster met de kop: <em>{headline}</em>. Marktkoopman Dirk roept je toe van achter zijn kraam.',
    dialogueTemplates: [
      'Dirk — "Drie euro vijftig! Maar als je deze zin kunt afmaken, twee euro!"',
      'Dirk — "Vers van vandaag! Kun je lezen wat er op het bordje staat?"',
      'Dirk — "Proeven mag! Maar vertel me eerst in goed Nederlands:"'
    ],
    correctReactions: ['"Keurig! Voor jou twee euro. Je bent een echte Amsterdammer!"', 'Dirk gooit er een extra haring bij. "Taalknobel!"', '"Perfecto! Eh, ik bedoel: perfect! Dat is dan drie vijftig. Korting was gisteren."'],
    wrongReactions: ['"Nee! Vier euro. Foutje is duurder."', 'Dirk draait zich naar de volgende klant. "VERSE HARING! Iemand die wél Nederlands spreekt?"', '"Haha, nee. Maar ik geef je gratis taalles bij elke stroopwafel."']
  }
];

const DUTCH_WORD_POOL = {
  verbs: ['hebben', 'zijn', 'worden', 'kunnen', 'zullen', 'moeten', 'mogen', 'willen', 'gaan', 'komen', 'maken', 'zien', 'geven', 'nemen', 'vinden', 'denken', 'zeggen', 'doen', 'staan', 'lopen', 'zitten', 'liggen', 'lezen', 'schrijven', 'eten', 'drinken', 'slapen', 'werken', 'wonen', 'kopen', 'betalen', 'wachten', 'beginnen', 'proberen', 'vergeten', 'leren'],
  nouns: ['huis', 'fiets', 'trein', 'water', 'brood', 'kaas', 'straat', 'stad', 'land', 'school', 'werk', 'geld', 'tijd', 'jaar', 'dag', 'mens', 'vrouw', 'man', 'kind', 'boek', 'brief', 'deur', 'auto', 'bureau', 'kamer', 'buurman', 'dokter', 'koffie', 'bier', 'markt', 'winkel', 'station', 'museum', 'koning', 'minister'],
  adjectives: ['groot', 'klein', 'goed', 'slecht', 'mooi', 'lelijk', 'oud', 'nieuw', 'jong', 'lang', 'kort', 'duur', 'goedkoop', 'warm', 'koud', 'druk', 'stil', 'snel', 'langzaam', 'leuk', 'moeilijk', 'makkelijk', 'belangrijk', 'mogelijk', 'nodig', 'klaar', 'bekend', 'vreemd', 'eigen', 'eerste'],
  prepositions: ['in', 'op', 'aan', 'met', 'van', 'voor', 'door', 'uit', 'naar', 'bij', 'om', 'over', 'onder', 'tussen', 'zonder', 'tegen', 'tijdens', 'na', 'tot', 'sinds']
};

const SPEL_DIFFICULTY = {
  easy: { blanks: 1, choices: 3, hint: 'translation', timer: 0, xp: 10, scenes: 2 },
  medium: { blanks: 2, choices: 4, hint: 'firstletter', timer: 30, xp: 20, scenes: 3 },
  hard: { blanks: 3, choices: 0, hint: 'none', timer: 15, xp: 35, scenes: 4 }
};

let spelState = {
  score: 0,
  round: 0,
  sceneIdx: 0,
  beatIndex: 0,
  difficulty: null,
  currentArticle: null,
  currentScenario: null,
  challenges: [],
  totalCorrect: 0,
  totalChallenges: 0,
  timerInterval: null,
  dialogueLog: [],
  skillLevels: { grammatica: 0, woordenschat: 0, cultureel: 0, straattaal: 0, bureaucratisch: 0 },
  thoughtCabinet: [],
  activeThought: null
};

let spelHighScore = 0;
try { spelHighScore = parseInt(localStorage.getItem('dutchquest_spel_highscore')) || 0; } catch(e) {}

function loadSpelState() {
  try {
    const saved = JSON.parse(localStorage.getItem('dutchquest_de_state'));
    if (saved) {
      if (saved.skillLevels) spelState.skillLevels = saved.skillLevels;
      if (saved.thoughtCabinet) spelState.thoughtCabinet = saved.thoughtCabinet;
      if (saved.activeThought) spelState.activeThought = saved.activeThought;
      if (saved.round) spelState.round = saved.round;
    }
  } catch(e) {}
}

function saveSpelState() {
  try {
    localStorage.setItem('dutchquest_de_state', JSON.stringify({
      skillLevels: spelState.skillLevels,
      thoughtCabinet: spelState.thoughtCabinet,
      activeThought: spelState.activeThought,
      round: spelState.round
    }));
  } catch(e) {}
}

function initSpel() {
  loadSpelState();
  renderSkillOverview();
  renderThoughtCabinet();
}

function setSpelDifficulty(diff) {
  spelState.difficulty = diff;
  document.querySelectorAll('.spel-diff-btn').forEach(b => {
    b.classList.toggle('active', b.dataset.diff === diff);
  });
  document.getElementById('spelStartBtn').disabled = false;
}

function extractSentences(text) {
  if (!text) return [];
  const clean = text.replace(/<[^>]+>/g, ' ').replace(/&[^;]+;/g, ' ').replace(/\s+/g, ' ').trim();
  const parts = clean.split(/(?<=[.!?])\s+/);
  return parts.filter(s => {
    const words = s.trim().split(/\s+/);
    return words.length >= 4 && words.length <= 30;
  }).map(s => s.trim());
}

function classifyWord(word) {
  const lower = word.toLowerCase();
  if (DUTCH_WORD_POOL.prepositions.includes(lower)) return 'prepositions';
  if (DUTCH_WORD_POOL.verbs.some(v => lower === v || lower.startsWith(v.slice(0, -2)))) return 'verbs';
  if (DUTCH_WORD_POOL.adjectives.includes(lower)) return 'adjectives';
  if (lower.length >= 4) return 'nouns';
  return null;
}

function pickDistractors(word, count) {
  const type = classifyWord(word) || 'nouns';
  const pool = DUTCH_WORD_POOL[type] || DUTCH_WORD_POOL.nouns;
  const lower = word.toLowerCase();
  const candidates = pool.filter(w => w !== lower);
  return shuffle(candidates).slice(0, count);
}

function generateCloze(sentence, numBlanks) {
  const words = sentence.split(/\s+/);
  const candidates = [];
  for (let i = 1; i < words.length; i++) {
    const clean = words[i].replace(/[^a-zA-Z\u00C0-\u017F]/g, '');
    if (clean.length >= 3) candidates.push({ idx: i, word: clean });
  }
  if (candidates.length === 0) return null;
  const selected = shuffle(candidates).slice(0, Math.min(numBlanks, candidates.length));
  selected.sort((a, b) => a.idx - b.idx);
  const blanks = [];
  const display = [...words];
  selected.forEach((sel, blankIdx) => {
    const punctuation = words[sel.idx].replace(sel.word, '');
    display[sel.idx] = '___' + punctuation;
    const distractors = pickDistractors(sel.word, (spelState.difficulty === 'easy' ? 2 : 3));
    blanks.push({ word: sel.word, options: shuffle([sel.word, ...distractors]), idx: sel.idx, blankIdx: blankIdx });
  });
  return { display: display.join(' '), blanks: blanks, sentence: sentence };
}

function generateWordOrder(sentence) {
  const clean = sentence.replace(/[.!?]+$/, '').trim();
  const words = clean.split(/\s+/).filter(w => w.length > 0);
  if (words.length < 3 || words.length > 12) return null;
  const correct = words.join(' ');

  // Generate 2 wrong orderings + the correct one
  const options = [correct];
  for (let attempt = 0; attempt < 20 && options.length < 3; attempt++) {
    const shuffled = shuffle([...words]).join(' ');
    if (shuffled !== correct && !options.includes(shuffled)) {
      options.push(shuffled);
    }
  }
  // Fallback: if we couldn't get 3 distinct options, add simple swaps
  while (options.length < 3) {
    const w = [...words];
    const i = Math.floor(Math.random() * (w.length - 1));
    [w[i], w[i + 1]] = [w[i + 1], w[i]];
    const s = w.join(' ');
    if (!options.includes(s)) options.push(s);
    else options.push(w.reverse().join(' '));
  }
  return { correct: correct, options: shuffle(options) };
}

function generateHeadlineCompletion(title) {
  const words = title.split(/\s+/);
  if (words.length < 3) return null;
  const removeCount = words.length > 5 ? 2 : 1;
  const removed = words.splice(-removeCount);
  const answer = removed.join(' ');
  const partial = words.join(' ') + ' ___';
  const distractors = pickDistractors(removed[0], (spelState.difficulty === 'easy' ? 2 : 3));
  const options = shuffle([answer, ...distractors.map(d => removeCount > 1 ? d + ' ' + (removed[1] || '') : d)]);
  return { display: partial, answer: answer, options: options };
}

function generateChallenges(article, scenarioLen) {
  const sentences = extractSentences(article.desc);
  const titleSentences = extractSentences(article.title);
  const allSentences = [...sentences, ...titleSentences];
  const diff = SPEL_DIFFICULTY[spelState.difficulty];
  const challenges = [];
  for (let i = 0; i < scenarioLen; i++) {
    const type = i === 0 ? 'headline' : (i % 2 === 1 ? 'cloze' : 'wordorder');
    if (type === 'headline') {
      const hc = generateHeadlineCompletion(article.title);
      if (hc) { challenges.push({ type: 'headline', data: hc }); continue; }
    }
    if (type === 'cloze' || challenges.length <= i) {
      const sent = allSentences[i % Math.max(allSentences.length, 1)];
      if (sent) {
        const cloze = generateCloze(sent, diff.blanks);
        if (cloze && cloze.blanks.length > 0) { challenges.push({ type: 'cloze', data: cloze }); continue; }
      }
    }
    if (type === 'wordorder' || challenges.length <= i) {
      const sent = allSentences[(i + 1) % Math.max(allSentences.length, 1)];
      if (sent) {
        const wo = generateWordOrder(sent);
        if (wo) { challenges.push({ type: 'wordorder', data: wo }); continue; }
      }
    }
    if (challenges.length <= i && allSentences.length > 0) {
      const fallbackSent = allSentences[Math.floor(Math.random() * allSentences.length)];
      const cloze = generateCloze(fallbackSent, diff.blanks);
      if (cloze && cloze.blanks.length > 0) challenges.push({ type: 'cloze', data: cloze });
    }
  }
  return challenges;
}

// === DIALOGUE ENGINE ===

function appendDialogue(type, content, skillKey) {
  const log = document.getElementById('deDialogueLog');
  const entry = document.createElement('div');
  entry.className = 'de-entry ' + type;

  if (type === 'skill-voice' && skillKey && DE_SKILLS[skillKey]) {
    const skill = DE_SKILLS[skillKey];
    entry.style.borderLeftColor = skill.color;
    entry.style.background = skill.color + '08';
    entry.innerHTML = '<span style="color:' + skill.color + ';font-weight:700;">' + skill.icon + ' ' + skill.name.toUpperCase() + '</span> — ' + content;
  } else if (type === 'npc') {
    const parts = content.split(' — ');
    if (parts.length >= 2) {
      entry.innerHTML = '<span class="de-speaker">' + parts[0] + '</span>' + parts.slice(1).join(' — ');
    } else {
      entry.textContent = content;
    }
  } else {
    entry.innerHTML = content;
  }

  log.appendChild(entry);
  spelState.dialogueLog.push({ type, content });

  return new Promise(resolve => {
    setTimeout(() => { log.scrollTop = log.scrollHeight; resolve(); }, 500);
  });
}

function renderChoices(choices) {
  const panel = document.getElementById('deChoices');
  panel.style.display = '';
  panel.innerHTML = '';
  choices.forEach(choice => {
    const btn = document.createElement('button');
    btn.className = 'de-choice-btn';
    let label = '';
    if (choice.badge) {
      const skill = DE_SKILLS[choice.badge.skill];
      const color = skill ? skill.color : '#666';
      label += '<span class="de-check-badge" style="color:' + color + ';border-color:' + color + ';">' + (choice.badge.label || '') + '</span>';
    }
    label += choice.text;
    btn.innerHTML = label;
    btn.onclick = choice.action;
    panel.appendChild(btn);
  });
}

function clearChoices() {
  const panel = document.getElementById('deChoices');
  panel.style.display = 'none';
  panel.innerHTML = '';
}

function pickSkillComment(skillKey, challengeType, mode) {
  const skill = DE_SKILLS[skillKey];
  if (!skill) return null;
  if (mode === 'passive') {
    const pool = skill.passiveComments[challengeType] || skill.passiveComments.cloze;
    return pool[Math.floor(Math.random() * pool.length)];
  }
  const pool = mode === 'success' ? skill.successComments : skill.failComments;
  return pool[Math.floor(Math.random() * pool.length)];
}

function advanceSkill(skillKey, amount) {
  spelState.skillLevels[skillKey] = Math.min(5, (spelState.skillLevels[skillKey] || 0) + amount);
  // Apply active thought bonus
  if (spelState.activeThought) {
    const thought = DE_THOUGHTS.find(t => t.id === spelState.activeThought);
    if (thought && thought.bonus.skill === skillKey) {
      spelState.skillLevels[skillKey] = Math.min(5, spelState.skillLevels[skillKey] + 0.1);
    }
  }
  saveSpelState();
  updateHudSkills();
  checkThoughtUnlocks();
}

function resolveSkillCheck(skillKey, isCorrect) {
  advanceSkill(skillKey, isCorrect ? 0.5 : 0.25);
}

function checkThoughtUnlocks() {
  DE_THOUGHTS.forEach(thought => {
    const level = spelState.skillLevels[thought.unlockSkill] || 0;
    if (level >= thought.unlockLevel && !spelState.thoughtCabinet.includes(thought.id)) {
      spelState.thoughtCabinet.push(thought.id);
      saveSpelState();
    }
  });
}

// === SKILL OVERVIEW & THOUGHT CABINET UI ===

function renderSkillOverview() {
  const container = document.getElementById('deSkillRows');
  if (!container) return;
  let html = '';
  Object.keys(DE_SKILLS).forEach(key => {
    const skill = DE_SKILLS[key];
    const level = spelState.skillLevels[key] || 0;
    const pct = Math.min((level / 5) * 100, 100);
    html += '<div class="de-skill-row">';
    html += '<span class="skill-icon">' + skill.icon + '</span>';
    html += '<span class="skill-name">' + skill.name + '</span>';
    html += '<div class="de-skill-bar"><div class="de-skill-bar-fill" style="width:' + pct + '%;background:' + skill.color + ';"></div></div>';
    html += '<span class="skill-level">' + level.toFixed(1) + '</span>';
    html += '</div>';
  });
  container.innerHTML = html;
}

function renderThoughtCabinet() {
  const grid = document.getElementById('deThoughtGrid');
  if (!grid) return;
  let html = '';
  DE_THOUGHTS.forEach(thought => {
    const unlocked = spelState.thoughtCabinet.includes(thought.id);
    const active = spelState.activeThought === thought.id;
    const cls = 'de-thought-card' + (unlocked ? '' : ' locked') + (active ? ' active' : '');
    const onclick = unlocked ? ' onclick="equipThought(\'' + thought.id + '\')"' : '';
    html += '<div class="' + cls + '"' + onclick + '>';
    html += '<div class="thought-name">' + (unlocked ? thought.name : '???') + '</div>';
    html += '<div class="thought-desc">' + (unlocked ? thought.desc : 'Bereik niveau ' + thought.unlockLevel + ' in ' + DE_SKILLS[thought.unlockSkill].name) + '</div>';
    if (unlocked) {
      const bonusSkill = DE_SKILLS[thought.bonus.skill];
      html += '<div class="thought-bonus" style="color:' + bonusSkill.color + ';">+' + thought.bonus.amount + ' ' + bonusSkill.name + '</div>';
    }
    html += '</div>';
  });
  grid.innerHTML = html;
}

function equipThought(id) {
  spelState.activeThought = spelState.activeThought === id ? null : id;
  saveSpelState();
  renderThoughtCabinet();
}

// === HUD ===

function updateHud() {
  const scenario = spelState.currentScenario;
  if (!scenario) return;
  document.getElementById('deHudLocation').innerHTML = '<span class="loc-icon">' + scenario.icon + '</span>' + scenario.location + ' — Ronde ' + spelState.round;
  document.getElementById('deHudXp').textContent = '\u2b50 ' + spelState.score + ' XP';
  updateHudSkills();
}

function updateHudSkills() {
  const container = document.getElementById('deHudSkills');
  if (!container) return;
  let html = '';
  Object.keys(DE_SKILLS).forEach(key => {
    const s = DE_SKILLS[key];
    const lvl = (spelState.skillLevels[key] || 0).toFixed(1);
    html += '<span class="de-hud-pip" title="' + s.name + ': ' + lvl + '" style="border-color:' + s.color + ';">' + s.icon + '</span>';
  });
  container.innerHTML = html;
}

// === TIMER ===

function startDeTimer(seconds) {
  const bar = document.getElementById('deTimerBar');
  const fill = document.getElementById('deTimerFill');
  bar.style.display = '';
  fill.style.width = '100%';
  fill.className = 'de-timer-fill';
  let remaining = seconds;
  spelState.timerInterval = setInterval(() => {
    remaining--;
    const pct = (remaining / seconds) * 100;
    fill.style.width = pct + '%';
    if (pct < 25) fill.className = 'de-timer-fill danger';
    else if (pct < 50) fill.className = 'de-timer-fill warning';
    if (remaining <= 0) {
      clearInterval(spelState.timerInterval);
      spelState.timerInterval = null;
      deTimerExpired();
    }
  }, 1000);
}

function deTimerExpired() {
  clearChoices();
  const scenario = spelState.currentScenario;
  const reactionIdx = spelState.sceneIdx % scenario.wrongReactions.length;
  appendDialogue('result-fail', '<strong>Tijd is op!</strong> ' + scenario.wrongReactions[reactionIdx]);
  resolveSkillCheck(scenario.primarySkill, false);
  setTimeout(() => advanceDialogueBeat(), 600);
}

// === CHALLENGE → DIALOGUE CONVERSION ===

function renderChallengeAsChoices(challenge) {
  const scenario = spelState.currentScenario;
  const primarySkill = scenario.primarySkill;
  const settings = SPEL_DIFFICULTY[spelState.difficulty];
  const diffLabel = spelState.difficulty === 'easy' ? 'Makkelijk' : spelState.difficulty === 'medium' ? 'Gemiddeld' : 'Moeilijk';

  if (challenge.type === 'cloze') {
    // Show sentence as narrator text
    appendDialogue('narrator', challenge.data.display).then(() => {
      if (challenge.data.blanks.length > 0) {
        renderClozeBlankChoices(challenge, 0, primarySkill, diffLabel);
      }
    });
  } else if (challenge.type === 'wordorder') {
    appendDialogue('narrator', 'Zet de woorden in de juiste volgorde:').then(() => {
      const choices = challenge.data.options.map(opt => ({
        text: opt,
        badge: { skill: primarySkill, label: DE_SKILLS[primarySkill].name + ' \u2014 ' + diffLabel },
        action: function() { handleWordOrderChoice(opt, challenge.data.correct, primarySkill); }
      }));
      renderChoices(choices);
      if (settings.timer > 0) startDeTimer(settings.timer);
    });
  } else if (challenge.type === 'headline') {
    appendDialogue('narrator', 'Maak de kop af: <strong>' + challenge.data.display + '</strong>').then(() => {
      const choices = challenge.data.options.map(opt => ({
        text: opt,
        badge: { skill: primarySkill, label: DE_SKILLS[primarySkill].name + ' \u2014 ' + diffLabel },
        action: function() { handleHeadlineChoice(opt, challenge.data.answer, primarySkill); }
      }));
      renderChoices(choices);
      if (settings.timer > 0) startDeTimer(settings.timer);
    });
  }
}

function renderClozeBlankChoices(challenge, blankIdx, primarySkill, diffLabel) {
  const blank = challenge.data.blanks[blankIdx];
  if (!blank) {
    // All blanks done — check results
    const allCorrect = challenge._results ? challenge._results.every(r => r) : false;
    const correctCount = challenge._results ? challenge._results.filter(r => r).length : 0;
    finishDeChallenge(allCorrect, correctCount, challenge.data.blanks.length);
    return;
  }
  if (!challenge._results) challenge._results = [];
  const settings = SPEL_DIFFICULTY[spelState.difficulty];

  const choices = blank.options.map(opt => ({
    text: opt,
    badge: { skill: primarySkill, label: DE_SKILLS[primarySkill].name + ' \u2014 ' + diffLabel },
    action: function() {
      const isCorrect = opt.toLowerCase() === blank.word.toLowerCase();
      challenge._results.push(isCorrect);
      clearChoices();
      appendDialogue('player', '"' + opt + '"').then(() => {
        if (isCorrect) {
          appendDialogue('result-success', 'Correct! Het woord is: <strong>' + blank.word + '</strong>');
        } else {
          appendDialogue('result-fail', 'Helaas! Het juiste woord was: <strong>' + blank.word + '</strong>');
        }
        resolveSkillCheck(primarySkill, isCorrect);
        setTimeout(() => {
          if (blankIdx < challenge.data.blanks.length - 1) {
            renderClozeBlankChoices(challenge, blankIdx + 1, primarySkill, diffLabel);
          } else {
            const allCorrect = challenge._results.every(r => r);
            const correctCount = challenge._results.filter(r => r).length;
            finishDeChallenge(allCorrect, correctCount, challenge.data.blanks.length);
          }
        }, 400);
      });
    }
  }));

  renderChoices(choices);
  if (settings.timer > 0 && blankIdx === 0) startDeTimer(settings.timer);
}

function handleWordOrderChoice(chosen, correct, primarySkill) {
  clearChoices();
  if (spelState.timerInterval) { clearInterval(spelState.timerInterval); spelState.timerInterval = null; }
  document.getElementById('deTimerBar').style.display = 'none';

  const isCorrect = chosen === correct;
  appendDialogue('player', '"' + chosen + '"').then(() => {
    if (isCorrect) {
      appendDialogue('result-success', 'Goed! De juiste volgorde.');
    } else {
      appendDialogue('result-fail', 'Niet helemaal. De juiste volgorde: <strong>' + correct + '</strong>');
    }
    resolveSkillCheck(primarySkill, isCorrect);
    finishDeChallenge(isCorrect, isCorrect ? 1 : 0, 1);
  });
}

function handleHeadlineChoice(chosen, correct, primarySkill) {
  clearChoices();
  if (spelState.timerInterval) { clearInterval(spelState.timerInterval); spelState.timerInterval = null; }
  document.getElementById('deTimerBar').style.display = 'none';

  const isCorrect = chosen.toLowerCase().trim() === correct.toLowerCase().trim();
  appendDialogue('player', '"' + chosen + '"').then(() => {
    if (isCorrect) {
      appendDialogue('result-success', 'Correct! De volledige kop is juist.');
    } else {
      appendDialogue('result-fail', 'Helaas. Het juiste antwoord: <strong>' + correct + '</strong>');
    }
    resolveSkillCheck(primarySkill, isCorrect);
    finishDeChallenge(isCorrect, isCorrect ? 1 : 0, 1);
  });
}

// === CHALLENGE FINISH + SCENE FLOW ===

function finishDeChallenge(allCorrect, correctCount, total) {
  if (spelState.timerInterval) { clearInterval(spelState.timerInterval); spelState.timerInterval = null; }
  document.getElementById('deTimerBar').style.display = 'none';

  const scenario = spelState.currentScenario;
  const settings = SPEL_DIFFICULTY[spelState.difficulty];
  const idx = spelState.sceneIdx;

  if (allCorrect) {
    spelState.totalCorrect++;
    const earned = settings.xp;
    spelState.score += earned;
    addXP(earned);
  }

  // NPC reaction
  const reactionIdx = idx % (allCorrect ? scenario.correctReactions.length : scenario.wrongReactions.length);
  const reaction = allCorrect ? scenario.correctReactions[reactionIdx] : scenario.wrongReactions[reactionIdx];

  // Skill voice commentary
  const commentSkill = allCorrect ? scenario.primarySkill : scenario.secondarySkill;
  const commentMode = allCorrect ? 'success' : 'fail';
  const comment = pickSkillComment(commentSkill, spelState.challenges[idx].type, commentMode);

  appendDialogue('npc', scenario.npc + ' — "' + reaction + '"').then(() => {
    if (comment) {
      return appendDialogue('skill-voice', comment, commentSkill);
    }
  }).then(() => {
    if (allCorrect) {
      appendDialogue('narrator', '<em>+' + settings.xp + ' XP</em>');
    }
    document.getElementById('deHudXp').textContent = '\u2b50 ' + spelState.score + ' XP';

    setTimeout(() => advanceDialogueBeat(), 600);
  });
}

function advanceDialogueBeat() {
  spelState.sceneIdx++;
  const isLast = spelState.sceneIdx >= spelState.challenges.length;
  if (isLast) {
    showDeDialogueSummary();
  } else {
    playDialogueBeat(spelState.sceneIdx);
  }
}

async function playDialogueBeat(beatIndex) {
  const scenario = spelState.currentScenario;
  const article = spelState.currentArticle;
  const challenge = spelState.challenges[beatIndex];

  if (!challenge) { showDeDialogueSummary(); return; }

  // NPC dialogue
  const dialogueIdx = beatIndex % scenario.dialogueTemplates.length;
  await appendDialogue('npc', scenario.dialogueTemplates[dialogueIdx]);

  // Maybe skill voice from secondary skill (70% chance)
  if (Math.random() < 0.7) {
    const skillKey = beatIndex % 2 === 0 ? scenario.primarySkill : scenario.secondarySkill;
    const comment = pickSkillComment(skillKey, challenge.type, 'passive');
    if (comment) {
      await new Promise(r => setTimeout(r, 400));
      await appendDialogue('skill-voice', comment, skillKey);
    }
  }

  await new Promise(r => setTimeout(r, 300));
  renderChallengeAsChoices(challenge);
}

// === START ROUND ===

async function startSpelRound() {
  const diff = spelState.difficulty;
  if (!diff) return;

  if (!nosFeedCache || nosFeedCache.length === 0) {
    document.getElementById('spelStartBtn').textContent = 'Nieuws laden...';
    document.getElementById('spelStartBtn').disabled = true;
    await new Promise((resolve) => {
      const check = setInterval(() => {
        if (nosFeedCache && nosFeedCache.length > 0) { clearInterval(check); resolve(); }
      }, 500);
      fetchNOSFeed();
      setTimeout(() => { clearInterval(check); resolve(); }, 12000);
    });
    if (!nosFeedCache || nosFeedCache.length === 0) {
      document.getElementById('spelStartBtn').textContent = 'Start Avontuur';
      document.getElementById('spelStartBtn').disabled = false;
      alert('Kon geen NOS-artikelen laden. Controleer je internet en probeer het opnieuw.');
      return;
    }
  }

  const article = nosFeedCache[Math.floor(Math.random() * nosFeedCache.length)];
  const scenario = SPEL_SCENARIOS[Math.floor(Math.random() * SPEL_SCENARIOS.length)];
  const settings = SPEL_DIFFICULTY[diff];
  const challenges = generateChallenges(article, settings.scenes);

  spelState.currentArticle = article;
  spelState.currentScenario = scenario;
  spelState.challenges = challenges;
  spelState.sceneIdx = 0;
  spelState.score = 0;
  spelState.totalCorrect = 0;
  spelState.totalChallenges = challenges.length;
  spelState.dialogueLog = [];
  spelState.round++;

  // Show game area, hide difficulty picker
  document.getElementById('spelDifficultyBar').style.display = 'none';
  document.getElementById('spelGameArea').style.display = '';

  // Clear dialogue log
  document.getElementById('deDialogueLog').innerHTML = '';
  clearChoices();

  // Update HUD
  updateHud();

  // Source attribution
  if (article.link) {
    document.getElementById('spelSource').innerHTML = 'Bron: <a href="' + article.link + '" target="_blank" rel="noopener">NOS.nl</a>';
  }

  // Beat 0: intro
  const narrative = scenario.introTemplate.replace('{headline}', article.title);
  await appendDialogue('narrator', narrative);
  await new Promise(r => setTimeout(r, 600));

  // Primary skill passive hint (70% chance)
  if (Math.random() < 0.7 && challenges.length > 0) {
    const comment = pickSkillComment(scenario.primarySkill, challenges[0].type, 'passive');
    if (comment) {
      await appendDialogue('skill-voice', comment, scenario.primarySkill);
      await new Promise(r => setTimeout(r, 400));
    }
  }

  // First NPC dialogue + challenge
  const dialogueIdx = 0;
  await appendDialogue('npc', scenario.dialogueTemplates[dialogueIdx]);
  await new Promise(r => setTimeout(r, 300));

  if (challenges.length > 0) {
    renderChallengeAsChoices(challenges[0]);
  } else {
    showDeDialogueSummary();
  }
}

// === SUMMARY IN DIALOGUE ===

function showDeDialogueSummary() {
  if (spelState.timerInterval) { clearInterval(spelState.timerInterval); spelState.timerInterval = null; }
  document.getElementById('deTimerBar').style.display = 'none';

  const total = spelState.totalChallenges;
  const correct = spelState.totalCorrect;
  const pct = total > 0 ? correct / total : 0;
  const stars = pct >= 0.9 ? 5 : pct >= 0.7 ? 4 : pct >= 0.5 ? 3 : pct >= 0.3 ? 2 : 1;

  if (spelState.score > spelHighScore) {
    spelHighScore = spelState.score;
    try { localStorage.setItem('dutchquest_spel_highscore', spelHighScore); } catch(e) {}
  }

  const starsStr = '\u2b50'.repeat(stars) + '\u2606'.repeat(5 - stars);
  const messages = [
    'Je overleeft het Nederlandse systeem... met moeite.',
    'Je begint de Nederlandse cultuur te begrijpen!',
    'De ambtenaren zijn onder de indruk.',
    'Je bent bijna een echte Nederlander!',
    'Fenomenaal! Zelfs buurman Henk zou trots zijn.'
  ];

  appendDialogue('narrator', '<br>' + starsStr + '<br><strong>' + spelState.score + ' XP</strong><br>' + correct + '/' + total + ' correct \u2022 Hoogste score: ' + spelHighScore + '<br><em>"' + messages[stars - 1] + '"</em>').then(() => {
    renderChoices([
      { text: 'Volgend artikel \u2192', action: function() { clearChoices(); startSpelRound(); } },
      { text: 'Terug naar menu', action: function() { clearChoices(); resetSpelToMenu(); } }
    ]);
  });

  saveSpelState();
  renderSkillOverview();
  renderThoughtCabinet();
}

function resetSpelToMenu() {
  if (spelState.timerInterval) { clearInterval(spelState.timerInterval); spelState.timerInterval = null; }
  document.getElementById('spelGameArea').style.display = 'none';
  document.getElementById('spelDifficultyBar').style.display = '';
  renderSkillOverview();
  renderThoughtCabinet();
}

</script>
</body>
</html>
